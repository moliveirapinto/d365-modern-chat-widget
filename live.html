<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self' https://*.microsoft.com https://*.azure.com https://*.dynamics.com https://*.crm.dynamics.com https://*.github.io;
        script-src 'self' 'unsafe-inline' 'unsafe-eval' https://*.microsoft.com https://*.azure.com https://*.azureedge.net https://oc-cdn-ocprod.azureedge.net https://moliveirapinto.github.io https://*.github.io https://unpkg.com https://www.googletagmanager.com https://www.clarity.ms;
        style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://*.azureedge.net https://oc-cdn-ocprod.azureedge.net;
        style-src-elem 'self' 'unsafe-inline' https://fonts.googleapis.com https://*.azureedge.net https://oc-cdn-ocprod.azureedge.net;
        font-src 'self' https://fonts.gstatic.com https://*.azureedge.net;
        img-src 'self' data: blob: https: *;
        frame-src 'self' https://*.omnichannelengagementhub.com https://*.azureedge.net https://oc-cdn-ocprod.azureedge.net https://forms.office.com https://*.forms.office.com https://*.microsoft.com;
        connect-src 'self' https://*.microsoft.com https://*.azure.com https://*.dynamics.com https://*.omnichannelengagementhub.com https://*.skype.com wss://*.skype.com https://*.azureedge.net wss://*.omnichannelengagementhub.com https://*.communication.azure.com wss://*.communication.azure.com https://www.google-analytics.com https://region1.google-analytics.com https://*.clarity.ms https://d365-widget-analytics.mauricio-o-pinto.workers.dev;
        worker-src 'self' blob:;
    ">
    <title>Modern Chat Widget - Live Demo</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZP59BHHH9F"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-ZP59BHHH9F');
    </script>
    
    <!-- Microsoft Clarity -->
    <script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "uopnw0l7a1");
    </script>
    
    <!-- Google Fonts for widget customization -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;500;600&family=Crimson+Text:wght@400;600&family=DM+Sans:wght@400;500;600&family=Fira+Code:wght@400;500&family=Fira+Sans:wght@400;500;600&family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400;500&family=Lato:wght@400;700&family=Lexend:wght@400;500;600&family=Libre+Baskerville:wght@400;700&family=Lora:wght@400;500;600&family=Manrope:wght@400;500;600&family=Merriweather:wght@400;700&family=Montserrat:wght@400;500;600&family=Nunito:wght@400;600;700&family=Open+Sans:wght@400;600&family=Outfit:wght@400;500;600&family=Playfair+Display:wght@400;500;600&family=Plus+Jakarta+Sans:wght@400;500;600&family=Poppins:wght@400;500;600&family=Quicksand:wght@400;500;600&family=Raleway:wght@400;500;600&family=Righteous&family=Roboto:wght@400;500&family=Rubik:wght@400;500;600&family=Source+Code+Pro:wght@400;500&family=Source+Sans+Pro:wght@400;600&family=Ubuntu:wght@400;500;700&family=Work+Sans:wght@400;500;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #667eea;
            --primary-dark: #5a67d8;
            --gradient-start: #667eea;
            --gradient-end: #764ba2;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--gradient-start) 0%, var(--gradient-end) 100%);
            min-height: 100vh;
            overflow: hidden;
            position: relative;
        }

        /* Background pattern overlay */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 25% 25%, rgba(255,255,255,0.1) 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, rgba(255,255,255,0.05) 0%, transparent 50%);
            pointer-events: none;
        }

        /* Center content container */
        .demo-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 40px 20px;
            position: relative;
            z-index: 1;
        }

        /* Main content card */
        .demo-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 48px;
            max-width: 600px;
            width: 100%;
            text-align: center;
            box-shadow: 
                0 25px 50px -12px rgba(0, 0, 0, 0.25),
                0 0 0 1px rgba(255, 255, 255, 0.1);
        }

        /* Logo/Icon */
        .demo-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--gradient-start) 0%, var(--gradient-end) 100%);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 24px;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .demo-icon svg {
            width: 44px;
            height: 44px;
            fill: white;
        }

        .demo-title {
            font-size: 32px;
            font-weight: 700;
            color: #1a202c;
            margin-bottom: 12px;
            letter-spacing: -0.5px;
        }

        .demo-subtitle {
            font-size: 18px;
            color: #4a5568;
            margin-bottom: 32px;
            line-height: 1.6;
        }

        /* Feature list */
        .features {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 32px;
            text-align: left;
        }

        .feature {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: #f7fafc;
            border-radius: 12px;
            transition: all 0.2s ease;
        }

        .feature:hover {
            background: #edf2f7;
            transform: translateX(4px);
        }

        .feature-icon {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, var(--gradient-start) 0%, var(--gradient-end) 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .feature-icon svg {
            width: 20px;
            height: 20px;
            fill: white;
        }

        .feature-text {
            font-size: 14px;
            font-weight: 500;
            color: #2d3748;
        }

        /* CTA text */
        .cta-text {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 16px 24px;
            background: linear-gradient(135deg, #f0f4ff 0%, #faf5ff 100%);
            border-radius: 12px;
            border: 2px dashed #c3dafe;
        }

        .cta-arrow {
            width: 32px;
            height: 32px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: bounce 2s ease-in-out infinite;
        }

        .cta-arrow svg {
            width: 18px;
            height: 18px;
            fill: white;
        }

        @keyframes bounce {
            0%, 100% { transform: translateX(0); }
            50% { transform: translateX(8px); }
        }

        .cta-text span {
            font-size: 15px;
            font-weight: 600;
            color: var(--primary-dark);
        }

        /* No config notice */
        .no-config-notice {
            display: none;
            margin-top: 24px;
            padding: 16px;
            background: #fff5f5;
            border: 1px solid #feb2b2;
            border-radius: 12px;
            color: #c53030;
            font-size: 14px;
        }

        .no-config-notice.show {
            display: block;
        }

        .no-config-notice a {
            color: #c53030;
            font-weight: 600;
        }

        /* Footer */
        .demo-footer {
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid #e2e8f0;
        }

        .demo-footer-text {
            font-size: 13px;
            color: #718096;
        }

        .demo-footer-text a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
        }

        .demo-footer-text a:hover {
            text-decoration: underline;
        }

        /* Responsive */
        @media (max-width: 640px) {
            .demo-card {
                padding: 32px 24px;
            }
            
            .demo-title {
                font-size: 24px;
            }
            
            .demo-subtitle {
                font-size: 16px;
            }
            
            .features {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <div class="demo-card">
            <div class="demo-icon">
                <svg viewBox="0 0 24 24">
                    <path d="M9.56158 3C5.41944 3 2.06158 6.35786 2.06158 10.5C2.06158 11.6329 2.31325 12.7088 2.76423 13.6734C2.5102 14.6714 2.22638 15.7842 2.03999 16.5147C1.80697 17.428 2.6294 18.2588 3.54374 18.039C4.29396 17.8587 5.44699 17.5819 6.47447 17.337C7.41678 17.7631 8.46241 18 9.56158 18C13.7037 18 17.0616 14.6421 17.0616 10.5C17.0616 6.35786 13.7037 3 9.56158 3ZM3.56158 10.5C3.56158 7.18629 6.24787 4.5 9.56158 4.5C12.8753 4.5 15.5616 7.18629 15.5616 10.5C15.5616 13.8137 12.8753 16.5 9.56158 16.5C8.60084 16.5 7.69487 16.2748 6.89161 15.8749L6.6482 15.7537L6.38368 15.8167C5.46095 16.0363 4.39489 16.2919 3.59592 16.4838C3.79467 15.7047 4.05784 14.6724 4.28601 13.7757L4.35619 13.4998L4.22568 13.2468C3.80145 12.4246 3.56158 11.4914 3.56158 10.5ZM14.5616 21.0001C12.5922 21.0001 10.8001 20.241 9.46191 18.9995C9.49511 18.9999 9.52835 19.0001 9.56163 19.0001C10.2796 19.0001 10.9768 18.911 11.6427 18.7434C12.5067 19.2254 13.5021 19.5001 14.5616 19.5001C15.5223 19.5001 16.4283 19.2748 17.2316 18.8749L17.475 18.7537L17.7395 18.8167C18.6611 19.0361 19.7046 19.2625 20.4162 19.4262C20.2412 18.6757 20.0025 17.6711 19.7747 16.7757L19.7045 16.4999L19.835 16.2469C20.2592 15.4247 20.4991 14.4915 20.4991 13.5001C20.4991 11.3853 19.4051 9.52617 17.7521 8.45761C17.5738 7.73435 17.3028 7.04756 16.9525 6.41052C19.8898 7.42684 21.9991 10.2171 21.9991 13.5001C21.9991 14.6332 21.7473 15.7094 21.2961 16.6741C21.5492 17.6821 21.8054 18.774 21.9679 19.4773C22.1723 20.3623 21.3929 21.1633 20.5005 20.9768C19.7733 20.8248 18.6308 20.581 17.587 20.3367C16.6445 20.763 15.5986 21.0001 14.5616 21.0001Z"/>
                </svg>
            </div>
            
            <h1 class="demo-title">Modern Chat Widget</h1>
            <p class="demo-subtitle">Experience our beautiful, customizable chat widget connected to Dynamics 365 Customer Service.</p>
            
            <div class="features">
                <div class="feature">
                    <div class="feature-icon">
                        <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
                    </div>
                    <span class="feature-text">Real-time messaging</span>
                </div>
                <div class="feature">
                    <div class="feature-icon">
                        <svg viewBox="0 0 24 24"><path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9c.83 0 1.5-.67 1.5-1.5 0-.39-.15-.74-.39-1.01-.23-.26-.38-.61-.38-.99 0-.83.67-1.5 1.5-1.5H16c2.76 0 5-2.24 5-5 0-4.42-4.03-8-9-8zm-5.5 9c-.83 0-1.5-.67-1.5-1.5S5.67 9 6.5 9 8 9.67 8 10.5 7.33 12 6.5 12zm3-4C8.67 8 8 7.33 8 6.5S8.67 5 9.5 5s1.5.67 1.5 1.5S10.33 8 9.5 8zm5 0c-.83 0-1.5-.67-1.5-1.5S13.67 5 14.5 5s1.5.67 1.5 1.5S15.33 8 14.5 8zm3 4c-.83 0-1.5-.67-1.5-1.5S16.67 9 17.5 9s1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/></svg>
                    </div>
                    <span class="feature-text">Fully customizable</span>
                </div>
                <div class="feature">
                    <div class="feature-icon">
                        <svg viewBox="0 0 24 24"><path d="M17 1.01L7 1c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99zM17 19H7V5h10v14z"/></svg>
                    </div>
                    <span class="feature-text">Mobile responsive</span>
                </div>
                <div class="feature">
                    <div class="feature-icon">
                        <svg viewBox="0 0 24 24"><path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/></svg>
                    </div>
                    <span class="feature-text">Secure & reliable</span>
                </div>
            </div>
            
            <div class="cta-text">
                <span>Click the chat button to start a conversation</span>
                <div class="cta-arrow">
                    <svg viewBox="0 0 24 24"><path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"/></svg>
                </div>
            </div>
            
            <div class="no-config-notice" id="noConfigNotice">
                <strong>‚ö†Ô∏è No widget configured.</strong><br>
                Please configure your widget in the <a href="index.html">Chat Widget Studio</a> first, then return here to test it.
            </div>
            
            <div class="demo-footer">
                <p class="demo-footer-text">
                    Built with ‚ù§Ô∏è for Dynamics 365 Customer Service<br>
                    <a href="index.html">Open Widget Studio</a> ¬∑ <a href="https://github.com/moliveirapinto/d365-modern-chat-widget" target="_blank">View on GitHub</a>
                </p>
            </div>
        </div>
    </div>

    <script>
        // Widget Loading - Same pattern as industry templates (healthcare.html, retail.html, etc.)
        function loadWidget() {
            const urlParams = new URLSearchParams(window.location.search);
            const configParam = urlParams.get('config');
            
            let config = null;
            
            // First, try to get config from URL parameter
            if (configParam) {
                try {
                    config = JSON.parse(decodeURIComponent(configParam));
                    console.log('üìã Live Demo: Loaded widget config from URL parameter');
                } catch (e) {
                    console.error('Failed to parse config from URL:', e);
                }
            }
            
            // If no URL config, try localStorage
            if (!config) {
                const savedSettings = localStorage.getItem('chatWidgetSettings');
                if (savedSettings) {
                    try {
                        config = JSON.parse(savedSettings);
                        console.log('üéØ Live Demo: Loaded widget config from localStorage:', {
                            widgetId: config.widgetId,
                            orgId: config.orgId,
                            orgUrl: config.orgUrl
                        });
                    } catch (e) {
                        console.error('Failed to parse saved settings:', e);
                    }
                }
            }

            if (config) {
                const widgetMode = config.widgetMode || 'custom';
                console.log('üéõÔ∏è Widget mode:', widgetMode);

                if (widgetMode === 'custom') {
                    console.log('‚úÖ Custom widget mode - loading embedded SDK directly');
                    
                    // Set global config for the widget
                    window.D365WidgetConfig = {
                        orgId: config.orgId,
                        orgUrl: config.orgUrl,
                        widgetId: config.widgetId
                    };
                    
                    // Copy all customization settings
                    if (config.headerTitle) window.D365WidgetConfig.headerTitle = config.headerTitle;
                    if (config.headerSubtitle) window.D365WidgetConfig.headerSubtitle = config.headerSubtitle;
                    if (config.headerTitleColor) window.D365WidgetConfig.headerTitleColor = config.headerTitleColor;
                    if (config.headerSubtitleColor) window.D365WidgetConfig.headerSubtitleColor = config.headerSubtitleColor;
                    if (config.headerLogo) window.D365WidgetConfig.headerLogo = config.headerLogo;
                    if (config.fontFamily) window.D365WidgetConfig.fontFamily = config.fontFamily;
                    if (config.useGradient !== undefined) window.D365WidgetConfig.useGradient = config.useGradient;
                    if (config.useBubbleGradient !== undefined) window.D365WidgetConfig.useBubbleGradient = config.useBubbleGradient;
                    if (config.gradientStart) window.D365WidgetConfig.gradientStart = config.gradientStart;
                    if (config.gradientEnd) window.D365WidgetConfig.gradientEnd = config.gradientEnd;
                    if (config.primaryColor) window.D365WidgetConfig.primaryColor = config.primaryColor;
                    if (config.userBubbleColor) window.D365WidgetConfig.userBubbleColor = config.userBubbleColor;
                    if (config.userTextColor) window.D365WidgetConfig.userTextColor = config.userTextColor;
                    if (config.agentBubbleColor) window.D365WidgetConfig.agentBubbleColor = config.agentBubbleColor;
                    if (config.agentTextColor) window.D365WidgetConfig.agentTextColor = config.agentTextColor;
                    if (config.chatBgColor) window.D365WidgetConfig.chatBgColor = config.chatBgColor;
                    if (config.launcherColor) window.D365WidgetConfig.launcherColor = config.launcherColor;
                    if (config.launcherIcon) window.D365WidgetConfig.launcherIcon = config.launcherIcon;
                    if (config.badgeColor) window.D365WidgetConfig.badgeColor = config.badgeColor;
                    if (config.sendBtnColor) window.D365WidgetConfig.sendBtnColor = config.sendBtnColor;
                    if (config.agentAvatar) window.D365WidgetConfig.agentAvatar = config.agentAvatar;
                    if (config.customerAvatar) window.D365WidgetConfig.customerAvatar = config.customerAvatar;
                    if (config.botAvatar) window.D365WidgetConfig.botAvatar = config.botAvatar;
                    if (config.enablePrechatForm !== undefined) window.D365WidgetConfig.enablePrechatForm = config.enablePrechatForm;
                    if (config.welcomeTitle) window.D365WidgetConfig.welcomeTitle = config.welcomeTitle;
                    if (config.welcomeMessage) window.D365WidgetConfig.welcomeMessage = config.welcomeMessage;
                    if (config.usePrechatGradient !== undefined) window.D365WidgetConfig.usePrechatGradient = config.usePrechatGradient;
                    if (config.prechatSolidColor) window.D365WidgetConfig.prechatSolidColor = config.prechatSolidColor;
                    if (config.prechatGradientStart) window.D365WidgetConfig.prechatGradientStart = config.prechatGradientStart;
                    if (config.prechatGradientEnd) window.D365WidgetConfig.prechatGradientEnd = config.prechatGradientEnd;
                    if (config.prechatTitleColor) window.D365WidgetConfig.prechatTitleColor = config.prechatTitleColor;
                    if (config.prechatSubtitleColor) window.D365WidgetConfig.prechatSubtitleColor = config.prechatSubtitleColor;
                    
                    // Pre-chat Hero Colors (additional)
                    if (config.prechatBadgeBg) window.D365WidgetConfig.prechatBadgeBg = config.prechatBadgeBg;
                    if (config.prechatBadgeText) window.D365WidgetConfig.prechatBadgeText = config.prechatBadgeText;
                    if (config.prechatStatusDot) window.D365WidgetConfig.prechatStatusDot = config.prechatStatusDot;
                    if (config.prechatAvatarBorder) window.D365WidgetConfig.prechatAvatarBorder = config.prechatAvatarBorder;
                    
                    // Pre-chat Form Labels (Localization)
                    if (config.nameFieldLabel) window.D365WidgetConfig.nameFieldLabel = config.nameFieldLabel;
                    if (config.nameFieldPlaceholder) window.D365WidgetConfig.nameFieldPlaceholder = config.nameFieldPlaceholder;
                    if (config.emailFieldLabel) window.D365WidgetConfig.emailFieldLabel = config.emailFieldLabel;
                    if (config.emailFieldPlaceholder) window.D365WidgetConfig.emailFieldPlaceholder = config.emailFieldPlaceholder;
                    if (config.questionFieldLabel) window.D365WidgetConfig.questionFieldLabel = config.questionFieldLabel;
                    if (config.questionFieldPlaceholder) window.D365WidgetConfig.questionFieldPlaceholder = config.questionFieldPlaceholder;
                    if (config.startBtnText) window.D365WidgetConfig.startBtnText = config.startBtnText;
                    
                    // Localization & Time Settings
                    if (config.timeFormat) window.D365WidgetConfig.timeFormat = config.timeFormat;
                    if (config.textConnecting) window.D365WidgetConfig.textConnecting = config.textConnecting;
                    if (config.textChatEndedTitle) window.D365WidgetConfig.textChatEndedTitle = config.textChatEndedTitle;
                    if (config.textChatEndedMessage) window.D365WidgetConfig.textChatEndedMessage = config.textChatEndedMessage;
                    if (config.textStartNewChat) window.D365WidgetConfig.textStartNewChat = config.textStartNewChat;
                    if (config.textEndChatTitle) window.D365WidgetConfig.textEndChatTitle = config.textEndChatTitle;
                    if (config.textEndChatMessage) window.D365WidgetConfig.textEndChatMessage = config.textEndChatMessage;
                    if (config.textCancelButton) window.D365WidgetConfig.textCancelButton = config.textCancelButton;
                    if (config.textEndChatButton) window.D365WidgetConfig.textEndChatButton = config.textEndChatButton;
                    if (config.textInputPlaceholder) window.D365WidgetConfig.textInputPlaceholder = config.textInputPlaceholder;
                    
                    console.log('üì¶ Widget config set:', window.D365WidgetConfig);
                    
                    // Log all color settings for debugging
                    console.log('üé® Color settings:', {
                        userBubbleColor: window.D365WidgetConfig.userBubbleColor,
                        gradientStart: window.D365WidgetConfig.gradientStart,
                        gradientEnd: window.D365WidgetConfig.gradientEnd,
                        primaryColor: window.D365WidgetConfig.primaryColor,
                        launcherColor: window.D365WidgetConfig.launcherColor,
                        sendBtnColor: window.D365WidgetConfig.sendBtnColor
                    });
                    
                    // Load the embedded widget SDK from CDN with cache busting
                    const script = document.createElement('script');
                    const cacheBuster = new Date().getTime();
                    script.src = 'https://moliveirapinto.github.io/d365-modern-chat-widget/dist/widget-core.js?v=' + cacheBuster;
                    script.onload = function() {
                        console.log('‚úÖ Widget SDK loaded successfully');
                    };
                    script.onerror = function() {
                        console.error('‚ùå Failed to load widget SDK from CDN');
                    };
                    document.head.appendChild(script);
                    
                } else if (widgetMode === 'standard') {
                    // Standard D365 LCW widget mode
                    if (config.lcwCode) {
                        console.log('‚úÖ Loading standard D365 LCW widget from embed code');
                        
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(config.lcwCode, 'text/html');
                        const scriptTag = doc.querySelector('script[id="Microsoft_Omnichannel_LCWidget"]');
                        
                        if (scriptTag) {
                            const lcwScript = document.createElement('script');
                            lcwScript.id = 'Microsoft_Omnichannel_LCWidget';
                            lcwScript.src = scriptTag.getAttribute('src');
                            lcwScript.setAttribute('data-app-id', scriptTag.getAttribute('data-app-id'));
                            lcwScript.setAttribute('data-org-id', scriptTag.getAttribute('data-org-id'));
                            lcwScript.setAttribute('data-org-url', scriptTag.getAttribute('data-org-url'));
                            document.head.appendChild(lcwScript);
                            console.log('‚úÖ D365 LCW widget script injected');
                            
                            window.addEventListener("lcw:ready", function handleLivechatReadyEvent() {
                                console.log('‚úÖ LCW Ready on live demo');
                                
                                if (config.enableStandardAuth === true && typeof Microsoft !== 'undefined') {
                                    Microsoft.Omnichannel.LiveChatWidget.SDK.setContextProvider(function contextProvider() {
                                        const authName = config.standardAuthName || 'Anonymous User';
                                        const authEmail = config.standardAuthEmail || 'anonymous@example.com';
                                        console.log('üîí Using auto-authentication:', { authName, authEmail });
                                        
                                        return {
                                            'emailaddress1': authEmail,
                                            'Name': { value: authName, isDisplayable: true },
                                            'Authenticated': { value: 'Authenticated', isDisplayable: true }
                                        };
                                    });
                                }
                            });
                        } else {
                            console.error('‚ùå Could not parse LCW code - invalid format');
                        }
                    } else if (config.widgetId && config.orgId && config.orgUrl) {
                        console.log('‚úÖ Building LCW widget from individual D365 values');
                        
                        const lcwScript = document.createElement('script');
                        lcwScript.id = 'Microsoft_Omnichannel_LCWidget';
                        lcwScript.src = 'https://oc-cdn-ocprod.azureedge.net/livechatwidget/scripts/LiveChatBootstrapper.js';
                        lcwScript.setAttribute('data-app-id', config.widgetId);
                        lcwScript.setAttribute('data-org-id', config.orgId);
                        lcwScript.setAttribute('data-org-url', config.orgUrl);
                        document.head.appendChild(lcwScript);
                        console.log('‚úÖ D365 LCW widget loaded with:', {
                            appId: config.widgetId,
                            orgId: config.orgId,
                            orgUrl: config.orgUrl
                        });
                        
                        window.addEventListener("lcw:ready", function handleLivechatReadyEvent() {
                            console.log('‚úÖ LCW Ready on live demo');
                            
                            if (config.enableStandardAuth === true && typeof Microsoft !== 'undefined') {
                                Microsoft.Omnichannel.LiveChatWidget.SDK.setContextProvider(function contextProvider() {
                                    const authName = config.standardAuthName || 'Anonymous User';
                                    const authEmail = config.standardAuthEmail || 'anonymous@example.com';
                                    return {
                                        'emailaddress1': authEmail,
                                        'Name': { value: authName, isDisplayable: true },
                                        'Authenticated': { value: 'Authenticated', isDisplayable: true }
                                    };
                                });
                            }
                        });
                    } else {
                        console.warn('‚ö†Ô∏è Standard mode requires lcwCode OR (widgetId + orgId + orgUrl)');
                        document.getElementById('noConfigNotice').classList.add('show');
                    }
                }
            } else {
                console.log('‚ÑπÔ∏è No widget configuration found. Configure in Chat Widget Studio first and save.');
                document.getElementById('noConfigNotice').classList.add('show');
            }
        }

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            loadWidget();
        });
    </script>
</body>
</html>
