<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D365 Chat Widget Bookmarklet Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 800px;
            width: 100%;
            padding: 40px;
        }

        h1 {
            color: #2d3748;
            margin-bottom: 10px;
            font-size: 32px;
        }

        .subtitle {
            color: #718096;
            margin-bottom: 30px;
            font-size: 16px;
        }

        .step {
            background: #f7fafc;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
        }

        .step-number {
            display: inline-block;
            background: #667eea;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            text-align: center;
            line-height: 32px;
            font-weight: bold;
            margin-right: 12px;
        }

        .step h2 {
            display: inline-block;
            color: #2d3748;
            font-size: 20px;
            margin-bottom: 12px;
        }

        .step p {
            color: #4a5568;
            line-height: 1.6;
            margin-top: 12px;
        }

        .bookmarklet-link {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 16px 32px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
            font-size: 18px;
            margin: 20px 0;
            cursor: move;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .bookmarklet-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .bookmarklet-link:active {
            transform: translateY(0);
        }

        .instruction {
            background: #fff5e1;
            border: 2px dashed #f59e0b;
            padding: 16px;
            border-radius: 8px;
            margin: 16px 0;
            color: #92400e;
        }

        .instruction strong {
            color: #78350f;
        }

        .video-demo {
            margin: 20px 0;
            text-align: center;
        }

        .video-demo img {
            max-width: 100%;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .alert {
            background: #ebf8ff;
            border-left: 4px solid #3182ce;
            padding: 16px;
            border-radius: 8px;
            margin: 20px 0;
            color: #2c5282;
        }

        .alert-icon {
            display: inline-block;
            margin-right: 8px;
        }

        code {
            background: #2d3748;
            color: #81e6d9;
            padding: 2px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }

        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin: 20px 0;
        }

        .feature {
            background: white;
            border: 2px solid #e2e8f0;
            padding: 16px;
            border-radius: 8px;
            text-align: center;
        }

        .feature-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .feature h3 {
            color: #2d3748;
            font-size: 16px;
            margin-bottom: 4px;
        }

        .feature p {
            color: #718096;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ D365 Chat Widget Injector</h1>
        <p class="subtitle">Inject your customized chat widget into ANY website you're browsing</p>

        <div class="alert">
            <span class="alert-icon">‚ÑπÔ∏è</span>
            <strong>How it works:</strong> This bookmarklet loads your chat widget settings from localStorage and injects the widget into whatever page you're currently viewing. No CSP restrictions!
        </div>

        <div class="step">
            <span class="step-number">1</span>
            <h2>Drag this button to your bookmarks bar</h2>
            <p>Click and drag the button below to your browser's bookmarks bar (press <code>Ctrl+Shift+B</code> if you don't see it)</p>
            
            <div style="text-align: center; margin: 20px 0;">
                <a href="javascript:void(0)" class="bookmarklet-link" id="bookmarkletLink" onclick="return false;">
                    üí¨ D365 Chat Widget
                </a>
            </div>

            <div class="instruction">
                <strong>üìå Can't drag?</strong> Right-click the button ‚Üí "Add to Bookmarks Bar" (or "Bookmark This Link")
            </div>
        </div>

        <div class="step">
            <span class="step-number">2</span>
            <h2>Configure your widget</h2>
            <p>First, customize your chat widget in <a href="admin.html" target="_blank" style="color: #667eea; font-weight: bold;">admin.html</a> and save your settings. Your configuration is stored in your browser's localStorage.</p>
        </div>

        <div class="step">
            <span class="step-number">3</span>
            <h2>Browse to any website</h2>
            <p>Navigate to <strong>any website</strong> where you want to demo your chat widget:</p>
            <ul style="margin-left: 40px; margin-top: 8px; color: #4a5568;">
                <li>Your company website</li>
                <li>A staging/test environment</li>
                <li>Any public website (Patagonia, Amazon, etc.)</li>
                <li>Even a local HTML file</li>
            </ul>
        </div>

        <div class="step">
            <span class="step-number">4</span>
            <h2>Click the bookmarklet</h2>
            <p>Once on your target site, click the <strong>"üí¨ D365 Chat Widget"</strong> bookmark in your bookmarks bar. The chat widget will instantly appear on top of the page!</p>
        </div>

        <div class="features">
            <div class="feature">
                <div class="feature-icon">‚ú®</div>
                <h3>No CSP Issues</h3>
                <p>Works on any site</p>
            </div>
            <div class="feature">
                <div class="feature-icon">üé®</div>
                <h3>Your Settings</h3>
                <p>Uses your admin config</p>
            </div>
            <div class="feature">
                <div class="feature-icon">‚ö°</div>
                <h3>Instant Injection</h3>
                <p>One-click activation</p>
            </div>
            <div class="feature">
                <div class="feature-icon">üîÑ</div>
                <h3>Re-usable</h3>
                <p>Use on multiple sites</p>
            </div>
        </div>

        <div class="alert">
            <span class="alert-icon">üí°</span>
            <strong>Pro Tip:</strong> The widget will remember your settings even when you navigate between pages. Click the bookmark again to refresh the widget with new settings!
        </div>
    </div>

    <script>
        // Generate the bookmarklet code
        function generateBookmarklet() {
            // This is the code that will be injected
            const injectionCode = `
(function() {
    // Check if already loaded
    if (window.d365ChatWidgetInjected) {
        alert('Chat widget is already active on this page!');
        return;
    }
    window.d365ChatWidgetInjected = true;

    // Load settings from localStorage (from the admin page domain)
    let settings = null;
    try {
        // Try to get settings from localStorage
        const savedSettings = localStorage.getItem('chatWidgetSettings');
        if (savedSettings) {
            settings = JSON.parse(savedSettings);
        }
    } catch (e) {
        console.warn('Could not load settings from localStorage:', e);
    }

    // Default settings if none found
    if (!settings) {
        settings = {
            position: 'bottom-right',
            primaryColor: '#0078d4',
            buttonSize: 'medium',
            welcomeMessage: 'Hi! How can I help you today?',
            companyName: 'Company',
            agentName: 'Support Agent'
        };
    }

    // Create the chat widget container
    const widgetContainer = document.createElement('div');
    widgetContainer.id = 'd365-chat-widget-injected';
    widgetContainer.style.cssText = 'position:fixed;' + (settings.position === 'bottom-right' ? 'bottom:20px;right:20px;' : 'bottom:20px;left:20px;') + 'z-index:2147483647;font-family:Segoe UI,Arial,sans-serif;';

    // Create chat button
    const chatButton = document.createElement('button');
    const buttonSizes = { small: '50px', medium: '60px', large: '70px' };
    const buttonSize = buttonSizes[settings.buttonSize] || '60px';
    
    chatButton.style.cssText = \`
        width:\${buttonSize};
        height:\${buttonSize};
        border-radius:50%;
        background:\${settings.primaryColor};
        border:none;
        cursor:pointer;
        box-shadow:0 4px 12px rgba(0,0,0,0.3);
        display:flex;
        align-items:center;
        justify-content:center;
        transition:transform 0.2s,box-shadow 0.2s;
    \`;
    
    chatButton.innerHTML = '<svg width="28" height="28" viewBox="0 0 24 24" fill="white"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/></svg>';
    
    chatButton.onmouseover = () => {
        chatButton.style.transform = 'scale(1.1)';
        chatButton.style.boxShadow = '0 6px 20px rgba(0,0,0,0.4)';
    };
    
    chatButton.onmouseout = () => {
        chatButton.style.transform = 'scale(1)';
        chatButton.style.boxShadow = '0 4px 12px rgba(0,0,0,0.3)';
    };

    // Create chat window
    const chatWindow = document.createElement('div');
    chatWindow.style.cssText = \`
        display:none;
        position:fixed;
        \${settings.position === 'bottom-right' ? 'bottom:100px;right:20px;' : 'bottom:100px;left:20px;'}
        width:350px;
        height:500px;
        background:white;
        border-radius:12px;
        box-shadow:0 8px 32px rgba(0,0,0,0.3);
        z-index:2147483647;
        flex-direction:column;
        overflow:hidden;
    \`;

    // Chat header
    const chatHeader = document.createElement('div');
    chatHeader.style.cssText = \`
        background:\${settings.primaryColor};
        color:white;
        padding:16px;
        display:flex;
        align-items:center;
        justify-content:space-between;
    \`;
    
    chatHeader.innerHTML = \`
        <div style="display:flex;align-items:center;gap:12px;">
            \${settings.companyLogo ? \`<img src="\${settings.companyLogo}" style="width:40px;height:40px;border-radius:50%;object-fit:cover;">\` : ''}
            <div>
                <div style="font-weight:bold;font-size:16px;">\${settings.companyName || 'Chat Support'}</div>
                <div style="font-size:12px;opacity:0.9;">\${settings.agentName || 'Agent'}</div>
            </div>
        </div>
        <button onclick="this.parentElement.parentElement.style.display='none'" style="background:none;border:none;color:white;cursor:pointer;font-size:24px;line-height:1;padding:0;">√ó</button>
    \`;

    // Chat messages area
    const chatMessages = document.createElement('div');
    chatMessages.style.cssText = 'flex:1;overflow-y:auto;padding:16px;background:#f7f7f7;';
    
    // Welcome message
    const welcomeMsg = document.createElement('div');
    welcomeMsg.style.cssText = 'background:white;padding:12px;border-radius:8px;margin-bottom:12px;box-shadow:0 1px 2px rgba(0,0,0,0.1);';
    welcomeMsg.textContent = settings.welcomeMessage || 'Hi! How can I help you today?';
    chatMessages.appendChild(welcomeMsg);

    // Chat input area
    const chatInput = document.createElement('div');
    chatInput.style.cssText = 'padding:16px;background:white;border-top:1px solid #e0e0e0;display:flex;gap:8px;';
    chatInput.innerHTML = \`
        <input type="text" placeholder="Type a message..." style="flex:1;padding:10px;border:1px solid #ccc;border-radius:20px;outline:none;">
        <button style="background:\${settings.primaryColor};color:white;border:none;border-radius:50%;width:40px;height:40px;cursor:pointer;display:flex;align-items:center;justify-content:center;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="white"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
        </button>
    \`;

    chatWindow.appendChild(chatHeader);
    chatWindow.appendChild(chatMessages);
    chatWindow.appendChild(chatInput);

    // Toggle chat window
    chatButton.onclick = () => {
        chatWindow.style.display = chatWindow.style.display === 'none' ? 'flex' : 'none';
    };

    widgetContainer.appendChild(chatButton);
    document.body.appendChild(widgetContainer);
    document.body.appendChild(chatWindow);

    console.log('D365 Chat Widget injected successfully!');
})();
`;

            // Minify and encode for bookmarklet
            const minified = injectionCode
                .replace(/\/\/[^\n]*/g, '') // Remove single-line comments
                .replace(/\/\*[\s\S]*?\*\//g, '') // Remove multi-line comments
                .replace(/\s+/g, ' ') // Collapse whitespace
                .trim();
            
            return 'javascript:' + encodeURIComponent(minified);
        }

        // Set the bookmarklet href
        document.getElementById('bookmarkletLink').href = generateBookmarklet();

        // Add helper text on click
        document.getElementById('bookmarkletLink').addEventListener('click', function(e) {
            e.preventDefault();
            alert('üìå To use this bookmarklet:\n\n1. Drag this button to your bookmarks bar\n   OR\n2. Right-click and select "Bookmark This Link"\n\nThen click it while browsing any website!');
        });
    </script>
</body>
</html>
