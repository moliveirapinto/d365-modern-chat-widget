/*! For license information please see chat-sdk-bundle.js.LICENSE.txt */
(()=>{var e={9:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SDKProvider=void 0;var r=n(8224);t.SDKProvider=r.default},13:(e,t,n)=>{"use strict";var r=n(4994);Object.defineProperty(t,"__esModule",{value:!0}),t.createGetChatTokenEndpoint=void 0;var i=r(n(3693)),o=n(86),s=r(n(8644));t.createGetChatTokenEndpoint=function(e,t,n){var r,a,c=(r={},(0,i.default)(r,o.LiveChatVersion.V1,s.default.LiveChatGetChatTokenPath),(0,i.default)(r,o.LiveChatVersion.V2,s.default.LiveChatv2GetChatTokenPath),(0,i.default)(r,o.LiveChatVersion.V3,s.default.LiveChatv3GetChatTokenPath),r),u=(a={},(0,i.default)(a,o.LiveChatVersion.V1,s.default.LiveChatAuthGetChatTokenPath),(0,i.default)(a,o.LiveChatVersion.V2,s.default.LiveChatv2AuthGetChatTokenPath),(0,i.default)(a,o.LiveChatVersion.V3,s.default.LiveChatv3AuthGetChatTokenPath),a);return n?t?s.default.LiveChatv4AuthGetChatTokenPath:s.default.LiveChatv4GetChatTokenPath:Object.values(o.LiveChatVersion).includes(e)?t?u[e]:c[e]:t?u[o.LiveChatVersion.V2]:c[o.LiveChatVersion.V2]}},44:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getOmnichannelChatSdkVersion=void 0;var r=n(4736);t.getOmnichannelChatSdkVersion=function(){try{var e=n(6517);if(e&&e.version&&"0.0.0-0"!==e.version)return e.version}catch(e){return r.omnichannelChatSdkVersion}return r.omnichannelChatSdkVersion}},70:(e,t,n)=>{"use strict";n.r(t),n.d(t,{calculateRetryDelay:()=>p,cancelablePromiseRace:()=>i,computeSha256Hash:()=>f,computeSha256Hmac:()=>g,createAbortablePromise:()=>s,delay:()=>c,getErrorMessage:()=>u,getRandomIntegerInclusive:()=>m,isBrowser:()=>S,isBun:()=>T,isDefined:()=>l,isDeno:()=>E,isError:()=>v,isNode:()=>b,isNodeLike:()=>I,isNodeRuntime:()=>w,isObject:()=>y,isObjectWithProperties:()=>d,isReactNative:()=>R,isWebWorker:()=>A,objectHasProperty:()=>h,randomUUID:()=>C,stringToUint8Array:()=>k,uint8ArrayToString:()=>O});var r=n(3336);async function i(e,t){const n=new AbortController;function r(){n.abort()}t?.abortSignal?.addEventListener("abort",r);try{return await Promise.race(e.map(e=>e({abortSignal:n.signal})))}finally{n.abort(),t?.abortSignal?.removeEventListener("abort",r)}}class o extends Error{constructor(e){super(e),this.name="AbortError"}}function s(e,t){const{cleanupBeforeAbort:n,abortSignal:r,abortErrorMsg:i}=t??{};return new Promise((t,s)=>{function a(){s(new o(i??"The operation was aborted."))}function c(){r?.removeEventListener("abort",u)}function u(){n?.(),c(),a()}if(r?.aborted)return a();try{e(e=>{c(),t(e)},e=>{c(),s(e)})}catch(e){s(e)}r?.addEventListener("abort",u)})}const a="The delay was aborted.";function c(e,t){let n;const{abortSignal:r,abortErrorMsg:i}=t??{};return s(t=>{n=setTimeout(t,e)},{cleanupBeforeAbort:()=>clearTimeout(n),abortSignal:r,abortErrorMsg:i??a})}function u(e){if((0,r.bJ)(e))return e.message;{let t;try{t="object"==typeof e&&e?JSON.stringify(e):String(e)}catch(e){t="[unable to stringify input]"}return`Unknown error ${t}`}}function l(e){return null!=e}function d(e,t){if(!l(e)||"object"!=typeof e)return!1;for(const n of t)if(!h(e,n))return!1;return!0}function h(e,t){return l(e)&&"object"==typeof e&&t in e}function p(e,t){return r.gE(e,t)}function f(e,t){return r.Z4(e,t)}function g(e,t,n){return r.g8(e,t,n)}function m(e,t){return r.Wq(e,t)}function v(e){return r.bJ(e)}function y(e){return r.Gv(e)}function C(){return r.N4()}const S=r.Bd,T=r.Qg,E=r.N6,b=r.qx,I=r.qx,w=r.tX,R=r.lV,A=r.p7;function O(e,t){return r.SW(e,t)}function k(e,t){return r.Al(e,t)}},79:e=>{e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r},e.exports.__esModule=!0,e.exports.default=e.exports},86:(e,t)=>{"use strict";var n,r,i,o,s,a,c,u;Object.defineProperty(t,"__esModule",{value:!0}),t.SDKError=t.LiveChatVersion=t.OCSDKTelemetryEvent=t.ChannelId=t.OperatingSystem=t.DeviceType=t.Browser=t.BrowserVendor=void 0,t.BrowserVendor=n,function(e){e.IE="IE",e.CHROME="Chrome",e.FIREFOX="Firefox",e.SAFARI="Safari",e.EDGE="Edge",e.EDGE_CHROMIUM="Edg",e.OPERA="Opera",e.UNKNOWN="Unknown"}(n||(t.BrowserVendor=n={})),t.Browser=r,function(e){e[e.Chrome=0]="Chrome",e[e.Firefox=1]="Firefox",e[e.Ie=2]="Ie",e[e.Edge=3]="Edge",e[e.Safari=4]="Safari",e[e.None=5]="None"}(r||(t.Browser=r={})),t.DeviceType=i,function(e){e.Desktop="Desktop",e.Mobile="Mobile",e.Tablet="Tablet"}(i||(t.DeviceType=i={})),t.OperatingSystem=o,function(e){e.WINDOWS="Windows",e.MACOSX="Mac OS X",e.WINDOWS_PHONE="Windows Phone",e.WINDOWS_RT="Windows RT",e.IOS="iOS",e.ANDROID="Android",e.LINUX="Linux",e.UNKNOWN="Unknown"}(o||(t.OperatingSystem=o={})),t.ChannelId=s,function(e){e.LCW="lcw",e.SMS="sms",e.FACEBOOK="facebook",e.WECHAT="wechat"}(s||(t.ChannelId=s={})),t.OCSDKTelemetryEvent=a,function(e){e.GETLCWFCSDETAILSSTARTED="GetLcwFcsDetailsStarted",e.GETLCWFCSDETAILSSUCCEEDED="GetLcwFcsDetailsSucceeded",e.GETLCWFCSDETAILSFAILED="GetLcwFcsDetailsFailed",e.GETCHATCONFIGFSTARTED="GetChatConfig",e.GETCHATCONFIGSUCCEEDED="GetChatConfigSucceeded",e.GETCHATCONFIGFAILED="GetChatConfigFailed",e.GETRECONNECTABLECHATSSTARTED="GetReconnnectableChatsStarted",e.GETRECONNECTABLECHATSSUCCEEDED="GetReconnnectableChatsSucceeded",e.GETRECONNECTABLECHATSFAILED="GetReconnnectableChatsFailed",e.GETRECONNECTAVAILABILITYSUCCEEDED="GetReconnnectableAvailabilitySucceeded",e.GETRECONNECTAVAILABILITYSTARTED="GetReconnnectableAvailabilityStarted",e.GETRECONNECTAVAILABILITYFAILED="GetReconnnectableAvailabilityFailed",e.GETCHATTOKENSTARTED="GetChatTokenStarted",e.GETCHATTOKENSUCCEEDED="GetChatTokenSucceeded",e.GETCHATTOKENFAILED="GetChatTokenFailed",e.GETLWISTATUSSTARTED="GetLwiStatusStarted",e.GETLWISTATUSSUCCEEDED="GetLwiStatusSucceeded",e.GETLWISTATUSFAILED="GetLwiStatusFailed",e.SESSIONINITSTARTED="SessionInitStarted",e.SESSIONINITSUCCEEDED="SessionInitSucceeded",e.SESSIONINITFAILED="SessionInitFailed",e.CREATESESSIONSTARTED="CreateSessionStarted",e.CREATESESSIONSUCCEEDED="CreateSessionSucceeded",e.CREATESESSIONFAILED="CreateSessionFailed",e.SESSIONCLOSESTARTED="SessionCloseStarted",e.SESSIONCLOSESUCCEEDED="SessionCloseSucceeded",e.SESSIONCLOSEFAILED="SessionCloseFailed",e.SUBMITPOSTCHATSTARTED="SubmitPostChatStarted",e.SUBMITPOSTCHATSUCCEEDED="SubmitPostChatSucceeded",e.SUBMITPOSTCHATFAILED="SubmitPostChatFailed",e.GETCHATTRANSCRIPTSTARTED="GetChatTranscriptStarted",e.GETCHATTRANSCRIPTSUCCEEDED="GetChatTranscriptSucceeded",e.GETCHATTRANSCRIPTFAILED="GetChatTranscriptFailed",e.EMAILTRANSCRIPTSTARTED="EmailTranscriptStarted",e.EMAILTRANSCRIPTSUCCEEDED="EmailTranscriptSucceeded",e.EMAILTRANSCRIPTFAILED="EmailTranscriptFailed",e.FETCHDATAMASKINGSTARTED="FetchDataMaskingStarted",e.FETCHDATAMASKINGSUCCEEDED="FetchDataMaskingSucceeded",e.FETCHDATAMASKINGFAILED="FetchDataMaskingFailed",e.SECONDARYCHANNELEVENTREQUESTSTARTED="SecondaryChannelEventRequestStarted",e.SECONDARYCHANNELEVENTREQUESTSUCCEEDED="SecondaryChannelEventRequestSucceeded",e.SECONDARYCHANNELEVENTREQUESTFAILED="SecondaryChannelEventRequestFailed",e.GETSURVEYINVITELINKSTARTED="GetSurveyInviteLinkStarted",e.GETSURVEYINVITELINKSUCCEEDED="GetSurveyInviteLinkSucceeded",e.GETSURVEYINVITELINKFAILED="GetSurveyInviteLinkFailed",e.VALIDATEAUTHCHATRECORDSTARTED="ValidateAuthChatRecordStarted",e.VALIDATEAUTHCHATRECORDSUCCEEDED="ValidateAuthChatRecordSucceeded",e.VALIDATEAUTHCHATRECORDFAILED="ValidateAuthChatRecordFailed",e.GETAGENTAVAILABILITYSTARTED="GetAgentAvailabilityStarted",e.GETAGENTAVAILABILITYSUCCEEDED="GetAgentAvailabilitySucceeded",e.GETAGENTAVAILABILITYFAILED="GetAgentAvailabilityFailed",e.SENDTYPINGINDICATORFAILED="SendTypingIndicatorFailed",e.SENDTYPINGINDICATORSUCCEEDED="SendTypingIndicatorSucceeded",e.GETPERSISTENTCHATHISTORYSTARTED="GetPersistentChatHistoryStarted",e.GETPERSISTENTCHATHISTORYSUCCEEDED="GetPersistentChatHistorySucceeded",e.GETPERSISTENTCHATHISTORYFAILED="GetPersistentChatHistoryFailed"}(a||(t.OCSDKTelemetryEvent=a={})),t.LiveChatVersion=c,function(e){e[e.V1=1]="V1",e[e.V2=2]="V2",e[e.V3=3]="V3"}(c||(t.LiveChatVersion=c={})),t.SDKError=u,function(e){e.ClientHTTPTimeoutErrorName="ClientHTTPTimeoutError",e.ClientHTTPTimeoutErrorMessage="Server took too long to respond"}(u||(t.SDKError=u={}))},103:(e,t,n)=>{"use strict";var r=n(4994);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(7383)),o=r(n(3693)),s=function e(){(0,i.default)(this,e)};t.default=s,(0,o.default)(s,"supportedLocales",["ar-sa","bg-bg","ca-es","cs-cz","da-dk","de-de","el-gr","en-us","es-es","et-ee","eu-es","fi-fi","fr-fr","gl-es","he-il","hi-in","hr-hr","hu-hu","id-id","it-it","ja-jp","kk-kz","ko-kr","lt-lt","lv-lv","ms-my","nb-no","nl-nl","pl-pl","pt-br","pt-pt","ro-ro","ru-ru","sk-sk","sl-si","sr-cyrl-cs","sr-latn-cs","sv-se","th-th","tr-tr","uk-ua","vi-vn","zh-cn","zh-hk","zh-tw"])},169:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.getLocationInfo=void 0;var o=n(1649),s=n(9229);t.getLocationInfo=function(e,t,n){return r(void 0,void 0,void 0,function(){var r;return i(this,function(i){return r=function(r,i){var s;console.error(r,i);try{s=JSON.stringify({Response:r,ExceptionalDetails:i})}catch(e){s=JSON.stringify({Response:r})}e.failScenario(o.default.GetGeolocation,{RequestId:n,ChatId:t,ExceptionDetails:s})},[2,new Promise(function(i,a){e.startScenario(o.default.GetGeolocation,{RequestId:n});var c={latitude:"",longitude:""};(s.default.isNode()||s.default.isReactNative()||!navigator.geolocation)&&(r("Unsupported"),i(c)),navigator.geolocation.getCurrentPosition(function(s){try{c.latitude=s.coords.latitude.toString(),c.longitude=s.coords.longitude.toString(),e.completeScenario(o.default.GetGeolocation,{RequestId:n,ChatId:t}),i(c)}catch(e){r("GetGeolocationFailed",e),i(c)}},function(e){r("GetGeolocationFailed",e),i(c)})})]})})}},241:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(6153),i=n(3136);t.default=function(e){return function(){return function(t){return function(n){return n&&n.channelData&&(n.channelData.tags||(n.channelData.tags=[]),n.channelData.tags.includes(r.channelIdTag)||n.channelData.tags.push(r.channelIdTag),n.channelData.tags.includes(r.customerMessageTag)||n.channelData.tags.push(r.customerMessageTag),n.channelData.metadata||(n.channelData.metadata={}),n.channelData.metadata.deliveryMode||(n.channelData.metadata.deliveryMode=i.DeliveryMode.Bridged),e.widgetId&&(n.channelData.metadata.widgetId=e.widgetId)),t(n)}}}}},279:function(e,t){"use strict";var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},n.apply(this,arguments)},r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return function(){return function(e){return function(t){return r(void 0,void 0,void 0,function(){var r,o,s,a,c,u;return i(this,function(i){if(r=t.attachments,o=t.channelData,!r)return[2,e(t)];if(!(null===(c=null==o?void 0:o.metadata)||void 0===c?void 0:c.amsreferences)&&(null===(u=null==o?void 0:o.metadata)||void 0===u?void 0:u.amsReferences)&&(t.channelData.metadata.amsreferences=o.metadata.amsReferences),s=o.metadata.amsreferences)try{a=function(r){var i=window.chatAdapter.fileManager.fileScanner;if(!i)return e(t);var o=i.retrieveFileScanResult(r);if(o){var s=o.scan,a=o.fileMetadata,c=t.attachments.findIndex(function(e){return e.name===a.name});t.channelData.fileScan||(t.channelData.fileScan=[]),t.channelData.fileScan[c]=s}i.addNext(r,e),i.addActivity(r,n({},t))},JSON.parse(s).forEach(function(e){return a(e)})}catch(e){console.error(e)}return[2,e(t)]})})}}}}},322:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},s=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0});var a=n(6469),c=n(7377),u=n(1590),l=n(6789),d=n(7912),h=n(8580),p=n(1524),f=n(4564),g=n(4897),m=n(3428),v=n(9445),y=n(7463),C=n(3677),S=n(2044),T=n(8634),E=n(5753),b=n(8508),I=n(4273),w=n(4786),R=n(9376),A=n(5881),O=n(2246),k=n(9),_=n(772),P=n(1753),M=n(3311),D=n(496),N=n(7516),x=n(4240),U=n(8990),L=n(9305),q=n(4140),j=n(4949),F=n(1649),B=n(4736),G=n(9759),H=n(5590),V=n(7881),z=n(8767),W=n(5274),K=n(6153),$=n(8770),J=n(169),X=n(7190),Q=n(7969),Y=n(1344),Z=n(9229),ee=n(6947),te=n(8362),ne=n(4154),re=n(414),ie=n(4810),oe=function(){function e(e,t){void 0===t&&(t=C.defaultChatSDKConfig);var n,i,o,s,c,u,l,h=this;this.ACSClient=null,this.AMSClient=null,this.sessionId=null,this.chatOperationInProgress=!1,this.pendingOperations=[],this.unqServicesOrgUrl=null,this.coreServicesOrgUrl=null,this.dynamicsLocationCode=null,this.widgetSnippetBaseUrl="",this.dataMaskingRules={rules:[]},this.authSettings=null,this.authenticatedUserToken=null,this.conversation=null,this.callingOption=b.default.NoCalling,this.telemetry=null,this.ic3ClientLogger=null,this.ocSdkLogger=null,this.acsClientLogger=null,this.acsAdapterLogger=null,this.callingSdkLogger=null,this.amsClientLogger=null,this.isPersistentChat=!1,this.isChatReconnect=!1,this.reconnectId=null,this.refreshTokenTimer=null,this.AMSClientLoadCurrentState=T.AMSClientLoadStates.NOT_LOADED,this.isMaskingDisabled=!1,this.maskingCharacter="#",this.botCSPId=null,this.isAMSClientAllowed=!1,this.debugSDK=!1,this.debugAMS=!1,this.debugACS=!1,this.detailedDebugEnabled=!1,this.regexCompiledForDataMasking=[],this.populateInitChatOptionalParam=function(e,t,n){if(e.initContext.locale=(0,f.getLocaleStringFromId)(h.localeId),null==t?void 0:t.customContext){var r=null==t?void 0:t.customContext;if("object"==typeof r)for(var i in r)null!==r[i].value&&void 0!==r[i].value&&""!==r[i].value||delete r[i];e.initContext.customContextData=null==t?void 0:t.customContext}if(t.browser&&(e.initContext.browser=t.browser),t.os&&(e.initContext.os=t.os),t.locale&&(e.initContext.locale=t.locale),t.device&&(e.initContext.device=t.device),t.preChatResponse&&(e.initContext.preChatResponse=t.preChatResponse),t.portalContactId&&(e.initContext.portalcontactid=t.portalContactId),t.sendDefaultInitContext){if(Z.default.isNode()||Z.default.isReactNative()){var o={RequestId:h.requestId,ChatId:h.chatToken.chatId};g.default.throwUnsupportedPlatform(h.scenarioMarker,n,"sendDefaultInitContext is only supported on browser",o)}e.getContext=!0}return t.initContext&&(e.initContext=t.initContext),h.authenticatedUserToken&&(e.authenticatedUserToken=h.authenticatedUserToken),h.chatToken.chatId&&(e.initContext.chatId=h.chatToken.chatId),e},this.debug=!1,this.debugSDK=!1,this.debugAMS=!1,this.debugACS=!1,this.detailedDebugEnabled=!1,this.runtimeId=(0,m.getRuntimeId)(null!==(i=null===(n=null==t?void 0:t.telemetry)||void 0===n?void 0:n.runtimeId)&&void 0!==i?i:null),this.omnichannelConfig=e,this.chatSDKConfig=r(r({},C.defaultChatSDKConfig),t),this.isInitialized=!1,this.liveChatVersion=_.default.V2,this.localeId=f.defaultLocaleId,this.requestId=(0,d.uuidv4)(),this.chatToken={},this.liveChatConfig={},this.authSettings=null,this.preChatSurvey=null,this.telemetry=(0,z.default)(this.debug),this.scenarioMarker=new q.default(this.omnichannelConfig),this.ic3ClientLogger=(0,a.createIC3ClientLogger)(this.omnichannelConfig),this.ocSdkLogger=(0,a.createOCSDKLogger)(this.omnichannelConfig),this.acsClientLogger=(0,a.createACSClientLogger)(this.omnichannelConfig),this.acsAdapterLogger=(0,a.createACSAdapterLogger)(this.omnichannelConfig),this.callingSdkLogger=(0,a.createCallingSDKLogger)(this.omnichannelConfig),this.amsClientLogger=(0,a.createAMSClientLogger)(this.omnichannelConfig),this.scenarioMarker.useTelemetry(this.telemetry),Q.default.useTelemetry(this.telemetry,this.ocSdkLogger,this.acsClientLogger,this.acsAdapterLogger,this.callingSdkLogger,this.amsClientLogger,this.ic3ClientLogger),this.scenarioMarker.setRuntimeId(this.runtimeId),Q.default.setRuntimeId(this.runtimeId,this.ocSdkLogger,this.acsClientLogger,this.acsAdapterLogger,this.callingSdkLogger,this.amsClientLogger,this.ic3ClientLogger),(0,ie.default)(e),(0,C.default)(t),(null===(o=this.chatSDKConfig.telemetry)||void 0===o?void 0:o.disable)&&(null===(s=this.telemetry)||void 0===s||s.disable());var p=(0,ee.default)(this.omnichannelConfig.orgUrl);(null===(c=this.chatSDKConfig.telemetry)||void 0===c?void 0:c.ariaCollectorUri)?this.telemetry.setCollectorUri(null===(u=this.chatSDKConfig.telemetry)||void 0===u?void 0:u.ariaCollectorUri):this.telemetry.setCollectorUri(p),(null===(l=this.chatSDKConfig.telemetry)||void 0===l?void 0:l.ariaTelemetryKey)&&this.telemetry.initialize(this.chatSDKConfig.telemetry.ariaTelemetryKey),this.chatSDKConfig.dataMasking&&(this.isMaskingDisabled=this.chatSDKConfig.dataMasking.disable,this.maskingCharacter=this.chatSDKConfig.dataMasking.maskingCharacter),e.cpsBotId&&(this.botCSPId=e.cpsBotId),Q.default.setRequestId(this.requestId,this.ocSdkLogger,this.acsClientLogger,this.acsAdapterLogger,this.callingSdkLogger,this.amsClientLogger,this.ic3ClientLogger)}return e.prototype.executeWithLock=function(e){return i(this,void 0,void 0,function(){var t=this;return o(this,function(n){return[2,new Promise(function(n,r){var s=function(){return i(t,void 0,void 0,function(){var t,i;return o(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,3,4]),[4,e()];case 1:return t=o.sent(),n(t),[3,4];case 2:return i=o.sent(),r(i),[3,4];case 3:return this.chatOperationInProgress=!1,this.processNextOperation(),[7];case 4:return[2]}})})};t.chatOperationInProgress?t.pendingOperations.push(s):(t.chatOperationInProgress=!0,s())})]})})},e.prototype.processNextOperation=function(){this.pendingOperations.length>0&&(this.chatOperationInProgress=!0,this.pendingOperations.shift()())},e.prototype.setDebug=function(e){var t;this.detailedDebugEnabled=!1,this.debug=e,null===(t=this.telemetry)||void 0===t||t.setDebug(e),this.scenarioMarker.setDebug(e),this.AMSClient&&this.AMSClient.setDebug(e),Q.default.setDebug(e,this.ocSdkLogger,this.acsClientLogger,this.acsAdapterLogger,this.callingSdkLogger,this.amsClientLogger,this.ic3ClientLogger)},e.prototype.setDebugDetailed=function(e){var t;this.detailedDebugEnabled=!0,this.debug=!0===(null==e?void 0:e.flagSDK),this.debugACS=!0===(null==e?void 0:e.flagACS),this.debugAMS=!0===(null==e?void 0:e.flagAttachment),null===(t=this.telemetry)||void 0===t||t.setDebug(this.debug),this.scenarioMarker.setDebug(this.debug),this.AMSClient&&this.AMSClient.setDebug(this.debugAMS),Q.default.setDebugDetailed(this.debug,this.debugACS,this.debugAMS,this.ocSdkLogger,this.acsClientLogger,this.acsAdapterLogger,this.callingSdkLogger,this.amsClientLogger)},e.prototype.retryLoadAMSClient=function(){return i(this,void 0,void 0,function(){var e,t,n;return o(this,function(r){switch(r.label){case 0:e=1e3,t=30,n=0,r.label=1;case 1:return n<t?this.AMSClient?[2,this.AMSClient]:[4,(0,v.sleep)(e)]:[3,3];case 2:return r.sent(),n++,[3,1];case 3:return[2,null]}})})},e.prototype.getAMSClient=function(){return i(this,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:if(!1===this.isAMSClientAllowed)return[2,null];if(this.AMSClientLoadCurrentState===T.AMSClientLoadStates.NOT_LOADED&&this.liveChatVersion===_.default.V1)return[2,null];switch(this.AMSClientLoadCurrentState){case T.AMSClientLoadStates.LOADED:return[3,1];case T.AMSClientLoadStates.LOADING:return[3,2];case T.AMSClientLoadStates.ERROR:case T.AMSClientLoadStates.NOT_LOADED:return[3,4]}return[3,6];case 1:return this.debug&&console.log("Attachment handler is already loaded"),[2,this.AMSClient];case 2:return this.debug&&console.log("Attachment handler is loading, waiting for it to be ready"),[4,this.retryLoadAMSClient()];case 3:return[2,e.sent()];case 4:return this.debug&&console.log("Attachment handler is not loaded, loading now"),[4,this.loadAmsClient()];case 5:return e.sent(),[2,this.AMSClient];case 6:return[2,null]}})})},e.prototype.loadInitComponents=function(){return i(this,void 0,void 0,function(){var e;return o(this,function(t){switch(t.label){case 0:return this.scenarioMarker.startScenario(F.default.InitializeComponents),[_.default.V1,_.default.V2].includes(this.liveChatVersion)||g.default.throwUnsupportedLiveChatVersionFailure(new Error(u.ChatSDKErrorName.UnsupportedLiveChatVersion),this.scenarioMarker,F.default.InitializeComponents),this.liveChatVersion!==_.default.V2?[3,1]:(this.ACSClient=new c.default(this.acsClientLogger),[3,3]);case 1:return e=this,[4,this.getIC3Client()];case 2:e.IC3Client=t.sent(),t.label=3;case 3:return this.scenarioMarker.completeScenario(F.default.InitializeComponents),[2]}})})},e.prototype.evaluateAMSAvailability=function(){var e,t,n,r;return"true"!==(null===(t=null===(e=this.liveChatConfig)||void 0===e?void 0:e.LiveWSAndLiveChatEngJoin)||void 0===t?void 0:t.msdyn_enablefileattachmentsforcustomers)&&"true"!==(null===(r=null===(n=this.liveChatConfig)||void 0===n?void 0:n.LiveWSAndLiveChatEngJoin)||void 0===r?void 0:r.msdyn_enablefileattachmentsforagents)||this.liveChatVersion!==_.default.V2||(this.isAMSClientAllowed=!0),this.isAMSClientAllowed},e.prototype.loadAmsClient=function(){return i(this,void 0,void 0,function(){var e,t,n,r,i,s,a,c,u;return o(this,function(o){switch(o.label){case 0:this.scenarioMarker.startScenario(F.default.InitializeMessagingClient),o.label=1;case 1:return o.trys.push([1,4,,5]),this.isAMSClientAllowed?this.AMSClientLoadCurrentState!==T.AMSClientLoadStates.NOT_LOADED?[3,3]:(this.AMSClientLoadCurrentState=T.AMSClientLoadStates.LOADING,this.debug&&console.time("ams_creation"),e=!1!==(null===(a=null===(s=this.chatSDKConfig)||void 0===s?void 0:s.internalConfig)||void 0===a?void 0:a.disableAMSWhitelistedUrls),t=!0===(null===(u=null===(c=this.chatSDKConfig)||void 0===c?void 0:c.internalConfig)||void 0===u?void 0:u.disableAMSRegionBasedUrl),n=(0,y.shouldUseFramedMode)(e),r=this,[4,(0,G.default)({framedMode:n,multiClient:!0,debug:this.detailedDebugEnabled?this.debugAMS:this.debug,logger:this.amsClientLogger,baseUrl:n&&!t?(0,y.retrieveRegionBasedUrl)(this.widgetSnippetBaseUrl):""})]):[3,3];case 2:r.AMSClient=o.sent(),this.debug&&console.timeEnd("ams_creation"),this.AMSClientLoadCurrentState=T.AMSClientLoadStates.LOADED,o.label=3;case 3:return this.scenarioMarker.completeScenario(F.default.InitializeMessagingClient),[3,5];case 4:return i=o.sent(),this.AMSClientLoadCurrentState=T.AMSClientLoadStates.ERROR,g.default.throwMessagingClientCreationFailure(i,this.scenarioMarker,F.default.InitializeMessagingClient),[3,5];case 5:return[2]}})})},e.prototype.parallelInitialization=function(){return i(this,arguments,void 0,function(e){var t,n;return void 0===e&&(e={}),o(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),this.scenarioMarker.startScenario(F.default.InitializeChatSDKParallel),this.isInitialized?(this.scenarioMarker.completeScenario(F.default.InitializeChatSDKParallel),[2,this.liveChatConfig]):(this.useCoreServicesOrgUrlIfNotSet(),[4,Promise.all([this.loadInitComponents(),this.loadChatConfig(e)])]);case 1:return r.sent(),this.loadAmsClient(),this.isInitialized=!0,this.scenarioMarker.completeScenario(F.default.InitializeChatSDKParallel),[3,3];case 2:throw t=r.sent(),n={RequestId:this.requestId,ExceptionDetails:t instanceof u.ChatSDKError?JSON.stringify(t.exceptionDetails):"".concat(t)},this.scenarioMarker.failScenario(F.default.InitializeChatSDKParallel,n),t;case 3:return[2,this.liveChatConfig]}})})},e.prototype.sequentialInitialization=function(){return i(this,arguments,void 0,function(e){var t,n,r,i,s,a,l,h,f,m,v,C,S,E,b,I;return void 0===e&&(e={}),o(this,function(o){switch(o.label){case 0:if(this.scenarioMarker.startScenario(F.default.InitializeChatSDK),this.isInitialized)return this.scenarioMarker.completeScenario(F.default.InitializeChatSDK),[2,this.liveChatConfig];this.useCoreServicesOrgUrlIfNotSet(),t=(0,p.isCoreServicesOrgUrl)(this.omnichannelConfig.orgUrl),o.label=1;case 1:return o.trys.push([1,3,,4]),this.OCSDKProvider=d.SDKProvider,n=this,[4,d.SDKProvider.getSDK(this.omnichannelConfig,(0,H.default)(t,null===(C=this.chatSDKConfig)||void 0===C?void 0:C.ocUserAgent),this.ocSdkLogger)];case 2:return n.OCClient=o.sent(),[3,4];case 3:return r=o.sent(),g.default.throwOmnichannelClientInitializationFailure(r,this.scenarioMarker,F.default.InitializeChatSDK),[3,4];case 4:return o.trys.push([4,6,,7]),i=e.getLiveChatConfigOptionalParams,[4,this.getChatConfig(i||{})];case 5:return o.sent(),[3,7];case 6:return s=o.sent(),g.default.throwChatConfigRetrievalFailure(s,this.scenarioMarker,F.default.InitializeChatSDK),[3,7];case 7:[_.default.V1,_.default.V2].includes(this.liveChatVersion)||g.default.throwUnsupportedLiveChatVersionFailure(new Error(u.ChatSDKErrorName.UnsupportedLiveChatVersion),this.scenarioMarker,F.default.InitializeChatSDK),o.label=8;case 8:return o.trys.push([8,14,,15]),this.liveChatVersion!==_.default.V2?[3,11]:(this.ACSClient=new c.default(this.acsClientLogger),this.isAMSClientAllowed&&this.AMSClientLoadCurrentState===T.AMSClientLoadStates.NOT_LOADED?(this.AMSClientLoadCurrentState=T.AMSClientLoadStates.LOADING,this.debug&&console.time("ams_seq_creation"),a=!1!==(null===(E=null===(S=this.chatSDKConfig)||void 0===S?void 0:S.internalConfig)||void 0===E?void 0:E.disableAMSWhitelistedUrls),l=!0===(null===(I=null===(b=this.chatSDKConfig)||void 0===b?void 0:b.internalConfig)||void 0===I?void 0:I.disableAMSRegionBasedUrl),h=(0,y.shouldUseFramedMode)(a),f=this,[4,(0,G.default)({framedMode:h,multiClient:!0,debug:this.detailedDebugEnabled?this.debugAMS:this.debug,logger:this.amsClientLogger,baseUrl:h&&!l?(0,y.retrieveRegionBasedUrl)(this.widgetSnippetBaseUrl):""})]):[3,10]);case 9:f.AMSClient=o.sent(),this.debug&&console.timeEnd("ams_seq_creation"),this.AMSClientLoadCurrentState=T.AMSClientLoadStates.LOADED,o.label=10;case 10:return[3,13];case 11:return this.liveChatVersion!==_.default.V1?[3,13]:(m=this,[4,this.getIC3Client()]);case 12:m.IC3Client=o.sent(),o.label=13;case 13:return this.isInitialized=!0,this.scenarioMarker.completeScenario(F.default.InitializeChatSDK),[3,15];case 14:return v=o.sent(),this.AMSClientLoadCurrentState=T.AMSClientLoadStates.ERROR,g.default.throwMessagingClientCreationFailure(v,this.scenarioMarker,F.default.InitializeChatSDK),[3,15];case 15:return[2,this.liveChatConfig]}})})},e.prototype.initialize=function(){return i(this,arguments,void 0,function(e){return void 0===e&&(e={}),o(this,function(t){switch(t.label){case 0:return!0!==e.useParallelLoad?[3,2]:[4,this.parallelInitialization(e)];case 1:case 3:return[2,t.sent()];case 2:return[4,this.sequentialInitialization(e)]}})})},e.prototype.loadChatConfig=function(){return i(this,arguments,void 0,function(e){var t,n,r,i;return void 0===e&&(e={}),o(this,function(o){switch(o.label){case 0:this.scenarioMarker.startScenario(F.default.InitializeLoadChatConfig),t=(0,p.isCoreServicesOrgUrl)(this.omnichannelConfig.orgUrl);try{this.OCSDKProvider=d.SDKProvider,this.OCClient=d.SDKProvider.getSDK(this.omnichannelConfig,(0,H.default)(t,null===(i=this.chatSDKConfig)||void 0===i?void 0:i.ocUserAgent),this.ocSdkLogger)}catch(e){g.default.throwOmnichannelClientInitializationFailure(e,this.scenarioMarker,F.default.InitializeLoadChatConfig)}o.label=1;case 1:return o.trys.push([1,3,,4]),n=e.getLiveChatConfigOptionalParams,[4,this.getChatConfig(n||{})];case 2:return o.sent(),[3,4];case 3:return r=o.sent(),g.default.throwChatConfigRetrievalFailure(r,this.scenarioMarker,F.default.InitializeLoadChatConfig),[3,4];case 4:return this.scenarioMarker.completeScenario(F.default.InitializeLoadChatConfig),[2]}})})},e.prototype.getChatReconnectContextWithAuthToken=function(){return i(this,void 0,void 0,function(){var e,t,n,r,i,s;return o(this,function(o){switch(o.label){case 0:this.scenarioMarker.startScenario(F.default.GetChatReconnectContextWithAuthToken,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),e={reconnectId:null,redirectURL:null},o.label=1;case 1:return o.trys.push([1,3,,4]),t={authenticatedUserToken:this.authenticatedUserToken,requestId:this.requestId},[4,this.OCClient.getReconnectableChats(t)];case 2:return(n=o.sent())&&n.reconnectid&&(e.reconnectId=n.reconnectid),this.scenarioMarker.completeScenario(F.default.GetChatReconnectContextWithAuthToken,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),[3,4];case 3:return r=o.sent(),i={response:"OCClientGetReconnectableChatsFailed"},s={RequestId:this.requestId,ChatId:this.chatToken.chatId,ExceptionDetails:JSON.stringify(i)},(0,m.isClientIdNotFoundErrorMessage)(r)&&g.default.throwAuthContactIdNotFoundFailure(r,this.scenarioMarker,F.default.GetChatReconnectContextWithAuthToken,s),this.scenarioMarker.failScenario(F.default.GetChatReconnectContextWithAuthToken,s),console.error("OmnichannelChatSDK/GetChatReconnectContextWithAuthToken/error ".concat(r)),[3,4];case 4:return[2,e]}})})},e.prototype.getChatReconnectContextWithReconnectId=function(){return i(this,arguments,void 0,function(e){var t,n,r,i;return void 0===e&&(e={}),o(this,function(o){switch(o.label){case 0:if(this.scenarioMarker.startScenario(F.default.GetChatReconnectContextWithReconnectId,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),t={reconnectId:null,redirectURL:null},!e.reconnectId)return[3,4];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.OCClient.getReconnectAvailability(e.reconnectId,{requestId:this.requestId})];case 2:return(n=o.sent())&&!n.isReconnectAvailable?n.reconnectRedirectionURL&&(t.redirectURL=n.reconnectRedirectionURL):t.reconnectId=e.reconnectId,this.scenarioMarker.completeScenario(F.default.GetChatReconnectContextWithReconnectId,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),[3,4];case 3:return r=o.sent(),i={response:"OCClientGetReconnectAvailabilityFailed"},this.scenarioMarker.failScenario(F.default.GetChatReconnectContextWithReconnectId,{RequestId:this.requestId,ChatId:this.chatToken.chatId,ExceptionDetails:JSON.stringify(i)}),console.error("OmnichannelChatSDK/GetChatReconnectContextWithReconnectId/error ".concat(r)),[3,4];case 4:return[2,t]}})})},e.prototype.getChatReconnectContext=function(){return i(this,arguments,void 0,function(e){var t;return void 0===e&&(e={}),o(this,function(n){switch(n.label){case 0:return this.scenarioMarker.startScenario(F.default.GetChatReconnectContext,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),this.isInitialized||g.default.throwUninitializedChatSDK(this.scenarioMarker,F.default.GetChatReconnectContext),this.requestId||(this.requestId=(0,d.uuidv4)()),t={reconnectId:null,redirectURL:null},[4,this.getChatReconnectContextWithReconnectId(e)];case 1:return(t=n.sent()).redirectURL&&t.redirectURL.length>0?[2,t]:this.authenticatedUserToken?[4,this.getChatReconnectContextWithAuthToken()]:[3,3];case 2:t=n.sent(),n.label=3;case 3:return this.scenarioMarker.completeScenario(F.default.GetChatReconnectContext,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),[2,t]}})})},e.prototype.startChat=function(){return i(this,arguments,void 0,function(e){var t=this;return void 0===e&&(e={}),o(this,function(n){return[2,this.executeWithLock(function(){return t.internalStartChat(e)})]})})},e.prototype.internalStartChat=function(){return i(this,arguments,void 0,function(e){var t,n,s,a,c,u,l,h,p,f,m,v,y,C,S,T,E,b,I,w,R,A,O,k,M,D=this;return void 0===e&&(e={}),o(this,function(N){switch(N.label){case 0:return this.scenarioMarker.startScenario(F.default.StartChat,{RequestId:this.requestId}),this.isInitialized||g.default.throwUninitializedChatSDK(this.scenarioMarker,F.default.StartChat),this.requestId||(this.requestId=(0,d.uuidv4)()),Z.default.isNode()||Z.default.isReactNative()||this.IC3Client||this.liveChatVersion!==_.default.V1?[3,2]:(t=this,[4,this.getIC3Client()]);case 1:t.IC3Client=N.sent(),N.label=2;case 2:if(this.isChatReconnect&&!(null===(S=this.chatSDKConfig.chatReconnect)||void 0===S?void 0:S.disable)&&!this.isPersistentChat&&e.reconnectId&&(this.reconnectId=e.reconnectId),!this.isPersistentChat||(null===(T=this.chatSDKConfig.persistentChat)||void 0===T?void 0:T.disable))return[3,6];N.label=3;case 3:return N.trys.push([3,5,,6]),n={authenticatedUserToken:this.authenticatedUserToken,requestId:this.requestId},[4,this.OCClient.getReconnectableChats(n)];case 4:return(s=N.sent())&&s.reconnectid&&(this.reconnectId=s.reconnectid),[3,6];case 5:return a=N.sent(),l={RequestId:this.requestId,ChatId:this.chatToken.chatId},g.default.throwPersistentChatConversationRetrievalFailure(a,this.scenarioMarker,F.default.StartChat,l),[3,6];case 6:return e.liveChatContext&&Object.keys(e.liveChatContext).length>0&&!this.reconnectId?(this.chatToken=e.liveChatContext.chatToken||{},this.requestId=e.liveChatContext.requestId||(0,d.uuidv4)(),this.sessionId=e.liveChatContext.sessionId||null,[4,this.getConversationDetails()]):[3,8];case 7:c=N.sent(),0===Object.keys(c).length&&(l={RequestId:this.requestId,ChatId:this.chatToken.chatId},g.default.throwInvalidConversation(this.scenarioMarker,F.default.StartChat,l)),c.state!==P.default.WrapUp&&c.state!==P.default.Closed||(console.error("Unable to join conversation that's in '".concat(c.state,"' state")),l={RequestId:this.requestId,ChatId:this.chatToken.chatId},g.default.throwClosedConversation(this.scenarioMarker,F.default.StartChat,l)),N.label=8;case 8:return this.authSettings?this.authenticatedUserToken?[3,10]:[4,this.setAuthTokenProvider(this.chatSDKConfig.getAuthToken,{throwError:!0})]:[3,14];case 9:N.sent(),N.label=10;case 10:if(!(e.liveChatContext&&Object.keys(e.liveChatContext).length>0))return[3,14];this.chatToken=e.liveChatContext.chatToken||{},this.requestId=e.liveChatContext.requestId||(0,d.uuidv4)(),N.label=11;case 11:return N.trys.push([11,13,,14]),[4,this.OCClient.validateAuthChatRecord(this.requestId,{authenticatedUserToken:this.authenticatedUserToken,chatId:this.chatToken.chatId})];case 12:return N.sent(),[3,14];case 13:return u=N.sent(),l={RequestId:this.requestId,ChatId:this.chatToken.chatId},g.default.throwAuthenticatedChatConversationRetrievalFailure(u,this.scenarioMarker,F.default.StartChat,l),[3,14];case 14:return(null===(E=this.chatSDKConfig.useCreateConversation)||void 0===E?void 0:E.disable)&&this.chatToken&&0===Object.keys(this.chatToken).length?[4,this.getChatToken(!1)]:[3,16];case 15:N.sent(),N.label=16;case 16:return(null===(b=this.chatToken)||void 0===b?void 0:b.chatId)&&Q.default.setChatId(this.chatToken.chatId||"",this.ocSdkLogger,this.acsClientLogger,this.acsAdapterLogger,this.callingSdkLogger,this.amsClientLogger,this.ic3ClientLogger),h={initContext:{}},(h=this.populateInitChatOptionalParam(h,e,F.default.StartChat)).initContext.isProactiveChat=!!e.isProactiveChat,e.platform&&(h.initContext.platform=e.platform),e.handle&&(h.initContext.handle=e.handle),this.isPersistentChat&&!(null===(I=this.chatSDKConfig.persistentChat)||void 0===I?void 0:I.disable)?h.reconnectId=this.reconnectId:!this.isChatReconnect||(null===(w=this.chatSDKConfig.chatReconnect)||void 0===w?void 0:w.disable)||this.isPersistentChat||(h.reconnectId=this.reconnectId),"true"!==(0,Y.parseLowerCaseString)(null===(A=null===(R=this.liveChatConfig)||void 0===R?void 0:R.LiveWSAndLiveChatEngJoin)||void 0===A?void 0:A.msdyn_requestvisitorlocation)?[3,18]:[4,(0,J.getLocationInfo)(this.scenarioMarker,this.chatToken.chatId,this.requestId)];case 17:p=N.sent(),h.initContext.latitude=p.latitude,h.initContext.longitude=p.longitude,N.label=18;case 18:return f=function(){return i(D,void 0,void 0,function(){var t,n,r,i,s;return o(this,function(o){switch(o.label){case 0:if(e.liveChatContext)return[3,4];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.OCClient.sessionInit(this.requestId,h)];case 2:return o.sent(),[3,4];case 3:return t=o.sent(),n={RequestId:this.requestId,ChatId:this.chatToken.chatId},(null==t?void 0:t.isAxiosError)&&(null===(s=null===(i=null===(r=t.response)||void 0===r?void 0:r.headers)||void 0===i?void 0:i.errorcode)||void 0===s?void 0:s.toString())===x.default.WidgetUseOutsideOperatingHour.toString()&&g.default.throwWidgetUseOutsideOperatingHour(t,this.scenarioMarker,F.default.StartChat,n),g.default.throwConversationInitializationFailure(t,this.scenarioMarker,F.default.StartChat,n),[3,4];case 4:return[2]}})})},m=function(){return i(D,void 0,void 0,function(){var t,n,r,i,s,a;return o(this,function(o){switch(o.label){case 0:if(e.liveChatContext)return[3,4];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.OCClient.createConversation(this.requestId,h)];case 2:return(t=o.sent())&&(this.setChatToken(t),Q.default.setChatId(this.chatToken.chatId||"",this.ocSdkLogger,this.acsClientLogger,this.acsAdapterLogger,this.callingSdkLogger,this.amsClientLogger,this.ic3ClientLogger)),[3,4];case 3:return n=o.sent(),r={RequestId:this.requestId,ChatId:this.chatToken.chatId},(null==n?void 0:n.isAxiosError)&&(null===(a=null===(s=null===(i=n.response)||void 0===i?void 0:i.headers)||void 0===s?void 0:s.errorcode)||void 0===a?void 0:a.toString())===x.default.WidgetUseOutsideOperatingHour.toString()&&g.default.throwWidgetUseOutsideOperatingHour(n,this.scenarioMarker,F.default.StartChat,r),g.default.throwConversationInitializationFailure(n,this.scenarioMarker,F.default.StartChat,r),[3,4];case 4:return[2]}})})},v=function(){return i(D,void 0,void 0,function(){var e,t,n,r,i,s,a,c,u,l;return o(this,function(o){switch(o.label){case 0:if(this.liveChatVersion!==_.default.V2)return[3,8];e={token:this.chatToken.token,id:this.chatToken.visitorId||"teamsvisitor",threadId:this.chatToken.chatId,environmentUrl:this.chatToken.acsEndpoint,pollingInterval:3e4},o.label=1;case 1:return o.trys.push([1,3,,4]),[4,null===(u=this.ACSClient)||void 0===u?void 0:u.initialize({token:e.token,environmentUrl:e.environmentUrl})];case 2:return o.sent(),[3,4];case 3:return t=o.sent(),c={RequestId:this.requestId,ChatId:this.chatToken.chatId},g.default.throwMessagingClientInitializationFailure(t,this.scenarioMarker,F.default.StartChat,c),[3,4];case 4:return o.trys.push([4,6,,7]),n=this,[4,null===(l=this.ACSClient)||void 0===l?void 0:l.joinConversation({id:e.id,threadId:e.threadId,pollingInterval:e.pollingInterval})];case 5:return n.conversation=o.sent(),this.scenarioMarker.completeScenario(F.default.StartChat,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),[3,7];case 6:return r=o.sent(),c={RequestId:this.requestId,ChatId:this.chatToken.chatId},g.default.throwMessagingClientConversationJoinFailure(r,this.scenarioMarker,F.default.StartChat,c),[3,7];case 7:return[3,14];case 8:return o.trys.push([8,10,,11]),[4,this.IC3Client.initialize({token:this.chatToken.token,regionGtms:this.chatToken.regionGTMS,visitor:!0})];case 9:return o.sent(),[3,11];case 10:return i=o.sent(),c={RequestId:this.requestId,ChatId:this.chatToken.chatId},g.default.throwMessagingClientInitializationFailure(i,this.scenarioMarker,F.default.StartChat,c),[3,11];case 11:return o.trys.push([11,13,,14]),s=this,[4,this.IC3Client.joinConversation(this.chatToken.chatId)];case 12:return s.conversation=o.sent(),this.scenarioMarker.completeScenario(F.default.StartChat,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),[3,14];case 13:return a=o.sent(),c={RequestId:this.requestId,ChatId:this.chatToken.chatId},g.default.throwMessagingClientConversationJoinFailure(a,this.scenarioMarker,F.default.StartChat,c),[3,14];case 14:return[2]}})})},y=function(){return i(D,void 0,void 0,function(){var e,t;return o(this,function(n){switch(n.label){case 0:return n.trys.push([0,4,,5]),this.liveChatVersion!==_.default.V2?[3,3]:this.isAMSClientAllowed?(this.debug&&console.time("ams_promise_initialization"),[4,this.getAMSClient()]):[2];case 1:return[4,null==(e=n.sent())?void 0:e.initialize({chatToken:this.chatToken})];case 2:n.sent(),this.debug&&console.timeEnd("ams_promise_initialization"),n.label=3;case 3:return[3,5];case 4:return n.sent(),t={RequestId:this.requestId,ChatId:this.chatToken.chatId},this.scenarioMarker.singleRecord("AMSLoadError",r({},t)),[3,5];case 5:return[2]}})})},(null===(O=this.chatSDKConfig.useCreateConversation)||void 0===O?void 0:O.disable)?[3,20]:[4,m()];case 19:return N.sent(),[3,22];case 20:return[4,f()];case 21:N.sent(),N.label=22;case 22:return N.trys.push([22,24,,26]),[4,Promise.all([v(),y()])];case 23:return N.sent(),[3,26];case 24:return C=N.sent(),[4,this.handleConversationJoinFailure(C,e)];case 25:throw N.sent(),C;case 26:return this.isPersistentChat&&!(null===(k=this.chatSDKConfig.persistentChat)||void 0===k?void 0:k.disable)&&(this.refreshTokenTimer=setInterval(function(){return i(D,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.getChatToken(!1)];case 1:return e.sent(),this.updateChatToken(this.chatToken.token,this.chatToken.regionGTMS),[3,3];case 2:return e.sent(),null!==this.refreshTokenTimer&&(clearInterval(this.refreshTokenTimer),this.refreshTokenTimer=null),[3,3];case 3:return[2]}})})},null===(M=this.chatSDKConfig.persistentChat)||void 0===M?void 0:M.tokenUpdateTime)),[2]}})})},e.prototype.closeChat=function(e){return i(this,void 0,void 0,function(){var t,n,i,s,a,c,u;return o(this,function(o){switch(o.label){case 0:if(t={RequestId:this.requestId,ChatId:this.chatToken.chatId,isSessionEnded:!(null==e?void 0:e.isSessionEnded)},this.scenarioMarker.startScenario(F.default.CloseChatSession,t),null==e?void 0:e.isSessionEnded)return[3,5];o.label=1;case 1:return o.trys.push([1,3,,4]),n={},this.isPersistentChat&&!(null===(c=this.chatSDKConfig.persistentChat)||void 0===c?void 0:c.disable)&&(i=null!==this.reconnectId,n.isPersistentChat=this.isPersistentChat,n.isReconnectChat=i),!this.isChatReconnect||(null===(u=this.chatSDKConfig.chatReconnect)||void 0===u?void 0:u.disable)||this.isPersistentChat||(s=null!==this.reconnectId,this.requestId=s?this.reconnectId:this.requestId,n.isReconnectChat=s),this.authenticatedUserToken&&(n.authenticatedUserToken=this.authenticatedUserToken),[4,this.OCClient.sessionClose(this.requestId,n)];case 2:return o.sent(),[3,4];case 3:return a=o.sent(),g.default.throwConversationClosureFailure(a,this.scenarioMarker,F.default.CloseChatSession,r(r({},t),{isSessionEnded:String(!(null==e?void 0:e.isSessionEnded))})),[3,4];case 4:this.scenarioMarker.completeScenario(F.default.CloseChatSession,t),o.label=5;case 5:return[2]}})})},e.prototype.endChat=function(){return i(this,arguments,void 0,function(e){var t=this;return void 0===e&&(e={}),o(this,function(n){return[2,this.executeWithLock(function(){return t.internalEndChat(e)})]})})},e.prototype.internalEndChat=function(){return i(this,arguments,void 0,function(e){var t,n,r,i;return void 0===e&&(e={}),o(this,function(o){switch(o.label){case 0:t={RequestId:this.requestId,ChatId:this.chatToken.chatId},this.scenarioMarker.startScenario(F.default.EndChat,t),this.isInitialized||g.default.throwUninitializedChatSDK(this.scenarioMarker,F.default.EndChat),o.label=1;case 1:o.trys.push([1,6,,7]),o.label=2;case 2:return o.trys.push([2,,4,5]),[4,this.closeChat(e)];case 3:return o.sent(),[3,5];case 4:return null===(i=this.conversation)||void 0===i||i.disconnect(),this.conversation=null,this.requestId=(0,d.uuidv4)(),this.chatToken={},this.reconnectId=null,this.IC3Client&&(this.IC3Client.dispose(),!Z.default.isNode()&&!Z.default.isReactNative()&&(0,v.removeElementById)(this.IC3Client.id),this.IC3Client=null),this.OCClient.sessionId&&(this.OCClient.sessionId=null,this.sessionId=null),Q.default.setRequestId(this.requestId,this.ocSdkLogger,this.acsClientLogger,this.acsAdapterLogger,this.callingSdkLogger,this.amsClientLogger,this.ic3ClientLogger),Q.default.setChatId("",this.ocSdkLogger,this.acsClientLogger,this.acsAdapterLogger,this.callingSdkLogger,this.amsClientLogger,this.ic3ClientLogger),null!==this.refreshTokenTimer&&(clearInterval(this.refreshTokenTimer),this.refreshTokenTimer=null),[7];case 5:return this.scenarioMarker.completeScenario(F.default.EndChat,t),[3,7];case 6:return n=o.sent(),r={RequestId:this.requestId,ChatId:this.chatToken.chatId},n instanceof u.ChatSDKError&&g.default.throwConversationClosureFailure(new Error(JSON.stringify(n.exceptionDetails)),this.scenarioMarker,F.default.EndChat,r),g.default.throwConversationClosureFailure(n,this.scenarioMarker,F.default.EndChat,r),[3,7];case 7:return[2]}})})},e.prototype.getCurrentLiveChatContext=function(){return i(this,void 0,void 0,function(){var e,t,n;return o(this,function(r){switch(r.label){case 0:return[4,this.getChatToken()];case 1:return e=r.sent(),t=this.requestId,this.scenarioMarker.startScenario(F.default.GetCurrentLiveChatContext,{RequestId:t,ChatId:e.chatId}),this.isInitialized||g.default.throwUninitializedChatSDK(this.scenarioMarker,F.default.GetCurrentLiveChatContext),n={chatToken:e,requestId:t},0===Object.keys(n.chatToken).length?[2,{}]:(this.reconnectId&&(n.reconnectId=this.reconnectId),this.sessionId&&(n.sessionId=this.sessionId),this.scenarioMarker.completeScenario(F.default.GetCurrentLiveChatContext,{RequestId:t,ChatId:e.chatId}),[2,n])}})})},e.prototype.getConversationDetails=function(){return i(this,arguments,void 0,function(e){var t,n,r,i,s,a,c,u,l,h,p,f,v,y,C,S,T,E,b;return void 0===e&&(e={}),o(this,function(o){switch(o.label){case 0:t=this.requestId,n=this.chatToken,r=n.chatId,i=this.reconnectId,s=this.sessionId,this.requestId||(this.requestId=(0,d.uuidv4)(),t=this.requestId),e.liveChatContext&&(t=e.liveChatContext.requestId,n=e.liveChatContext.chatToken,r=n.chatId),(null===(S=e.liveChatContext)||void 0===S?void 0:S.reconnectId)&&(i=e.liveChatContext.reconnectId),(null===(T=e.liveChatContext)||void 0===T?void 0:T.sessionId)&&(s=e.liveChatContext.sessionId,this.OCClient.sessionId=s),this.scenarioMarker.startScenario(F.default.GetConversationDetails,{RequestId:t,ChatId:r||""}),this.isInitialized||g.default.throwUninitializedChatSDK(this.scenarioMarker,F.default.GetConversationDetails),a={},this.isPersistentChat&&!(null===(E=this.chatSDKConfig.persistentChat)||void 0===E?void 0:E.disable)&&i&&(a.reconnectId=i),this.isChatReconnect&&!(null===(b=this.chatSDKConfig.chatReconnect)||void 0===b?void 0:b.disable)&&!this.isPersistentChat&&i&&(a.reconnectId=i),this.authenticatedUserToken&&(a.authenticatedUserToken=this.authenticatedUserToken),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.OCClient.getLWIDetails(t,a)];case 2:return c=o.sent(),u=c.State,l=c.ConversationId,h=c.AgentAcceptedOn,p=c.CanRenderPostChat,f=c.ParticipantType,v={state:u,conversationId:l},h&&(v.agentAcceptedOn=h),p&&(v.canRenderPostChat=p),f&&(v.participantType=f),this.sessionId&&(this.OCClient.sessionId=this.sessionId),this.scenarioMarker.completeScenario(F.default.GetConversationDetails,{RequestId:t,ChatId:r||""}),[2,v];case 3:return y=o.sent(),C={RequestId:t,ChatId:r},(0,m.isClientIdNotFoundErrorMessage)(y)&&g.default.throwAuthContactIdNotFoundFailure(y,this.scenarioMarker,F.default.GetConversationDetails,C),$.default.suppressConversationDetailsRetrievalFailure(y,this.scenarioMarker,F.default.GetConversationDetails,C),[3,4];case 4:return[2,{}]}})})},e.prototype.getPreChatSurvey=function(){return i(this,arguments,void 0,function(e){var t;return void 0===e&&(e=!0),o(this,function(n){this.scenarioMarker.startScenario(F.default.GetPreChatSurvey);try{return t=e?JSON.parse(this.preChatSurvey):this.preChatSurvey,this.scenarioMarker.completeScenario(F.default.GetPreChatSurvey),[2,t]}catch(e){this.scenarioMarker.failScenario(F.default.GetPreChatSurvey)}return[2]})})},e.prototype.getLiveChatConfig=function(e){return i(this,void 0,void 0,function(){return o(this,function(t){return e&&!0!==e.useRuntimeCache?[2,this.getChatConfig({sendCacheHeaders:(null==e?void 0:e.sendCacheHeaders)||!1})]:[2,this.liveChatConfig]})})},e.prototype.getChatToken=function(){return i(this,arguments,void 0,function(e,t){var n,r,i,s,a,c,u;return void 0===e&&(e=!0),o(this,function(o){switch(o.label){case 0:if(this.scenarioMarker.startScenario(F.default.GetChatToken,{RequestId:this.requestId}),this.isInitialized||g.default.throwUninitializedChatSDK(this.scenarioMarker,F.default.GetChatToken),e)return[3,5];o.label=1;case 1:return o.trys.push([1,3,,4]),n={},this.authenticatedUserToken&&(n.authenticatedUserToken=this.authenticatedUserToken),this.isPersistentChat&&!(null===(a=this.chatSDKConfig.persistentChat)||void 0===a?void 0:a.disable)&&(n.reconnectId=this.reconnectId),!this.isChatReconnect||(null===(c=this.chatSDKConfig.chatReconnect)||void 0===c?void 0:c.disable)||this.isPersistentChat||(n.reconnectId=this.reconnectId),!0===(null==t?void 0:t.refreshToken)&&(n.refreshToken=null==t?void 0:t.refreshToken),this.botCSPId&&(n.MsOcBotApplicationId=this.botCSPId),[4,this.OCClient.getChatToken(this.requestId,n)];case 2:return r=o.sent(),this.setChatToken(r),this.scenarioMarker.completeScenario(F.default.GetChatToken,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),[3,4];case 3:return i=o.sent(),s={RequestId:this.requestId,ChatId:null===(u=this.chatToken)||void 0===u?void 0:u.chatId},(0,m.isClientIdNotFoundErrorMessage)(i)?g.default.throwAuthContactIdNotFoundFailure(i,this.scenarioMarker,F.default.GetChatToken,s):g.default.throwChatTokenRetrievalFailure(i,this.scenarioMarker,F.default.GetChatToken,s),[3,4];case 4:return[3,6];case 5:this.scenarioMarker.completeScenario(F.default.GetChatToken,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),o.label=6;case 6:return[2,this.chatToken]}})})},e.prototype.setChatToken=function(e){var t=e.ChatId,n=e.Token,r=e.RegionGtms,i=e.ExpiresIn,o=e.VisitorId,s=e.VoiceVideoCallToken,a=e.ACSEndpoint,c=e.AttachmentConfiguration;this.chatToken={chatId:t,regionGTMS:JSON.parse(r),requestId:this.requestId,token:n,expiresIn:i,visitorId:o,voiceVideoCallToken:s,acsEndpoint:a},c&&c.AttachmentServiceEndpoint&&(this.chatToken.amsEndpoint=c.AttachmentServiceEndpoint),this.OCClient.sessionId&&(this.sessionId=this.OCClient.sessionId)},e.prototype.getCallingToken=function(){return i(this,void 0,void 0,function(){return o(this,function(e){return this.chatToken&&0===Object.keys(this.chatToken).length?[2,""]:this.chatToken.voiceVideoCallToken?(this.debug&&console.log("calling:acs"),[2,this.chatToken.voiceVideoCallToken.Token]):(this.debug&&console.log("calling:skype"),[2,this.chatToken.token])})})},e.prototype.recordMessages=function(e){return i(this,void 0,void 0,function(){var t,n,i,s;return o(this,function(o){if(t={RequestId:this.requestId,ChatId:this.chatToken.chatId},!e||0===(null==e?void 0:e.length))return null===(i=this.scenarioMarker)||void 0===i||i.singleRecord(F.default.MessageReceived,r(r({},t),{CustomProperties:"No messages received",Source:D.MessageSource.GetRestCall})),[2];try{n=e.map(function(e){return l.MessagePrinterFactory.printifyMessage(e,l.PrinterType.Omnichannel)}),null===(s=this.scenarioMarker)||void 0===s||s.singleRecord(F.default.MessageReceived,r(r({},t),{CustomProperties:JSON.stringify(n),Source:D.MessageSource.GetRestCall}))}catch(e){console.warn("Error while recording messages: ".concat(e))}return[2]})})},e.prototype.getMessages=function(){return i(this,void 0,void 0,function(){var e,t;return o(this,function(n){switch(n.label){case 0:this.scenarioMarker.startScenario(F.default.GetMessages,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),this.isInitialized||g.default.throwUninitializedChatSDK(this.scenarioMarker,F.default.GetMessages),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,null===(t=this.conversation)||void 0===t?void 0:t.getMessages()];case 2:return e=n.sent(),this.recordMessages(e),this.scenarioMarker.completeScenario(F.default.GetMessages,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),[2,e];case 3:return n.sent(),this.scenarioMarker.failScenario(F.default.GetMessages,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),[3,4];case 4:return[2]}})})},e.prototype.getDataMaskingRules=function(){return i(this,void 0,void 0,function(){return o(this,function(e){return[2,this.dataMaskingRules]})})},e.prototype.transformMessage=function(e){if(this.isMaskingDisabled)return e;var t,n=e.content;if(0===this.regexCompiledForDataMasking.length)return e;for(var r=0,i=this.regexCompiledForDataMasking;r<i.length;r++){var o=i[r];try{for(var s=-1;null!==(t=o.exec(n));){if(o.lastIndex===s){this.debug&&console.warn("[OmnichannelChatSDK][transformMessage] Data masking regex caused zero-width match, skipping rule ".concat(o));break}s=o.lastIndex;var a=t[0].replace(/./g,this.maskingCharacter);n=n.replace(t[0],a)}t=null}catch(e){this.debug&&console.error("[OmnichannelChatSDK][transformMessage] Data masking regex failed for rule ".concat(o,": ").concat(e))}}return e.content=n,e},e.prototype.sendMessage=function(e){return i(this,void 0,void 0,function(){var t,n,i,s,a;return o(this,function(o){switch(o.label){case 0:this.scenarioMarker.startScenario(F.default.SendMessages,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),this.isInitialized||g.default.throwUninitializedChatSDK(this.scenarioMarker,F.default.SendMessages),this.transformMessage(e),(t={content:e.content}).metadata={widgetId:this.omnichannelConfig.widgetId,clientMessageId:Date.now().toString()},e.metadata&&(t.metadata=r(r({},t.metadata),e.metadata)),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,null===(a=this.conversation)||void 0===a?void 0:a.sendMessage(t)];case 2:return n=o.sent(),this.scenarioMarker.completeScenario(F.default.SendMessages,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),[2,n];case 3:throw i=o.sent(),s={response:u.ChatSDKErrorName.ChatSDKSendMessageFailed,errorObject:"".concat(i)},this.scenarioMarker.failScenario(F.default.SendMessages,{RequestId:this.requestId,ChatId:this.chatToken.chatId,ExceptionDetails:JSON.stringify(s)}),new u.ChatSDKError(u.ChatSDKErrorName.ChatSDKSendMessageFailed,void 0,{response:u.ChatSDKErrorName.ChatSDKSendMessageFailed,errorObject:"".concat(i)});case 4:return[2]}})})},e.prototype.onNewMessage=function(e){return i(this,arguments,void 0,function(e,t){var n,r,i,s,a,c,u,l,d=this;return void 0===t&&(t={}),o(this,function(o){switch(o.label){case 0:return this.scenarioMarker.startScenario(F.default.OnNewMessage,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),this.isInitialized||g.default.throwUninitializedChatSDK(this.scenarioMarker,F.default.OnNewMessage),this.liveChatVersion!==_.default.V2?[3,3]:(n=new Set,(null==t?void 0:t.rehydrate)?(this.debug&&console.log("[OmnichannelChatSDK][onNewMessage] rehydrate"),[4,this.getMessages()]):[3,2]);case 1:for(r=o.sent(),i=0,s=r.reverse();i<s.length;i++)a=s[i],c=a.id,n.has(c)||(n.add(c),e(a));o.label=2;case 2:try{u={disablePolling:!1},(null==t?void 0:t.pollingInterval)&&(u.pollingInterval=null==t?void 0:t.pollingInterval),!0===(null==t?void 0:t.disablePolling)&&(u.disablePolling=null==t?void 0:t.disablePolling),null===(l=this.conversation)||void 0===l||l.registerOnNewMessage(function(t){var r=t.id,i=Object.keys(t).includes("editedOn");console.log("[OmnichannelChatSDK][onNewMessage] New message received",t),console.log("[OmnichannelChatSDK][onNewMessage] isChatMessageEditedEvent=>",i);var o=(0,V.default)(t,{liveChatVersion:d.liveChatVersion,debug:d.detailedDebugEnabled?d.debugACS:d.debug});n.has(r)&&!i||(e(o),console.log("[OmnichannelChatSDK][onNewMessage] Message posted"),n.add(r))},u),this.scenarioMarker.completeScenario(F.default.OnNewMessage,{RequestId:this.requestId,ChatId:this.chatToken.chatId})}catch(e){this.scenarioMarker.failScenario(F.default.OnNewMessage,{RequestId:this.requestId,ChatId:this.chatToken.chatId})}o.label=3;case 3:return[2]}})})},e.prototype.sendTypingEvent=function(){return i(this,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:if(this.scenarioMarker.startScenario(F.default.SendTypingEvent,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),this.isInitialized||g.default.throwUninitializedChatSDK(this.scenarioMarker,F.default.SendTypingEvent),this.liveChatVersion!==_.default.V2)return[3,5];e.label=1;case 1:return e.trys.push([1,4,,5]),[4,this.OCClient.sendTypingIndicator(this.requestId,_.default.V2,{customerDisplayName:S.default.Customer})];case 2:return e.sent(),[4,this.conversation.sendTyping()];case 3:return e.sent(),this.scenarioMarker.completeScenario(F.default.SendTypingEvent,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),[3,5];case 4:throw e.sent(),this.scenarioMarker.failScenario(F.default.SendTypingEvent,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),new Error("SendTypingFailure");case 5:return[2]}})})},e.prototype.onTypingEvent=function(e){return i(this,void 0,void 0,function(){var t;return o(this,function(n){if(this.scenarioMarker.startScenario(F.default.OnTypingEvent,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),this.isInitialized||g.default.throwUninitializedChatSDK(this.scenarioMarker,F.default.OnTypingEvent),this.liveChatVersion===_.default.V2)try{this.conversation.onTypingEvent(e),this.scenarioMarker.completeScenario(F.default.OnTypingEvent,{RequestId:this.requestId,ChatId:this.chatToken.chatId})}catch(e){this.scenarioMarker.failScenario(F.default.OnTypingEvent,{RequestId:this.requestId,ChatId:this.chatToken.chatId})}else try{null===(t=this.conversation)||void 0===t||t.registerOnNewMessage(function(t){var n=t.messageType;(0,m.isCustomerMessage)(t)||n===N.default.Typing&&e(t)}),this.scenarioMarker.completeScenario(F.default.OnTypingEvent,{RequestId:this.requestId,ChatId:this.chatToken.chatId})}catch(e){this.scenarioMarker.failScenario(F.default.OnTypingEvent,{RequestId:this.requestId,ChatId:this.chatToken.chatId})}return[2]})})},e.prototype.onAgentEndSession=function(e){return i(this,void 0,void 0,function(){var t=this;return o(this,function(n){this.scenarioMarker.startScenario(F.default.OnAgentEndSession,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),this.isInitialized||g.default.throwUninitializedChatSDK(this.scenarioMarker,F.default.OnAgentEndSession);try{this.conversation.registerOnThreadUpdate(function(n){return i(t,void 0,void 0,function(){var t;return o(this,function(r){switch(r.label){case 0:return[4,this.getConversationDetails()];case 1:return t=r.sent(),0!==Object.keys(t).length&&t.state!=P.default.WrapUp&&t.state!=P.default.Closed||(e(n),this.stopPolling()),[2]}})})}),this.scenarioMarker.completeScenario(F.default.OnAgentEndSession,{RequestId:this.requestId,ChatId:this.chatToken.chatId})}catch(e){this.scenarioMarker.failScenario(F.default.OnAgentEndSession,{RequestId:this.requestId,ChatId:this.chatToken.chatId})}return[2]})})},e.prototype.uploadFileAttachment=function(e){return i(this,void 0,void 0,function(){var t,n,i,a,c,u,l,d,h,p,f,m;return o(this,function(o){switch(o.label){case 0:return this.scenarioMarker.startScenario(F.default.UploadFileAttachment,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),this.isInitialized||g.default.throwUninitializedChatSDK(this.scenarioMarker,F.default.UploadFileAttachment),this.liveChatVersion!==_.default.V2?[3,8]:(!1===this.isAMSClientAllowed&&g.default.throwFeatureDisabled(this.scenarioMarker,F.default.UploadFileAttachment,"Enable support for attachment upload and receive in the widget configuration."),[4,this.getAMSClient()]);case 1:return null==(t=o.sent())&&(0,g.throwAMSLoadFailure)(this.scenarioMarker,F.default.UploadFileAttachment,"Attachment handler client is null, no action can be performed"),[4,null==t?void 0:t.createObject(null===(f=this.chatToken)||void 0===f?void 0:f.chatId,e)];case 2:return n=o.sent(),i=n.id,[4,null==t?void 0:t.uploadDocument(i,e)];case 3:a=o.sent(),c={amsReferences:JSON.stringify([i]),amsreferences:JSON.stringify([i])},u={amsMetadata:JSON.stringify([{contentType:e.type,fileName:e.name}])},l={content:"",metadata:r(r({widgetId:this.omnichannelConfig.widgetId,clientMessageId:Date.now().toString()},c),u)},h={content:"",timestamp:new Date,contentType:M.default.Text,deliveryMode:R.default.Bridged,messageType:N.default.UserMessage,tags:s([],K.defaultMessageTags,!0),sender:{displayName:"Customer",id:"customer",type:U.default.User},fileMetadata:a},o.label=4;case 4:return o.trys.push([4,6,,7]),[4,null===(m=this.conversation)||void 0===m?void 0:m.sendMessage(l)];case 5:return o.sent(),this.scenarioMarker.completeScenario(F.default.UploadFileAttachment,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),[2,h];case 6:return o.sent(),console.error("OmnichannelChatSDK/uploadFileAttachment/sendMessage/error"),this.scenarioMarker.failScenario(F.default.UploadFileAttachment,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),[3,7];case 7:return[2,{}];case 8:return d=void 0,Z.default.isReactNative()||Z.default.isNode()?[4,this.conversation.sendFileData(e,A.default.AmsBasedFileSharing)]:[3,10];case 9:return d=o.sent(),[3,12];case 10:return[4,this.conversation.uploadFile(e,A.default.AmsBasedFileSharing)];case 11:d=o.sent(),o.label=12;case 12:h={content:"",timestamp:new Date,contentType:M.default.Text,deliveryMode:R.default.Bridged,messageType:N.default.UserMessage,tags:s([],K.defaultMessageTags,!0),sender:{displayName:"Customer",id:"customer",type:U.default.User},fileMetadata:d},o.label=13;case 13:return o.trys.push([13,15,,16]),[4,this.conversation.sendFileMessage(d,h)];case 14:return o.sent(),this.scenarioMarker.completeScenario(F.default.UploadFileAttachment,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),[2,h];case 15:return p=o.sent(),console.error("OmnichannelChatSDK/uploadFileAttachment/error: ".concat(p)),this.scenarioMarker.failScenario(F.default.UploadFileAttachment,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),[3,16];case 16:return[2,{}]}})})},e.prototype.downloadFileAttachment=function(e){return i(this,void 0,void 0,function(){var t,n,r,i,s,a;return o(this,function(o){switch(o.label){case 0:if(this.scenarioMarker.startScenario(F.default.DownloadFileAttachment,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),this.isInitialized||g.default.throwUninitializedChatSDK(this.scenarioMarker,F.default.DownloadFileAttachment),this.liveChatVersion!==_.default.V2)return[3,7];o.label=1;case 1:return o.trys.push([1,5,,6]),!1===this.isAMSClientAllowed&&(this.scenarioMarker.failScenario(F.default.DownloadFileAttachment,{RequestId:this.requestId,ChatId:this.chatToken.chatId,ExceptionDetails:"AMSClient is disabled"}),g.default.throwFeatureDisabled(this.scenarioMarker,F.default.DownloadFileAttachment,"Enable support for attachment upload and receive in the widget configuration.")),[4,this.getAMSClient()];case 2:return null==(t=o.sent())&&(0,g.throwAMSLoadFailure)(this.scenarioMarker,F.default.DownloadFileAttachment,"Attachment handler is null, no action can be performed"),[4,null==t?void 0:t.getViewStatus(e)];case 3:return n=o.sent(),r=n.view_location,[4,null==t?void 0:t.getView(e,r)];case 4:return i=o.sent(),this.scenarioMarker.completeScenario(F.default.DownloadFileAttachment,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),[2,i];case 5:throw o.sent(),this.scenarioMarker.failScenario(F.default.DownloadFileAttachment,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),new Error("DownloadFileAttachmentFailed");case 6:return[3,10];case 7:return o.trys.push([7,9,,10]),[4,this.conversation.downloadFile(e)];case 8:return s=o.sent(),this.scenarioMarker.completeScenario(F.default.DownloadFileAttachment,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),[2,s];case 9:throw a=o.sent(),console.error("OmnichannelChatSDK/downloadFileAttachment/error: ".concat(a)),this.scenarioMarker.failScenario(F.default.DownloadFileAttachment,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),new Error("DownloadFileAttachmentFailed");case 10:return[2]}})})},e.prototype.emailLiveChatTranscript=function(e){return i(this,arguments,void 0,function(e,t){var n,r,i,s,a,c,u,l;return void 0===t&&(t={}),o(this,function(o){switch(o.label){case 0:n={},r=this.requestId,i=this.chatToken,s=i.chatId,a=this.sessionId,t.liveChatContext&&(r=t.liveChatContext.requestId,i=t.liveChatContext.chatToken,s=i.chatId),(null===(l=t.liveChatContext)||void 0===l?void 0:l.sessionId)&&(a=t.liveChatContext.sessionId,this.OCClient.sessionId=a),this.scenarioMarker.startScenario(F.default.EmailLiveChatTranscript,{RequestId:r,ChatId:s}),this.isInitialized||g.default.throwUninitializedChatSDK(this.scenarioMarker,F.default.EmailLiveChatTranscript),o.label=1;case 1:return o.trys.push([1,3,,4]),this.authenticatedUserToken&&(n.authenticatedUserToken=this.authenticatedUserToken),c={ChatId:s,EmailAddress:e.emailAddress,DefaultAttachmentMessage:e.attachmentMessage,CustomerLocale:e.locale||(0,f.getLocaleStringFromId)(this.localeId)},[4,this.OCClient.emailTranscript(r,i.token,c,n)];case 2:return o.sent(),this.sessionId&&(this.OCClient.sessionId=this.sessionId),this.scenarioMarker.completeScenario(F.default.EmailLiveChatTranscript,{RequestId:r,ChatId:s}),[3,4];case 3:return u=o.sent(),console.error("OmnichannelChatSDK/emailLiveChatTranscript/error: ".concat(u)),this.scenarioMarker.failScenario(F.default.EmailLiveChatTranscript,{RequestId:r,ChatId:s}),[3,4];case 4:return[2]}})})},e.prototype.getLiveChatTranscript=function(){return i(this,arguments,void 0,function(e){var t,n,r,i,s,a,c,l,d,h;return void 0===e&&(e={}),o(this,function(o){switch(o.label){case 0:if(t={},n=this.requestId,r=this.chatToken,i=r.chatId,s=this.sessionId,e.liveChatContext&&(this.isPersistentChat&&!(null===(d=this.chatSDKConfig.persistentChat)||void 0===d?void 0:d.disable)?(n=this.requestId||e.liveChatContext.requestId,r=this.chatToken&&Object.keys(this.chatToken).length>0?this.chatToken:e.liveChatContext.chatToken):(n=e.liveChatContext.requestId,r=e.liveChatContext.chatToken),i=r.chatId),(null===(h=e.liveChatContext)||void 0===h?void 0:h.sessionId)&&(s=e.liveChatContext.sessionId,this.OCClient.sessionId=s),!i)throw new u.ChatSDKError(u.ChatSDKErrorName.LiveChatTranscriptRetrievalFailure,void 0,{response:u.ChatSDKErrorName.LiveChatTranscriptRetrievalFailure,errorObject:"ChatId is not defined"});this.scenarioMarker.startScenario(F.default.GetLiveChatTranscript,{RequestId:n,ChatId:i}),this.isInitialized||g.default.throwUninitializedChatSDK(this.scenarioMarker,F.default.GetLiveChatTranscript),o.label=1;case 1:return o.trys.push([1,3,,4]),this.authenticatedUserToken&&(t.authenticatedUserToken=this.authenticatedUserToken),[4,this.OCClient.getChatTranscripts(n,r.chatId,r.token,t)];case 2:return a=o.sent(),this.sessionId&&(this.OCClient.sessionId=this.sessionId),this.scenarioMarker.completeScenario(F.default.GetLiveChatTranscript,{RequestId:n,ChatId:i}),[2,a];case 3:return c=o.sent(),l={RequestId:n,ChatId:i},g.default.throwLiveChatTranscriptRetrievalFailure(c,this.scenarioMarker,F.default.GetLiveChatTranscript,l),[3,4];case 4:return[2]}})})},e.prototype.createChatAdapter=function(){return i(this,arguments,void 0,function(e){var t,n,r,i,s,a;return void 0===e&&(e={}),o(this,function(o){return Z.default.isNode()||Z.default.isReactNative()?[2,Promise.reject("ChatAdapter is only supported on browser")]:(t=e.protocol,n=[I.default.ACS,I.default.IC3,I.default.DirectLine],t&&!n.includes(t)?[2,Promise.reject("ChatAdapter for protocol ".concat(t," currently not supported"))]:t===I.default.DirectLine?[2,(0,h.createDirectLine)(e,this.chatSDKConfig,this.liveChatVersion,I.default.DirectLine,this.telemetry,this.scenarioMarker)]:t===I.default.ACS||this.liveChatVersion===_.default.V2?(r={fileScan:null===(s=e.ACSAdapter)||void 0===s?void 0:s.fileScan},i=new E.default(this.AMSClient,this.acsAdapterLogger,r),[2,(0,h.createACSAdapter)(e,this.chatSDKConfig,this.liveChatVersion,I.default.ACS,this.telemetry,this.scenarioMarker,this.omnichannelConfig,this.chatToken,i,null===(a=this.ACSClient)||void 0===a?void 0:a.getChatClient(),this.acsAdapterLogger)]):t===I.default.IC3||this.liveChatVersion===_.default.V1?[2,(0,h.createIC3Adapter)(e,this.chatSDKConfig,this.liveChatVersion,I.default.IC3,this.telemetry,this.scenarioMarker,this.chatToken,this.IC3Client,this.ic3ClientLogger)]:[2,Promise.reject("ChatAdapter for protocol ".concat(t," currently not supported"))])})})},e.prototype.isVoiceVideoCallingEnabled=function(){return this.callingOption.toString()!==b.default.NoCalling.toString()},e.prototype.getVoiceVideoCalling=function(){return i(this,arguments,void 0,function(e){var t,n=this;return void 0===e&&(e={}),o(this,function(s){return this.scenarioMarker.startScenario(F.default.GetVoiceVideoCalling),this.isInitialized||g.default.throwUninitializedChatSDK(this.scenarioMarker,F.default.GetVoiceVideoCalling),(Z.default.isNode()||Z.default.isReactNative())&&(t="VoiceVideoCalling is only supported on browser",g.default.throwUnsupportedPlatform(this.scenarioMarker,F.default.GetVoiceVideoCalling,t)),this.isVoiceVideoCallingEnabled()||(t="Voice and video call is not enabled",g.default.throwFeatureDisabled(this.scenarioMarker,F.default.GetVoiceVideoCalling,t)),this.widgetSnippetBaseUrl&&this.widgetSnippetBaseUrl.length?[2,new Promise(function(t){return i(n,void 0,void 0,function(){var n,s,a,c=this;return o(this,function(u){switch(u.label){case 0:return n="".concat(this.widgetSnippetBaseUrl,"/livechatwidget/v2scripts/callingsdk/").concat(B.callingBundleVersion,"/CallingBundle.js"),null===(a=this.telemetry)||void 0===a||a.setCDNPackages({VoiceVideoCalling:n}),s={logger:this.callingSdkLogger},[4,(0,v.loadScript)(n,function(){return i(c,void 0,void 0,function(){var i;return o(this,function(o){switch(o.label){case 0:return this.debug&&console.debug("".concat(n," loaded!")),[4,(0,W.default)(r(r({},e),s))];case 1:return i=o.sent(),this.scenarioMarker.completeScenario(F.default.GetVoiceVideoCalling),i.useScenarioMarker(this.scenarioMarker),t(i),[2]}})})},function(){return i(c,void 0,void 0,function(){var e;return o(this,function(t){throw e={response:"VoiceVideoCallingLoadFailed",message:"Failed to load VoiceVideoCalling"},this.scenarioMarker.failScenario(F.default.GetVoiceVideoCalling,{ExceptionDetails:JSON.stringify(e)}),new Error(e.response)})})})];case 1:return u.sent(),[2]}})})})]:[2]})})},e.prototype.getPostChatSurveyContext=function(){return i(this,void 0,void 0,function(){var e,t,n,r,i,s,a,c,u,l,d,h,p,m,v,y,C,S,T,E,b,I,w,R,A,O,k,_,P,M,D,N,x,U,L;return o(this,function(o){switch(o.label){case 0:this.scenarioMarker.startScenario(F.default.GetPostChatSurveyContext,{RequestId:this.requestId,ChatId:null===(A=this.chatToken)||void 0===A?void 0:A.chatId}),this.isInitialized||g.default.throwUninitializedChatSDK(this.scenarioMarker,F.default.GetPostChatSurveyContext),o.label=1;case 1:return o.trys.push([1,6,,7]),t=this.liveChatConfig,n=t.LiveWSAndLiveChatEngJoin,r=n.msdyn_postconversationsurveyenable,i=n.msfp_sourcesurveyidentifier,s=n.msfp_botsourcesurveyidentifier,a=n.postConversationSurveyOwnerId,c=n.postConversationBotSurveyOwnerId,u=n.msdyn_surveyprovider,parseInt(u)!==j.SurveyProvider.CustomerVoice||i?"true"!==(0,Y.parseLowerCaseString)(r)?[3,4]:[4,this.getConversationDetails()]:(this.scenarioMarker.failScenario(F.default.GetPostChatSurveyContext,{RequestId:this.requestId,ChatId:null!==(k=null===(O=this.chatToken)||void 0===O?void 0:O.chatId)&&void 0!==k?k:"",ExceptionDetails:"GetPostChatSurveyContext : msfp_sourcesurveyidentifier is mandatory for survey provider ".concat(j.SurveyProvider.CustomerVoice,".")}),[2,Promise.reject("GetPostChatSurveyContext : msfp_sourcesurveyidentifier is mandatory for survey provider ".concat(j.SurveyProvider.CustomerVoice,"."))]);case 2:return l=o.sent(),0===Object.keys(l).length?(this.scenarioMarker.failScenario(F.default.GetPostChatSurveyContext,{RequestId:this.requestId,ChatId:null===(_=this.chatToken)||void 0===_?void 0:_.chatId,ExceptionDetails:"GetPostChatSurveyContext : LiveWorkItemDetails is null."}),[2,Promise.reject("GetPostChatSurveyContext : LiveWorkItemDetails is null.")]):(d="true"===(0,Y.parseLowerCaseString)(null==l?void 0:l.canRenderPostChat),h=null==l?void 0:l.participantType,(e=null==l?void 0:l.conversationId)?(p={SurveyProvider:u,WidgetId:this.omnichannelConfig.widgetId,FormId:i,ConversationId:e,OCLocaleCode:(0,f.getLocaleStringFromId)(this.localeId)},m={SurveyProvider:u,WidgetId:this.omnichannelConfig.widgetId,FormId:s,ConversationId:e,OCLocaleCode:(0,f.getLocaleStringFromId)(this.localeId)},v={requestId:this.requestId},this.authenticatedUserToken&&(v.authenticatedUserToken=this.authenticatedUserToken),[4,Promise.all([this.OCClient.getSurveyInviteLink(a,p,v),c&&s?this.OCClient.getSurveyInviteLink(c,m,v):Promise.resolve(null)])]):(this.scenarioMarker.failScenario(F.default.GetPostChatSurveyContext,{RequestId:this.requestId,ChatId:null!==(M=null===(P=this.chatToken)||void 0===P?void 0:P.chatId)&&void 0!==M?M:"",ExceptionDetails:"GetPostChatSurveyContext : Conversation ID is mandatory."}),[2,Promise.reject("GetPostChatSurveyContext : Conversation ID is mandatory.")]));case 3:return y=o.sent(),C=y[0],S=y[1],T=void 0,E=void 0,b=void 0,I=void 0,null!=C?null==C.inviteList||1!=C.inviteList.length?(this.scenarioMarker.failScenario(F.default.GetPostChatSurveyContext,{ConversationId:e,RequestId:this.requestId,ChatId:null===(D=this.chatToken)||void 0===D?void 0:D.chatId,ExceptionDetails:"Survey Invite link failed to send response."}),[2,Promise.reject("Survey Invite link failed to send response.")]):(T=C.inviteList[0].invitationLink,null!=C.formsProLocaleCode&&(E=C.formsProLocaleCode),null!=S&&(null!=S.inviteList&&1==S.inviteList.length&&(b=S.inviteList[0].invitationLink),null!=S.formsProLocaleCode&&(I=S.formsProLocaleCode)),w={participantJoined:d,participantType:h,surveyInviteLink:T,botSurveyInviteLink:b,formsProLocale:E,botFormsProLocale:I},this.scenarioMarker.completeScenario(F.default.GetPostChatSurveyContext,{RequestId:this.requestId,ChatId:null===(N=this.chatToken)||void 0===N?void 0:N.chatId}),[2,Promise.resolve(w)]):(this.scenarioMarker.failScenario(F.default.GetPostChatSurveyContext,{ConversationId:e,RequestId:this.requestId,ChatId:null===(x=this.chatToken)||void 0===x?void 0:x.chatId,ExceptionDetails:"surveyInviteLinkResponse is null."}),[2,Promise.reject("surveyInviteLinkResponse is null.")]);case 4:return this.scenarioMarker.failScenario(F.default.GetPostChatSurveyContext,{RequestId:this.requestId,ChatId:null===(U=this.chatToken)||void 0===U?void 0:U.chatId,ExceptionDetails:"Post Chat Survey is disabled. Please check the Omnichannel Administration Portal."}),[2,Promise.reject("Post Chat is disabled from admin side, or chat doesnt have a survey as part of their configuration.")];case 5:return[3,7];case 6:return R=o.sent(),this.scenarioMarker.failScenario(F.default.GetPostChatSurveyContext,{ConversationId:null!=e?e:"",RequestId:this.requestId,ChatId:null===(L=this.chatToken)||void 0===L?void 0:L.chatId,ExceptionDetails:JSON.stringify(R)}),[2,Promise.reject("Retrieving post chat context failed "+JSON.stringify(R))];case 7:return[2]}})})},e.prototype.getAgentAvailability=function(){return i(this,arguments,void 0,function(e){var t,n,r,i,s=this;return void 0===e&&(e={}),o(this,function(o){switch(o.label){case 0:t=function(e,t,n){void 0===n&&(n="");var r={response:e,message:t};throw s.scenarioMarker.failScenario(F.default.GetAgentAvailability,{RequestId:s.requestId,ExceptionDetails:JSON.stringify(r),ChatId:n}),new Error(r.message)},this.scenarioMarker.startScenario(F.default.GetAgentAvailability,{RequestId:this.requestId}),this.isInitialized||t("UninitializedChatSDK","Chat SDK is not initialized."),this.conversation&&t("InvalidOperation","GetAgentAvailability can only be called before a chat has started.",this.chatToken.chatId),n={initContext:{}},n=this.populateInitChatOptionalParam(n,e,F.default.GetAgentAvailability),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.OCClient.getAgentAvailability(this.requestId,n)];case 2:return r=o.sent(),this.scenarioMarker.completeScenario(F.default.GetAgentAvailability,{RequestId:this.requestId}),[2,r];case 3:return i=o.sent(),t("GetAgentAvailabilityFailed",i.message),[3,4];case 4:return[2]}})})},e.prototype.startPolling=function(){return i(this,void 0,void 0,function(){return o(this,function(e){return[2,(0,te.default)(this.isInitialized,this.scenarioMarker,this.liveChatVersion,this.requestId,this.chatToken.chatId,this.conversation)]})})},e.prototype.stopPolling=function(){return i(this,void 0,void 0,function(){return o(this,function(e){return[2,(0,ne.default)(this.isInitialized,this.scenarioMarker,this.liveChatVersion,this.requestId,this.chatToken.chatId,this.conversation)]})})},e.prototype.getIC3Client=function(){return i(this,void 0,void 0,function(){var e,t=this;return o(this,function(n){switch(n.label){case 0:return Z.default.isNode()||Z.default.isReactNative()?(this.debug&&console.debug("IC3Core"),this.scenarioMarker.startScenario(F.default.GetIC3Client),this.IC3SDKProvider=k.SDKProvider,[4,k.SDKProvider.getSDK({hostType:O.default.Page,protocolType:L.default.IC3V1SDK})]):[3,2];case 1:return(e=n.sent()).setDebug(this.debug),this.scenarioMarker.completeScenario(F.default.GetIC3Client),[2,e];case 2:return this.debug&&console.debug("IC3Client"),[2,new Promise(function(e,n){return i(t,void 0,void 0,function(){var t,r,s,a=this;return o(this,function(c){switch(c.label){case 0:return t=this.resolveIC3ClientUrl(),null===(s=this.telemetry)||void 0===s||s.setCDNPackages({IC3Client:t}),this.scenarioMarker.startScenario(F.default.GetIC3Client),this.IC3SDKProvider?[4,this.IC3SDKProvider.getSDK({hostType:O.default.IFrame,protocolType:L.default.IC3V1SDK,logger:this.ic3ClientLogger})]:[3,2];case 1:return r=c.sent(),[2,e(r)];case 2:return window.addEventListener("ic3:sdk:load",function(){return i(a,void 0,void 0,function(){var t,n,r;return o(this,function(i){switch(i.label){case 0:return this.debug&&console.debug("ic3:sdk:load"),t=window.Microsoft.CRM.Omnichannel.IC3Client.SDK,n=t.SDKProvider,this.IC3SDKProvider=n,[4,n.getSDK({hostType:O.default.IFrame,protocolType:L.default.IC3V1SDK,logger:this.ic3ClientLogger})];case 1:return r=i.sent(),this.scenarioMarker.completeScenario(F.default.GetIC3Client),e(r),[2]}})})}),[4,(0,v.loadScript)(t,function(){a.debug&&console.debug("IC3Client loaded!")},function(){a.scenarioMarker.failScenario(F.default.GetIC3Client,{ExceptionDetails:JSON.stringify({response:"IC3ClientLoadFailed"})}),n("Failed to load IC3Client")})];case 3:return c.sent(),[2]}})})})]}})})},e.prototype.setPrechatConfigurations=function(e){return i(this,void 0,void 0,function(){return o(this,function(t){return"true"===(0,Y.parseLowerCaseString)(e.msdyn_prechatenabled)&&e.PreChatSurvey&&e.PreChatSurvey.trim().length>0&&(this.preChatSurvey=e.PreChatSurvey,this.debug&&console.log("Prechat Survey!")),[2]})})},e.prototype.setDataMaskingConfiguration=function(e){return i(this,void 0,void 0,function(){var t,n,r,i,s;return o(this,function(o){if(e.setting.msdyn_maskforcustomer&&e.dataMaskingRules){for(t=0,n=Object.entries(e.dataMaskingRules);t<n.length;t++)r=n[t],i=r[0],s=r[1],this.dataMaskingRules.rules.push({id:i,regex:s});this.compileDataMaskingRegex()}return[2]})})},e.prototype.compileDataMaskingRegex=function(){this.regexCompiledForDataMasking=[];for(var e=0,t=this.dataMaskingRules.rules;e<t.length;e++){var n=t[e];try{var r=new RegExp(n.regex,"g");this.regexCompiledForDataMasking.push(r)}catch(e){console.error("Error compiling regex for data masking rule id ".concat(n.id,": ").concat(e))}}},e.prototype.setAuthSettingConfig=function(e){return i(this,void 0,void 0,function(){return o(this,function(t){switch(t.label){case 0:return e&&(this.authSettings=e),this.authSettings&&this.chatSDKConfig.getAuthToken?[4,this.setAuthTokenProvider(this.chatSDKConfig.getAuthToken,{throwError:!1})]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},e.prototype.setPersistentChatConfiguration=function(e){return i(this,void 0,void 0,function(){var t,n;return o(this,function(r){return t="true"===(0,Y.parseLowerCaseString)(e.msdyn_enablechatreconnect),(null===(n=e.msdyn_conversationmode)||void 0===n?void 0:n.toString())===w.default.PersistentChat.toString()&&(this.isPersistentChat=!0),t&&!this.isPersistentChat&&(this.isChatReconnect=!0),[2]})})},e.prototype.setLocaleIdConfiguration=function(e){return i(this,void 0,void 0,function(){return o(this,function(t){return this.localeId=e.msdyn_localeid||f.defaultLocaleId,[2]})})},e.prototype.setCallingOptionConfiguration=function(e){return i(this,void 0,void 0,function(){var t;return o(this,function(n){return t=e.msdyn_callingoptions,this.callingOption=(null==t?void 0:t.trim().length)>0?Number(t):b.default.NoCalling,[2]})})},e.prototype.setLiveChatVersionConfiguration=function(e){return i(this,void 0,void 0,function(){return o(this,function(t){return this.liveChatVersion=e||_.default.V2,[2]})})},e.prototype.setWidgetSnippetBaseUrl=function(e){return i(this,void 0,void 0,function(){var t,n,r;return o(this,function(i){return t=new RegExp('src="(https:\\/\\/[\\w-.]+)[\\w-.\\/]+"'),(n=e.msdyn_widgetsnippet)&&(r=n.match(t))&&r.length&&(this.widgetSnippetBaseUrl=r[1]),[2]})})},e.prototype.getChatConfig=function(){return i(this,arguments,void 0,function(e){var t,n,r,i,s,a,c;return void 0===e&&(e={}),o(this,function(o){switch(o.label){case 0:t=e.sendCacheHeaders,n=!0===t,o.label=1;case 1:return o.trys.push([1,3,,8]),[4,this.OCClient.getChatConfig(this.requestId,n)];case 2:return r=o.sent(),this.liveChatConfig=r,this.evaluateAMSAvailability(),this.buildConfigurations(r),this.debug&&console.log("[OmnichannelChatSDK][getChatConfig][liveChatVersion] ".concat(this.liveChatVersion)),[2,this.liveChatConfig];case 3:return i=o.sent(),(0,X.isCoreServicesOrgUrlDNSError)(i,this.coreServicesOrgUrl,this.dynamicsLocationCode)?(this.omnichannelConfig.orgUrl=this.unqServicesOrgUrl,s=this,[4,d.SDKProvider.getSDK(this.omnichannelConfig,(0,H.default)(!1),this.ocSdkLogger)]):[3,6];case 4:return s.OCClient=o.sent(),[4,this.OCClient.getChatConfig(this.requestId,n)];case 5:return r=o.sent(),[3,7];case 6:throw(null===(c=null===(a=i.response)||void 0===a?void 0:a.headers)||void 0===c?void 0:c.errorcode)&&parseInt(i.response.headers.errorcode)===x.default.WidgetNotFound&&console.warn("No widget with the given app id is present in the system."),i;case 7:return[3,8];case 8:return[2,this.liveChatConfig]}})})},e.prototype.buildConfigurations=function(e){return i(this,void 0,void 0,function(){var t,n,r,i,s;return o(this,function(o){return t=e.DataMaskingInfo,n=e.LiveChatConfigAuthSettings,r=e.LiveWSAndLiveChatEngJoin,i=e.LiveChatVersion,s=e.ChatWidgetLanguage,Promise.all([this.setDataMaskingConfiguration(t),this.setPrechatConfigurations(r),this.setAuthSettingConfig(n),this.setPersistentChatConfiguration(r),this.setCallingOptionConfiguration(r),this.setLocaleIdConfiguration(s),this.setLiveChatVersionConfiguration(i),this.setWidgetSnippetBaseUrl(r)]),[2]})})},e.prototype.resolveIC3ClientUrl=function(){return re.default.resolveIC3ClientUrl(this.chatSDKConfig)},e.prototype.resolveChatAdapterUrl=function(e){return re.default.resolveChatAdapterUrl(this.chatSDKConfig,this.liveChatVersion,e)},e.prototype.updateChatToken=function(e,t){return i(this,void 0,void 0,function(){var n,r;return o(this,function(i){switch(i.label){case 0:this.scenarioMarker.startScenario(F.default.UpdateChatToken,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),i.label=1;case 1:return i.trys.push([1,4,,5]),this.liveChatVersion!==_.default.V1?[3,3]:(n={token:e,regionGtms:t,visitor:!0},[4,this.IC3Client.initialize(n)]);case 2:i.sent(),i.label=3;case 3:return this.scenarioMarker.completeScenario(F.default.UpdateChatToken,{RequestId:this.requestId,ChatId:this.chatToken.chatId}),[3,5];case 4:return i.sent(),r={response:"UpdateChatTokenFailed"},this.scenarioMarker.failScenario(F.default.UpdateChatToken,{RequestId:this.requestId,ChatId:this.chatToken.chatId,ExceptionDetails:JSON.stringify(r)}),[3,5];case 5:return[2]}})})},e.prototype.setAuthTokenProvider=function(e){return i(this,arguments,void 0,function(e,t){var n,r,i;return void 0===t&&(t={}),o(this,function(o){switch(o.label){case 0:if(this.scenarioMarker.startScenario(F.default.GetAuthToken),this.chatSDKConfig.getAuthToken=e,!this.chatSDKConfig.getAuthToken)return[3,5];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.chatSDKConfig.getAuthToken()];case 2:if(n=o.sent())this.authenticatedUserToken=n,this.scenarioMarker.completeScenario(F.default.GetAuthToken);else{if(i={response:u.ChatSDKErrorName.UndefinedAuthToken},null==t?void 0:t.throwError)throw Error(i.response);this.scenarioMarker.failScenario(F.default.GetAuthToken,{ExceptionDetails:JSON.stringify(i)})}return[3,4];case 3:if(r=o.sent(),i={response:u.ChatSDKErrorName.GetAuthTokenFailed},r.message==u.ChatSDKErrorName.UndefinedAuthToken&&(i.response=r.message),this.scenarioMarker.failScenario(F.default.GetAuthToken,{ExceptionDetails:JSON.stringify(i)}),null==t?void 0:t.throwError)throw Error(i.response);return[3,4];case 4:return[3,6];case 5:if(i={response:u.ChatSDKErrorName.GetAuthTokenNotFound},this.scenarioMarker.failScenario(F.default.GetAuthToken,{ExceptionDetails:JSON.stringify(i)}),null==t?void 0:t.throwError)throw Error(i.response);o.label=6;case 6:return[2]}})})},e.prototype.useCoreServicesOrgUrlIfNotSet=function(){var e;if(!(0,p.isCoreServicesOrgUrl)(this.omnichannelConfig.orgUrl)&&!1!==(null===(e=this.chatSDKConfig.internalConfig)||void 0===e?void 0:e.createCoreServicesOrgUrlAtRuntime)){var t=p.unqOrgUrlPattern.exec(this.omnichannelConfig.orgUrl);if(t){this.dynamicsLocationCode=t[1];var n=(0,p.getCoreServicesGeoName)(this.dynamicsLocationCode);n&&(this.unqServicesOrgUrl=this.omnichannelConfig.orgUrl,this.coreServicesOrgUrl=(0,p.createCoreServicesOrgUrl)(this.omnichannelConfig.orgId,n),this.omnichannelConfig.orgUrl=this.coreServicesOrgUrl)}}},e.prototype.handleConversationJoinFailure=function(e,t){return i(this,void 0,void 0,function(){var n,r;return o(this,function(i){switch(i.label){case 0:if(!(e instanceof u.ChatSDKError&&(null==e?void 0:e.message)===u.ChatSDKErrorName.MessagingClientConversationJoinFailure)||(null===(r=this.chatSDKConfig.useCreateConversation)||void 0===r?void 0:r.disable)||t.liveChatContext&&Object.keys(t.liveChatContext).length>0||this.reconnectId)return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.internalEndChat()];case 2:return i.sent(),[3,4];case 3:return n=i.sent(),this.debug&&console.error("Failed to cleanup conversation after join failure:",n),[3,4];case 4:return[2]}})})},e.prototype.getPersistentChatHistory=function(){return i(this,arguments,void 0,function(e){var t,n,i,s,a,c,l,h,p;return void 0===e&&(e={}),o(this,function(o){switch(o.label){case 0:this.requestId||(this.requestId=(0,d.uuidv4)()),this.scenarioMarker.startScenario(F.default.GetPersistentChatHistory,{RequestId:this.requestId}),this.isInitialized||g.default.throwUninitializedChatSDK(this.scenarioMarker,F.default.GetPersistentChatHistory),this.isPersistentChat&&!0!==(null===(a=this.chatSDKConfig.persistentChat)||void 0===a?void 0:a.disable)||g.default.throwNotPersistentChatEnabled(this.scenarioMarker,F.default.GetPersistentChatHistory,{RequestId:this.requestId,ChatId:null===(c=this.chatToken)||void 0===c?void 0:c.chatId}),this.authenticatedUserToken||g.default.throwChatSDKError(u.ChatSDKErrorName.AuthenticatedUserTokenNotFound,new Error("Authenticated user token not found"),this.scenarioMarker,F.default.GetPersistentChatHistory,{RequestId:this.requestId,ChatId:null===(l=this.chatToken)||void 0===l?void 0:l.chatId}),o.label=1;case 1:return o.trys.push([1,3,,4]),(t={}).pageSize=e.pageSize||void 0,t.pageToken=e.pageToken||void 0,[4,this.OCClient.getPersistentChatHistory(this.requestId,r(r({},t),{authenticatedUserToken:this.authenticatedUserToken}))];case 2:return n=o.sent(),this.scenarioMarker.completeScenario(F.default.GetPersistentChatHistory,{RequestId:this.requestId,ChatId:null===(h=this.chatToken)||void 0===h?void 0:h.chatId}),[2,n];case 3:return i=o.sent(),s={RequestId:this.requestId,ChatId:null===(p=this.chatToken)||void 0===p?void 0:p.chatId,ErrorMessage:(null==i?void 0:i.message)||"Unknown error"},g.default.throwPersistentChatConversationRetrievalFailure(i,this.scenarioMarker,F.default.GetPersistentChatHistory,s),[3,4];case 4:return[2]}})})},e}();t.default=oe},369:(e,t,n)=>{"use strict";n.d(t,{Bd:()=>r,N6:()=>o,Qg:()=>s,lV:()=>u,p7:()=>i,qx:()=>a,tX:()=>c});const r="undefined"!=typeof window&&void 0!==window.document,i="object"==typeof self&&"function"==typeof self?.importScripts&&("DedicatedWorkerGlobalScope"===self.constructor?.name||"ServiceWorkerGlobalScope"===self.constructor?.name||"SharedWorkerGlobalScope"===self.constructor?.name),o="undefined"!=typeof Deno&&void 0!==Deno.version&&void 0!==Deno.version.deno,s="undefined"!=typeof Bun&&void 0!==Bun.version,a=void 0!==globalThis.process&&Boolean(globalThis.process.version)&&Boolean(globalThis.process.versions?.node),c=a&&!s&&!o,u="undefined"!=typeof navigator&&"ReactNative"===navigator?.product},393:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3364),i=n(860),o=function(){function e(e,t){this.sdk=e,this.logger=t}return e.prototype.log=function(e,t,n){if(this.isLoggingEnabled()){var r=i.default.getTelemetryEventData(this.sdk,t,n);this.logEvent(e,r)}},e.prototype.logEvent=function(e,t){this.isLoggingEnabled()&&setTimeout(this.logger.logClientSdkTelemetryEvent.bind(this.logger),0,e,t)},e.prototype.isLoggingEnabled=function(){return!r.default.isNullOrUndefined(this.logger)},e}();t.default=o},414:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resolveChatAdapterUrl=t.resolveIC3ClientUrl=void 0;var r=n(772),i=n(4273),o=n(7187),s=function(e){return e.ic3Config&&"ic3ClientCDNUrl"in e.ic3Config?e.ic3Config.ic3ClientCDNUrl:e.ic3Config&&"ic3ClientVersion"in e.ic3Config?o.default.getIC3ClientCDNUrl(e.ic3Config.ic3ClientVersion):o.default.getIC3ClientCDNUrl()};t.resolveIC3ClientUrl=s;var a=function(e,t,n){var s=[i.default.ACS,i.default.IC3,i.default.DirectLine];if(n&&!s.includes(n))throw new Error("ChatAdapter for protocol ".concat(n," currently not supported"));return n===i.default.DirectLine?function(e){return e.chatAdapterConfig&&"webChatDirectLineCDNUrl"in e.chatAdapterConfig?e.chatAdapterConfig.webChatDirectLineCDNUrl:e.chatAdapterConfig&&"webChatDirectLineVersion"in e.chatAdapterConfig?o.default.getDirectLineCDNUrl(e.chatAdapterConfig.webChatDirectLineVersion):o.default.getDirectLineCDNUrl()}(e):n===i.default.ACS||t===r.default.V2?function(e){return e.chatAdapterConfig&&"webChatACSAdapterCDNUrl"in e.chatAdapterConfig?e.chatAdapterConfig.webChatACSAdapterCDNUrl:e.chatAdapterConfig&&"webChatACSAdapterVersion"in e.chatAdapterConfig?o.default.getACSAdapterCDNUrl(e.chatAdapterConfig.webChatACSAdapterVersion):o.default.getACSAdapterCDNUrl()}(e):n===i.default.IC3||t===r.default.V1?function(e){return e.chatAdapterConfig&&"webChatIC3AdapterCDNUrl"in e.chatAdapterConfig?e.chatAdapterConfig.webChatIC3AdapterCDNUrl:e.chatAdapterConfig&&"webChatIC3AdapterVersion"in e.chatAdapterConfig?o.default.getIC3AdapterCDNUrl(e.chatAdapterConfig.webChatIC3AdapterVersion):o.default.getIC3AdapterCDNUrl()}(e):""};t.resolveChatAdapterUrl=a,t.default={resolveIC3ClientUrl:s,resolveChatAdapterUrl:a}},470:(e,t,n)=>{"use strict";var r=n(4994),i=n(3738);Object.defineProperty(t,"__esModule",{value:!0}),t.isRetryableError=d,t.axiosRetryHandlerWithNotFound=function(e,t){l(e,{retries:t.retries,waitTimeInMsBetweenRetries:t.waitTimeInMsBetweenRetries,shouldRetry:function(e){var n;return u(e,t.retryOn429)||(null===(n=e.response)||void 0===n?void 0:n.status)===s.default.notFoundStatusCode}})},t.default=void 0;var o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==i(e)&&"function"!=typeof e)return{default:e};var n=a(t);if(n&&n.has(e))return n.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var c=o?Object.getOwnPropertyDescriptor(e,s):null;c&&(c.get||c.set)?Object.defineProperty(r,s,c):r[s]=e[s]}return r.default=e,n&&n.set(e,r),r}(n(3770)),s=r(n(6009));function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(a=function(e){return e?n:t})(e)}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var u=function(e,t){var n,r,i;return!((null===(n=e.response)||void 0===n?void 0:n.status)===s.default.tooManyRequestsStatusCode&&!t)&&(d(e)||(0,o.isNetworkError)(e)||0===(null===(r=e.response)||void 0===r?void 0:r.status)||!(null!==(i=e.response)&&void 0!==i&&i.status))},l=function(e,t){void 0!==t.retryOn429&&null!==t.retryOn429||(t.retryOn429=!1),t.shouldRetry||(t.shouldRetry=function(e){return u(e,t.retryOn429)}),(0,o.default)(e,{retries:t.retries,retryCondition:t.shouldRetry,onRetry:function(e,n,r){var i=n.response,o=t.headerOverwrites;if(o&&null!=i&&i.headers){var s,a=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}(o);try{for(a.s();!(s=a.n()).done;){var u=s.value,l=null==i?void 0:i.headers[u.toLocaleLowerCase()];l&&r.headers&&(r.headers[u]=l)}}catch(e){a.e(e)}finally{a.f()}}},retryDelay:function(e,n){var r,i,o,a=t.waitTimeInMsBetweenRetries,c=null==n||null===(r=n.response)||void 0===r||null===(i=r.headers)||void 0===i?void 0:i["retry-after"],u=a;if(c){var l=parseInt(c);if(isNaN(l)){var d=new Date(c),h=(new Date).getTime();d&&d instanceof Date&&isFinite(d.getTime())&&(u=Math.max(0,d.getTime()-h))}else u=l*a;return u}return(null===(o=n.response)||void 0===o?void 0:o.status)===s.default.tooManyRequestsStatusCode?5e3:Math.pow(2,e)*a}})};function d(e){return"ECONNABORTED"!==e.code&&(!e.response||429===e.response.status||e.response.status>=500&&e.response.status<=599)}var h=l;t.default=h},477:()=>{},496:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.MessageSource=void 0,function(e){e.Polling="Poll",e.WebSocket="WS",e.GetRestCall="Get"}(n||(t.MessageSource=n={}))},514:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.read="read",e}();t.default=n},579:(e,t,n)=>{var r=n(3738).default;e.exports=function(e){if(null!=e){var t=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}throw new TypeError(r(e)+" is not iterable")},e.exports.__esModule=!0,e.exports.default=e.exports},656:(e,t,n)=>{"use strict";var r=n(4994);Object.defineProperty(t,"__esModule",{value:!0}),t.LoggingSanitizer=void 0;var i=r(n(3738)),o=r(n(7383)),s=r(n(4579)),a=r(n(3693)),c=r(n(6009)),u=r(n(6984)),l=function(){function e(){(0,o.default)(this,e)}return(0,s.default)(e,null,[{key:"stripCustomContextDataValues",value:function(e){var t;e&&(null===(t=Object.keys(e))||void 0===t||t.forEach(function(t){var n;null!==(n=e["".concat(t)])&&void 0!==n&&n.value&&(e["".concat(t)].value=c.default.hiddenContentPlaceholder)}))}},{key:"stripPreChatResponse",value:function(e){e&&Object.keys(e).forEach(function(t){e["".concat(t)]&&"Type"!==t&&(e["".concat(t)]=c.default.hiddenContentPlaceholder)})}},{key:"stripGeolocation",value:function(e){e&&(Object.keys(e).includes("longitude")&&(e.longitude=c.default.hiddenContentPlaceholder),Object.keys(e).includes("latitude")&&(e.latitude=c.default.hiddenContentPlaceholder))}},{key:"stripAuthenticationUserToken",value:function(e){e&&(Object.keys(e).includes(u.default.authenticatedUserToken)&&(e[u.default.authenticatedUserToken]=c.default.hiddenContentPlaceholder),Object.keys(e).includes(u.default.authCodeNonce)&&(e[u.default.authCodeNonce]=c.default.hiddenContentPlaceholder),Object.keys(e).includes(u.default.authorization)&&(e[u.default.authorization]=c.default.hiddenContentPlaceholder))}},{key:"stripRequestHeadersSensitiveProperties",value:function(t){e.stripAuthenticationUserToken(t),Object.keys(t).includes(u.default.authorization)&&(t[u.default.authorization]=c.default.hiddenContentPlaceholder)}},{key:"stripRequestPayloadData",value:function(t){if(null!=t&&t.data){var n;if("string"==typeof t.data)try{n=JSON.parse(t.data)}catch(e){n=void 0}n&&(Object.keys(n).includes("preChatResponse")&&e.stripPreChatResponse(n.preChatResponse),Object.keys(n).includes("customContextData")&&e.stripCustomContextDataValues(n.customContextData),e.stripGeolocation(n),t.data=JSON.stringify(n),t.data=e.stripEmailDataFromError(t.data))}}},{key:"stripEmailDataFromError",value:function(e){return e.replace(this.emailRegex,c.default.hiddenContentPlaceholder)}},{key:"stripAxiosErrorSensitiveProperties",value:function(t){var n,r,i,o,s,a,c,u,l,d;t.isAxiosError&&(null!=t&&null!==(n=t.config)&&void 0!==n&&n.headers&&e.stripAuthenticationUserToken(null==t||null===(c=t.config)||void 0===c?void 0:c.headers),null!=t&&null!==(r=t.config)&&void 0!==r&&r.data&&this.stripRequestPayloadData(null==t?void 0:t.config),null!=t&&null!==(i=t.response)&&void 0!==i&&null!==(o=i.config)&&void 0!==o&&o.data&&this.stripRequestPayloadData(null==t||null===(u=t.response)||void 0===u?void 0:u.config),null!=t&&null!==(s=t.response)&&void 0!==s&&null!==(a=s.config)&&void 0!==a&&a.headers&&e.stripAuthenticationUserToken(null==t||null===(l=t.response)||void 0===l||null===(d=l.config)||void 0===d?void 0:d.headers))}},{key:"stripErrorSensitiveProperties",value:function(e){var t;e&&"object"===(0,i.default)(e)&&(null===(t=Object.keys(e))||void 0===t?void 0:t.length)>0&&this.stripAxiosErrorSensitiveProperties(e)}}]),e}();t.LoggingSanitizer=l,(0,a.default)(l,"emailRegex",/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/g)},772:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.V1=1]="V1",e[e.V2=2]="V2"}(n||(n={})),t.default=n},781:(e,t,n)=>{"use strict";function r(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var i=r(n(3449)),o=r(n(70)),s=r(n(1219)),a=r(n(3893)),c="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{};function u(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function l(e,t){return e(t={exports:{}},t.exports),t.exports}var d=l(function(e,t){e.exports=function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=1)}([function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.Timespan=t.toJson=t.fetchWithTimeout=void 0,t.fetchWithTimeout=function(e,t){var n,r=new Promise(function(t,r){fetch(e).then(function(e){void 0!==n&&clearTimeout(n),t(e)}).catch(function(e){void 0!==n&&clearTimeout(n),r(e)})});if(0!==t){var i=new Promise(function(r,i){n=setTimeout(i,t,new Error("Fetch for '".concat(e.url,"' timed out")))});return Promise.race([r,i])}return r},t.toJson=function(e){try{return JSON.stringify(e)}catch(t){return"Unable to serialize object of type ".concat(typeof e)}};var r=function(){function e(){this.start=Date.now()}return Object.defineProperty(e.prototype,"duration",{get:function(){return Date.now()-this.start},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"startTime",{get:function(){return this.start},enumerable:!1,configurable:!0}),e.prototype.reset=function(){this.start=Date.now()},e}();t.Timespan=r},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__assign||function(){return i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?n(e.value):i(e.value).then(s,a)}c((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;a&&(a=0,n[0]&&(c=0)),c;)try{if(i=1,o&&(s=2&n[0]?o.return:n[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(s=(s=c.trys).length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){c.label=n[1];break}if(6===n[0]&&c.label<s[1]){c.label=s[1],s=n;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(n);break}s[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,s,a,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(t,"__esModule",{value:!0}),t.createRegistrarClient=t.RegistrarClient=void 0;var a=n(0),c=["skype","aad","cae"],u=function(e){function t(t){var n=e.call(this,t)||this;return n.name="CancelationError",n}return r(t,e),t}(Error),l=function(){function e(t,n,r){this.logger=t,this.maxBackoffInMs=n,this.initialDelay=r,this.backoffCount=0,this.id=++e.idCounter}return e.prototype.delay=function(e){var t=this;if(void 0!==this.timerHandle)throw new Error("Retry sequence logical failure");if(-1===this.backoffCount)return new Promise(function(e,t){t(new u("Cancelled"))});var n=this.calculateNextBackoffMs();return this.backoffCount++,this.logger.info("[RegistrarClient] Backing off ".concat(e," for ").concat(n," milliseconds with ID ").concat(this.id)),new Promise(function(r,i){t.cancelFunc=i,t.timerHandle=setTimeout(function(){t.logger.info("[RegistrarClient] Back off for ".concat(e," with ID ").concat(t.id," complete")),t.timerHandle=void 0,r()},n)})},e.prototype.cancel=function(){void 0!==this.timerHandle&&(this.logger.debug("Resetting back off"),clearTimeout(this.timerHandle),void 0!==this.cancelFunc&&this.cancelFunc(new u("Cancelled"))),this.backoffCount=-1},e.prototype.calculateNextBackoffMs=function(){var e=1+.4*(Math.random()-.5),t=this.initialDelay*Math.pow(2,this.backoffCount)*e;return t=Math.round(t),Math.min(this.maxBackoffInMs,t)},e.idCounter=0,e}(),d=function(){function e(e,t,n){var r;this.logger=e,this.tokenProvider=t,this.options=n,this.DEFAULT_MAX_RETRIES_FOR_GET_TOKEN=15,this.DEFAULT_MAX_BACKOFF_TIME_IN_MS=3e5,this.backoffs={},this.maxBackOffTime=this.options.maxRetryDelayMs>0?this.options.maxRetryDelayMs:this.DEFAULT_MAX_BACKOFF_TIME_IN_MS,this.maxRetriesForGetToken=void 0===n.maxRetriesForGetToken||null===n.maxRetriesForGetToken?this.DEFAULT_MAX_RETRIES_FOR_GET_TOKEN:n.maxRetriesForGetToken,this.proxyUrlRewrite=null!==(r=n.proxyUrlRewrite)&&void 0!==r?r:function(e){return e}}return e.prototype.setTelemetryLogger=function(e){this.eventLogger=e},e.prototype.register=function(e,t){return o(this,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:return[4,this.performRegistration(e,t,"pr_set_registration")];case 1:return n.sent(),this.cachedRegistrationParams=[e,t],[2]}})})},e.prototype.unregister=function(){return o(this,void 0,void 0,function(){var e;return s(this,function(t){switch(t.label){case 0:return this.logger.info("[RegistrarClient] sending unregister request"),e=new Request(this.proxyUrlRewrite("".concat(this.options.registrarUrl,"/").concat(this.options.registrationId)),{method:"DELETE",mode:"cors",headers:new Headers(i(i({},this.options.extraRegistrationHeaders),{accept:"application/json, text/javascript"}))}),[4,this.callRegistrar(e,"pr_delete_registration")];case 1:return t.sent(),[2]}})})},e.prototype.cancelPendingRequests=function(){var e=this;Object.keys(this.backoffs).forEach(function(t){e.backoffs[t].cancel()}),this.backoffs={}},e.prototype.resendRegistration=function(){return o(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:if(!this.cachedRegistrationParams)throw new Error("Re-registration failed because there is no registration parameters cached");return[4,this.performRegistration(this.cachedRegistrationParams[0],this.cachedRegistrationParams[1],"pr_resend_registration")];case 1:return e.sent(),[2]}})})},e.prototype.performRegistration=function(e,t,n){return o(this,void 0,void 0,function(){var r,o;return s(this,function(s){switch(s.label){case 0:return this.logger.info("[RegistrarClient] Sending register request"),r={clientDescription:e,registrationId:this.options.registrationId,nodeId:"",transports:t},o=new Request(this.proxyUrlRewrite(this.options.registrarUrl),{method:"POST",mode:"cors",headers:new Headers(i(i({},this.options.extraRegistrationHeaders),{"content-type":"application/json",accept:"application/json, text/javascript"})),body:(0,a.toJson)(r)}),[4,this.callRegistrar(o,n)];case 1:return s.sent(),[2]}})})},e.prototype.startBackoff=function(){var e=new l(this.logger,this.maxBackOffTime,this.options.initialRetryDelayMs);return this.backoffs[e.id]=e,e},e.prototype.stopBackoff=function(e){e.cancel(),delete this.backoffs[e.id]},e.prototype.getToken=function(e){return o(this,void 0,void 0,function(){var t,n,r,i,o,a,u;return s(this,function(s){switch(s.label){case 0:t=this.startBackoff(),n=0,s.label=1;case 1:return s.trys.push([1,3,,8]),this.logger.info("[RegistrarClient] Asking for a new token"),[4,this.tokenProvider({needFresh:!0,supportedTokenTypes:c,wwwAuthenticateHeader:e,purpose:"registrar"})];case 2:return r=s.sent(),this.stopBackoff(t),[2,r];case 3:i=s.sent(),s.label=4;case 4:return s.trys.push([4,6,,7]),n++,o=JSON.stringify(i),n>this.maxRetriesForGetToken?(a="[RegistrarClient] getToken retry limit hit. Will not retry now. Error: ".concat(o),this.logger.error(a),this.stopBackoff(t),[2,Promise.reject(a)]):(this.logger.warn("[RegistrarClient] Retrying for a new token. Retry Count: ".concat(n," Error: ").concat(o)),[4,t.delay("Fetching a new token")]);case 5:return s.sent(),[3,8];case 6:throw u=s.sent(),this.stopBackoff(t),u;case 7:return[3,8];case 8:return[3,1];case 9:return[2]}})})},e.prototype.callRegistrar=function(e,t){var n,r,i;return o(this,void 0,void 0,function(){var o,u,l,d,h,p,f,g,m,v,y,C,S,T,E,b;return s(this,function(s){switch(s.label){case 0:return o=this.startBackoff(),[4,this.tokenProvider({needFresh:!1,supportedTokenTypes:c,wwwAuthenticateHeader:void 0,purpose:"registrar"})];case 1:u=s.sent(),this.setTokenHeader(e,u),l=new a.Timespan,d=0,s.label=2;case 2:h=void 0,s.label=3;case 3:return s.trys.push([3,10,15,16]),p=e.clone(),[4,(0,a.fetchWithTimeout)(p,this.options.requestTimeoutMs)];case 4:return 401!==(h=s.sent()).status?[3,8]:++d>this.maxRetriesForGetToken?(f="[RegistrarClient] getSkypeToken retry limit hit. Will not retry now. Request '".concat(e.url,"' failed with ").concat(h.status," ").concat(h.statusText),this.logger.error(f),this.stopBackoff(o),[2,Promise.reject(f)]):(this.logger.warn("[RegistrarClient] Retry Count ".concat(d,". Request '").concat(e.url,"' failed with ").concat(h.status," ").concat(h.statusText)),g=null!==(r=null===(n=h.headers)||void 0===n?void 0:n.get("www-authenticate"))&&void 0!==r?r:void 0,m=this.setTokenHeader,v=[e],[4,this.getToken(g)]);case 5:return m.apply(this,v.concat([s.sent()])),d>1?[4,o.delay("Registrar call retry after 401")]:[3,7];case 6:s.sent(),s.label=7;case 7:return[3,22];case 8:if(h.status>=500&&h.status<600)throw new Error("Fetch for '".concat(e.url,"' failed with ").concat(h.status," ").concat(h.statusText));s.label=9;case 9:return[3,16];case 10:y=s.sent(),this.logger.error("[RegistrarClient] Request failed with ".concat(y)),s.label=11;case 11:return s.trys.push([11,13,,14]),[4,o.delay("Registrar call retry")];case 12:return s.sent(),[3,22];case 13:throw C=s.sent(),this.logger.error("[RegistrarClient] Request cancelled"),this.stopBackoff(o),C;case 14:return[3,16];case 15:return this.sendTelemetryEvent(t,e,h,l),[7];case 16:return this.stopBackoff(o),h.ok?[2,h]:[3,17];case 17:S=void 0,s.label=18;case 18:return s.trys.push([18,20,,21]),E=(T=JSON).stringify,[4,h.json()];case 19:return S=E.apply(T,[s.sent()]),[3,21];case 20:return s.sent(),S="no details",[3,21];case 21:throw b="Fetch for '".concat(e.url,"' failed with ").concat(h.status," ").concat(h.statusText," (").concat(S,", MS-CV: ").concat(null===(i=h.headers)||void 0===i?void 0:i.get("MS-CV"),")"),this.logger.error("[RegistrarClient] ".concat(b)),new Error(b);case 22:return[3,2];case 23:return[2]}})})},e.prototype.setTokenHeader=function(e,t){switch(e.headers.delete("X-Skypetoken"),e.headers.delete("Authorization"),e.headers.delete("X-MS-Migration"),t.tokenType.toLowerCase()){case"skype":e.headers.set("X-Skypetoken",t.token);break;case"aad":case"cae":e.headers.set("Authorization","Bearer ".concat(t.token));break;default:throw new Error("unsupported token type: ".concat(t.tokenType))}!1===this.options.usingLegacyTokenApi&&e.headers.set("X-MS-Migration","True")},e.prototype.sendTelemetryEvent=function(e,t,n,r){if(void 0!==this.eventLogger){var i={name:e,properties:{url:{value:t.url},result_code:{value:void 0!==n?n.status:0},begin_timestamp:{value:r.startTime},elapsed:{value:r.duration}}};this.eventLogger.logEvent(i)}},e}();t.RegistrarClient=d,t.createRegistrarClient=function(e,t,n){return new d(e,t,n)}}])});u(d);var h=l(function(e,t){var n;e.exports=(n=d,function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=20)}([function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0;var r=function(){function e(e,t){this.name=e,this.logger=t}return e.prototype.debug=function(e){this.logger.debug("[".concat(this.name,"] ").concat(e))},e.prototype.info=function(e){this.logger.info("[".concat(this.name,"] ").concat(e))},e.prototype.warn=function(e){this.logger.warn("[".concat(this.name,"] ").concat(e))},e.prototype.error=function(e){this.logger.error("[".concat(this.name,"] ").concat(e))},e}();t.Logger=r},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.USER_AUTHENTICATE_EVENT_NAME=t.SUPPORTED_TOKEN_TYPES=t.FAILED_MESSAGE_ACK=t.UNHANDLED_MESSAGE_ACK=t.HANDLED_MESSAGE_ACK=t.CLIENT_VERSION=t.constants=void 0,t.constants={TROUTER_INIT:"trouterinit",TROUTER_READY_EVENT:"trouterReadyEvent",TROUTER_READY_TIMEOUT:"trouterReadyTimeout",TROUTER_TOKEN_REQUEST:"trouterTokenRequest",TROUTER_TOKEN_GET_SUCCEEDED:"trouterTokenGetSucceeded",TROUTER_TOKEN_GET_FAILED:"trouterTokenGetFailed",TROUTER_RECONNECTING:"trouterReconnecting",RENEWAL:"renewal",NEW_CONNECTION:"newConnection",ENDPOINT_REGISTRATION_FAILED:"endpointRegistrationFailed"},t.CLIENT_VERSION="2024.14.01.55",t.HANDLED_MESSAGE_ACK=200,t.UNHANDLED_MESSAGE_ACK=404,t.FAILED_MESSAGE_ACK=500,t.SUPPORTED_TOKEN_TYPES=["skype","aad","cae"],t.USER_AUTHENTICATE_EVENT_NAME="user.authenticate"},function(e,t,n){var r,i;Object.defineProperty(t,"__esModule",{value:!0}),t.TrouterState=t.UserActivityState=void 0,function(e){e[e.Unknown=0]="Unknown",e[e.Active=1]="Active",e[e.Inactive=2]="Inactive"}(r||(t.UserActivityState=r={})),function(e){e[e.Unknown=0]="Unknown",e[e.Connected=2]="Connected",e[e.Disconnected=3]="Disconnected",e[e.Switching=9]="Switching"}(i||(t.TrouterState=i={}))},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?n(e.value):i(e.value).then(s,a)}c((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;a&&(a=0,n[0]&&(c=0)),c;)try{if(i=1,o&&(s=2&n[0]?o.return:n[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(s=(s=c.trys).length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){c.label=n[1];break}if(6===n[0]&&c.label<s[1]){c.label=s[1],s=n;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(n);break}s[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,s,a,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(t,"__esModule",{value:!0}),t.Timespan=t.CorrelationVector=t.fetchWithTimeout=t.calculateExpireTsInSec=t.calculateTtlInSec=t.toJson=void 0,t.toJson=function(e){try{return JSON.stringify(e)}catch(t){return"Unable to serialize object of type ".concat(typeof e)}},t.calculateTtlInSec=function(e){var t=Math.round((new Date).getTime()/1e3);return void 0!==e&&e>t?e-t:0},t.calculateExpireTsInSec=function(e){return Math.round((new Date).getTime()/1e3)+e},t.fetchWithTimeout=function(e,t){return r(this,void 0,void 0,function(){var n,r,o;return i(this,function(i){return r=new Promise(function(t,r){fetch(e).then(function(e){clearTimeout(n),t(e)}).catch(function(e){clearTimeout(n),r(e)})}),0!==t?(o=new Promise(function(r,i){var o=new URL(e.url),s=new Error("".concat(e.method," ").concat(o.origin).concat(o.pathname," timed out"));n=setTimeout(i,t,s)}),[2,Promise.race([r,o])]):[2,r]})})};var o=function(){function e(e){this.base=void 0!==e?e:this.createCorrelationVectorBase(),this.extension=0}return e.extend=function(t){return new e(t)},e.prototype.increase=function(){this.extension++},e.prototype.value=function(){return"".concat(this.base,".").concat(this.extension)},e.prototype.createCorrelationVectorBase=function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0987654321/+",t="AQgw",n="",r=0;r<21;r++)n+=e.charAt(Math.floor(64*Math.random()));return n+t.charAt(Math.floor(4*Math.random()))},e}();t.CorrelationVector=o;var s=function(){function e(){this.start=Date.now()}return Object.defineProperty(e.prototype,"duration",{get:function(){return Date.now()-this.start},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"startTime",{get:function(){return this.start},enumerable:!1,configurable:!0}),e.prototype.reset=function(){this.start=Date.now()},e}();t.Timespan=s},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.TrouterManagerState=t.UserActivityEventReason=t.ServerState=void 0;var r,i,o=n(3),s=function(){function e(e,t,n,r,i,o,s){this.connectionId=e,this.connectedClientId=t,this.domId=n,this.unsecureUrl=r,this.url=i,this.c2cUrlBase=o,this.expirationTsSec=s}return e.prototype.getRemainingTtlInSec=function(){return(0,o.calculateTtlInSec)(this.expirationTsSec)},e}();t.ServerState=s,function(e){e[e.Unknown=0]="Unknown",e[e.Modified=1]="Modified",e[e.Snapshot=2]="Snapshot",e[e.Connected=3]="Connected"}(r||(t.UserActivityEventReason=r={})),function(e){e[e.Unknown=0]="Unknown",e[e.Connected=2]="Connected",e[e.Disconnected=3]="Disconnected",e[e.Switching=9]="Switching",e[e.TerminalError=10]="TerminalError"}(i||(t.TrouterManagerState=i={}))},function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.redirectUrlIfPresent=t.ensureNumber=t.reconnectParamsWithoutUrls=t.adaptUrl=t.isV4ConnectEvent=t.usedProtocolAfterFallback=t.usedProtocol=void 0,t.usedProtocol=function(e,t){return"skype"===e&&"1"!==function(e){return"string"==typeof e?e:"number"==typeof e?e.toString():void 0}(null==t?void 0:t.scae)?"v4a":"v4c"},t.usedProtocolAfterFallback=function(e,t){return"v4c-websocket-failure"===(null==t?void 0:t.kind)?"v4a":e},t.isV4ConnectEvent=function(e){return Object.prototype.hasOwnProperty.call(e,"connectparams")},t.adaptUrl=function(e,t){return"v4a"===t?e.replace(/\/v4\/c\b/,"/v4/a").replace("wss://","https://").replace("ws://","http://"):e.replace(/\/v4\/a\b/,"/v4/c").replace("https://","wss://").replace("http://","ws://")},t.reconnectParamsWithoutUrls=function(e){if(void 0!==e)return r(r({},e),{reconnectUrl:void 0,serviceUrl:void 0})},t.ensureNumber=function(e){return"string"==typeof e?parseInt(e,10):e},t.redirectUrlIfPresent=function(e){if("redirect"===(null==e?void 0:e.kind)&&void 0!==e.host){var t=e.host;return t.endsWith("/")&&(t=t.substring(0,t.length-1)),t.endsWith("/v4/c")||t.endsWith("/v4/a")||(t+="/v4/c"),t}}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.TrouterFsm=t.State=void 0;var r,i,o=n(4),s=n(0),a=n(5);!function(e){e[e.Initial=0]="Initial",e[e.RetrievingToken=1]="RetrievingToken",e[e.Allocating=2]="Allocating",e[e.Handshaking=3]="Handshaking",e[e.Connecting=4]="Connecting",e[e.AnonymousConnecting=5]="AnonymousConnecting",e[e.WebsocketAuthenticating=6]="WebsocketAuthenticating",e[e.Connected=7]="Connected",e[e.Unregistering=8]="Unregistering",e[e.TerminalError=9]="TerminalError"}(r||(t.State=r={})),function(e){e[e.Initial=0]="Initial",e[e.Registering=1]="Registering",e[e.RegisteringButResendPending=2]="RegisteringButResendPending",e[e.Retrying=3]="Retrying",e[e.Registered=4]="Registered",e[e.RegistrationDisabled=5]="RegistrationDisabled"}(i||(i={}));var c=function(){function e(e,t,n,o){this.worker=t,this.incallModeEnabled=n,this.protocolSelector=o,this.state=r.Initial,this.autoReconnect=!0,this.logger=new s.Logger("ConnectionFsm",e),this.registrationState=i.Initial}return e.prototype.getState=function(){return this.state},e.prototype.isActive=function(){return this.state===r.Allocating||this.state===r.Connected||this.state===r.Handshaking||this.state===r.Connecting||this.state===r.RetrievingToken||this.state===r.AnonymousConnecting||this.state===r.WebsocketAuthenticating},e.prototype.isConnecting=function(){return this.state===r.Allocating||this.state===r.Handshaking||this.state===r.Connecting||this.state===r.AnonymousConnecting},e.prototype.start=function(){return this.state===r.Initial?(this.setState(r.RetrievingToken),this.worker.getToken(!0,!1,void 0),!0):(this.showIgnored("start"),!1)},e.prototype.stop=function(e,t){e&&(this.registrationState=i.Initial),this.worker.isIncallMode()&&this.worker.exitIncallMode(),this.worker.resetTokenBackoff(),this.worker.cancelPendingRegistrationRequests(),this.worker.stopConnectionTimer(),this.worker.stopPingTimer(),this.worker.clearSentEventTimers(),this.worker.stopRegistrationTimer(),this.worker.stopSocketIo(),this.state===r.Connected&&this.worker.sendDisconnectTelemetryEvent("connection stopped"),this.registrationState!==i.Registered&&this.registrationState!==i.Registering&&this.registrationState!==i.RegisteringButResendPending||this.state===r.Unregistering?t?(this.setState(r.TerminalError),this.worker.dispatchTerminalError()):(this.setState(r.Initial),this.worker.dispatchDisconnected()):(this.registrationState=i.Initial,this.setState(r.Unregistering),this.worker.sendUnregisterRequest())},e.prototype.onTokenReceived=function(e,t,n){this.state===r.RetrievingToken?"v4c"===(0,a.usedProtocolAfterFallback)(this.protocolSelector(e.tokenType,n),t)?(this.setState(r.AnonymousConnecting),this.worker.startConnectionTimer(),this.worker.connectV4c(e,t)):(this.setState(r.Allocating),this.worker.startConnectionTimer(),this.worker.sendAllocateRequest(e)):this.showIgnored("onTokenReceived")},e.prototype.checkConnection=function(e){e&&this.onPingInterval()},e.prototype.onAllocationSucceed=function(e){return this.state===r.Allocating&&this.registrationState===i.Registered&&this.worker.dispatchUnregistered(),this.state===r.Allocating?(this.setState(r.Handshaking),this.registrationState=i.Initial,this.worker.startSocketIo(e),!0):(this.showIgnored("onAllocationSucceed"),!1)},e.prototype.onAllocationFailed=function(e,t){this.state===r.Allocating?this.cleanUpAndInitiateReconnect({backoff:!0,allowCachedToken:!e,claimsChallenge:t}):this.showIgnored("onAllocationFailed")},e.prototype.onV4cException=function(){this.state!==r.AnonymousConnecting&&this.state!==r.WebsocketAuthenticating||(this.logger.error("v4c exception, falling back to longpoll"),this.cleanUpAndInitiateReconnect({backoff:!0,allowCachedToken:!0,fallbackReason:{kind:"v4c-websocket-failure"}}))},e.prototype.onConnectingTimeout=function(){this.state===r.Allocating||this.state===r.Connecting||this.state===r.Handshaking||this.state===r.AnonymousConnecting||this.state===r.WebsocketAuthenticating?this.cleanUpAndInitiateReconnect({backoff:!1,allowCachedToken:!0}):this.showIgnored("onConnectingTimeout")},e.prototype.onConnecting=function(){this.state===r.Handshaking?this.setState(r.Connecting):this.showIgnored("onConnecting")},e.prototype.onSocketConnect=function(e){this.state===r.AnonymousConnecting?(this.setState(r.WebsocketAuthenticating),this.worker.sendV4cAuthenticationEvent(e)):this.showIgnored("onSocketConnect")},e.prototype.onConnectingFailed=function(){this.state===r.Connecting?this.onConnectingTimeout():this.state===r.Handshaking?(this.logger.error("Unexpected error in Socket.io - no valid transports"),this.onConnectingTimeout()):this.state===r.AnonymousConnecting||this.state===r.WebsocketAuthenticating?(this.logger.info("/v4/c falling back to longpoll"),this.cleanUpAndInitiateReconnect({backoff:!0,allowCachedToken:!0,fallbackReason:{kind:"v4c-websocket-failure"}})):this.showIgnored("onConnectingFailed")},e.prototype.onSocketDisconnect=function(e){this.state===r.Handshaking||this.state===r.Connected||this.state===r.WebsocketAuthenticating?(this.state===r.Connected&&this.worker.sendDisconnectTelemetryEvent(null==e?void 0:e.toTelemetryString()),this.state===r.WebsocketAuthenticating&&this.worker.countDisconnectBeforeConnectionEstablishment(),"skypetoken-deprecated"===(null==e?void 0:e.reason)?(this.logger.error("Skypetoken deprecated response, not retrying any further"),this.onTerminalError()):this.cleanUpAndInitiateReconnect({backoff:this.state!==r.Connected&&"dup"!==(null==e?void 0:e.reason),allowCachedToken:"unauthorized"!==(null==e?void 0:e.reason),claimsChallenge:null==e?void 0:e.claims})):this.showIgnored("onSocketDisconnect")},e.prototype.onTrouterConnected=function(){this.state===r.Connecting||this.state===r.WebsocketAuthenticating?(this.setState(r.Connected),this.worker.resetTokenBackoff(),this.worker.stopConnectionTimer(),this.worker.sendUserActivityState(o.UserActivityEventReason.Connected,!0),this.worker.startPingTimer(),this.worker.dispatchConnected(),this.worker.shouldSkipRegistration()?(this.registrationState=i.RegistrationDisabled,this.worker.dispatchRegistered()):(this.registrationState=i.Registering,this.worker.sendRegisterRequest())):this.showIgnored("onTrouterConnected")},e.prototype.onReconnectRequired=function(e,t,n){this.state===r.AnonymousConnecting||this.state===r.WebsocketAuthenticating?void 0===n||"host"!==n.target||void 0===n.url||""===n.url?(this.logger.error("unexpected reconnect arguments: ".concat(null==n?void 0:n.target," ").concat(null==n?void 0:n.url,", reconnecting without cache")),this.cleanUpAndInitiateReconnect({backoff:!0,allowCachedToken:!0,fallbackReason:{kind:"redirect-no-host"}})):this.cleanUpAndInitiateReconnect({backoff:!0,allowCachedToken:!0,fallbackReason:{kind:"redirect",host:n.url}}):this.worker.dispatchReconnectIsRequired(e,t)},e.prototype.disableAutoReconnect=function(){this.autoReconnect=!1},e.prototype.onDownstreamRequest=function(e){this.state===r.Connected?(this.switchToIncallModeIfEnabled(),this.worker.dispatchDownstreamRequest(e)):this.showIgnored("onDownstreamRequest")},e.prototype.onTrouterMessageLost=function(e){this.state===r.Connected?this.worker.dispatchTrouterMessageLost(e):this.showIgnored("onTrouterMessageLost")},e.prototype.onPingInterval=function(){this.state===r.Connected?this.worker.sendPingRequest():this.showIgnored("onPingInterval")},e.prototype.onPingResponseTimeout=function(){this.onMissedResponse("onPingResponseTimeout")},e.prototype.onPingResponse=function(){this.state===r.Connected||this.showIgnored("onPingResponse")},e.prototype.onRegistrationFailed=function(){this.state===r.Connected&&this.registrationState===i.Registering?(this.worker.dispatchUnregistered(),this.registrationState=i.Retrying,this.worker.startRegistrationRetryTimer()):this.state===r.Connected&&this.registrationState===i.RegisteringButResendPending?(this.registrationState=i.Registering,this.worker.sendRegisterRequest()):this.showIgnored("onRegistrationFailed")},e.prototype.onRetryRegistration=function(){this.state===r.Connected&&this.registrationState===i.Retrying?(this.registrationState=i.Registering,this.worker.sendRegisterRequest()):this.showIgnored("onRetryRegistration")},e.prototype.onRegistrationSucceeded=function(){this.state===r.Connected&&this.registrationState===i.Registering?(this.registrationState=i.Registered,this.worker.dispatchRegistered(),this.worker.startRegistrationTimer()):this.state===r.Connected&&this.registrationState===i.RegisteringButResendPending?(this.registrationState=i.Registering,this.worker.sendRegisterRequest()):this.showIgnored("onRegistrationSucceeded")},e.prototype.onRegistrationNearExpiry=function(){this.state===r.Connected&&this.registrationState===i.Registered?(this.registrationState=i.Registering,this.worker.sendRegisterRequest()):this.showIgnored("onRegistrationNearExpiry")},e.prototype.onUnregistrationDone=function(){this.state===r.Unregistering?(this.setState(r.Initial),this.worker.dispatchUnregistered(),this.worker.dispatchDisconnected()):this.showIgnored("onUnregistrationDone")},e.prototype.onResendRegistration=function(){this.worker.dispatchUnregistered(),this.state===r.Connected&&this.registrationState===i.Registered?(this.registrationState=i.Registering,this.worker.stopRegistrationTimer(),this.worker.sendRegisterRequest()):this.state===r.Connected&&this.registrationState===i.Registering&&(this.registrationState=i.RegisteringButResendPending)},e.prototype.onIncallModeTimer=function(){this.worker.exitIncallMode(),this.state===r.Connected?(this.worker.stopPingTimer(),this.worker.startPingTimer()):this.showIgnored("onIncallModeTimer")},e.prototype.onSetNewUserActivityState=function(){this.worker.sendUserActivityState(o.UserActivityEventReason.Modified,this.state===r.Connected)},e.prototype.onActivityStateResponseTimeout=function(){this.onMissedResponse("onActivityStateResponseTimeout")},e.prototype.forceReconnect=function(e){this.state===r.Connected&&this.worker.sendDisconnectTelemetryEvent(e),this.worker.resetTokenBackoff(),this.cleanUpAndInitiateReconnect({backoff:!1,allowCachedToken:!0})},e.prototype.onTerminalError=function(){this.logger.error("Cannot proceed, reached terminal state. Switching from state '".concat(r[this.state],"' to ").concat(r[r.TerminalError])),this.stop(!0,!0),this.setState(r.TerminalError)},e.prototype.onMissedResponse=function(e){this.state===r.Connected?(this.worker.sendDisconnectTelemetryEvent(e),this.cleanUpAndInitiateReconnect({backoff:!1,allowCachedToken:!0})):this.showIgnored(e)},e.prototype.showIgnored=function(e){this.logger.debug("Ignoring event '".concat(e,"' in state '").concat(r[this.state],"'"))},e.prototype.setState=function(e){this.logger.info("Switching from state '".concat(r[this.state],"' to state '").concat(r[e],"'")),this.state!==e?this.state=e:this.logger.error("Attempt to switch to the current state '".concat(r[e],"'"))},e.prototype.switchToIncallModeIfEnabled=function(){this.incallModeEnabled&&(this.worker.isIncallMode()||(this.worker.enterIncallMode(),this.worker.stopPingTimer(),this.worker.startPingTimer()),this.worker.restartIncallModeTimer())},e.prototype.cleanUpAndInitiateReconnect=function(e){if(!this.autoReconnect)return this.logger.info("Automatic reconnect is disabled, stopping this connection"),void this.stop(!0);this.worker.cancelPendingRegistrationRequests(),this.worker.stopConnectionTimer(),this.worker.stopPingTimer(),this.worker.clearSentEventTimers(),this.worker.stopRegistrationTimer(),this.worker.stopSocketIo(),this.setState(r.RetrievingToken),this.worker.dispatchReconnecting(),this.worker.getToken(e.allowCachedToken,e.backoff,e.claimsChallenge,e.fallbackReason)},e}();t.TrouterFsm=c},function(e,t,n){function r(e,t){var n=t?void 0:{"X-MS-Migration":"True"};switch(e.tokenType.toLowerCase()){case"skype":return s({"X-Skypetoken":e.token},n);case"aad":case"cae":return s({Authorization:"Bearer ".concat(e.token)},n);default:throw new Error("unsupported token type: ".concat(e.tokenType))}}function i(e){return"object"==typeof e&&null!==e&&void 0!==e.stack?(0,d.toJson)(e.stack):'"(no error.stack)"'}function o(e){return"object"==typeof e&&null!==e&&"string"==typeof e.message?e.message:"(no error.message)"}var s=this&&this.__assign||function(){return s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},s.apply(this,arguments)},a=this&&this.__awaiter||function(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?n(e.value):i(e.value).then(s,a)}c((r=r.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;a&&(a=0,n[0]&&(c=0)),c;)try{if(i=1,o&&(s=2&n[0]?o.return:n[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(s=(s=c.trys).length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){c.label=n[1];break}if(6===n[0]&&c.label<s[1]){c.label=s[1],s=n;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(n);break}s[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,s,a,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(t,"__esModule",{value:!0}),t.TrouterConnection=t.ReconnectReason=void 0;var u,l=n(21),d=n(3),h=n(15),p=n(1),f=n(16),g=n(17),m=n(2),v=n(4),y=n(0),C=n(5),S=n(6),T=n(12),E=function(){this.cv=p.CLIENT_VERSION,this.ua="",this.hr="",this.v=""},b=function(){function e(){this["force new connection"]=!0,this.reconnect=!1,this.query="",this.ackTimeoutMs=5e3}return e.prototype.rewriteUrlForProxy=function(e){return e},e}(),I="MS-CV",w=function(){function e(e,t){this.logger=t,this.cvCounter=0;var n=JSON.parse(e);this.startTS=this.safeJsonNumber(n,"startTS",0),this.url=this.safeJsonString(n,"url",""),this.shortUrl=this.safeJsonString(n,"shortUrl",""),this.body=this.safeJsonString(n,"body",""),this.headers=this.safeJsonRecord(n,"headers",{}),this.id=this.safeJsonNumber(n,"id",-1),this.method=this.safeJsonString(n,"method",""),this.replied=!1,this.timedout=!1,this.receivedCv=this.headers[I],this.updateCvHeader()}return Object.defineProperty(e.prototype,"correlationVector",{get:function(){return this.receivedCv?"".concat(this.receivedCv,".").concat(this.cvCounter):""},enumerable:!1,configurable:!0}),e.prototype.on=function(e,t){"data"===e?this.dataCallback=t:"end"===e&&("function"==typeof this.dataCallback&&this.dataCallback(this.body),t())},e.prototype.incrementCorrelationVector=function(){++this.cvCounter,this.updateCvHeader()},e.prototype.updateCvHeader=function(){var e=this.correlationVector;e&&(this.headers[I]=e)},e.prototype.safeJsonNumber=function(e,t,n){var r;if(null!=e&&Object.prototype.hasOwnProperty.call(e,t)){var i=e;if("number"==typeof i[t])return i[t];if("string"==typeof i[t])return parseFloat(i[t]);null===(r=this.logger)||void 0===r||r.warn("unexpected type of '".concat(t,"': ").concat(typeof i[t]))}return n},e.prototype.safeJsonString=function(e,t,n){var r;if(null!=e&&Object.prototype.hasOwnProperty.call(e,t)){var i=e;if("string"==typeof i[t])return i[t];null===(r=this.logger)||void 0===r||r.warn("unexpected type of '".concat(t,"': ").concat(typeof i[t]))}return n},e.prototype.safeJsonRecord=function(e,t,n){var r;if(null!=e&&Object.prototype.hasOwnProperty.call(e,t)){var i=e;if("object"==typeof i[t])return i[t];null===(r=this.logger)||void 0===r||r.warn("unexpected type of '".concat(t,"': ").concat(typeof i[t]))}return n},e}(),R=function(){function e(e,t,n){this.request=e,this.responseData=t,this.sendResponse=n}return e.prototype.writeHead=function(e,t){this.responseData.status=e,this.responseData.headers=t},e.prototype.write=function(e){this.responseData.body+=e},e.prototype.end=function(e){return e&&(this.responseData.body+=e),this.sendResponse(this.request,this.responseData)},e}(),A=function(e){this.name=e,this.args={},this.timeoutTimerId=0};!function(e){e[e.Configuration=0]="Configuration",e[e.ServerInitiated=1]="ServerInitiated"}(u||(t.ReconnectReason=u={}));var O=function(){function e(e,t,n,r,i,o,s,a){var c,u=this;this.options=t,this.manager=n,this.tokenProvider=r,this.usingLegacyTokenApi=i,this.protocolSelector=s,this.audienceSubscriptionState=a,this.WEBSOCKET_TRANSPORT_NAME="websocket",this.XHR_POLLING_TRANSPORT_NAME="xhr-polling",this.AUDIENCE_SUBSCRIPTION_RESULT_ERROR="Error",this.AUDIENCE_SUBSCRIPTION_RESULT_UNSUBSCRIBED="Unsubscribed",this.AUDIENCE_SUBSCRIPTION_RESULT_TIMEOUT="Timeout",this.AUDIENCE_SUBSCRIPTION_RESULT_BAD_REQUEST="BadRequest",this.AUDIENCE_SUBSCRIPTION_STATE_QUERY_PARAM_REGEX=/&audienceSubscriptionState=[^&]*|^audienceSubscriptionState=[^&]*&?/,this.connectionId="",this.inIncallMode=!1,this.connectionAttempt=0,this.connectedClientId="",this.isNavigatorOnline=!0,this.onNavigatorOnlineStatusUpdateBound=this.onNavigatorOnlineStatusUpdate.bind(this),this.c2cUrlBase="",this.connectingErrorsInRow=0,this.unauthorizedErrorCount=0,this.pendingSentEventTimers={},this.lastDisconnectReason="",this.UNKNOWN_TRANSPORT="unknown_transport",this.connectingErrorsThreshold=3,this.pendingAudienceSubscription=void 0,this.logger=new y.Logger("Connection",e),this.timeoutOptions=this.options.timeoutOptions,this.tokenBackoff=new g.ExponentialBackoff(this.logger,this.timeoutOptions.maxBackoffMs),this.clientID=Date.now(),"undefined"!=typeof window&&window.location&&(this.domId=window.location.hostname);var d=new E;d.cv=p.CLIENT_VERSION,d.ua="",(null===(c=this.options)||void 0===c?void 0:c.clientInfo)&&(d.ua=this.safeString(this.options.clientInfo.ua),d.v=this.safeString(this.options.clientInfo.v)),this.clientInfo=d,this.connectionTracker=new h.ConnectionTracker(e,this.clientID,this.clientInfo,function(){return u.getServerState()},this.options.endpointId,this.options.clientCorrelationID,this.options.environment),this.applyConnectionTrackerOptions(t);var f=this.options.incallModeTimeoutMs>0;if(this.fsm=new S.TrouterFsm(e,this,f,this.protocolSelector),t.registration){var m={registrarUrl:t.registration.registrarUrl,proxyUrlRewrite:t.rewriteUrlForProxy,registrationId:t.registration.registrationId,requestTimeoutMs:t.timeoutOptions.fetchTimeoutMs,initialRetryDelayMs:1e3,maxRetryDelayMs:t.timeoutOptions.maxBackoffMs,usingLegacyTokenApi:this.usingLegacyTokenApi,maxRetriesForGetToken:t.retryLimitOnTokenFetch,extraRegistrationHeaders:t.extraConnectionHeaders};this.registrarClient=(0,l.createRegistrarClient)(e,this.tokenProvider,m)}this.userActivityState=o}return e.prototype.start=function(e){this.logger.info("Starting"),this.reconnectParams=e,"undefined"!=typeof window&&window.navigator&&window.addEventListener?(this.isNavigatorOnline=window.navigator.onLine,window.addEventListener("online",this.onNavigatorOnlineStatusUpdateBound),window.addEventListener("offline",this.onNavigatorOnlineStatusUpdateBound),this.logger.debug("Registered for browser online notifications - current state: ".concat(this.isNavigatorOnline))):this.isNavigatorOnline=!0,this.fsm.start()},e.prototype.stop=function(e){this.logger.info("Stopping"),"undefined"!=typeof window&&window.navigator&&(window.removeEventListener("online",this.onNavigatorOnlineStatusUpdateBound),window.removeEventListener("offline",this.onNavigatorOnlineStatusUpdateBound)),this.fsm.stop(e),this.connectionTracker.close()},e.prototype.configure=function(e){var t=this.options.trouterUrl!==e.trouterUrl;this.options=e,this.applyConnectionTrackerOptions(e),t&&(this.logger.info("Configuration changed. Reconnection required."),this.fsm.onReconnectRequired(!1,u.Configuration))},e.prototype.checkConnection=function(e){this.logger.info("checkConnection called with ".concat(e)),this.fsm.checkConnection(e),e&&this.connectionTracker.sendTelemetry(h.ClientEventName.CheckConnection,{disconnectDetected:e},[])},e.prototype.disableRegistrationsAndAutoReconnect=function(){this.stopRegistrationTimer(),this.cancelPendingRegistrationRequests(),this.fsm.disableAutoReconnect()},e.prototype.getServerState=function(){return new v.ServerState(this.connectionId,this.connectedClientId,this.domId?this.domId:"",this.allocateResult?this.allocateResult.url:"",this.allocateResult?this.allocateResult.surl:"",this.c2cUrlBase,this.connectionExpireTimestampInSecs)},e.prototype.getState=function(){return this.fsm.getState()},e.prototype.getToken=function(e,t,n,r,i){var o=this;void 0===i&&(i=0),this.logger.info("Getting token ".concat(t?"with backoff":"without backoff"));var s=function(){o.connectionTracker.trackStart("token");var t={needFresh:!e,wwwAuthenticateHeader:n,supportedTokenTypes:p.SUPPORTED_TOKEN_TYPES,purpose:"trouter"};o.logger.info("Requesting token: needFresh=".concat(t.needFresh," ")+"types=[".concat(p.SUPPORTED_TOKEN_TYPES,"], ")+"wwwAuthenticateHeader is ".concat(t.wwwAuthenticateHeader?"non empty":"empty")),o.tokenProvider(t).then(function(e){o.logger.debug("".concat(e.tokenType," token is received")),o.connectionTracker.trackEnd("token"),o.fsm.onTokenReceived(e,r,o.reconnectParams)}).catch(function(t){var s=(0,d.toJson)(t.stack);if(o.logger.error("Getting token failed, will retry after timeout. Error: ".concat(s)),o.connectionTracker.trackError("token",s),!o.canRetryTokenFetchRequest(i+o.unauthorizedErrorCount))return o.connectionTracker.trackError("token","getToken retry limit hit, reached terminal error state"),o.resetTokenBackoff(),void o.fsm.onTerminalError();o.getToken(e,!0,n,r,i+1)})};t?this.tokenBackoff.backoff("getting token",s):(this.resetTokenBackoff(),s())},e.prototype.startConnectionTimer=function(){var e=this;this.stopConnectionTimer(),this.logger.debug("Starting connection timeout for ".concat(this.timeoutOptions.connectionTimeoutMs," ms")),this.connectionTimeoutId=setTimeout(function(){e.logger.info("Connection timeout is fired"),e.fsm.onConnectingTimeout()},this.timeoutOptions.connectionTimeoutMs)},e.prototype.stopConnectionTimer=function(){this.connectionTimeoutId&&(this.logger.debug("Stopping connection timeout"),clearTimeout(this.connectionTimeoutId),this.connectionTimeoutId=void 0)},e.prototype.startPingTimer=function(){var e=this;"websocket"===this.transportTypeName?(this.logger.debug("Starting ping timeout for ".concat(this.timeoutOptions.pingTimeoutMs," ms")),this.pingTimerId=setInterval(function(){e.logger.info("Ping interval fired"),e.fsm.onPingInterval()},this.timeoutOptions.pingTimeoutMs)):this.logger.debug("Not starting ping for transport ".concat(this.transportTypeName))},e.prototype.stopPingTimer=function(){this.pingTimerId&&(this.logger.debug("Stopping ping timeout"),this.clearPingResponseTimer(),clearInterval(this.pingTimerId),this.pingTimerId=void 0)},e.prototype.shouldSkipRegistration=function(){return void 0===this.options.registration},e.prototype.hasCustomRegistrationTtl=function(){var e,t;return void 0!==(null===(e=this.options.registration)||void 0===e?void 0:e.registrarTtlSec)&&0!==(null===(t=this.options.registration)||void 0===t?void 0:t.registrarTtlSec)},e.prototype.startRegistrationTimer=function(){var e=this;this.stopRegistrationTimer();var t=this.getRegistrationTtl(),n=t[0],r=t[1];if(n<=30||!r)return this.logger.debug("Starting registration expiration timer (TTL ".concat(n," sec)")),void(this.registrationTimerId=setTimeout(function(){e.registrationTimerId=void 0,e.logger.warn("Registration expired but the connection is still alive. Should never happen"),e.dispatchUnregistered()},1e3*n));var i=n-30;this.logger.debug("Starting registration extension timer for ".concat(i," sec")),this.registrationTimerId=setTimeout(function(){e.logger.info("Registration extension timer fired"),e.registrationTimerId=setTimeout(function(){e.registrationTimerId=void 0,e.logger.debug("Registration extension did not happen in time"),e.dispatchUnregistered()},3e4),e.fsm.onRegistrationNearExpiry()},1e3*i)},e.prototype.startRegistrationRetryTimer=function(){var e=this;this.stopRegistrationTimer(),this.registrationTimerId=setTimeout(function(){e.registrationTimerId=void 0,e.fsm.onRetryRegistration()},123e3)},e.prototype.stopRegistrationTimer=function(){this.registrationTimerId&&(this.logger.debug("Stopping registration timeout"),clearTimeout(this.registrationTimerId),this.registrationTimerId=void 0)},e.prototype.resendRegistration=function(){if(!this.registrarClient)throw new Error("Trouter Client not configured to handle registrations");return this.fsm.onResendRegistration(),Promise.resolve()},e.prototype.buildSocketIoUrlParams=function(e,t){if(!this.allocateResult)throw new Error("Allocate result is undefined in buildSocketIoUrlParams()");for(var n={},r=this.allocateResult.connectparams,i=0,o=Object.keys(r);i<o.length;i++){var s=o[i];if(void 0!==r[s]){var a=r[s];"string"==typeof a||"number"==typeof a?n[s]=a:this.logger.error("signatureData[".concat(s,"] has unsupported type ").concat(typeof a))}}return n.v="v4",n.tc=encodeURI((0,d.toJson)(this.clientInfo)),n.timeout=this.timeoutOptions.pingTimeoutMs/1e3,n.auth="true",this.options.endpointId&&(n.epid=this.options.endpointId),e&&(n.userActivity=encodeURI((0,d.toJson)(e))),t&&(n.audienceSubscriptionState=encodeURIComponent((0,d.toJson)(t))),this.appendConnectedClientIds(this.buildQuery(n),!0)},e.prototype.startSocketIo=function(e){var t,n;if(this.logger.debug("Starting socket io"),this.connectionTracker.trackStart("connectSocket"),!this.allocateResult)throw new Error("Allocate result is undefined in startSocketIo()");var i=this.options.ioOptions?s({},this.options.ioOptions):new b,o=this.userActivityState.state!==m.UserActivityState.Unknown?this.userActivityState.increaseCvAndGetEventObject():void 0,a=null===(t=this.audienceSubscriptionState)||void 0===t?void 0:t.increaseCvAndGetEventObject();if(i["force new connection"]=!0,i.reconnect=!1,i.rewriteUrlForProxy=this.options.rewriteUrlForProxy,i.requestHeaders=s(s({},this.options.extraConnectionHeaders),r(e,this.usingLegacyTokenApi)),i.query=this.buildSocketIoUrlParams(o,a),this.logger.info("connecting to ".concat(this.allocateResult.socketio,"?").concat(i.query)),this.stopSocketIo(),this.socket=(null!==(n=this.options.io)&&void 0!==n?n:T).connect(this.allocateResult.socketio,i),void 0===this.socket)throw new Error("Can't create Socket.io object");this.attachSocketIoHandlers(this.socket,e,o,a)},e.prototype.stopSocketIo=function(){if(this.socket){this.logger.debug("clearing socket.io");try{for(var e=0,t=["connecting","connect","connect_failed","close_during_connecting","disconnect","reconnect","reconnect_failed","reconnecting","error","message","trouter.connected","trouter.reconnect","trouter.message_loss"];e<t.length;e++){var n=t[e];this.socket.removeAllListeners(n)}this.socket.disconnect(),this.logger.debug("cleared socket"),this.socket=void 0}catch(e){this.logger.error("exception in disconnecting previous socket. Error: ".concat(i(e)))}}},e.prototype.dispatchConnected=function(){this.logger.info("dispatching connected"),this.manager.onConnected(this)},e.prototype.dispatchRegistered=function(){this.logger.info("dispatching registered"),this.manager.onRegistered(this)},e.prototype.dispatchUnregistered=function(){this.logger.info("dispatching unregistered"),this.manager.onUnregistered(this)},e.prototype.dispatchDownstreamRequest=function(e){var t=this;this.logger.debug("dispatching downstream request");try{var n=new R(e,new h.ResponseData(e.id),function(e,n){return t.logger.debug("sending response to downstream"),t.sendResponse(e,n)});this.manager.onDownstreamRequest(this,e,n)}catch(e){this.logger.error("exception in socket.on message. Error : ".concat(i(e)))}},e.prototype.dispatchReconnecting=function(){this.logger.info("dispatching reconnecting"),this.manager.onReconnecting(this)},e.prototype.dispatchReconnectIsRequired=function(e,t){this.logger.info("dispatching reconnect is required by server"),this.manager.onReconnectIsRequired(this,e,t)},e.prototype.dispatchDisconnected=function(){this.logger.info("dispatching disconnected"),this.manager.onDisconnected(this)},e.prototype.dispatchTerminalError=function(){this.logger.info("dispatching terminal error"),this.manager.onTerminalError(this)},e.prototype.dispatchTrouterMessageLost=function(e){this.logger.info("dispatching trouter message lost"),this.manager.onTrouterMessageLost(e)},e.prototype.countDisconnectBeforeConnectionEstablishment=function(){this.logger.warn("counting disconnect before connection was fully established as a connection failure"),++this.connectingErrorsInRow>=this.connectingErrorsThreshold&&this.resetReconnectParamsOnErrorThreshold()},e.prototype.sendProcessedDroppedIndicators=function(e){var t=this;try{this.logger.debug("emitting processed flow tags to the server");var n=new A("trouter.processed_message_loss");n.args={droppedIndicators:e},this.sendDownstreamEvent(n,function(){t.logger.info("emitted processed flow tags to the server")})}catch(e){var r=i(e);this.logger.error("unable to send processed message loss event. Error: ".concat(r)),this.connectionTracker.trackError("trouter.processed_message_loss",r,!1)}},e.prototype.sendAllocateRequest=function(e){var t=this;this.connectionAttempt++,this.connectionTracker.trackNewConnection();var n,i=this.options.trouterUrl,o=this.reconnectParams,a="string"==typeof(null==o?void 0:o.se)?parseInt(o.se,10):"number"==typeof(null==o?void 0:o.se)?o.se:void 0;a&&a<=Date.now()+36e5&&(this.logger.warn("Dropping expired cached connection parameters: ".concat(new Date(a))),this.reconnectParams=o=void 0),o&&o.serviceUrl!==i&&(this.logger.warn("Dropping cached connection parameters for a different environment (".concat(o.serviceUrl,", now ").concat(i,")")),this.reconnectParams=o=void 0),(null==o?void 0:o.reconnectUrl)&&(i=o.reconnectUrl),n=o?s(s({},o),{serviceUrl:void 0,reconnectUrl:void 0}):null,i=(0,C.adaptUrl)(i,"v4a"),i=this.appendCorrelationIds(i,!1),i=this.appendEndpointId(i,!1),n&&(i+="&".concat(this.buildQuery(n)),n.v||(i+="&v=".concat("v4"))),i=this.options.rewriteUrlForProxy(i);var c=new Request(i,{method:"POST",mode:"cors",headers:new Headers(s(s({"Content-Type":"text/plain"},this.options.extraConnectionHeaders),r(e,this.usingLegacyTokenApi)))});this.logger.info("sendAllocateRequest: POST ".concat(i)),this.connectionTracker.trackStart("allocation");var u,l=Date.now(),h=-1,p=!1;(0,d.fetchWithTimeout)(c,this.timeoutOptions.fetchTimeoutMs).then(function(e){var n;if(h=e.status,!e.ok)throw u=null!==(n=e.headers.get("www-authenticate"))&&void 0!==n?n:void 0,p="1"===e.headers.get("x-trouter-skypetoken-deprecated"),t.logger.warn("Allocation request got response status ".concat(e.status,", www-authenticate header was ").concat(u?"not empty":"empty")),new Error(e.statusText);var r=e.headers.get("content-type");if(!r||"application/json"!==r&&!r.startsWith("application/json;"))throw new Error("Content-type '".concat(r,"' is unexpected"));return t.connectionTracker.trackEnd("allocation"),e.json()}).then(function(n){t.unauthorizedErrorCount=0,t.onAllocationResponse(n,e)}).catch(function(e){t.connectingErrorsInRow++;var n="".concat(e).concat(h>=0?", status code ".concat(h):"");if(t.logger.error("".concat(t.connectingErrorsInRow," failed connecting attempt(s) in a row. ").concat(n)),t.connectionTracker.trackError("allocation",n),p){var r="Skypetoken deprecated response, not retrying any further";return t.logger.error(r),t.connectionTracker.trackError("allocation",r),void t.fsm.onTerminalError()}if(401===h&&t.unauthorizedErrorCount++,!t.canRetryTokenFetchRequest(t.unauthorizedErrorCount))return r="getToken retry limit hit, reached terminal error state",t.connectionTracker.trackError("allocation",r),void t.fsm.onTerminalError();if(-1!==h||t.isNavigatorOnline){if(t.reconnectParams&&t.connectingErrorsInRow>=t.connectingErrorsThreshold)if(h>=400&&h<=599)t.resetReconnectParamsOnErrorThreshold();else if(t.reconnectParams.reconnectUrl&&t.connectingErrorsInRow%3==0){t.logger.warn("".concat(t.connectingErrorsInRow," connection attempts, testing nominal service URL"));var i=Math.min(t.timeoutOptions.connectionTimeoutMs-(Date.now()-l)-500,t.timeoutOptions.fetchTimeoutMs);return void t.testNominalUrlConnectivity(i).then(function(e){t.connectionTracker.trackProgress("nomcheck",e?"ok":"failed"),e?(t.logger.warn("Nominal service URL is reachable, erasing cached reconnect URL"),t.reconnectParams&&delete t.reconnectParams.reconnectUrl):t.logger.warn("Nominal service URL is not reachable either, keeping cached reconnect URL"),t.fsm.onAllocationFailed(!1,void 0)},function(){t.fsm.onAllocationFailed(!1,void 0)})}}else t.logger.info("Expected failure, the browser says it is not online at the moment");t.fsm.onAllocationFailed(401===h,u)})},e.prototype.testNominalUrlConnectivity=function(e){var t,n=this;if(e<1e3)return this.logger.warn("There is no time left to reasonably perform the nominal service URL connectivity check (".concat(e," ms), falling back to assuming that the connectivity is fine")),Promise.resolve(!0);try{var r=new URL(this.options.trouterUrl);r.pathname="/",r.search="?"+this.buildQuery({check:Date.now(),cor_id:encodeURIComponent(this.options.clientCorrelationID),epid:encodeURIComponent(this.options.endpointId?this.options.endpointId:""),tc:encodeURIComponent((0,d.toJson)(this.clientInfo))}),t=new Request(this.options.rewriteUrlForProxy(r.toString()),{method:"GET",headers:{Accept:"text/plain"}})}catch(e){return this.logger.warn("Nominal service URL connectivity test request could not be created (".concat(e,"), falling back to assuming that the connectivity is fine")),Promise.resolve(!0)}return(0,d.fetchWithTimeout)(t,e).then(function(e){if(200!==e.status)throw new Error("Not 200 OK: ".concat(e.status," ").concat(e.statusText));return e.text()}).then(function(e){if("Trouter"!==e)throw new Error('Not "Trouter": '.concat(e.substring(0,16)).concat(e.length>16?"...":""));return!0}).catch(function(e){return n.logger.error("Nominal service URL connectivity test failed: ".concat(e)),!1})},e.prototype.sendPingRequest=function(){var e=this;if(this.socket&&void 0===this.pingResponseTimerId)try{this.logger.debug("emitting ping event");var t=!1;this.socket.emit("ping",function(){!0!==t&&e.onPingResponse()}),this.pingResponseTimerId=setTimeout(function(){e.logger.error("Ping response timeout is fired"),t=!0,e.clearPingResponseTimer(),e.fsm.onPingResponseTimeout()},this.timeoutOptions.pongTimeoutMs)}catch(e){var n=i(e);this.logger.error("unable to send ping. Error: ".concat(n)),this.connectionTracker.trackError("ping",n,!1)}},e.prototype.connectV4c=function(e,t){var n,r,i,o,a,c,u=this.options.ioOptions?s({},this.options.ioOptions):new b;u["force new connection"]=!0,u.reconnect=!1,(null===(n=this.reconnectParams)||void 0===n?void 0:n.serviceUrl)&&(0,C.adaptUrl)(this.reconnectParams.serviceUrl,"v4c")!==(0,C.adaptUrl)(this.options.trouterUrl,"v4c")&&(this.logger.warn("Dropping cached connection parameters for a different environment (".concat(this.reconnectParams.serviceUrl,", now ").concat(this.options.trouterUrl,")")),this.reconnectParams=void 0);var l=null!==(o=null!==(r=(0,C.redirectUrlIfPresent)(t))&&void 0!==r?r:"redirect-no-host"!==(null==t?void 0:t.kind)?null===(i=this.reconnectParams)||void 0===i?void 0:i.reconnectUrl:void 0)&&void 0!==o?o:this.options.trouterUrl,d=(0,C.adaptUrl)(l,"v4c");u["skipped handshake data"]={timeout:70,websocketUrl:d},u.query=this.buildV4cUrlParams(),u.rewriteUrlForProxy=this.options.rewriteUrlForProxy;try{if(this.stopSocketIo(),this.transportTypeName="websocket",this.socket=(null!==(a=this.options.io)&&void 0!==a?a:T).connect(this.options.trouterUrl,u),void 0===this.socket)throw new Error("failed to create Socket.io object");var h=null===(c=this.audienceSubscriptionState)||void 0===c?void 0:c.increaseCvAndGetEventObject();this.attachSocketIoHandlers(this.socket,e,void 0,h)}catch(e){this.logger.error("".concat(e)),this.connectionTracker.trackError("v4c","".concat(e)),this.fsm.onV4cException()}},e.prototype.sendV4cAuthenticationEvent=function(e){var t,n={headers:s(s({},this.options.extraConnectionHeaders),r(e,this.usingLegacyTokenApi)),connectparams:(0,C.reconnectParamsWithoutUrls)(this.reconnectParams)};null===(t=this.socket)||void 0===t||t.emit(p.USER_AUTHENTICATE_EVENT_NAME,n)},e.prototype.setUserActivityState=function(e){var t=e.state!==this.userActivityState.state;this.userActivityState=e,t?(this.logger.info("Changing user activity state to '".concat(e.toEventJSON(),"'")),this.fsm.onSetNewUserActivityState()):(this.logger.debug("Not changing the same user activity state '".concat(e.toEventJSON(),"'")),this.manager.onUserActivityStateAccepted(e.correlationVector.value()))},e.prototype.sendUserActivityState=function(e,t){this.userActivityState.state!==m.UserActivityState.Unknown&&("websocket"===this.transportTypeName&&t?e===v.UserActivityEventReason.Connected?this.sendUserActivityStateMultiple(2):this.sendUserActivityStateMultiple(1):"xhr-polling"===this.transportTypeName&&e===v.UserActivityEventReason.Modified&&this.fsm.forceReconnect("user activity/force reconnect"))},e.prototype.setAudienceSubscriptionsAsync=function(e,t){var n=this.audienceSubscriptionState;if(this.audienceSubscriptionState=e,this.transportTypeName===this.WEBSOCKET_TRANSPORT_NAME)return this.setAudienceSubscriptionsInternalAsync(e.increaseCvAndGetEventObject(),t);if(this.transportTypeName===this.XHR_POLLING_TRANSPORT_NAME){var r=this.setAudienceSubscriptionsLongpollInternalAsync(e.increaseCvAndGetEventObject(),t,n);return this.fsm.forceReconnect("set audience subscription force reconnect"),r}throw new Error("set audience subscription executed on an unknown transport")},e.prototype.setAudienceSubscriptionsUnsafeAsync=function(e){if(e)return this.transportTypeName===this.WEBSOCKET_TRANSPORT_NAME?this.setAudienceSubscriptionsInternalAsync(e,15e3):void 0},e.prototype.setAudienceSubscriptionsInternalAsync=function(e,t){return a(this,void 0,void 0,function(){var n,r,i=this;return c(this,function(o){switch(o.label){case 0:return this.logger.info("[WebSocket] Audience subscription set requested."),(n=new A("audience.subscribe")).args=e,[4,new Promise(function(r){var o=!1,s=setTimeout(function(){return o=!0,r(i.buildAudienceSubscriptionsTimeoutResponse(e))},t);i.sendDownstreamEvent(n,function(e,t){o||(clearTimeout(s),i.logger.debug("[Websocket] Audience subscription response: ".concat(t)),i.pendingAudienceSubscription&&i.onAudienceSubscriptionResult(t),r(t))})})];case 1:return r=o.sent(),this.manager.onAudiencesSetResolved(r,e.cv),[2,r]}})})},e.prototype.setAudienceSubscriptionsLongpollInternalAsync=function(e,t,n){var r;return a(this,void 0,void 0,function(){var i,o,s,a,u,l,d=this;return c(this,function(c){switch(c.label){case 0:return this.logger.info("[XHR Polling] Audience subscription set requested."),this.pendingAudienceSubscription&&(this.logger.error("Racing audience subscriptions occured. This situation resolves into undefined scenario and/or nasal demons."),clearTimeout(this.pendingAudienceSubscription.timeoutId)),0===e.audiences.length?[2,this.handleAudienceUnsubscribeLongpoll(e.cv,n)]:[4,new Promise(function(n){var r=setTimeout(function(){return d.pendingAudienceSubscription=void 0,n(d.buildAudienceSubscriptionsTimeoutResponse(e))},t);d.pendingAudienceSubscription={audienceSetResolve:n,timeoutId:r}})];case 1:return i=c.sent(),this.manager.getState()===m.TrouterState.Unknown||this.transportTypeName===this.WEBSOCKET_TRANSPORT_NAME?[2,i]:(null==(o=i.responses[0])?void 0:o.result.audienceSubscriptionState)===this.AUDIENCE_SUBSCRIPTION_RESULT_BAD_REQUEST?(this.clearAudienceSubscriptionStateQueryParam(),this.manager.onAudiencesSetResolved(i,e.cv),[2,i]):(s=i.responses.find(function(t){return t.audienceId===e.audiences[0].id}),(null==s?void 0:s.result.audienceSubscriptionState)===this.AUDIENCE_SUBSCRIPTION_RESULT_ERROR?(this.clearAudienceSubscriptionStateQueryParam(),this.manager.onAudiencesSetResolved(i,e.cv),[2,i]):(a=(null===(r=null==n?void 0:n.audienceSubscriptionModel.audienceSubscriptions[0])||void 0===r?void 0:r.id)!==(null==o?void 0:o.audienceId),n&&a&&(u=this.mapToSyntheticAudienceSubscriptionResponses(n.audienceSubscriptionModel.audienceSubscriptions,this.AUDIENCE_SUBSCRIPTION_RESULT_UNSUBSCRIBED,200),(l=i.responses).push.apply(l,u)),this.manager.onAudiencesSetResolved(i,e.cv),[2,i]))}})})},e.prototype.clearAudienceSubscriptionStateQueryParam=function(){var e,t,n;(null===(n=null===(t=null===(e=this.socket)||void 0===e?void 0:e.socket)||void 0===t?void 0:t.options)||void 0===n?void 0:n.query)&&(this.socket.socket.options.query=this.socket.socket.options.query.replace(this.AUDIENCE_SUBSCRIPTION_STATE_QUERY_PARAM_REGEX,""))},e.prototype.handleAudienceUnsubscribeLongpoll=function(e,t){var n;this.audienceSubscriptionState=void 0;var r={responses:[]};if(t){var i=this.mapToSyntheticAudienceSubscriptionResponses(t.audienceSubscriptionModel.audienceSubscriptions,this.AUDIENCE_SUBSCRIPTION_RESULT_UNSUBSCRIBED,200);(n=r.responses).push.apply(n,i)}return this.manager.onAudiencesSetResolved(r,e),r},e.prototype.buildAudienceSubscriptionsTimeoutResponse=function(e){return this.logger.error("Audience subscription attempt has timed out."),{responses:this.mapToSyntheticAudienceSubscriptionResponses(e.audiences,this.AUDIENCE_SUBSCRIPTION_RESULT_TIMEOUT)}},e.prototype.mapToSyntheticAudienceSubscriptionResponses=function(e,t,n){return e.map(function(e){return{audienceId:e.id,result:{audienceSubscriptionState:t,responseStatus:n}}})},e.prototype.expediteBackoff=function(){this.tokenBackoff.expediteIfPending()},e.prototype.sendRegisterRequest=function(){var e=this;if(!this.options.registration||!this.registrarClient)throw new Error("Internal error - options.registration is undefined");if(!this.allocateResult)throw new Error("Allocate result is undefined in sendRegisterRequest()");this.logger.info("sending register request");var t=new d.Timespan;this.connectionTracker.trackStart("registration");var n=this.getRegistrationTtl()[0];this.registrarClient.register({appId:this.options.registration.pnhAppId,aesKey:"",languageId:"en-US",platform:this.options.registration.platform,templateKey:this.options.registration.pnhTemplateKey,platformUIVersion:this.options.registration.platformUIVersion,productContext:this.options.registration.productContext},{TROUTER:[{context:this.options.registration.context,path:this.allocateResult.surl,ttl:n}]}).then(function(){e.logger.info("Register request successful"),e.connectionTracker.trackEnd("registration"),e.fsm.onRegistrationSucceeded(),e.connectionTracker.sendTelemetry(h.ClientEventName.Registration,{duration:t.duration},[])}).catch(function(n){e.logger.error("Register request failed. Error: ".concat(n)),e.connectionTracker.trackError("registration",o(n)),e.fsm.onRegistrationFailed(),e.connectionTracker.sendTelemetry(h.ClientEventName.Registration,{duration:t.duration},[])})},e.prototype.sendUnregisterRequest=function(){var e=this;this.logger.info("sending unregister request");var t=new d.Timespan;if(!this.options.registration||!this.registrarClient)throw new Error("Internal error - options.registration is undefined");this.connectionTracker.trackStart("unregistration"),this.registrarClient.unregister().then(function(){e.logger.info("Unregister request successful"),e.connectionTracker.trackEnd("unregistration"),e.fsm.onUnregistrationDone(),e.connectionTracker.sendTelemetry(h.ClientEventName.Unregistration,{duration:t.duration},[])}).catch(function(n){e.logger.error("Unregister request failed. Error: ".concat(n)),e.connectionTracker.trackError("unregistration",o(n)),e.fsm.onUnregistrationDone(),e.connectionTracker.sendTelemetry(h.ClientEventName.Unregistration,{duration:t.duration},[])})},e.prototype.resetTokenBackoff=function(){this.tokenBackoff.reset()},e.prototype.cancelPendingRegistrationRequests=function(){this.registrarClient&&this.registrarClient.cancelPendingRequests()},e.prototype.clearSentEventTimers=function(){var e=Object.keys(this.pendingSentEventTimers);if(e.length>0){this.logger.debug("Clearing all pending downstream events related timers");for(var t=0,n=e;t<n.length;t++){var r=n[t];this.clearSentEventTimer(Number(r))}}},e.prototype.restartIncallModeTimer=function(){var e=this;this.clearIncallModeTimerId(),this.logger.debug("Restarting incall mode timer"),this.incallModeTimerId=setTimeout(function(){e.logger.info("Call mode timer fired"),e.fsm.onIncallModeTimer()},this.options.incallModeTimeoutMs)},e.prototype.enterIncallMode=function(){this.logger.info("Entering incall mode"),this.timeoutOptions=this.options.incallTimeoutOptions,this.tokenBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs),this.inIncallMode=!0},e.prototype.exitIncallMode=function(){this.logger.info("Exiting incall mode"),this.clearIncallModeTimerId(),this.timeoutOptions=this.options.timeoutOptions,this.tokenBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs),this.inIncallMode=!1},e.prototype.isIncallMode=function(){return this.inIncallMode},e.prototype.sendDisconnectTelemetryEvent=function(e){var t={reason:e,serverClosed:!this.fsm.isActive()};this.connectionTracker.trackDisconnected(t),this.connectionTracker.clearConnectedInfo()},e.prototype.forceReconnectDueToNoRegistration=function(){this.fsm.forceReconnect("force reconnect due to no registration")},e.prototype.resetReconnectParamsOnErrorThreshold=function(){this.logger.warn("".concat(this.connectingErrorsInRow," connection attempts, server-side failure: erasing cached connection parameters")),this.reconnectParams=void 0},e.prototype.onSocketConnecting=function(e){this.logger.info("onSocketConnecting(".concat(e,")")),this.transportTypeName=e,this.connectionTracker.trackProgress("connecting",this.transportTypeName),this.fsm.onConnecting()},e.prototype.onSocketConnect=function(e){this.logger.info("onSocketConnect"),this.fsm.onSocketConnect(e)},e.prototype.onSocketConnectFailed=function(e){this.logger.error("onSocketConnectFailed"),this.connectionTracker.trackError("connect_failed",e,!0,this.transportTypeName?this.transportTypeName:this.UNKNOWN_TRANSPORT),this.fsm.onConnectingFailed()},e.prototype.onSocketDisconnect=function(e){var t=this.connectionTracker.getSessionLength()||0,n=f.DisconnectReason.fromRawReason(e);this.logger.error("onSocketDisconnect, reason: ".concat(n.reason)),"dup"===n.reason&&"dup"===this.lastDisconnectReason&&t<this.options.duplicateDisconnectThresholdMs&&(this.logger.warn("Socket was closed by server as Duplicate for the second time in a row "+"after ".concat(t," ms which is below the threshold of ")+"".concat(this.options.duplicateDisconnectThresholdMs," ms. Resetting cached ")+"connection parameters and making a new allocation."),this.reconnectParams=void 0),this.lastDisconnectReason=n.reason,this.fsm.onSocketDisconnect(n),this.connectionExpireTimestampInSecs=void 0},e.prototype.onSocketReconnect=function(){this.logger.error("onSocketReconnect"),this.fsm.onTrouterConnected()},e.prototype.onSocketReconnectFailed=function(e){this.logger.error("onSocketReconnectFailed with '".concat(e,"'")),this.fsm.onSocketDisconnect(f.DisconnectReason.fromSocketIoEventData("reconnecterror",e))},e.prototype.onSocketReconnecting=function(){this.logger.error("onSocketReconnecting")},e.prototype.onSocketError=function(e){this.logger.error("onSocketError with '".concat((0,d.toJson)(e),"'")),this.fsm.isConnecting()&&++this.connectingErrorsInRow>=this.connectingErrorsThreshold&&this.resetReconnectParamsOnErrorThreshold(),this.connectionTracker.trackError("connectSocket",function(e){return null!=e&&"function"==typeof e.toString?e.toString():"[".concat(typeof e,"]")}(e)),this.fsm.onSocketDisconnect(f.DisconnectReason.fromSocketIoEventData("socketerror",e))},e.prototype.onSocketMessage=function(e){var t,n,r=this;this.logger.debug("onSocketMessage");try{var s=null===(t=(n=new w(e,this.logger)).headers)||void 0===t?void 0:t["X-Microsoft-Skype-Chain-ID"],a=s?" Chain-Id ".concat(s):"";this.logger.info("Received request N ".concat(n.id).concat(a," CV ").concat(n.correlationVector," to '").concat(n.url,"'")),n.startTS=Date.now(),n.url&&this.urlPath&&n.url.startsWith(this.urlPath)&&(n.shortUrl=n.url.substring(this.urlPath.length))}catch(e){var c=i(e);return this.logger.error("unable to parse request. Error: ".concat(c)),this.connectionTracker.trackRequest(void 0,c),void this.connectionTracker.sendResponseError("unable to parse request, error: ".concat(e))}n.timeoutTimerId=setTimeout(function(){if(!n.replied){r.logger.error("Request ".concat(n.id," timed out"));var e=new h.ResponseData(n.id);e.status=504,e.headers={"Trouter-Responder":"ClientLib"},r.sendResponse(n,e),n.timedout=!0}},this.timeoutOptions.requestTimeoutMs);try{this.connectionTracker.trackRequest(n),this.fsm.onDownstreamRequest(n)}catch(e){this.logger.error("exception in socket.on message. Error: ".concat(i(e))),this.connectionTracker.sendResponseError(o(e),n,void 0)}},e.prototype.onTrouterConnected=function(e,t,n){var r,i,o,a,c=this;if((0,C.isV4ConnectEvent)(e)){var u=e;this.allocateResult=s(s({},u),{ttl:e.ttl.toString()}),this.populateAndCacheReconnectParams(u,u.reconnectUrl),this.populateConnectionStateFields(u)}else if(!this.allocateResult)return void this.logger.error("Invalid internal state - received onTrouterConnected while allocateResult is not set");this.connectingErrorsInRow=0,this.logger.info("onTrouterConnected: ".concat(this.allocateResult.url)),"xhr-polling"===this.transportTypeName&&t&&this.manager.onUserActivityStateAccepted(t.cv),(null===(o=null===(i=null===(r=this.socket)||void 0===r?void 0:r.socket)||void 0===i?void 0:i.options)||void 0===o?void 0:o.query)&&(this.socket.socket.options.query+="&connected=true"),this.urlPath=this.allocateResult.url.replace(/https?:\/\/([A-z0-9\:\$\-\_\.\+\!\*\"\(\)\,]*)\//,"/");var l=this.connectedUrl!==this.allocateResult.url;this.connectedUrl=this.allocateResult.url,this.connectionExpireTimestampInSecs=(0,d.calculateExpireTsInSec)((0,C.ensureNumber)(e.ttl)),this.connectionTracker.trackEnd("connectSocket"),this.connectionTracker.trackConnected(l,this.transportTypeName?this.transportTypeName:this.UNKNOWN_TRANSPORT),null===(a=this.setAudienceSubscriptionsUnsafeAsync(n))||void 0===a||a.catch(function(e){return c.logger.error("Re-subscribe to audiences has failed with ".concat(e))}),this.fsm.onTrouterConnected()},e.prototype.onTrouterReconnect=function(e){var t=e.target;this.logger.info("onTrouterReconnect target: ".concat(t)),"self"===t?this.fsm.onReconnectRequired(!0,u.ServerInitiated):this.fsm.onReconnectRequired(!1,u.ServerInitiated,e)},e.prototype.onTrouterMessageLoss=function(e){this.logger.debug("onTrouterMessageLoss"),this.fsm.onTrouterMessageLost(e.droppedIndicators)},e.prototype.onAudienceSubscriptionResult=function(e){this.logger.info("onAudienceSubscriptionResult"),this.pendingAudienceSubscription&&(clearTimeout(this.pendingAudienceSubscription.timeoutId),this.pendingAudienceSubscription.audienceSetResolve(e),this.pendingAudienceSubscription=void 0)},e.prototype.buildV4cUrlParams=function(){var e={};return e.tc=encodeURI((0,d.toJson)(this.clientInfo)),e.timeout=Math.floor(this.timeoutOptions.pingTimeoutMs/1e3),this.options.endpointId&&(e.epid=this.options.endpointId),this.appendConnectedClientIds(this.buildQuery(e),!0)},e.prototype.attachSocketIoHandlers=function(e,t,n,r){var i=this;e.on("connecting",function(e){i.onSocketConnecting(e)}),e.on("connect",function(){i.onSocketConnect(t)}),e.on("connect_failed",function(e){i.onSocketConnectFailed(e)}),e.on("close_during_connecting",function(e){i.onSocketConnectFailed(e)}),e.on("disconnect",function(e){i.onSocketDisconnect(e)}),e.on("reconnect",function(){i.onSocketReconnect()}),e.on("reconnect_failed",function(e){i.onSocketReconnectFailed(e)}),e.on("reconnecting",function(){i.onSocketReconnecting()}),e.on("error",function(e){i.onSocketError(e)}),e.on("message",function(e){i.onSocketMessage(e)}),e.on("trouter.connected",function(e){i.onTrouterConnected(e,n,r)}),e.on("trouter.reconnect",function(e){i.onTrouterReconnect(e)}),e.on("trouter.message_loss",function(e){i.onTrouterMessageLoss(e)}),e.on("audience.subscriptionresult",function(e,t){i.onAudienceSubscriptionResult(t)})},e.prototype.onNavigatorOnlineStatusUpdate=function(){var e=window.navigator.onLine;this.logger.debug("Browser online status update - new state: ".concat(e,", previously: ").concat(this.isNavigatorOnline)),e&&!this.isNavigatorOnline?(this.isNavigatorOnline=!0,this.tokenBackoff.expediteIfPending(),this.connectionTracker.trackProgress("browserNet","online")):!e&&this.isNavigatorOnline&&(this.isNavigatorOnline=!1,this.connectionTracker.trackProgress("browserNet","offline"))},e.prototype.onAllocationResponse=function(e,t){this.logger.info("Received allocation response ".concat(JSON.stringify(e))),this.allocateResult=e,this.populateAndCacheReconnectParams(this.allocateResult,"".concat(this.allocateResult.socketio,"v4/a")),this.populateConnectionStateFields(this.allocateResult),this.fsm.onAllocationSucceed(t)},e.prototype.populateAndCacheReconnectParams=function(e,t){this.reconnectParams=s({serviceUrl:this.options.trouterUrl,reconnectUrl:t},e.connectparams),this.manager.onConnectionParametersUpdated(this.reconnectParams)},e.prototype.populateConnectionStateFields=function(e){var t,n,r="string"==typeof e.ttl?parseInt(e.ttl,10):e.ttl;if(this.connectionExpireTimestampInSecs=(0,d.calculateExpireTsInSec)(r),this.connectionId=null!==(t=e.id)&&void 0!==t?t:"",this.connectedClientId=e.ccid,this.logger.debug("connected client id set {connectedClientId:".concat(this.connectedClientId,"}")),this.c2cUrlBase=null!==(n=e.curlb)&&void 0!==n?n:"",""===this.c2cUrlBase){var i=e.surl.indexOf("://");i>=0&&(i=e.surl.indexOf("/",i+3))>=5&&":3443"===e.surl.substr(i-5,5)&&(this.c2cUrlBase=e.surl.substr(0,i-5))}},e.prototype.onPingResponse=function(){this.logger.debug("onPingResponse"),this.connectionTracker.increasePingResponseCount(),this.clearPingResponseTimer(),this.fsm.onPingResponse()},e.prototype.clearPingResponseTimer=function(){void 0!==this.pingResponseTimerId&&(clearTimeout(this.pingResponseTimerId),this.pingResponseTimerId=void 0)},e.prototype.buildQuery=function(e){for(var t=[],n=0,r=Object.keys(e);n<r.length;n++){var i=r[n];void 0!==e[i]&&t.push("".concat(i,"=").concat(e[i]))}return t.join("&")},e.prototype.appendConnectedClientIds=function(e,t){var n="";e.includes("ccid=")||(n="ccid=".concat(this.connectedClientId,"&")),this.domId&&(n+="dom=".concat(this.domId,"&")),n.length>0&&(n=n.slice(0,-1));var r=t||e.includes("?")?"&":"?";return this.appendCorrelationIds(e+r+n,t)},e.prototype.appendEndpointId=function(e,t){var n=t||e.includes("?")?"&":"?";return!e.includes("epid")&&this.options.endpointId?"".concat(e).concat(n,"epid=").concat(this.options.endpointId):e},e.prototype.appendCorrelationIds=function(e,t){var n=t||e.includes("?")?"&":"?";return e.includes("cor_id")?e:"".concat(e).concat(n,"cor_id=").concat(this.options.clientCorrelationID)+"&con_num=".concat(this.clientID,"_").concat(this.connectionAttempt)},e.prototype.safeString=function(e){return"string"==typeof e?e:""},e.prototype.sendResponse=function(e,t){var n,r,o;if(e.timedout)return this.logger.error("Request ".concat(e.id," already timed out")),1;if(e.replied)return this.logger.error("Response for request ".concat(e.id," already sent")),2;clearTimeout(e.timeoutTimerId),e.timeoutTimerId=void 0,e.replied=!0,t.headers=null!==(n=t.headers)&&void 0!==n?n:{};var s=e.correlationVector;this.logger.info("Sending response N ".concat(e.id," CV ").concat(s," with status ").concat(t.status)),s&&(t.headers[I]=s),(null===(r=e.headers)||void 0===r?void 0:r["trouter-request"])&&(t.headers["trouter-request"]=e.headers["trouter-request"]);var a=Date.now()-e.startTS;if(t.headers["trouter-client"]=(0,d.toJson)({cd:a}),(null===(o=e.headers)||void 0===o?void 0:o["trouter-is-broadcast"])&&(t.headers["trouter-is-broadcast"]=e.headers["trouter-is-broadcast"]),this.logger.debug("response: ".concat((0,d.toJson)(t))),!this.socket)return this.connectionTracker.sendResponseError("no socket",e,t),4;try{return this.socket.send((0,d.toJson)(t)),t.sentTS=Date.now(),e.incrementCorrelationVector(),this.connectionTracker.trackResponse(e,a,t),"websocket"===this.transportTypeName&&this.sendPingRequest(),0}catch(n){var c="unable to send data on response.end. Error: ".concat(i(n));return this.logger.error(c),this.connectionTracker.sendResponseError(c,e,t),4}},e.prototype.sendUserActivityStateMultiple=function(e){var t=this,n=new A("user.activity"),r=this.userActivityState.increaseCvAndGetEventObject();n.args=r,this.logger.debug("Sending user activity '".concat(this.userActivityState.toEventJSON(),"', remaining ").concat(e-1));var i=!1;this.sendDownstreamEvent(n,function(){if(!0!==i&&(t.logger.info("User activity state: ".concat(r.state,", cv: ").concat(r.cv," accepted")),t.manager.onUserActivityStateAccepted(r.cv),t.clearSentEventTimer(n.timeoutTimerId),e>1)){var o=setTimeout(function(){t.clearSentEventTimer(o),t.sendUserActivityStateMultiple(e-1)},t.options.userActivitySecondResendDelayMs);t.registerSentEventTimer(o,"user.activity/resend")}}),n.timeoutTimerId=setTimeout(function(){t.logger.error("Activity state response timeout is fired"),i=!0,t.fsm.onActivityStateResponseTimeout(),t.clearSentEventTimer(n.timeoutTimerId)},this.timeoutOptions.userActivityResponseTimeoutMs),this.registerSentEventTimer(n.timeoutTimerId,"user.activity/response")},e.prototype.sendDownstreamEvent=function(e,t){this.logger.debug("Sending downstream event ".concat(e.name)),this.socket&&this.socket.emit(e.name,e.args,t)},e.prototype.registerSentEventTimer=function(e,t){this.logger.debug("registering timer ".concat(e," -> ").concat(t)),this.pendingSentEventTimers[e]=t},e.prototype.clearSentEventTimer=function(e){var t=this.pendingSentEventTimers[e];this.logger.debug("clearing timer ".concat(e," -> ").concat(t)),delete this.pendingSentEventTimers[e],clearTimeout(e)},e.prototype.getRegistrationTtl=function(){var e,t,n=(0,d.calculateTtlInSec)(this.connectionExpireTimestampInSecs);if(this.logger.debug("Current connectionID will expire in ".concat(n," seconds")),(null===(e=this.options.registration)||void 0===e?void 0:e.registrarTtlSec)&&n>0){var r=this.options.registration.registrarTtlSec<n;return[Math.min(this.options.registration.registrarTtlSec,n),r]}return(null===(t=this.options.registration)||void 0===t?void 0:t.registrarTtlSec)?[this.options.registration.registrarTtlSec,!1]:n>0?[n,!1]:[3600,!1]},e.prototype.clearIncallModeTimerId=function(){void 0!==this.incallModeTimerId&&(this.logger.debug("Clearing in-call mode timer"),clearTimeout(this.incallModeTimerId),this.incallModeTimerId=void 0)},e.prototype.applyConnectionTrackerOptions=function(e){try{e.eventLogger&&"function"==typeof e.eventLogger.logEvent?(this.connectionTracker.mergeSettings(e.telemetrySettings),this.connectionTracker.enable(e.eventLogger)):this.logger.warn("Trouter client event logging disabled due to invalid configuration.")}catch(e){this.logger.warn("Trouter client event logging disabled. Error: ".concat(i(e))),this.connectionTracker.disable()}},e.prototype.canRetryTokenFetchRequest=function(e){var t=this.options.retryLimitOnTokenFetch;return null==t||e<t||(this.logger.warn("Reached limit on maximum number of token fetch request. Current count: ".concat(e,", retry limit: ").concat(t)),!1)},e}();t.TrouterConnection=O},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.MessageHandlerRegistry=void 0;var r=n(1),i=n(0),o=function(){function e(e){this.messageHandlers=[],this.logger=new i.Logger("MessageHandlers",e)}return e.prototype.register=function(e){if(this.messageHandlers.some(function(t){return t===e}))throw new Error("Registering the same handler twice is not allowed");this.messageHandlers.push(e)},e.prototype.clear=function(){this.logger.debug("Clearing message handlers"),this.messageHandlers=[]},e.prototype.active=function(){return this.messageHandlers.length>0},e.prototype.handleMessage=function(e){for(var t={resultCode:r.UNHANDLED_MESSAGE_ACK,isHandled:!1},n=0,i=this.messageHandlers;n<i.length;n++){var o=i[n],s=this.safeExecuteHandle(o,e);if(void 0!==s&&(void 0===s.isHandled||s.isHandled))return void 0===s.resultCode&&(s.resultCode=r.HANDLED_MESSAGE_ACK),s}return t},e.prototype.safeExecuteHandle=function(e,t){try{return e.handleMessage(t)}catch(e){return void this.logger.warn("Trouter message handler threw an exception: ".concat(e))}},e}();t.MessageHandlerRegistry=o},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?n(e.value):i(e.value).then(s,a)}c((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;a&&(a=0,n[0]&&(c=0)),c;)try{if(i=1,o&&(s=2&n[0]?o.return:n[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(s=(s=c.trys).length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){c.label=n[1];break}if(6===n[0]&&c.label<s[1]){c.label=s[1],s=n;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(n);break}s[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,s,a,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(t,"__esModule",{value:!0}),t.addCacheAsBackupTo=void 0,t.addCacheAsBackupTo=function(e){var t,n=this;return function(o){return r(n,void 0,void 0,function(){return i(this,function(n){return o&&(t=void 0),[2,new Promise(function(n,r){e(o).then(function(e){t=e,n(e)}).catch(function(e){void 0!==t&&t.length>0&&n(t),r(e)})})]})})}}},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?n(e.value):i(e.value).then(s,a)}c((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;a&&(a=0,n[0]&&(c=0)),c;)try{if(i=1,o&&(s=2&n[0]?o.return:n[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(s=(s=c.trys).length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){c.label=n[1];break}if(6===n[0]&&c.label<s[1]){c.label=s[1],s=n;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(n);break}s[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,s,a,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(t,"__esModule",{value:!0}),t.TrouterManager=t.AudienceSubscriptionState=t.UserActivityObject=void 0;var o=n(3),s=n(2),a=n(4),c=n(0),u=n(5),l=n(18),d=n(7),h=n(6),p=n(19),f=function(){function e(e,t){this.state=e,this.correlationVector=void 0!==t?t:o.CorrelationVector.extend()}return e.prototype.getStateString=function(){switch(this.state){case s.UserActivityState.Active:return"active";case s.UserActivityState.Inactive:return"inactive";case s.UserActivityState.Unknown:return"unknown";default:return"undefined"}},e.prototype.increaseCvAndGetEventObject=function(){return this.correlationVector.increase(),this.toEventObject()},e.prototype.toEventObject=function(){return{state:this.getStateString(),cv:this.correlationVector.value()}},e.prototype.toEventJSON=function(){return(0,o.toJson)(this.toEventObject())},e}();t.UserActivityObject=f;var g=function(){function e(e,t){void 0===t&&(t=o.CorrelationVector.extend()),this.audienceSubscriptionModel=e,this.correlationVector=t}return e.prototype.increaseCvAndGetEventObject=function(){return this.correlationVector.increase(),this.toEventObject()},e.prototype.toEventObject=function(){return{audiences:this.audienceSubscriptionModel.audienceSubscriptions,cv:this.correlationVector.value()}},e.prototype.toEventJSON=function(){return(0,o.toJson)(this.toEventObject())},e}();t.AudienceSubscriptionState=g;var m=function(){function e(e,t,n,r,i,a){var l=this;this.logFunc=e,this.options=t,this.tokenProvider=n,this.usingLegacyTokenApi=r,this.listener=i,this.tokenTypeProtocolSelector=function(e,t){return l.options.forceV4aProtocol?"v4a":(0,u.usedProtocol)(e,t)},this.logger=new c.Logger("Manager",e),this.logger.info("Created TrouterManager with options ".concat((0,o.toJson)(this.options))),this.fsm=new p.TrouterManagerFsm(e,this),this.baseEndpointUrl="",this.processedMessageLoss={},this.userActivityObject=new f(s.UserActivityState.Unknown),this.protocolSelector=null!=a?a:this.tokenTypeProtocolSelector.bind(this)}return e.prototype.start=function(){this.fsm.start()},e.prototype.stop=function(e){this.fsm.stop(e)},e.prototype.configure=function(e){this.options=e,void 0!==this.firstConnection&&this.firstConnection.configure(e),void 0!==this.secondConnection&&this.secondConnection.configure(e),this.logger.info("Reconfigured TrouterManager with options ".concat((0,o.toJson)(this.options)))},e.prototype.checkConnection=function(e){void 0!==this.firstConnection&&this.firstConnection.checkConnection(e),void 0!==this.secondConnection&&this.secondConnection.checkConnection(e)},e.prototype.resendRegistration=function(){return r(this,void 0,void 0,function(){return i(this,function(e){return void 0!==this.secondConnection?(this.logger.info("Resending registration on the second/new connection"),[2,this.secondConnection.resendRegistration()]):void 0!==this.firstConnection?(this.logger.info("Resending registration on the first/current connection"),[2,this.firstConnection.resendRegistration()]):(this.logger.info("No connection to resend registration on, will be done upon (re)connect"),[2])})})},e.prototype.getServerState=function(){if(void 0!==this.firstConnection)return this.firstConnection.getServerState()},e.prototype.getState=function(){return this.fsm.getState()},e.prototype.isInTerminalState=function(){return this.fsm.getInternalState()===a.TrouterManagerState.TerminalError},e.prototype.reportStateInfo=function(){var e=this.firstConnection?h.State[this.firstConnection.getState()]:"Unknown",t=a.TrouterManagerState[this.fsm.getInternalState()];if(this.secondConnection){var n=h.State[this.secondConnection.getState()];return"Manager ".concat(t,"; 1st ").concat(e,"; 2nd ").concat(n)}return"Manager ".concat(t,"; Connection ").concat(e)},e.prototype.startFirstConnection=function(){var e=new d.TrouterConnection(this.logFunc,this.options,this.configuredTrouterManager(),this.tokenProvider,this.usingLegacyTokenApi,this.userActivityObject,this.protocolSelector,this.audienceSubscriptionState);this.firstConnection=e,this.getConnectionCache().then(function(t){e.start(t)}).catch(function(){})},e.prototype.startSecondConnection=function(e){var t=new d.TrouterConnection(this.logFunc,this.options,this.configuredTrouterManager(),this.tokenProvider,this.usingLegacyTokenApi,this.userActivityObject,this.protocolSelector,this.audienceSubscriptionState);this.secondConnection=t,void 0!==this.firstConnection&&this.firstConnection.disableRegistrationsAndAutoReconnect(),e?this.getConnectionCache().then(function(e){t.start(e)}).catch(function(){}):t.start()},e.prototype.stopFirstConnection=function(e){void 0!==this.firstConnection&&(this.storedFirstConnection=this.firstConnection,this.firstConnection.stop(e),this.firstConnection=void 0)},e.prototype.stopSecondConnection=function(e){void 0!==this.secondConnection&&(this.secondConnection.stop(e),this.secondConnection=void 0)},e.prototype.stopSecondConnectionDelayed=function(){if(void 0!==this.secondConnection){var e=this.secondConnection;this.secondConnection=void 0,this.logger.info("Closing an inactive connection in ".concat(Math.round(this.options.lingeringConnectionDelayMs/1e3),"s")),setTimeout(function(){e.stop(!0)},this.options.lingeringConnectionDelayMs)}},e.prototype.forceStopLingeringConnection=function(){this.storedFirstConnection&&(this.storedFirstConnection.stop(!1),this.storedFirstConnection=void 0)},e.prototype.switchConnections=function(){var e=this.firstConnection;this.firstConnection=this.secondConnection,this.secondConnection=e},e.prototype.doesSecondConnectionExist=function(){return void 0!==this.secondConnection},e.prototype.dispatchConnected=function(){if(void 0!==this.firstConnection){var e=this.firstConnection.getServerState(),t=e.url.endsWith("/")?e.url.slice(0,-1):e.url,n={baseEndpointUrl:t,newEndpointUrl:t!==this.baseEndpointUrl,c2cUrlBase:e.c2cUrlBase,clientId:e.connectedClientId,connectionId:e.connectionId,connectionTtlSec:e.getRemainingTtlInSec()};this.baseEndpointUrl=t,this.listener.onTrouterConnected(e.url,n)}},e.prototype.dispatchDisconnected=function(){this.listener.onTrouterDisconnected&&this.listener.onTrouterDisconnected()},e.prototype.dispatchTerminalError=function(){this.listener.onTrouterDisconnected&&this.listener.onTrouterDisconnected()},e.prototype.dispatchRegistrationState=function(e){this.options.registrationStateCallback&&this.options.registrationStateCallback(e)},e.prototype.expediteBackoffOnConnections=function(){var e;void 0!==this.lastExpediteBackoffCallAt&&Date.now()-this.lastExpediteBackoffCallAt<(null!==(e=this.options.expediteBackoffOnStartMinimumDelayMs)&&void 0!==e?e:1e4)?this.logger.info("Expedite backoff due to start() too frequent, skipping"):(this.lastExpediteBackoffCallAt=Date.now(),void 0!==this.firstConnection&&this.firstConnection.expediteBackoff(),void 0!==this.secondConnection&&this.secondConnection.expediteBackoff())},e.prototype.onDownstreamRequest=function(e,t,n){var r={id:t.id,method:t.method,path:"/".concat(t.shortUrl),body:t.body,headers:t.headers},i={id:t.id,status:0,headers:{},body:"",send:function(){return i.status<=100||i.status>=999?3:(n.writeHead(i.status,i.headers),n.end(i.body))}};this.listener.onTrouterRequest(r,i)},e.prototype.onConnected=function(e){this.fsm.onConnected(e===this.firstConnection)},e.prototype.onRegistered=function(e){this.fsm.onRegistered(e===this.firstConnection)},e.prototype.onUnregistered=function(e){this.fsm.onUnregistered(e===this.firstConnection||e===this.storedFirstConnection)},e.prototype.onReconnecting=function(e){this.fsm.onReconnecting(e===this.firstConnection)},e.prototype.onReconnectIsRequired=function(e,t,n){this.fsm.onReconnectionRequired(e===this.firstConnection,t,n)},e.prototype.onDisconnected=function(e){this.fsm.onDisconnected(e===this.firstConnection||e==this.storedFirstConnection),this.storedFirstConnection=void 0},e.prototype.onTerminalError=function(){this.fsm.onTerminalError(),this.storedFirstConnection=void 0},e.prototype.onUserActivityStateAccepted=function(e){this.listener.onTrouterUserActivityStateAccepted&&this.listener.onTrouterUserActivityStateAccepted(e)},e.prototype.onAudiencesSetResolved=function(e,t){var n,r;null===(r=(n=this.listener).onAudiencesSetResolved)||void 0===r||r.call(n,e,t)},e.prototype.onConnectionParametersUpdated=function(e){this.setConnectionCache(e)},e.prototype.setUserActivityState=function(e,t){return this.userActivityObject=new f(e,o.CorrelationVector.extend(t)),void 0!==this.secondConnection?(this.logger.info("Setting user activity ".concat(this.userActivityObject.toEventJSON()," on the second/new connection")),void this.secondConnection.setUserActivityState(this.userActivityObject)):void 0!==this.firstConnection?(this.logger.info("Setting user activity ".concat(this.userActivityObject.toEventJSON()," on the first/current connection")),void this.firstConnection.setUserActivityState(this.userActivityObject)):void 0},e.prototype.setAudienceSubscriptionsAsync=function(e,t,n){if(this.audienceSubscriptionState=new g(e,o.CorrelationVector.extend(n)),this.secondConnection)return this.logger.info("Setting audience subscriptions ".concat(this.audienceSubscriptionState.toEventJSON()," on second/new connection")),this.secondConnection.setAudienceSubscriptionsAsync(this.audienceSubscriptionState,t);if(this.firstConnection)return this.logger.info("Setting audience subscriptions ".concat(this.audienceSubscriptionState.toEventJSON()," on first/current connection")),this.firstConnection.setAudienceSubscriptionsAsync(this.audienceSubscriptionState,t);throw new Error("No connection found")},e.prototype.onTrouterMessageLost=function(e){var t=this;if(this.listener.onTrouterMessageLoss)if(null==e?void 0:e.length){var n=e.filter(function(e){return void 0!==t.processedMessageLoss["".concat(e.tag,"-").concat(e.etag)]});if(n.length&&(this.logger.info("onTrouterMessageLoss - immediately acknowledging ".concat(n.length," seen dropped indicators")),this.sendProcessedDroppedIndicators(n),!(e=e.filter(function(e){return void 0===t.processedMessageLoss["".concat(e.tag,"-").concat(e.etag)]})).length))return void this.logger.info("onTrouterMessageLoss - all declared dropped indicators have been seen before");if(!this.listener.onTrouterMessageLoss(e.map(function(e){return e.tag})))return void this.logger.warn("onTrouterMessageLoss - some flow tag(s) have not been processed by listeners");e.forEach(function(e){t.processedMessageLoss["".concat(e.tag,"-").concat(e.etag)]=""}),this.sendProcessedDroppedIndicators(e)}else this.logger.warn("onTrouterMessageLoss - no flow tags have been provided")},e.prototype.getConnectionCache=function(){var e=this;return this.options.connectionCache?(this.logger.debug("Querying host's connection cache"),this.options.connectionCache.onGetTrouterConnectionCache().then(function(e){var t=e?JSON.parse(e):void 0;return"object"==typeof t?t:void 0}).catch(function(t){return e.logger.warn("Invalid connection cache content provided: ".concat(t)),e.connectionCache})):Promise.resolve(this.connectionCache)},e.prototype.setConnectionCache=function(e){if(this.connectionCache=e,this.options.connectionCache)try{this.options.connectionCache.onSetTrouterConnectionCache(JSON.stringify(e))}catch(e){this.logger.warn("Error setting external connection cache: ".concat(e))}},e.prototype.sendProcessedDroppedIndicators=function(e){return void 0!==this.firstConnection?void this.firstConnection.sendProcessedDroppedIndicators(e):void 0!==this.secondConnection?void this.secondConnection.sendProcessedDroppedIndicators(e):void 0},e.prototype.configuredTrouterManager=function(){return new l.RegistrationEnforcer(this,this.options.connectionDependsOnRegistration,this.options.delayEventsUntilRegistered)},e}();t.TrouterManager=m},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.TrouterUrlPromise=void 0;var r=n(0),i=function(){function e(e){this.logger=new r.Logger("UrlPromise",e)}return e.prototype.getPromise=function(){var e=this;return void 0!==this.url?(this.logger.debug("returning previously resolved url: ".concat(this.url)),Promise.resolve(this.url)):(void 0===this.pendingPromise?(this.logger.debug("creating and returning promise"),this.pendingPromise=new Promise(function(t,n){e.pendingPromiseResolveRef=t,e.pendingPromiseRejectRef=n})):this.logger.debug("returning existing promise"),this.pendingPromise)},e.prototype.resolveUrl=function(e){this.url=e,this.logger.debug("got url: ".concat(this.url));var t=this.pendingPromiseResolveRef;this.pendingPromise=void 0,this.pendingPromiseResolveRef=void 0,this.pendingPromiseRejectRef=void 0,void 0!==t&&(this.logger.debug("resolving promise"),t(e))},e.prototype.rejectUrl=function(e){this.logger.debug("aborting");var t=this.pendingPromiseRejectRef;this.url=void 0,this.pendingPromise=void 0,this.pendingPromiseResolveRef=void 0,this.pendingPromiseRejectRef=void 0,void 0!==t&&(this.logger.debug("rejecting promise"),t(e))},e.prototype.resetUrl=function(){this.logger.debug("resetting url"),this.url=void 0},e}();t.TrouterUrlPromise=i},function(e,t,n){(function(e,n){!function(e,t){var n=e;n.version="0.9.6",n.protocol=1,n.transports=[],n.j=[],n.sockets={},n.connect=function(e,r){var i,o,s=n.util.parseUri(e);t&&t.location&&(s.protocol=s.protocol||t.location.protocol.slice(0,-1),s.host=s.host||(t.document?t.document.domain:t.location.hostname),s.port=s.port||t.location.port),i=n.util.uniqueUri(s);var a={host:s.host,secure:"https"==s.protocol,port:s.port||("https"==s.protocol?443:80),query:s.query||""};return n.util.merge(a,r),!a["force new connection"]&&n.sockets[i]||(o=new n.Socket(a)),!a["force new connection"]&&o&&(n.sockets[i]=o),o=o||n.sockets[i],a["skipped handshake data"]?o.of(""):o.of(s.path.length>1?s.path:"")}}(n.exports,void 0===e?window:e);var r=n.exports;!function(e,t){var n=e.util={},r=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,i=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];n.parseUri=function(e){for(var t=r.exec(e||""),n={},o=14;o--;)n[i[o]]=t[o]||"";return n},n.uniqueUri=function(e){var n=e.protocol,r=e.host,i=e.port;return"document"in t?(r=r||document.domain,i=i||("https"==n&&"https:"!==document.location.protocol?443:document.location.port)):(r=r||"localhost",i||"https"!=n||(i=443)),(n||"http")+"://"+r+":"+(i||80)},n.query=function(e,t){var r=n.chunkQuery(e||""),i=[];for(var o in n.merge(r,n.chunkQuery(t||"")),r)r.hasOwnProperty(o)&&i.push(o+"="+r[o]);return i.length?"?"+i.join("&"):""},n.chunkQuery=function(e){for(var t,n={},r=e.split("&"),i=0,o=r.length;i<o;++i)(t=r[i].split("="))[0]&&(n[t[0]]=t[1]);return n};var o=!1;n.load=function(e){if("document"in t&&"complete"===document.readyState||o)return e();n.on(t,"load",e,!1)},n.on=function(e,t,n,r){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener&&e.addEventListener(t,n,r)},n.request=function(e){if(e&&"undefined"!=typeof XDomainRequest)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!e||n.ua.hasCORS))return new XMLHttpRequest;if(!e)try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}return null},"undefined"!=typeof window&&n.load(function(){o=!0}),n.defer=function(e){if(!n.ua.webkit||"undefined"!=typeof importScripts)return e();n.load(function(){setTimeout(e,100)})},n.merge=function(e,t,r,i){var o,s=i||[],a=void 0===r?2:r;for(o in t)t.hasOwnProperty(o)&&n.indexOf(s,o)<0&&("object"==typeof e[o]&&a?n.merge(e[o],t[o],a-1,s):(e[o]=t[o],s.push(t[o])));return e},n.mixin=function(e,t){n.merge(e.prototype,t.prototype)},n.inherit=function(e,t){function n(){}n.prototype=t.prototype,e.prototype=new n},n.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},n.intersect=function(e,t){for(var r=[],i=e.length>t.length?e:t,o=e.length>t.length?t:e,s=0,a=o.length;s<a;s++)~n.indexOf(i,o[s])&&r.push(o[s]);return r},n.indexOf=function(e,t,n){var r=e.length;for(n=n<0?n+r<0?0:n+r:n||0;n<r&&e[n]!==t;n++);return r<=n?-1:n},n.toArray=function(e){for(var t=[],n=0,r=e.length;n<r;n++)t.push(e[n]);return t},n.ua={},n.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var e=new XMLHttpRequest}catch(e){return!1}return null!=e.withCredentials}(),n.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent)}(void 0!==r?r:n.exports,void 0===e?window:e),function(e,t){function n(){}e.EventEmitter=n,n.prototype.on=function(e,n){return this.$events||(this.$events={}),this.$events[e]?t.util.isArray(this.$events[e])?this.$events[e].push(n):this.$events[e]=[this.$events[e],n]:this.$events[e]=n,this},n.prototype.addListener=n.prototype.on,n.prototype.once=function(e,t){function n(){r.removeListener(e,n),t.apply(this,arguments)}var r=this;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,n){if(this.$events&&this.$events[e]){var r=this.$events[e];if(t.util.isArray(r)){for(var i=-1,o=0,s=r.length;o<s;o++)if(r[o]===n||r[o].listener&&r[o].listener===n){i=o;break}if(i<0)return this;r.splice(i,1),r.length||delete this.$events[e]}else(r===n||r.listener&&r.listener===n)&&delete this.$events[e]}return this},n.prototype.removeAllListeners=function(e){return this.$events&&this.$events[e]&&(this.$events[e]=null),this},n.prototype.listeners=function(e){return this.$events||(this.$events={}),this.$events[e]||(this.$events[e]=[]),t.util.isArray(this.$events[e])||(this.$events[e]=[this.$events[e]]),this.$events[e]},n.prototype.emit=function(e){if(!this.$events)return!1;var n=this.$events[e];if(!n)return!1;var r=Array.prototype.slice.call(arguments,1);if("function"==typeof n)n.apply(this,r);else{if(!t.util.isArray(n))return!1;for(var i=n.slice(),o=0,s=i.length;o<s;o++)i[o].apply(this,r)}return!0}}(void 0!==r?r:n.exports,void 0!==r?r:n.parent.exports),function(e,t){if(t&&t.parse)return e.JSON={parse:t.parse,stringify:t.stringify};throw new Error("JSON not available")}(void 0!==r?r:n.exports,"undefined"!=typeof JSON?JSON:void 0),function(e,t){var n=e.parser={},r=n.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],i=n.reasons=["transport not supported","client not handshaken","unauthorized"],o=n.advice=["reconnect"],s=t.JSON,a=t.util.indexOf;n.encodePacket=function(e){var t=a(r,e.type),n=e.id||"",c=e.endpoint||"",u=e.ack,l=null;switch(e.type){case"error":var d=e.reason?a(i,e.reason):"",h=e.advice?a(o,e.advice):"";""===d&&""===h||(l=d+(""!==h?"+"+h:""));break;case"message":""!==e.data&&(l=e.data);break;case"event":var p={name:e.name};e.args&&e.args.length&&(p.args=e.args),l=s.stringify(p);break;case"json":l=s.stringify(e.data);break;case"connect":e.qs&&(l=e.qs);break;case"ack":l=e.ackId+(e.args&&e.args.length?"+"+s.stringify(e.args):"")}var f=[t,n+("data"==u?"+":""),c];return null!=l&&f.push(l),f.join(":")},n.encodePayload=function(e){var t="";if(1==e.length)return e[0];for(var n=0,r=e.length;n<r;n++)t+=""+e[n].length+""+e[n];return t};var c=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;n.decodePacket=function(e){if(!(a=e.match(c)))return{};var t=a[2]||"",n=(e=a[5]||"",{type:r[a[1]],endpoint:a[4]||""});switch(t&&(n.id=t,a[3]?n.ack="data":n.ack=!0),n.type){case"error":var a=e.split("+");n.reason=i[a[0]]||"",n.advice=o[a[1]]||"";break;case"message":n.data=e||"";break;case"event":try{var u=s.parse(e);n.name=u.name,n.args=u.args}catch(e){}n.args=n.args||[];break;case"json":try{n.data=s.parse(e)}catch(e){}break;case"connect":n.qs=e||"";break;case"ack":if((a=e.match(/^([0-9]+)(\+)?(.*)/))&&(n.ackId=a[1],n.args=[],a[3]))try{n.args=a[3]?s.parse(a[3]):[]}catch(e){}break;case"disconnect":n.reason=e}return n},n.decodePayload=function(e){if(""==e.charAt(0)){for(var t=[],r=1,i="";r<e.length;r++)""==e.charAt(r)?(t.push(n.decodePacket(e.substr(r+1).substr(0,i))),r+=Number(i)+1,i=""):i+=e.charAt(r);return t}return[n.decodePacket(e)]}}(void 0!==r?r:n.exports,void 0!==r?r:n.parent.exports),function(e,t){function n(e,t){this.socket=e,this.sessid=t,this.connectErrorCallback=void 0,this.isOpened=!1}e.Transport=n,t.util.mixin(n,t.EventEmitter),n.prototype.onData=function(e){if(this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout(),""!==e){var n=t.parser.decodePayload(e);if(n&&n.length)for(var r=0,i=n.length;r<i;r++)this.onPacket(n[r])}return this},n.prototype.onPacket=function(e){return this.socket.setHeartbeatTimeout(),"heartbeat"==e.type?this.onHeartbeat():("connect"==e.type&&""==e.endpoint&&this.onConnect(),"error"==e.type&&"reconnect"==e.advice&&(this.isOpened=!1),this.socket.onPacket(e),this)},n.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var e=this;this.closeTimeout=setTimeout(function(){e.onDisconnect()},this.socket.closeTimeout)}},n.prototype.onDisconnect=function(){return this.close&&this.isOpened&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},n.prototype.onConnect=function(){return this.socket.onConnect(),this.connectErrorCallback=void 0,this},n.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},n.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},n.prototype.packet=function(e){this.send(t.parser.encodePacket(e))},n.prototype.onHeartbeat=function(e){this.packet({type:"heartbeat"})},n.prototype.onOpen=function(){this.isOpened=!0,this.clearCloseTimeout(),this.socket.onOpen()},n.prototype.onClose=function(){this.isOpened=!1,this.socket.onClose(),this.onDisconnect()},n.prototype.prepareUrl=function(e){var n=this.socket.options;if(n["skipped handshake data"])return n.rewriteUrlForProxy(n["skipped handshake data"].websocketUrl+(e||""));var r=this.scheme()+"://"+n.host+":"+n.port+"/"+n.resource+"/"+t.protocol+"/"+this.name+"/"+this.sessid+(e||"");return n.rewriteUrlForProxy(r)},n.prototype.ready=function(e,t){t.call(this)},n.prototype.clearEventHandlers=function(){return this}}(void 0!==r?r:n.exports,void 0!==r?r:n.parent.exports),function(e,t,n){function r(e){if(this.options={port:80,secure:!1,document:"document"in n&&document,resource:"socket.io",transports:t.transports.slice(),"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":1/0,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!0,"auto connect":!0,"flash policy port":10843},t.util.merge(this.options,e),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1,this.disconnected=!1,this.options["sync disconnect on unload"]&&(!this.isXDomain()||t.util.ua.hasCORS)){var r=this;t.util.on(n,"unload",function(){r.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function i(){}e.Socket=r,t.util.mixin(r,t.EventEmitter),r.prototype.of=function(e){return this.namespaces[e]||(this.namespaces[e]=new t.SocketNamespace(this,e),""!==e&&this.namespaces[e].packet({type:"connect"})),this.namespaces[e]},r.prototype.publish=function(){var e;for(var t in this.emit.apply(this,arguments),this.namespaces)this.namespaces.hasOwnProperty(t)&&(e=this.of(t)).$emit.apply(e,arguments)},r.prototype.handshake=function(e){function n(t){t instanceof Error?r.onError(t.message):e.apply(null,t.split(":"))}var r=this,o=this.options;if(!r.disconnected){var s=o.rewriteUrlForProxy(["http"+(o.secure?"s":"")+":/",o.host+":"+o.port,o.resource,t.protocol,t.util.query(this.options.query,"t="+ +new Date)].join("/"));if(this.isXDomain()&&!t.util.ua.hasCORS){var a=document.getElementsByTagName("script")[0],c=document.createElement("script");c.src=s+"&jsonp="+t.j.length,a.parentNode.insertBefore(c,a),t.j.push(function(e){n(e),c.parentNode.removeChild(c)})}else{var u=t.util.request();u.open("GET",s,!0);var l=this.options.requestHeaders;void 0!==l&&Object.keys(l).forEach(function(e){u.setRequestHeader(e,l[e])}),u.onreadystatechange=function(){4==u.readyState&&(u.onreadystatechange=i,200==u.status?n(u.responseText):!r.reconnecting&&r.onError(u.responseText))},u.send(null)}}},r.prototype.getTransport=function(e){for(var n,r=e||this.transports,i=0;n=r[i];i++)if(t.Transport[n]&&t.Transport[n].check(this)&&(!this.isXDomain()||t.Transport[n].xdomainCheck()))return new t.Transport[n](this,this.sessionid);return null},r.prototype.connect=function(e){if(this.connecting||this.disconnected)return this;var n=this,r=function(r,i,o,s){function a(){if(!n.connected&&!n.disconnected)if(n.connecting=!1,clearTimeout(n.connectTimeoutTimer),n.options["try multiple transports"]){for(;n.remainingTransports.length>0&&n.remainingTransports.splice(0,1)[0]!=n.transport.name;);n.remainingTransports.length?c(n.remainingTransports):n.publish("connect_failed")}else n.publish("connect_failed")}function c(e){if(n.transport&&(n.transport.clearTimeouts(),n.transport.clearEventHandlers()),n.transport=n.getTransport(e),!n.transport||n.disconnected)return n.publish("connect_failed");n.transport.ready(n,function(){n.connecting=!0,n.publish("connecting",n.transport.name),n.transport.open(a),n.options["connect timeout"]&&(n.connectTimeoutTimer=setTimeout(function(){a()},n.options["connect timeout"]))})}n.sessionid=r,n.closeTimeout=1e3*o+2e3,n.heartbeatTimeout=1e3*i+2e3,n.transports=s?t.util.intersect(s.split(","),n.options.transports):n.options.transports,n.setHeartbeatTimeout(),n.remainingTransports=n.transports.slice(0),c(n.transports),n.once("connect",function(){clearTimeout(n.connectTimeoutTimer),e&&"function"==typeof e&&e()})};if(this.options["skipped handshake data"]){var i=this.options["skipped handshake data"];r("v4c-"+(new Date).getTime(),i.timeout,i.timeout,"websocket")}else this.handshake(r);return this},r.prototype.setHeartbeatTimeout=function(){clearTimeout(this.heartbeatTimeoutTimer);var e=this;this.heartbeatTimeoutTimer=setTimeout(function(){e.transport.onClose()},this.heartbeatTimeout)},r.prototype.packet=function(e){return this.connected&&!this.doBuffer?this.transport.packet(e):this.buffer.push(e),this},r.prototype.setBuffer=function(e){this.doBuffer=e,!e&&this.connected&&this.buffer.length&&(this.transport.payload(this.buffer),this.buffer=[])},r.prototype.disconnect=function(){return(this.connected||this.connecting)&&(this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted")),this.disconnected=!0,this},r.prototype.disconnectSync=function(){var e=t.util.request(),n=this.resource+"/"+t.protocol+"/"+this.sessionid;e.open("GET",n,!0),this.onDisconnect("booted")},r.prototype.isXDomain=function(){var e=n.location.port||("https:"==n.location.protocol?443:80);return this.options.host!==n.location.hostname||this.options.port!=e},r.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},r.prototype.onOpen=function(){this.open=!0},r.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},r.prototype.onPacket=function(e){this.of(e.endpoint).onPacket(e)},r.prototype.onError=function(e){e&&e.advice&&"reconnect"===e.advice&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",e&&e.reason?e.reason:e)},r.prototype.onDisconnect=function(e){var t=this.connected,n=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1,(t||n)&&(this.transport.close(),this.transport.clearTimeouts(),t?(this.publish("disconnect",e),"booted"!=e&&this.options.reconnect&&!this.reconnecting&&this.reconnect()):this.publish("close_during_connecting",e))},r.prototype.reconnect=function(){function e(){if(n.connected){for(var e in n.namespaces)n.namespaces.hasOwnProperty(e)&&""!==e&&n.namespaces[e].packet({type:"connect"});n.publish("reconnect",n.transport.name,n.reconnectionAttempts)}clearTimeout(n.reconnectionTimer),n.removeListener("connect_failed",t),n.removeListener("connect",t),n.reconnecting=!1,delete n.reconnectionAttempts,delete n.reconnectionDelay,delete n.reconnectionTimer,delete n.redoTransports,n.options["try multiple transports"]=i}function t(){if(n.reconnecting)return n.connected?e():n.connecting&&n.reconnecting?n.reconnectionTimer=setTimeout(t,1e3):void(n.reconnectionAttempts++>=r?n.redoTransports?(n.publish("reconnect_failed"),e()):(n.on("connect_failed",t),n.options["try multiple transports"]=!0,n.transport=n.getTransport(),n.redoTransports=!0,n.connect()):(n.reconnectionDelay<o&&(n.reconnectionDelay*=2),n.connect(),n.publish("reconnecting",n.reconnectionDelay,n.reconnectionAttempts),n.reconnectionTimer=setTimeout(t,n.reconnectionDelay)))}this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var n=this,r=this.options["max reconnection attempts"],i=this.options["try multiple transports"],o=this.options["reconnection limit"];this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(t,this.reconnectionDelay),this.on("connect",t)}}(void 0!==r?r:n.exports,void 0!==r?r:n.parent.exports,void 0===e?window:e),function(e,t){function n(e,t){this.socket=e,this.name=t||"",this.flags={},this.json=new r(this,"json"),this.ackPackets=0,this.acks={}}function r(e,t){this.namespace=e,this.name=t}e.SocketNamespace=n,t.util.mixin(n,t.EventEmitter),n.prototype.$emit=t.EventEmitter.prototype.emit,n.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},n.prototype.packet=function(e){return e.endpoint=this.name,this.socket.packet(e),this.flags={},this},n.prototype.send=function(e,t){var n={type:this.flags.json?"json":"message",data:e};return"function"==typeof t&&(n.id=++this.ackPackets,n.ack=!0,this.acks[n.id]=t),this.packet(n)},n.prototype.emit=function(e){var t=Array.prototype.slice.call(arguments,1),n=t[t.length-1],r={type:"event",name:e};return"function"==typeof n&&(r.id=++this.ackPackets,r.ack="data",this.acks[r.id]=n,t=t.slice(0,t.length-1)),r.args=t,this.packet(r)},n.prototype.disconnect=function(){return""===this.name?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},n.prototype.onPacket=function(e){function n(){r.packet({type:"ack",args:t.util.toArray(arguments),ackId:e.id})}var r=this;switch(e.type){case"connect":this.$emit("connect");break;case"disconnect":""===this.name?this.socket.onDisconnect(e.reason||"booted"):this.$emit("disconnect",e.reason||"");break;case"message":case"json":var i=["message",e.data];"data"==e.ack?i.push(n):e.ack&&this.packet({type:"ack",ackId:e.id}),this.$emit.apply(this,i);break;case"event":i=[e.name].concat(e.args),"data"==e.ack&&i.push(n),this.$emit.apply(this,i);break;case"ack":this.acks[e.ackId]&&(this.acks[e.ackId].apply(this,e.args),delete this.acks[e.ackId]);break;case"error":e.advice?this.socket.onError(e):"unauthorized"==e.reason?this.$emit("connect_failed",e.reason):this.$emit("error",e.reason)}},r.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},r.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}(void 0!==r?r:n.exports,void 0!==r?r:n.parent.exports),function(e,t,n){function r(e){t.Transport.apply(this,arguments)}function i(){}e.websocket=r,t.util.inherit(r,t.Transport),r.prototype.name="websocket",r.prototype.open=function(e){var r,i=t.util.query(this.socket.options.query),o=this;return this.connectErrorCallback=e,r||(r=n.MozWebSocket||n.WebSocket),this.websocket=new r(this.prepareUrl(i)),this.websocket.onopen=function(){o.onOpen(),o.socket.setBuffer(!1)},this.websocket.onmessage=function(e){o.onData(e.data)},this.websocket.onclose=function(){o.onClose(),o.socket.setBuffer(!0)},this.websocket.onerror=function(e){o.onError(e)},this},r.prototype.send=function(e){return this.websocket.send(e),this},r.prototype.payload=function(e){for(var t=0,n=e.length;t<n;t++)this.packet(e[t]);return this},r.prototype.close=function(){return this.websocket.close(),this},r.prototype.onError=function(e){void 0!==this.connectErrorCallback&&(this.connectErrorCallback(),this.connectErrorCallback=void 0),this.socket.onError(e)},r.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},r.check=function(){return"WebSocket"in n&&!("__addTask"in WebSocket)||"MozWebSocket"in n},r.xdomainCheck=function(){return!0},r.prototype.clearEventHandlers=function(){return this.websocket&&(this.websocket.onopen=this.websocket.onmessage=this.websocket.onclose=this.websocket.onerror=i),this},t.transports.push("websocket")}(void 0!==r?r.Transport:n.exports,void 0!==r?r:n.parent.exports,void 0===e?window:e),function(e,t,n){function r(e){e&&t.Transport.apply(this,arguments)}function i(){}e.XHR=r,t.util.inherit(r,t.Transport),r.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},r.prototype.payload=function(e){for(var n=[],r=0,i=e.length;r<i;r++)n.push(t.parser.encodePacket(e[r]));this.send(t.parser.encodePayload(n))},r.prototype.send=function(e){return this.post(e),this},r.prototype.post=function(e){var t=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),n.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=function(){this.onload=i,t.socket.setBuffer(!1)}:this.sendXHR.onreadystatechange=function(){4==this.readyState&&(this.onreadystatechange=i,200==this.status?(clearTimeout(this.ackTimeoutTimer),t.socket.setBuffer(!1)):t.onClose())},this.sendXHR.send(e),t.sendXHR.ackTimeoutTimer=setTimeout(function(){t.onClose()},t.socket.options.ackTimeoutMs)},r.prototype.close=function(){return this.onClose(),this},r.prototype.request=function(e){var n=t.util.request(this.socket.isXDomain()),r=t.util.query(this.socket.options.query,"t="+ +new Date);n.open(e||"GET",this.prepareUrl(r),!0);var i=this.socket.options.requestHeaders;if(void 0!==i&&Object.keys(i).forEach(function(e){n.setRequestHeader(e,i[e])}),"POST"==e)try{n.setRequestHeader?n.setRequestHeader("Content-type","text/plain;charset=UTF-8"):n.contentType="text/plain"}catch(e){}return n},r.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},r.check=function(e,r){try{var i=t.util.request(r),o=n.XDomainRequest&&i instanceof XDomainRequest,s=(e&&e.options&&e.options.secure?"https:":"http:")!=n.location.protocol;if(i&&(!o||!s))return!0}catch(e){}return!1},r.xdomainCheck=function(){return r.check(null,!0)},r.prototype.clearEventHandlers=function(){return this.sendXHR&&(this.sendXHR.onreadystatechange=this.sendXHR.onload=i),this}}(void 0!==r?r.Transport:n.exports,void 0!==r?r:n.parent.exports,void 0===e?window:e),function(e,t,n){function r(){t.Transport.XHR.apply(this,arguments)}function i(){}e["xhr-polling"]=r,t.util.inherit(r,t.Transport.XHR),t.util.merge(r,t.Transport.XHR),r.prototype.name="xhr-polling",r.prototype.open=function(e){return this.connectErrorCallback=e,t.Transport.XHR.prototype.open.call(this),!1},r.prototype.get=function(){if(this.isOpened){var e=this;this.xhr=this.request(),n.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=function(){e.connectErrorCallback=void 0,this.onload=i,this.onerror=i,e.onData(this.responseText),e.get()},this.xhr.onerror=function(){e.onClose(),void 0!==e.connectErrorCallback&&(e.connectErrorCallback(),e.connectErrorCallback=void 0)}):this.xhr.onreadystatechange=function(){4==this.readyState&&(this.onreadystatechange=i,200==this.status?(e.connectErrorCallback=void 0,e.onData(this.responseText),e.get()):(e.onClose(),void 0!==e.connectErrorCallback&&(e.connectErrorCallback(),e.connectErrorCallback=void 0)))},this.xhr.send(null)}},r.prototype.onClose=function(){if(t.Transport.XHR.prototype.onClose.call(this),this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=i;try{this.xhr.abort()}catch(e){}this.xhr=null}},r.prototype.ready=function(e,n){var r=this;t.util.defer(function(){n.call(r)})},r.prototype.clearEventHandlers=function(){return t.Transport.XHR.prototype.clearEventHandlers.call(this),this.xhr&&(this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=i),this},t.transports.push("xhr-polling")}(void 0!==r?r.Transport:n.exports,void 0!==r?r:n.parent.exports,void 0===e?window:e),t.io=r}).call(t,n(13),n(14)(e))},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectionTracker=t.Properties=t.TrackerStep=t.ClientEventName=t.ResponseData=void 0;var r,i=n(3),o=n(1),s=n(0),a=function(e){this.id=e,this.status=200,this.headers={},this.body=""};t.ResponseData=a,function(e){e.Connected="trouter_js_client_connected",e.Disconnected="trouter_js_client_disconnected",e.Error="trouter_js_client_error",e.Progress="trouter_js_client_progress",e.Response="trouter_js_client_response",e.Request="trouter_js_client_request",e.CheckConnection="trouter_js_client_check_connection",e.Registration="trouter_js_client_registration",e.Unregistration="trouter_js_client_unregistration"}(r||(t.ClientEventName=r={}));var c=function(e,t,n,r,i){this.stepName=e,this.operation=t,this.delta=n,this.ts=r,this.error=i};t.TrackerStep=c;var u=function(){};t.Properties=u;var l=function(){this.numberOfPingReplies=0,this.connectedTimestamp=0,this.isNewUrl=!1,this.transportType="",this.connectionNumber=0},d=function(){this.enabled=!1,this.numberOfStepsToMaintain=40,this.logHealthCheckError=!1,this.sendProgressTimeoutSecs=55,this.logSendPingError=!1,this.maxBackoffInMs=12e4,this.trouter_js_client_connected=!1,this.trouter_js_client_disconnected=!1,this.trouter_js_client_error=!1,this.trouter_js_client_progress=!1,this.trouter_js_client_response=!1,this.trouter_js_client_request=!1,this.trouter_js_client_registration=!1,this.trouter_js_client_unregistration=!1,this.trouter_js_client_check_connection=!0},h=function(){function e(e,t,n,r,o,a,c){this.clientId=t,this.clientInfo=n,this.getServerState=r,this.endpointId=o,this.clientCorrelationID=a,this.environment=c,this.logger=new s.Logger("ConnectionTracker",e),this.clientCorrelationID=void 0!==a?a:"",this.steps=[],this.connectionAttempt=0,this.totalStepCount=0,this.beginTimestamp=new i.Timespan,this.eventLogSettings=new d,this.connectedInfo=new l}return e.prototype.enable=function(e){this.eventLogSettings.enabled=!0,this.eventLogger=e},e.prototype.disable=function(){this.eventLogSettings.enabled=!1},e.prototype.sendProgress=function(e){this.steps.length>0&&this.sendTelemetry(r.Progress,e,this.steps)},e.prototype.cancelProgressTimer=function(){void 0!==this.progressTimeout&&(clearTimeout(this.progressTimeout),this.progressTimeout=void 0)},e.prototype.resetProgressSendTimer=function(){var e=this;this.cancelProgressTimer(),void 0!==this.eventLogSettings.sendProgressTimeoutSecs&&this.eventLogSettings.sendProgressTimeoutSecs>0&&(this.progressTimeout=setTimeout(function(){e.sendProgress({reason:"timeout",timeoutSecs:e.eventLogSettings.sendProgressTimeoutSecs})},1e3*this.eventLogSettings.sendProgressTimeoutSecs))},e.prototype.setConnectedInfo=function(e,t){this.connectedInfo.numberOfPingReplies=0,this.connectedInfo.connectedTimestamp=Date.now(),this.connectedInfo.isNewUrl=e,this.connectedInfo.transportType=t,++this.connectedInfo.connectionNumber},e.prototype.clearConnectedInfo=function(){this.connectedInfo.numberOfPingReplies=0,this.connectedInfo.connectedTimestamp=0,this.connectedInfo.isNewUrl=!0,this.connectedInfo.transportType=""},e.prototype.copyProperties=function(e,t){for(var n=0,r=Object.keys(t);n<r.length;n++){var i=r[n];void 0!==t[i]&&(e[i.replace(/-/g,"_")]={value:t[i]})}},e.prototype.increasePingResponseCount=function(){++this.connectedInfo.numberOfPingReplies},e.prototype.sendTelemetry=function(e,t,n){try{if(!0===this.eventLogSettings.enabled&&!0===this.eventLogSettings[e]&&void 0!==this.eventLogger){var r=this.getServerState(),s={name:e,properties:{connectionAttempt:{value:this.connectionAttempt},epid:{value:this.endpointId},clientCorrelationID:{value:this.clientCorrelationID},steps:{value:(0,i.toJson)(n)},clientID:{value:this.clientId},eventVersion:{value:3},environment:{value:this.environment},cv:{value:o.CLIENT_VERSION},ua:{value:this.clientInfo.ua},connectionId:{value:r.connectionId},connectedClientId:{value:r.connectedClientId},domId:{value:r.domId},url:{value:r.unsecureUrl},surl:{value:r.url},ttlInSecs:{value:r.getRemainingTtlInSec()},numberOfPingReplies:{value:this.connectedInfo.numberOfPingReplies},connectedTimestamp:{value:this.connectedInfo.connectedTimestamp},isNewUrl:{value:this.connectedInfo.isNewUrl},transportType:{value:this.connectedInfo.transportType},connectionNumber:{value:this.connectedInfo.connectionNumber}}};this.copyProperties(s.properties,t),this.eventLogger.logEvent(s)}}catch(t){this.logger.warn("error in sending event ".concat(e,": ").concat((0,i.toJson)(t)))}},e.prototype.createStep=function(e,t,n){return new c(e,t,this.beginTimestamp.duration,Date.now(),n)},e.prototype.addStep=function(e,t,n){if(!1!==this.eventLogSettings.enabled&&(0===this.steps.length&&this.beginTimestamp.reset(),this.steps.push(this.createStep(e,t,n)),++this.totalStepCount,void 0!==this.eventLogSettings.numberOfStepsToMaintain&&this.steps.length>this.eventLogSettings.numberOfStepsToMaintain)){var i=this.steps.slice(0);this.steps.length=0,this.sendTelemetry(r.Progress,{reason:"flush"},i)}},e.prototype.trackStart=function(e){this.addStep(e,"start")},e.prototype.trackEnd=function(e){this.addStep(e,"end")},e.prototype.trackError=function(e,t,n,i){void 0===n&&(n=!0),"health"===e&&!0!==this.eventLogSettings.logHealthCheckError||"ping"===e&&!1===this.eventLogSettings.logSendPingError||(void 0===i&&(i="error"),!0===n&&this.addStep(e,i,t),this.sendTelemetry(r.Error,{},[this.createStep(e,i,t)]))},e.prototype.trackProgress=function(e,t){this.addStep(e,t)},e.prototype.trackConnected=function(e,t){this.setConnectedInfo(e,t);var n=this.steps.slice(0),i=this.totalStepCount,o=this.beginTimestamp.duration;this.steps.length=0,this.totalStepCount=0,this.sendTelemetry(r.Connected,{stepCount:n.length,totalStepCount:i,connectionEstablishmentMs_Total:o},n),this.cancelProgressTimer()},e.prototype.getSessionLength=function(){return Date.now()-this.connectedInfo.connectedTimestamp},e.prototype.trackDisconnected=function(e){e.sessionLengthMS=this.getSessionLength(),this.sendTelemetry(r.Disconnected,e,[]),this.resetProgressSendTimer()},e.prototype.trackNewConnection=function(){++this.connectionAttempt},e.prototype.trackRequest=function(e,t){var n={};void 0!==t&&(n.hasError=!0,n.error=t);try{if(e){n.requestID=e.id,n.httpMethod=e.method,n.url=e.url,n.bodyLength=e.body.length,n.shortUrl=e.shortUrl,n.requestTimeStamp=e.startTS,n.correlationVector=e.correlationVector;for(var o=e.headers,s=0,a=Object.keys(o);s<a.length;s++){var c=a[s];n[c]=o[c]}}}catch(e){n.hasError=!0,n.error="".concat(n.error," error creating request context ").concat((0,i.toJson)(e))}this.sendTelemetry(r.Request,n,[])},e.prototype.trackResponse=function(e,t,n,o){var s={};void 0!==o&&(s.hasError=!0,s.error=o);try{if(s.responseTimestamp=void 0!==n?n.sentTS:Date.now(),e){s.requestID=e.id,s.httpMethod=e.method,s.shortUrl=e.shortUrl,s.correlationVector=e.correlationVector;for(var a=e.headers,c=0,u=Object.keys(a);c<u.length;c++){var l=u[c];s[l]=a[l]}}n&&(s.latencyMS=t,s.responseCode=n.status,s.responseLength=n.body.length)}catch(e){s.hasError=!0,s.error="".concat(s.error," error creating response context ").concat((0,i.toJson)(e))}this.sendTelemetry(r.Response,s,[])},e.prototype.sendResponseError=function(e,t,n){this.trackResponse(t,void 0,n,e)},e.prototype.close=function(){this.sendProgress({reason:"closed"}),this.steps.length=0,this.cancelProgressTimer()},e.prototype.mergeSettings=function(e){if(e){this.eventLogSettings.numberOfStepsToMaintain=Math.min(40,Math.max(10,void 0!==e.numberOfStepsToMaintain?e.numberOfStepsToMaintain:0));var t=Math.min(3600,Math.max(55,void 0!==e.sendProgressTimeoutSecs?e.sendProgressTimeoutSecs:0));this.eventLogSettings.logHealthCheckError=e.logHealthCheckError,this.eventLogSettings.logSendPingError=e.logSendPingError;for(var n=0,i=Object.keys(r).map(function(e){return r[e]});n<i.length;n++){var o=i[n];void 0!==e[o]&&(this.eventLogSettings[o]=e[o])}this.eventLogSettings.sendProgressTimeoutSecs!==t&&(this.eventLogSettings.sendProgressTimeoutSecs=t,this.resetProgressSendTimer())}},e}();t.ConnectionTracker=h},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.DisconnectReason=void 0;var r=function(){function e(e,t,n){this.reason=e,this.claims=t,this.details=n}return e.fromRawReason=function(t,n){if(""===t||"dup"===t)return new e(t);try{var r=JSON.parse(t);return"object"!=typeof r||void 0===r.reason?(null==n||n.error("invalid disconnect reason format"),new e("unknown",void 0,t)):new e(r.reason,r.claims,r.details)}catch(n){return new e("disconnect",void 0,t)}},e.fromSocketIoEventData=function(t,n){return"string"==typeof n?new e(t,void 0,n):void 0},e.prototype.toTelemetryString=function(){return"socketerror"===this.reason||"reconnecterror"===this.reason||"disconnect"===this.reason?this.details:this.reason},e}();t.DisconnectReason=r},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.ExponentialBackoff=void 0;var r=function(){function e(e,t,n){void 0===n&&(n={tolerance:2,minimumWaitMs:1e4}),this.logger=e,this.maxBackoffInMs=t,this.gapDetectionSettings=n,this.backoffId=0,this.backoffCount=0}return e.calculateNextBackoffMs=function(e,t){var n=1+.4*(Math.random()-.5),r=1e3*Math.pow(2,e)*n;return r=Math.round(r),Math.min(t,r)},e.prototype.setMaxBackoffMs=function(e){this.maxBackoffInMs=e},e.prototype.backoff=function(t,n){var r=this;if(void 0!==this.timerHandle&&(this.logger.debug("Clearing current back off"),clearTimeout(this.timerHandle),this.timerHandle=void 0),void 0!==this.previousCompleteTime){var i=Date.now()-this.previousCompleteTime;i>this.maxBackoffInMs*this.gapDetectionSettings.tolerance&&i>this.gapDetectionSettings.minimumWaitMs&&(this.logger.info("Back off for ".concat(t," with ID ").concat(this.backoffId," will be reset due to a lot of time having passed since the previous backoff (").concat(i," ms)")),this.backoffCount=0,this.previousCompleteTime=void 0)}var o=e.calculateNextBackoffMs(this.backoffCount,this.maxBackoffInMs);this.backoffId++,this.backoffCount++,this.logger.info("Backing off ".concat(t," for ").concat(o," milliseconds with ID ").concat(this.backoffId)),this.callback=function(e,i){(function(e,t,n){if(void 0===e||void 0===t)return!1;var r=Date.now()-e;return r>t*n.tolerance&&r>n.minimumWaitMs})(e,i,r.gapDetectionSettings)&&(r.logger.info("Back off for ".concat(t," with ID ").concat(r.backoffId," will be reset due to the wait (").concat(Date.now()-(null!=e?e:0)," ms) being longer than expected (").concat(i," ms)")),r.backoffCount=0),r.logger.info("Back off for ".concat(t," with ID ").concat(r.backoffId," complete, invoking handler")),r.timerHandle=void 0,r.callback=void 0,r.previousCompleteTime=Date.now(),n()};var s=Date.now();this.timerHandle=setTimeout(function(){var e;return null===(e=r.callback)||void 0===e?void 0:e.call(r,s,o)},o)},e.prototype.reset=function(){void 0!==this.timerHandle&&(this.logger.debug("Resetting back off with ID ".concat(this.backoffId)),clearTimeout(this.timerHandle),this.timerHandle=void 0,this.callback=void 0),this.backoffCount=0},e.prototype.expediteIfPending=function(){if(this.backoffCount=0,void 0!==this.timerHandle){this.logger.debug("Expediting back off with ID ".concat(this.backoffId)),clearTimeout(this.timerHandle),this.timerHandle=void 0;var e=this.callback;this.callback=void 0,e&&e()}},e}();t.ExponentialBackoff=r},function(e,t,n){var r=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.LoggingManagerConsumer=t.RegistrationEnforcer=void 0;var i=n(6),o=function(){function e(e,t,n){this.wrapped=e,this.shouldConnectionDependOnRegistration=t,this.shouldHoldBackEvents=n,this.isRegistered=!1,this.heldBackEvents=[]}return e.prototype.onDownstreamRequest=function(e,t,n){this.passIfRegisteredOrNotNeeded("onDownstreamRequest",e,t,n)},e.prototype.onConnected=function(e){this.passIfRegisteredOrNotNeeded("onConnected",e)},e.prototype.onRegistered=function(e){this.isRegistered=!0,this.wrapped.onRegistered(e),this.fireHeldBackEvents()},e.prototype.onUnregistered=function(e){this.isRegistered=!1,this.wrapped.onUnregistered(e),e.getState()===i.State.Connected&&this.shouldConnectionDependOnRegistration()&&e.forceReconnectDueToNoRegistration()},e.prototype.onReconnecting=function(e){this.wrapped.onReconnecting(e)},e.prototype.onReconnectIsRequired=function(e,t,n){this.wrapped.onReconnectIsRequired(e,t,n)},e.prototype.onDisconnected=function(e){this.isRegistered=!1,this.dropHeldBackEvents(),this.wrapped.onDisconnected(e)},e.prototype.onTerminalError=function(e){this.wrapped.onTerminalError(e)},e.prototype.onConnectionParametersUpdated=function(e){this.wrapped.onConnectionParametersUpdated(e)},e.prototype.onTrouterMessageLost=function(e){this.passIfRegisteredOrNotNeeded("onTrouterMessageLost",e)},e.prototype.onUserActivityStateAccepted=function(e){this.passIfRegisteredOrNotNeeded("onUserActivityStateAccepted",e)},e.prototype.onAudiencesSetResolved=function(e,t){this.passIfRegisteredOrNotNeeded("onAudiencesSetResolved",e,t)},e.prototype.getState=function(){return this.wrapped.getState()},e.prototype.holdBackEvent=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.heldBackEvents.push({kind:e,args:t})},e.prototype.passIfRegisteredOrNotNeeded=function(e){for(var t,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];var o=this.shouldConnectionDependOnRegistration(),s=this.shouldHoldBackEvents();o&&s||this.fireHeldBackEvents(o?function(e){return"onConnected"!==e.kind}:void 0),this.isRegistered||!o||!1===s&&"onConnected"!==e?(t=this.wrapped)[e].apply(t,n):this.holdBackEvent.apply(this,r([e],n,!1))},e.prototype.fireHeldBackEvents=function(e){for(var t,n=0,r=this.heldBackEvents;n<r.length;n++){var i=r[n];(void 0===e||e(i))&&(t=this.wrapped)[i.kind].apply(t,i.args)}this.heldBackEvents=void 0===e?[]:this.heldBackEvents.filter(function(t){return!e(t)})},e.prototype.dropHeldBackEvents=function(){this.heldBackEvents=[]},e}();t.RegistrationEnforcer=o;var s=function(){function e(e,t,n,r){this.wrapped=e,this.prefix=t,this.logger=n,this.onEventAction=r}return e.prototype.onEvent=function(e,t){var n;void 0!==this.onEventAction?this.onEventAction(e,t):(null!==(n=this.logger)&&void 0!==n?n:console).log("".concat(this.prefix," TracingEnforcer: ").concat(e,"(").concat(t,")"))},e.prototype.onDownstreamRequest=function(e,t,n){this.onEvent("onDownstreamRequest",JSON.stringify({request:t,response:n})),this.wrapped.onDownstreamRequest(e,t,n)},e.prototype.onConnected=function(e){this.onEvent("onConnected",e.getState().toString()),this.wrapped.onConnected(e)},e.prototype.onRegistered=function(e){this.onEvent("onRegistered",e.getState().toString()),this.wrapped.onRegistered(e)},e.prototype.onUnregistered=function(e){this.onEvent("onUnregistered",e.getState().toString()),this.wrapped.onUnregistered(e)},e.prototype.onReconnecting=function(e){this.onEvent("onReconnecting",e.getState().toString()),this.wrapped.onReconnecting(e)},e.prototype.onReconnectIsRequired=function(e,t,n){this.onEvent("onReconnectIsRequired",JSON.stringify({connection:e.getState().toString(),useConnectParamsFromCache:t,reason:n})),this.wrapped.onReconnectIsRequired(e,t,n)},e.prototype.onDisconnected=function(e){this.onEvent("onDisconnected",e.getState().toString()),this.wrapped.onDisconnected(e)},e.prototype.onTerminalError=function(e){this.onEvent("onTerminalError",JSON.stringify({connection:e})),this.wrapped.onTerminalError(e)},e.prototype.onConnectionParametersUpdated=function(e){this.onEvent("onConnectionParametersUpdated",JSON.stringify({connectParams:e})),this.wrapped.onConnectionParametersUpdated(e)},e.prototype.onTrouterMessageLost=function(e){this.onEvent("onTrouterMessageLost",JSON.stringify({flowTags:e})),this.wrapped.onTrouterMessageLost(e)},e.prototype.onUserActivityStateAccepted=function(e){this.onEvent("onUserActivityStateAccepted",JSON.stringify({cv:e})),this.wrapped.onUserActivityStateAccepted(e)},e.prototype.onAudiencesSetResolved=function(e,t){this.onEvent("onAudiencesSetResolved",JSON.stringify({audienceSubscriptionsResponse:e,cv:t})),this.wrapped.onAudiencesSetResolved(e,t)},e.prototype.getState=function(){return this.wrapped.getState()},e}();t.LoggingManagerConsumer=s},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.TrouterManagerFsm=void 0;var r=n(2),i=n(4),o=n(0),s=n(7),a=function(){function e(e,t){this.worker=t,this.state=i.TrouterManagerState.Unknown,this.logger=new o.Logger("ManagerFsm",e)}return e.prototype.start=function(){this.state===i.TrouterManagerState.Unknown?(this.setState(i.TrouterManagerState.Disconnected),this.worker.forceStopLingeringConnection(),this.worker.startFirstConnection()):(this.logger.info("start called in state '".concat(i.TrouterManagerState[this.state],"', expediting pending backoffs, if any")),this.worker.expediteBackoffOnConnections())},e.prototype.stop=function(e){this.state!==i.TrouterManagerState.Unknown?(this.setState(i.TrouterManagerState.Unknown),this.worker.stopFirstConnection(!0===e),this.worker.stopSecondConnection(!0===e)):this.showIgnored("stop")},e.prototype.getState=function(){switch(this.state){case i.TrouterManagerState.Unknown:case i.TrouterManagerState.Connected:case i.TrouterManagerState.Disconnected:case i.TrouterManagerState.Switching:return this.state;case i.TrouterManagerState.TerminalError:return r.TrouterState.Disconnected}},e.prototype.getInternalState=function(){return this.state},e.prototype.onConnected=function(e){this.state===i.TrouterManagerState.Disconnected&&e?this.worker.doesSecondConnectionExist()?this.setState(i.TrouterManagerState.Switching):(this.setState(i.TrouterManagerState.Connected),this.worker.dispatchConnected()):this.showIgnored("onConnected(".concat(e,")"))},e.prototype.onRegistered=function(e){this.state!==i.TrouterManagerState.Disconnected||e?this.state!==i.TrouterManagerState.Switching||e?this.state===i.TrouterManagerState.Disconnected&&e&&(this.setState(i.TrouterManagerState.Connected),this.worker.dispatchConnected()):(this.setState(i.TrouterManagerState.Connected),this.worker.switchConnections(),this.worker.stopSecondConnectionDelayed(),this.worker.dispatchConnected()):(this.setState(i.TrouterManagerState.Connected),this.worker.switchConnections(),this.worker.stopSecondConnection(!0),this.worker.dispatchConnected()),this.worker.dispatchRegistrationState(!0)},e.prototype.onUnregistered=function(e){e&&this.worker.dispatchRegistrationState(!1)},e.prototype.onReconnecting=function(e){this.state!==i.TrouterManagerState.Connected&&this.state!==i.TrouterManagerState.Switching||!e?this.showIgnored("onReconnecting(".concat(e,")")):(this.setState(i.TrouterManagerState.Disconnected),this.worker.dispatchDisconnected())},e.prototype.onReconnectionRequired=function(e,t,n){this.state===i.TrouterManagerState.Connected&&e?(this.setState(i.TrouterManagerState.Switching),this.worker.startSecondConnection(t)):this.state===i.TrouterManagerState.Disconnected&&e?this.worker.startSecondConnection(t):this.state===i.TrouterManagerState.Switching&&e&&n===s.ReconnectReason.Configuration?(this.logger.debug("onReconnectionRequired: switch requested while already in Switching state"),this.worker.stopSecondConnection(!0),this.worker.startSecondConnection(t)):this.showIgnored("onReconnectionRequired(".concat(e,")"))},e.prototype.onDisconnected=function(e){this.state==i.TrouterManagerState.Unknown&&e?this.worker.dispatchDisconnected():this.state==i.TrouterManagerState.Switching&&e?(this.worker.switchConnections(),this.worker.stopSecondConnection(!1),this.setState(i.TrouterManagerState.Disconnected),this.worker.dispatchDisconnected()):this.showIgnored("onDisconnected(".concat(e,")"))},e.prototype.onTerminalError=function(){this.setState(i.TrouterManagerState.TerminalError),this.worker.dispatchTerminalError()},e.prototype.showIgnored=function(e){this.logger.info("Ignoring event '".concat(e,"' in state '").concat(i.TrouterManagerState[this.state],"'"))},e.prototype.setState=function(e){this.logger.info("Switching from state '".concat(i.TrouterManagerState[this.state],"' to state '").concat(i.TrouterManagerState[e],"'")),this.state!==e?this.state=e:this.logger.error("Attempt to switch to the current state '".concat(i.TrouterManagerState[e],"'"))},e}();t.TrouterManagerFsm=a},function(e,t,n){function r(e,t){if(!t)return e;var n=o(o({},e),{enabled:t.TelemetryEnabled});return void 0!==t.ClientTelemetryEventEnabled&&(n=o(o({},n),t.ClientTelemetryEventEnabled)),n}function i(e,t,n){var i,s,a,c,u,l,d,h,p,f,g=function(n){return e.proxyUrlRewrite?(t.info("Using rewritten URL for proxy"),e.proxyUrlRewrite(n)):n};return{clientInfo:{ua:e.trouterSettings.productName,v:e.trouterSettings.version},ioOptions:{ackTimeoutMs:5e3,rewriteUrlForProxy:g},clientCorrelationID:e.trouterSettings.sessionId,environment:e.trouterSettings.environment,telemetrySettings:r(e.telemetryConfig.settings,n),eventLogger:e.telemetryConfig.eventLogger,endpointId:e.trouterSettings.registrationId,trouterUrl:(null==n?void 0:n.TrouterConnectionUrl)||e.trouterSettings.trouterServiceUrl,registration:e.trouterSettings.registrarServiceUrl?{registrarUrl:e.trouterSettings.registrarServiceUrl,registrationId:null!==(i=e.trouterSettings.registrationId)&&void 0!==i?i:"",pnhAppId:null!==(s=e.trouterSettings.pnhAppId)&&void 0!==s?s:"",platform:null!==(a=e.trouterSettings.platform)&&void 0!==a?a:"",pnhTemplateKey:null!==(c=e.trouterSettings.pnhTemplate)&&void 0!==c?c:"",platformUIVersion:null!==(u=e.trouterSettings.platformUIVersion)&&void 0!==u?u:"",productContext:e.trouterSettings.pnhProductContext||void 0,context:null!==(l=e.trouterSettings.pnhContext)&&void 0!==l?l:"",registrarTtlSec:(null!==(d=e.trouterSettings.maxRegistrationTimeInMs)&&void 0!==d?d:0)/1e3}:void 0,connectionDependsOnRegistration:void 0===e.trouterSettings.registrarServiceUrl?function(){return!1}:null!==(h=e.trouterSettings.connectionDependsOnRegistration)&&void 0!==h?h:function(){return!1},delayEventsUntilRegistered:null!==(p=e.trouterSettings.delayEventsUntilRegistered)&&void 0!==p?p:function(){return!1},timeoutOptions:o({connectionTimeoutMs:e.trouterSettings.trouterConnectTimeoutInMs||3e4,fetchTimeoutMs:1e4,pingTimeoutMs:4e4,pongTimeoutMs:5e3,maxBackoffMs:"TeamsCDL"===e.trouterSettings.productName?3e5:3e4,requestTimeoutMs:5e3,userActivityResponseTimeoutMs:1e4},e.trouterSettings.timeoutOptions),incallTimeoutOptions:o({connectionTimeoutMs:1e4,fetchTimeoutMs:5e3,pingTimeoutMs:5e3,pongTimeoutMs:2e3,maxBackoffMs:"TeamsCDL"===e.trouterSettings.productName?3e5:1e4,requestTimeoutMs:5e3,userActivityResponseTimeoutMs:1e4},e.trouterSettings.incallTimeoutOptions),incallModeTimeoutMs:null!==(f=e.trouterSettings.incallModeTimeoutMs)&&void 0!==f?f:0,lingeringConnectionDelayMs:6e4,userActivitySecondResendDelayMs:e.trouterSettings.userActivitySecondResendDelayMs||1e4,duplicateDisconnectThresholdMs:1e4,connectionCache:e.connectionCache,registrationStateCallback:e.registrationStateCallbackForAcsDoNotUse,rewriteUrlForProxy:g,retryLimitOnTokenFetch:e.trouterSettings.retryLimitOnTokenFetch,extraConnectionHeaders:e.trouterSettings.extraConnectionHeaders,expediteBackoffOnStartMinimumDelayMs:1e4,toJSON:function(){return o(o({},this),{connectionCache:this.connectionCache?{}:this.connectionCache})}}}var o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},o.apply(this,arguments)},s=this&&this.__awaiter||function(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?n(e.value):i(e.value).then(s,a)}c((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;a&&(a=0,n[0]&&(c=0)),c;)try{if(i=1,o&&(s=2&n[0]?o.return:n[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(s=(s=c.trys).length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){c.label=n[1];break}if(6===n[0]&&c.label<s[1]){c.label=s[1],s=n;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(n);break}s[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,s,a,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(t,"__esModule",{value:!0}),t.replaceTrouterUrlBase=t.getTrouterServiceVersion=t.createTrouterService=t.TrouterService=t.UserActivityState=t.TrouterState=void 0;var c=n(1),u=n(2);Object.defineProperty(t,"TrouterState",{enumerable:!0,get:function(){return u.TrouterState}}),Object.defineProperty(t,"UserActivityState",{enumerable:!0,get:function(){return u.UserActivityState}});var l=n(0),d=n(8),h=n(9),p=n(10),f=n(11),g=function(){function e(e){this.logProvider=e,this.stateChangedListeners=[],this.logger=new l.Logger("Trouter",e),this.trouterUrlPromise=new f.TrouterUrlPromise(e),this.messageHandlers=new d.MessageHandlerRegistry(e),this.listeners={},this.connectionInfo=null,this.logger.info("Created TrouterService version ".concat(c.CLIENT_VERSION))}return e.prototype.start=function(e){var t;if(this.logger.info("Start"),!e.skypeTokenProvider&&!e.authTokenProvider)throw new Error("no token provider has been configured, either skypeTokenProvider or authTokenProvider must be populated");e.skypeTokenProvider&&!e.trouterSettings.disableInternalSkypeTokenCache&&(e.skypeTokenProvider=(0,h.addCacheAsBackupTo)(e.skypeTokenProvider)),this.trouterCfg=e;var n=i(e,this.logger,this.ecsCfg);!1===e.internalEnableV4cProtocol&&(n.forceV4aProtocol=!0);var r=function(e,t){var n,r=this;return function(i){return s(r,void 0,void 0,function(){var r,o,s;return a(this,function(a){switch(a.label){case 0:r=new Date,o=setInterval(function(){var t=Math.round((Date.now()-r.getTime())/6e4);e.warn("Note: Trouter auth token request promise from ".concat(r.toISOString()," has not been resolved for ").concat(t," minutes. The client is blocked from operating properly"))},3e5),a.label=1;case 1:return a.trys.push([1,,3,4]),[4,t(i)];case 2:return s=a.sent(),i.needFresh&&s.token===n&&e.error("API violation: Trouter auth token provider got a request with needRefresh=true, but returned the same token as last time anyway. Please fix the host app"),n=s.token,[2,s];case 3:return clearInterval(o),[7];case 4:return[2]}})})}}(this.logger,null!==(t=e.authTokenProvider)&&void 0!==t?t:function(e){var t=this;return function(n){return s(t,void 0,void 0,function(){var t;return a(this,function(r){switch(r.label){case 0:return t={},[4,e(n.needFresh)];case 1:return[2,(t.token=r.sent(),t.tokenType="skype",t)]}})})}}(e.skypeTokenProvider));void 0===this.trouterServer&&(this.trouterServer=new p.TrouterManager(this.logProvider,n,r,void 0===e.authTokenProvider,this)),void 0!==this.pendingActivityState&&(this.trouterServer.setUserActivityState(this.pendingActivityState[0],this.pendingActivityState[1]),this.pendingActivityState=void 0),this.trouterServer.start()},e.prototype.stop=function(e){this.logger.info("close connection"),this.trouterUrlPromise.rejectUrl(new Error("TrouterService is stopped")),void 0!==this.trouterServer&&this.trouterServer.stop(e)},e.prototype.setEcsConfig=function(e){return s(this,void 0,void 0,function(){var t=this;return a(this,function(n){return[2,new Promise(function(n){if(t.ecsCfg=e.TrouterJScriptClient,t.logger.info("Setting ECS configuration to ".concat(JSON.stringify(t.ecsCfg))),void 0!==t.trouterServer&&void 0!==t.trouterCfg){var r=i(t.trouterCfg,t.logger,t.ecsCfg);t.trouterServer.configure(r)}n()})]})})},e.prototype.checkConnection=function(e){void 0!==this.trouterServer&&this.trouterServer.checkConnection(null!=e&&e)},e.prototype.resendRegistration=function(){return s(this,void 0,void 0,function(){return a(this,function(e){if(!this.trouterServer)throw new Error("resendRegistration called too early");return[2,this.trouterServer.resendRegistration()]})})},e.prototype.registerListener=function(e,t){return""===t||!t.startsWith("/")||t.includes("?")||t.includes("#")?(this.logger.error("Listener path '".concat(t,"' is not valid")),!1):this.listeners[t]?(this.logger.error("Another listener is already registered for path '".concat(t,"'")),!1):(this.listeners[t]=e,this.logger.debug("Listener for path '".concat(t,"' registered")),this.connectionInfo&&e.onTrouterConnected(this.connectionInfo.baseEndpointUrl+t,this.connectionInfo),!0)},e.prototype.unregisterListener=function(e){for(var t=[],n=0,r=Object.keys(this.listeners);n<r.length;n++){var i=r[n];this.listeners[i]===e&&t.push(i)}if(0===t.length)return!1;for(var o=0,s=t;o<s.length;o++)i=s[o],delete this.listeners[i];return this.logger.debug("Listener for path(s) '".concat(t.join("', '"),"' unregistered")),!0},e.prototype.onTrouterConnected=function(e,t){this.logger.debug("Trouter is now connected");for(var n=0,r=Object.keys(this.listeners);n<r.length;n++){var i=r[n];try{this.listeners[i].onTrouterConnected(t.baseEndpointUrl+i,t)}catch(e){this.logger.error("Listener '".concat(i,"' threw an exception from onTrouterConnected(): ").concat(e))}}this.connectionInfo=t,this.trouterUrlPromise.resolveUrl(e),this.notifyStateChanged(u.TrouterState.Connected,{url:e,getRemainingTtlInSec:function(){return t.connectionTtlSec}})},e.prototype.onTrouterDisconnected=function(){this.logger.debug("Trouter is now disconnected"),this.connectionInfo=null;for(var e=0,t=Object.keys(this.listeners);e<t.length;e++){var n=t[e],r=this.listeners[n];if(r.onTrouterDisconnected)try{r.onTrouterDisconnected()}catch(e){this.logger.error("Listener '".concat(n,"' threw an exception from onTrouterDisconnected(): ").concat(e))}}this.notifyStateChanged(u.TrouterState.Disconnected)},e.prototype.onTrouterRequest=function(e,t){for(var n="",r=0,i=Object.keys(this.listeners);r<i.length;r++){var o=i[r];e.path.startsWith(o)&&o.length>n.length&&(n=o)}if(""===n)this.tryMessageHandlers(e,t)||(t.status=404,t.headers={"Trouter-Responder":"ClientLib"},t.send());else try{this.listeners[n].onTrouterRequest(e,t)}catch(e){this.logger.error("Listener '".concat(n,"' threw an exception from onTrouterRequest(): ").concat(e)),t.status=500,t.headers={"Trouter-Responder":"ClientLib"},t.send()}},e.prototype.onTrouterMessageLoss=function(e){this.logger.info("onTrouterMessageLoss called with tags [".concat(e,"]"));for(var t=!0,n=0,r=Object.keys(this.listeners);n<r.length;n++){var i=r[n],o=this.listeners[i];if(o.onTrouterMessageLoss)try{void 0===(t=o.onTrouterMessageLoss(e)&&t)&&(this.logger.error("Listener '".concat(i,"' did not return a boolean value from onTrouterMessageLoss()")),t=!1)}catch(e){this.logger.error("Listener '".concat(i,"' threw an exception from onTrouterMessageLoss(): ").concat(e)),t=!1}}return t},e.prototype.onTrouterUserActivityStateAccepted=function(e){this.logger.debug("onTrouterUserActivityStateAccepted cv: ".concat(e));for(var t=0,n=Object.keys(this.listeners);t<n.length;t++){var r=n[t],i=this.listeners[r];if(i.onTrouterUserActivityStateAccepted)try{i.onTrouterUserActivityStateAccepted(e)}catch(e){this.logger.error("Listener '".concat(r,"' threw an exception from onTrouterUserActivityStateAccepted(): ").concat(e))}}},e.prototype.onAudiencesSetResolved=function(e,t){this.logger.debug("onAudiencesSetResolved cv: ".concat(t));for(var n=0,r=Object.keys(this.listeners);n<r.length;n++){var i=r[n],o=this.listeners[i];if(o.onAudiencesSetResolved)try{o.onAudiencesSetResolved(e,t)}catch(e){this.logger.error("Listener '".concat(i,"' threw an exception from onAudienceSubscribed(): ").concat(e))}}},e.prototype.setUserActivityState=function(e,t){if(e!==u.UserActivityState.Active&&e!==u.UserActivityState.Inactive)throw new Error("setUserActivityState called with unsupported value ".concat(e));this.logger.info("setUserActivityState called with value ".concat(u.UserActivityState[e])),this.trouterServer&&this.state()!==u.TrouterState.Unknown?this.trouterServer.setUserActivityState(e,t):(this.pendingActivityState=[e,t],this.logger.warn("setUserActivityState called before start() or after stop()"))},e.prototype.setAudienceSubscriptions=function(e,t){if(e.audienceSubscriptions.length>1)throw new Error("Only singular audience subscription is supported");if(this.trouterServer&&this.state()!==u.TrouterState.Unknown)return this.trouterServer.setAudienceSubscriptionsAsync(e,15e3,t);throw new Error("audience subscribe called before start() or after stop()")},e.prototype.state=function(){return void 0!==this.trouterServer?this.trouterServer.getState():u.TrouterState.Unknown},e.prototype.isInTerminalState=function(){return void 0!==this.trouterServer&&this.trouterServer.isInTerminalState()},e.prototype.reportStateInfo=function(){return void 0===this.trouterServer?"":this.trouterServer.reportStateInfo()},e.prototype.getServerState=function(){if(void 0!==this.trouterServer)return this.trouterServer.getServerState()},e.prototype.getTrouterUrlAsync=function(){return void 0!==this.trouterServer?this.trouterUrlPromise.getPromise():Promise.reject(new Error("TrouterService has not been started"))},e.prototype.onStateChanged=function(e){if(this.logger.info("onStateChanged called"),void 0===e)this.stateChangedListeners=this.stateChangedListeners.filter(function(e){return void 0===e.wrappedCallback});else{this.offStateChanged(e);var t=function(t,n){e(t,n?n.url:"")};t.wrappedCallback=e,this.stateChangedListeners.push(t)}},e.prototype.offStateChanged=function(e){this.logger.info("offStateChanged called");var t=this.stateChangedListeners.length;return this.stateChangedListeners=this.stateChangedListeners.filter(function(t){return t.wrappedCallback!==e}),t>this.stateChangedListeners.length},e.prototype.addCallback=function(e){this.logger.info("addListener called"),-1===this.stateChangedListeners.indexOf(e,0)&&void 0!==e&&this.stateChangedListeners.push(e)},e.prototype.removeCallback=function(e){this.logger.info("removeListener called");var t=this.stateChangedListeners.indexOf(e,0);return t>-1&&(this.stateChangedListeners.splice(t,1),!0)},e.prototype.registerMessageHandler=function(e){this.logger.info("registerMessageHandler is called"),this.messageHandlers.register(e)},e.prototype.clearMessageHandlers=function(){this.logger.info("clearMessageHandlers is called"),this.messageHandlers.clear()},e.prototype.notifyStateChanged=function(e,t){var n=this;this.logger.info("notifyStateChanged called, will forward to ".concat(this.stateChangedListeners.length," listeners")),this.stateChangedListeners.forEach(function(r){try{r(e,t)}catch(e){n.logger.error("Error in callback ".concat(e))}})},e.prototype.tryMessageHandlers=function(e,t){if(!this.messageHandlers.active())return!1;var n,r=null;try{r=(n=JSON.parse(e.body))&&(n.evt||n.eventId)||null}catch(e){}var i={eventId:r,url:(this.connectionInfo?this.connectionInfo.baseEndpointUrl:"")+e.path,body:n,rawBody:e.body,headers:e.headers},o=this.messageHandlers.handleMessage(i);return!!o.isHandled&&(t.status=o.resultCode,o.responseHeaders&&(t.headers=o.responseHeaders),o.responseBody&&(t.body=o.responseBody),t.send(),!0)},e}();t.TrouterService=g,t.createTrouterService=function(e){return new g(e)},t.getTrouterServiceVersion=function(){return c.CLIENT_VERSION},t.replaceTrouterUrlBase=function(e,t){var n=e.indexOf("://");if(n>=0){var r=e.indexOf("/",n+3);if(r>=0)return t+e.substr(r)}return""}},function(e,t){e.exports=n}]))});u(h);var p=l(function(e,t){var n,r;Object.defineProperty(t,"__esModule",{value:!0}),t.PACKAGE_VERSION=t.CONFIG_API_VERSION=t.EudbCountries=t.CloudPrefix=t.CloudType=t.MAX_NUMBER_OF_TOKEN_FETCH_RETRIES=void 0,t.MAX_NUMBER_OF_TOKEN_FETCH_RETRIES=3,function(e){e.Public="Public",e.GccHigh="GCC High",e.Dod="DoD"}(n||(t.CloudType=n={})),function(e){e.OrgId="orgid",e.Acs="acs",e.Spool="spool",e.GccHigh="gcch",e.GccHighAcs="gcch-acs",e.Dod="dod",e.DodAcs="dod-acs"}(r||(t.CloudPrefix=r={})),t.EudbCountries=["europe","france","germany","norway","switzerland","sweden"],t.CONFIG_API_VERSION="2024-09-01",t.PACKAGE_VERSION="1.0.0-beta.29"});u(p),p.PACKAGE_VERSION,p.CONFIG_API_VERSION,p.EudbCountries,p.CloudPrefix,p.CloudType,p.MAX_NUMBER_OF_TOKEN_FETCH_RETRIES;var f=l(function(e,t){var n=c&&c.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.isEudbLocation=t.parseTokenCredential=t.base64decode=t.toTelemetrySender=t.toLogProvider=t.toMessageHandler=void 0,t.generateUuid=function(){return(0,i.v4)()};const r=new Map([["chatMessageReceived",200],["typingIndicatorReceived",245],["readReceiptReceived",246],["chatMessageEdited",247],["chatMessageDeleted",248],["chatThreadCreated",257],["chatThreadPropertiesUpdated",258],["chatThreadDeleted",259],["participantsAdded",260],["participantsRemoved",261]]);t.toMessageHandler=(e,t,n,i)=>{const o=r.get(e);return{handleMessage(r){let a=null;if((null==r?void 0:r.rawBody)&&(a=JSON.parse(r.rawBody)),null===a||a.eventId!==o)return;const c=s(e,a,n,i);return null!==c?(t(c),{isHandled:!0,resultCode:200}):void 0}}};const s=(e,t,n,r)=>{if("chatMessageReceived"===e){const e=t;return{threadId:e.groupId,sender:a(e.senderId),senderDisplayName:e.senderDisplayName,recipient:a(e.recipientMri),id:e.messageId,createdOn:new Date(e.originalArrivalTime),version:e.version,type:e.messageType,message:e.messageBody,metadata:u(e.acsChatMessageMetadata)||{},attachments:d(u(e.attachments)||[],n,r)}}if("chatMessageEdited"===e){const e=t;return{threadId:e.groupId,sender:a(e.senderId),senderDisplayName:e.senderDisplayName,recipient:a(e.recipientMri),id:e.messageId,createdOn:new Date(e.originalArrivalTime),version:e.version,message:e.messageBody,editedOn:new Date(e.edittime),type:e.messageType,metadata:u(e.acsChatMessageMetadata)||{},attachments:d(u(e.attachments)||[],n,r)}}if("chatMessageDeleted"===e){const e=t;return{threadId:e.groupId,sender:a(e.senderId),senderDisplayName:e.senderDisplayName,recipient:a(e.recipientMri),id:e.messageId,createdOn:new Date(e.originalArrivalTime),version:e.version,deletedOn:new Date(e.deletetime),type:e.messageType}}if("typingIndicatorReceived"===e){const e=t;return{threadId:e.groupId,sender:a(e.senderId),senderDisplayName:e.senderDisplayName,recipient:a(e.recipientMri),version:e.version,receivedOn:new Date(e.originalArrivalTime)}}if("readReceiptReceived"===e){const e=t,n=JSON.parse(e.messageBody).consumptionhorizon.split(";");return{threadId:e.groupId,sender:a(e.senderId),senderDisplayName:"",recipient:a(e.recipientMri),chatMessageId:e.messageId,readOn:new Date(+n[1])}}if("chatThreadCreated"===e){const e=t,n=JSON.parse(unescape(e.createdBy)),r=JSON.parse(unescape(e.members)),i=JSON.parse(unescape(e.properties)),o={id:a(n.participantId),displayName:n.displayName},s=r.map(e=>({id:a(e.participantId),displayName:e.displayName}));return{threadId:e.threadId,createdOn:new Date(e.createTime),createdBy:o,version:e.version,participants:s,properties:i}}if("chatThreadPropertiesUpdated"===e){const e=t,n=JSON.parse(unescape(e.editedBy)),r=JSON.parse(unescape(e.properties)),i={id:a(n.participantId),displayName:n.displayName};return{threadId:e.threadId,updatedOn:new Date(e.editTime),updatedBy:i,version:e.version,properties:r}}if("chatThreadDeleted"===e){const e=t,n=JSON.parse(unescape(e.deletedBy)),r={id:a(n.participantId),displayName:n.displayName};return{threadId:e.threadId,deletedOn:new Date(e.deleteTime),deletedBy:r,version:e.version}}if("participantsAdded"===e){const e=t,n=JSON.parse(unescape(e.addedBy)),r=JSON.parse(unescape(e.participantsAdded)),i={id:a(n.participantId),displayName:n.displayName},o=r.map(e=>({id:a(e.participantId),displayName:e.displayName,shareHistoryTime:new Date(e.shareHistoryTime)}));return{threadId:e.threadId,addedOn:new Date(e.time),addedBy:i,version:e.version,participantsAdded:o}}if("participantsRemoved"===e){const e=t,n=JSON.parse(unescape(e.removedBy)),r=JSON.parse(unescape(e.participantsRemoved)),i={id:a(n.participantId),displayName:n.displayName},o=r.map(e=>({id:a(e.participantId),displayName:e.displayName,shareHistoryTime:new Date(e.shareHistoryTime)}));return{threadId:e.threadId,removedOn:new Date(e.time),removedBy:i,version:e.version,participantsRemoved:o}}return null};t.toLogProvider=e=>({log:(...t)=>e.info(t),warn:(...t)=>e.warning(t),error:(...t)=>e.error(t),debug:(...t)=>e.verbose(t),info:(...t)=>e.verbose(t)}),t.toTelemetrySender=e=>({logEvent:t=>e.info(t)});const a=e=>e.startsWith("8:orgid:")?{kind:"microsoftTeamsUser",rawId:e,microsoftTeamsUserId:e.substring(8),isAnonymous:!1,cloud:"public"}:e.startsWith("8:dod:")?{kind:"microsoftTeamsUser",rawId:e,microsoftTeamsUserId:e.substring(6),isAnonymous:!1,cloud:"dod"}:e.startsWith("8:gcch:")?{kind:"microsoftTeamsUser",rawId:e,microsoftTeamsUserId:e.substring(7),isAnonymous:!1,cloud:"gcch"}:e.startsWith("8:teamsvisitor:")?{kind:"microsoftTeamsUser",rawId:e,microsoftTeamsUserId:e.substring(15),isAnonymous:!0}:e.startsWith("4:")?{kind:"phoneNumber",rawId:e,phoneNumber:e.substring(2)}:e.startsWith("8:acs:")||e.startsWith("8:gcch-acs:")||e.startsWith("8:dod-acs:")||e.startsWith("8:spool:")?{kind:"communicationUser",communicationUserId:e}:{kind:"unknown",id:e},u=e=>{if(null!=e&&""!==e&&"null"!==e&&"{}"!==e&&"[]"!==e)return JSON.parse(e)},l=(e,t,n)=>{let r;try{r=new URL(e),"http:"!==r.protocol&&"https:"!==r.protocol||(r=new URL(r.pathname,t))}catch(n){try{r=new URL(e,t)}catch(t){return e}}return r.searchParams.set("api-version",n),r.toString()},d=(e,t,n)=>null!=t&&""!==t&&(e=>{let t;try{t=new URL(e)}catch(e){return!1}return"http:"===t.protocol||"https:"===t.protocol})(t)?(e.filter(e=>e.attachmentType.toLowerCase()==="image".toLowerCase()).map(e=>{e.previewUrl&&(e.previewUrl=l(e.previewUrl,t,n)),e.url&&(e.url=l(e.url,t,n))}),e):e;t.base64decode=e=>o.isNodeLike?Buffer.from(e,"base64").toString():atob(e),t.parseTokenCredential=e=>n(void 0,void 0,void 0,function*(){const n=yield e.getToken(),r=null==n?void 0:n.token,i=(e=>{let[,n]=null==e?void 0:e.split(".");if(void 0===n)throw new Error("Invalid token");return n=n.replace(/-/g,"+").replace(/_/g,"/"),JSON.parse(decodeURIComponent(escape((0,t.base64decode)(n))))})(r),o=i.skypeid;return{jwtToken:r,acsResourceId:i.resourceId,identityMri:o,cloudType:function(e){switch(e.substring(0,e.indexOf(":"))){case p.CloudPrefix.OrgId:case p.CloudPrefix.Acs:case p.CloudPrefix.Spool:return p.CloudType.Public;case p.CloudPrefix.GccHigh:case p.CloudPrefix.GccHighAcs:return p.CloudType.GccHigh;case p.CloudPrefix.Dod:case p.CloudPrefix.DodAcs:return p.CloudType.Dod;default:return p.CloudType.Public}}(o),resourceLocation:i.resourceLocation||""}}),t.isEudbLocation=e=>!!e&&!!p.EudbCountries.find(t=>t===e)});u(f),f.isEudbLocation,f.parseTokenCredential,f.base64decode,f.toTelemetrySender,f.toLogProvider,f.toMessageHandler,f.generateUuid;var g=l(function(e,t){var n=c&&c.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),r=c&&c.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=c&&c.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&n(t,e,i);return r(t,e),t},o=c&&c.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.RealTimeNotificationConfiguration=t.TrouterConfigClient=void 0;const u=i(s);class l extends u.ServiceClient{constructor(e,t){t||(t={});const n=`azsdk-js-communication-signaling/${p.PACKAGE_VERSION}`,r=t.userAgentOptions&&t.userAgentOptions.userAgentPrefix?`${t.userAgentOptions.userAgentPrefix} ${n}`:`${n}`;super(Object.assign(Object.assign({},t),{userAgentOptions:{userAgentPrefix:r},additionalPolicies:t.additionalPolicies})),this.apiVersion=p.CONFIG_API_VERSION,this.endpoint=e,this.httpClient=(0,a.createDefaultHttpClient)()}fetchServiceUrls(e){return o(this,void 0,void 0,function*(){try{const t=(yield e.getToken()).token,n=(0,a.createPipelineRequest)({url:`${this.endpoint}/chat/config/realTimeNotifications?api-version=${this.apiVersion}`,method:"GET",headers:(0,a.createHttpHeaders)({Authorization:`Bearer ${t}`})}),r=yield this.pipeline.sendRequest(this.httpClient,n);if(200!==r.status||!r.bodyAsText)throw new Error(`Failed to fetch service URLs. Status: ${r.status}, Body: ${r.bodyAsText||"No response body"}`);const i=JSON.parse(r.bodyAsText);if(!i.trouterServiceUrl||!i.registrarServiceUrl||!i.cloudType)throw new Error("One or more required fields are missing in the response data");return new d(i.trouterServiceUrl,i.registrarServiceUrl,i.cloudType)}catch(e){throw new Error(`Error fetching real-time notification configuration from Chat Gateway: ${e.message}`)}})}}t.TrouterConfigClient=l;class d{constructor(e,t,n){this.trouterServiceUrl=e,this.registrarServiceUrl=t,this.cloudType=n}}t.RealTimeNotificationConfiguration=d});u(g),g.RealTimeNotificationConfiguration,g.TrouterConfigClient;var m=l(function(e,t){var n=c&&c.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.defaultTelemetrySettings=t.createSettings=void 0;const r={version:"1.0.0",registrationId:"",sessionId:"",pnhAppId:"AcsWeb",pnhTemplate:"AcsWeb_Chat_1.8",platform:"SPOOL",platformUIVersion:"0.0.0",environment:"",productName:"acs-chat-web",trouterServiceUrl:"",registrarServiceUrl:"",registrarRefreshTimeoutInMs:35e4,timeoutOptions:{connectionTimeoutMs:2e4,fetchTimeoutMs:1e4,pingTimeoutMs:4e4,pongTimeoutMs:5e3,maxBackoffMs:5e4,requestTimeoutMs:5e3},maxRegistrationTimeInMs:72e5};t.createSettings=(e,t)=>n(void 0,void 0,void 0,function*(){var n;const i=null==t?void 0:t.resourceEndpoint;if(void 0===i)throw new Error("'endpoint' cannot be null");const o=Object.assign({},r);o.registrationId=(0,f.generateUuid)(),o.sessionId=(0,f.generateUuid)();const s=new g.TrouterConfigClient(i,t),a=yield s.fetchServiceUrls(e);return o.trouterServiceUrl=`${a.trouterServiceUrl}/v4/a`,o.registrarServiceUrl=`${a.registrarServiceUrl}/v3/registrations`,"int"===a.cloudType&&(o.pnhAppId="cns-e2e-test",o.pnhTemplate="cns-e2e-test:1.8"),o.maxRegistrationTimeInMs=null!==(n=null==t?void 0:t.registrationTimeInMs)&&void 0!==n?n:r.maxRegistrationTimeInMs,o}),t.defaultTelemetrySettings={enabled:!1}});u(m),m.defaultTelemetrySettings,m.createSettings;var v=l(function(e,t){var n,r=c&&c.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.CommunicationSignalingClient=t.ConnectionState=void 0,function(e){e[e.Unknown=0]="Unknown",e[e.Connected=2]="Connected",e[e.Disconnected=3]="Disconnected",e[e.Switching=9]="Switching"}(n||(t.ConnectionState=n={})),t.CommunicationSignalingClient=class{constructor(e,t,n){this.credential=e,this.logger=t,this.options=n,this.stateChangedListener=null,this.tokenFetchRetries=0,this.trouter=(0,h.createTrouterService)((0,f.toLogProvider)(t))}start(){return r(this,void 0,void 0,function*(){var e,t;if(this.resourceEndpoint=null===(e=this.options)||void 0===e?void 0:e.resourceEndpoint,void 0===this.resourceEndpoint)throw new Error("'endpoint' cannot be null");this.gatewayApiVersion=(null===(t=this.options)||void 0===t?void 0:t.gatewayApiVersion)||"2024-03-07",void 0===this.config&&(this.config={trouterSettings:yield(0,m.createSettings)(this.credential,this.options),skypeTokenProvider:e=>r(this,void 0,void 0,function*(){if(e){if(this.tokenFetchRetries+=1,this.tokenFetchRetries>p.MAX_NUMBER_OF_TOKEN_FETCH_RETRIES)throw yield this.stop(!0),new Error(`Access token is expired and failed to fetch a valid one after ${p.MAX_NUMBER_OF_TOKEN_FETCH_RETRIES} retries`)}else this.tokenFetchRetries=0;return Promise.resolve((yield this.credential.getToken()).token)}),telemetryConfig:{eventLogger:(0,f.toTelemetrySender)(this.logger),settings:m.defaultTelemetrySettings}}),this.trouter.start(this.config),this.trouter.setUserActivityState(h.UserActivityState.Active)})}stop(e){return r(this,void 0,void 0,function*(){this.trouter.offStateChanged(this.stateChangedListener),this.trouter.clearMessageHandlers(),this.trouter.stop(null!=e?e:this.tokenFetchRetries>p.MAX_NUMBER_OF_TOKEN_FETCH_RETRIES)})}on(e,t){if("connectionChanged"===e)return this.trouter.offStateChanged(this.stateChangedListener),this.stateChangedListener=(e,n)=>t(e),void this.trouter.onStateChanged(this.stateChangedListener);this.trouter.registerMessageHandler((0,f.toMessageHandler)(e,t,this.resourceEndpoint,this.gatewayApiVersion))}}});u(v),v.CommunicationSignalingClient,v.ConnectionState;var y=u(l(function(e,t){var n=c&&c.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),r=c&&c.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),r(v,t)}));e.exports=y},860:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.getTelemetryEventData=function(e,t,n){return{Description:n.Description,ElapsedTimeInMilliseconds:n.ElapsedTimeInMilliseconds,EndpointUrl:n.EndpointUrl,EndpointId:n.EndpointId,ErrorCode:n.ErrorCode,Event:t,ExceptionDetails:n.ExceptionDetails,ShouldBubbleToHost:n.ShouldBubbleToHost,SubscriptionId:e.id}},e}();t.default=n},875:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2301),i=n(4938),o=n(7028),s="UserInfo.IdType",a=function(){function e(e,t){this._allowDeviceFields=e,this._properties=t}return e.prototype.setAppId=function(e){this._addContext("AppInfo.Id",e)},e.prototype.setAppVersion=function(e){this._addContext("AppInfo.Version",e)},e.prototype.setAppLanguage=function(e){this._addContext("AppInfo.Language",e)},e.prototype.setDeviceId=function(e){this._allowDeviceFields&&(r.default.checkAndSaveDeviceId(e),this._addContext("DeviceInfo.Id",e))},e.prototype.setDeviceOsName=function(e){this._allowDeviceFields&&this._addContext("DeviceInfo.OsName",e)},e.prototype.setDeviceOsVersion=function(e){this._allowDeviceFields&&this._addContext("DeviceInfo.OsVersion",e)},e.prototype.setDeviceBrowserName=function(e){this._allowDeviceFields&&this._addContext("DeviceInfo.BrowserName",e)},e.prototype.setDeviceBrowserVersion=function(e){this._allowDeviceFields&&this._addContext("DeviceInfo.BrowserVersion",e)},e.prototype.setDeviceMake=function(e){this._allowDeviceFields&&this._addContext("DeviceInfo.Make",e)},e.prototype.setDeviceModel=function(e){this._allowDeviceFields&&this._addContext("DeviceInfo.Model",e)},e.prototype.setUserId=function(e,t,n){if(!isNaN(n)&&null!==n&&n>=0&&n<=12)this._addContext(s,n.toString());else{var r=void 0;switch(t){case i.AWTPiiKind.SipAddress:r=o.AWTUserIdType.SipAddress;break;case i.AWTPiiKind.PhoneNumber:r=o.AWTUserIdType.PhoneNumber;break;case i.AWTPiiKind.SmtpAddress:r=o.AWTUserIdType.EmailAddress;break;default:r=o.AWTUserIdType.Unknown}this._addContext(s,r.toString())}if(isNaN(t)||null===t||t===i.AWTPiiKind.NotSet||t>13)switch(n){case o.AWTUserIdType.Skype:t=i.AWTPiiKind.Identity;break;case o.AWTUserIdType.EmailAddress:t=i.AWTPiiKind.SmtpAddress;break;case o.AWTUserIdType.PhoneNumber:t=i.AWTPiiKind.PhoneNumber;break;case o.AWTUserIdType.SipAddress:t=i.AWTPiiKind.SipAddress;break;default:t=i.AWTPiiKind.NotSet}this._addContextWithPii("UserInfo.Id",e,t)},e.prototype.setUserAdvertisingId=function(e){this._addContext("UserInfo.AdvertisingId",e)},e.prototype.setUserTimeZone=function(e){this._addContext("UserInfo.TimeZone",e)},e.prototype.setUserLanguage=function(e){this._addContext("UserInfo.Language",e)},e.prototype._addContext=function(e,t){"string"==typeof t&&this._properties.setProperty(e,t)},e.prototype._addContextWithPii=function(e,t,n){"string"==typeof t&&this._properties.setPropertyWithPii(e,t,n)},e}();t.default=a},884:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e._ConvertNumberToArray=function(e,t){if(!e)return t?this._doubleZero:this._floatZero;var n=t?52:23,r=(1<<(t?11:8)-1)-1,i=1-r,o=r,s=e<0?1:0;e=Math.abs(e);for(var a=Math.floor(e),c=e-a,u=2*(r+2)+n,l=new Array(u),d=0;d<u;)l[d++]=0;for(d=r+2;d&&a;)l[--d]=a%2,a=Math.floor(a/2);for(d=r+1;d<u-1&&c>0;)(c*=2)>=1?(l[++d]=1,--c):l[++d]=0;for(var h=0;h<u&&!l[h];)h++;var p=r+1-h,f=h+n;if(l[f+1]){for(d=f;d>h&&(l[d]=1-l[d],!l);--d);d===h&&++p}if(p>o||a)return s?t?this._doubleNegInifinity:this._floatNegInifinity:t?this._doubleInifinity:this._floatInifinity;if(p<i)return t?this._doubleZero:this._floatZero;if(t){var g=0;for(d=0;d<20;++d)g=g<<1|l[++h];for(var m=0;d<52;++d)m=m<<1|l[++h];return[255&m,m>>8&255,m>>16&255,m>>>24,255&(g=s<<31|2147483647&(g|=p+r<<20)),g>>8&255,g>>16&255,g>>>24]}var v=0;for(d=0;d<23;++d)v=v<<1|l[++h];return[255&(v=s<<31|2147483647&(v|=p+r<<23)),v>>8&255,v>>16&255,v>>>24]},e._floatZero=[0,0,0,0],e._doubleZero=[0,0,0,0,0,0,0,0],e._floatInifinity=[0,0,128,127],e._floatNegInifinity=[0,0,128,255],e._doubleInifinity=[0,0,0,0,0,0,240,127],e._doubleNegInifinity=[0,0,0,0,0,0,240,255],e}();t.FloatUtils=n},887:(e,t,n)=>{var r=n(6993),i=n(1791);e.exports=function(e,t,n,o,s){return new i(r().w(e,t,n,o),s||Promise)},e.exports.__esModule=!0,e.exports.default=e.exports},983:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(2246),s=n(3480),a=function(){function e(e){this.hostType=o.default.Page,this.id=(0,s.uuidv4)(),this.protocolType=e,this.newConversationMessageListeners={},this.threadUpdateListeners={},this.debug=!1}return e.prototype.setDebug=function(e){this.debug=e},e.prototype.joinConversation=function(e,t){var n=this;return this.onJoinConversation(e,t).then(function(e){return{disconnect:n.disconnectFromConversation.bind(n,e),downloadFile:n.downloadFile.bind(n,e),getFileStatus:n.getFileStatus.bind(n,e),getMembers:n.getMembers.bind(n,e),getMessages:n.getMessages.bind(n,e),id:e.id,indicateTypingStatus:n.indicateTypingStatus.bind(n,e),registerOnNewMessage:n.registerOnNewMessage.bind(n,e),registerOnThreadUpdate:n.registerOnThreadUpdate.bind(n,e),sendFileMessage:n.sendFileMessage.bind(n,e),sendMessage:n.sendMessage.bind(n,e),sendMessageToBot:n.sendMessageToBot.bind(n,e),uploadFile:n.uploadFile.bind(n,e),sendFileData:n.sendFileData.bind(n,e)}})},e.prototype.registerOnNewMessage=function(e,t){return r(this,void 0,void 0,function(){return i(this,function(e){return[2,Promise.resolve()]})})},e.prototype.registerOnThreadUpdate=function(e,t){return r(this,void 0,void 0,function(){return i(this,function(e){return[2,Promise.resolve()]})})},e.prototype.uploadFile=function(e,t,n){return Promise.resolve()},e.prototype.downloadFile=function(e,t){return this.debug&&console.debug("IC3Core/ClientBridge/downloadFile"),this.downloadFileData(e,t).then(function(e){var t=e;if(t&&t.size)return t;var n=new Blob([new Uint8Array(e)]);return!n||0===n.size&&""===n.type?e:n})},e}();t.default=a},1039:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.LoadIframeState=void 0;var s,a=n(1317),c=n(6824),u=n(3712),l=n(8171),d=n(1770),h=n(3316),p=n(9714),f=n(1243),g=n(6654);!function(e){e[e.Loading=0]="Loading",e[e.Loaded=1]="Loaded",e[e.Failed=2]="Failed",e[e.NotLoaded=3]="NotLoaded"}(s=t.LoadIframeState||(t.LoadIframeState={}));var m=a.sdkVersion,v=function(){function e(e,t){void 0===e&&(e=void 0),void 0===t&&(t=void 0),this.runtimeId=g.uuidv4(),this.baseUrl=a.baseUrl,this.clientId=g.uuidv4(),this.origin=window.location.origin,this.requestCallbacks={},this.debug=!1,this.loadIframeState=s.NotLoaded,this.logger=e,this.iframeId="Microsoft_Omnichannel_AMSClient_Iframe_Window",this.logger&&(this.scenarioMarker=new f.default(this.logger)),t&&t.baseUrl&&(this.baseUrl=t.baseUrl),t&&t.multiClient&&(this.iframeId=this.clientId)}return e.prototype.setDebug=function(e){this.debug=e},e.prototype.setup=function(){var e,t,n;return i(this,void 0,void 0,function(){var r,i=this;return o(this,function(o){switch(o.label){case 0:if(null===(e=this.scenarioMarker)||void 0===e||e.startScenario(c.default.Setup,{AMSClientRuntimeId:this.runtimeId}),this.debug&&console.log("[FramedClient][setup]"),this.debug&&console.time("ams:setup"),this.onMessageEvent(function(e){return i.handleEvent(e)}),!p.default.isBrowser())throw new Error("FramedMode was used in non-Web platform");return this.loadIframeState!==s.NotLoaded?[3,2]:[4,this.loadIframe()];case 1:o.sent(),o.label=2;case 2:return null===(t=this.scenarioMarker)||void 0===t||t.completeScenario(c.default.Setup,{AMSClientRuntimeId:this.runtimeId}),this.debug&&console.timeEnd("ams:setup"),this.loadIframeState===s.Failed&&(!u.default.silentError&&console.error("iframe not loaded"),r={Reason:"LoadIframeFailed",Message:"iframe not loaded"},null===(n=this.scenarioMarker)||void 0===n||n.failScenario(c.default.Setup,{AMSClientRuntimeId:this.runtimeId,ExceptionDetails:JSON.stringify(r)})),[2]}})})},e.prototype.initialize=function(e){var t,n,r,s;return i(this,void 0,void 0,function(){return o(this,function(i){return this.chatToken=e.chatToken,null===(t=this.scenarioMarker)||void 0===t||t.startScenario(c.default.Initialize,{AMSClientRuntimeId:this.runtimeId,ChatId:null===(n=this.chatToken)||void 0===n?void 0:n.chatId}),this.debug&&console.log("[FramedClient][initialize]"),this.debug&&console.time("ams:initialize"),this.skypeTokenAuth(),this.debug&&console.timeEnd("ams:initialize"),null===(r=this.scenarioMarker)||void 0===r||r.completeScenario(c.default.Initialize,{AMSClientRuntimeId:this.runtimeId,ChatId:null===(s=this.chatToken)||void 0===s?void 0:s.chatId}),[2]})})},e.prototype.skypeTokenAuth=function(e){return void 0===e&&(e=null),i(this,void 0,void 0,function(){var t,n=this;return o(this,function(r){switch(r.label){case 0:return this.debug&&console.log("[FramedClient][skypeAuth]"),this.debug&&console.time("ams:skypeTokenAuth"),t={chatToken:e||this.chatToken},this.loadIframeState!==s.NotLoaded?[3,2]:[4,this.loadIframe()];case 1:r.sent(),r.label=2;case 2:return this.debug&&console.timeEnd("ams:skypeTokenAuth"),[2,new Promise(function(e,r){n.postMessage(h.default.Request,l.default.SkypeTokenAuth,t,e,r)})]}})})},e.prototype.createObject=function(e,t,n,r){return void 0===n&&(n=null),void 0===r&&(r=[]),i(this,void 0,void 0,function(){var i,a=this;return o(this,function(o){switch(o.label){case 0:return this.debug&&console.log("[FramedClient][createObject]"),this.debug&&console.time("ams:createObject"),i={id:e,file:t,chatToken:n||this.chatToken,supportedImagesMimeTypes:r},this.loadIframeState!==s.NotLoaded?[3,2]:[4,this.loadIframe()];case 1:o.sent(),o.label=2;case 2:return this.debug&&console.timeEnd("ams:createObject"),[2,new Promise(function(e,t){a.postMessage(h.default.Request,l.default.CreateObject,i,e,t)})]}})})},e.prototype.uploadDocument=function(e,t,n,r){return void 0===n&&(n=null),void 0===r&&(r=[]),i(this,void 0,void 0,function(){var i,a=this;return o(this,function(o){switch(o.label){case 0:return this.debug&&console.log("[FramedClient][uploadDocument]"),this.debug&&console.time("ams:uploadDocument"),i={documentId:e,file:t,chatToken:n||this.chatToken,supportedImagesMimeTypes:r},this.loadIframeState!==s.NotLoaded?[3,2]:[4,this.loadIframe()];case 1:o.sent(),o.label=2;case 2:return this.debug&&console.timeEnd("ams:uploadDocument"),[2,new Promise(function(e,t){a.postMessage(h.default.Request,l.default.UploadDocument,i,e,t)})]}})})},e.prototype.getViewStatus=function(e,t,n){return void 0===t&&(t=null),void 0===n&&(n=[]),i(this,void 0,void 0,function(){var r,i=this;return o(this,function(o){switch(o.label){case 0:return this.debug&&console.log("[FramedClient][getViewStatus]"),this.debug&&console.time("ams:getViewStatus"),r={fileMetadata:e,chatToken:t||this.chatToken,supportedImagesMimeTypes:n},this.loadIframeState!==s.NotLoaded?[3,2]:[4,this.loadIframe()];case 1:o.sent(),o.label=2;case 2:return this.debug&&console.timeEnd("ams:getViewStatus"),[2,new Promise(function(e,t){i.postMessage(h.default.Request,l.default.GetViewStatus,r,e,t)})]}})})},e.prototype.getView=function(e,t,n,r){return void 0===n&&(n=null),void 0===r&&(r=[]),i(this,void 0,void 0,function(){var i,a=this;return o(this,function(o){switch(o.label){case 0:return this.debug&&console.log("[FramedClient][getView]"),this.debug&&console.time("ams:getView"),i={fileMetadata:e,viewLocation:t,chatToken:n||this.chatToken,supportedImagesMimeTypes:r},this.loadIframeState!==s.NotLoaded?[3,2]:[4,this.loadIframe()];case 1:o.sent(),o.label=2;case 2:return this.debug&&console.timeEnd("ams:getView"),[2,new Promise(function(e,t){a.postMessage(h.default.Request,l.default.GetView,i,e,t)})]}})})},e.prototype.fetchBlob=function(e){return i(this,void 0,void 0,function(){var t;return o(this,function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),[4,fetch(e)];case 1:return[4,n.sent().blob()];case 2:return[2,n.sent()];case 3:throw t=n.sent(),!u.default.silentError&&console.log(t),new Error("fetchBlob");case 4:return[2]}})})},e.prototype.onMessageEvent=function(e){window.addEventListener("message",e,!0)},e.prototype.postMessage=function(e,t,n,i,o){void 0===n&&(n={}),void 0===i&&(i=function(e){return{}}),void 0===o&&(o=function(e){return{}});var s=g.uuidv4();this.requestCallbacks[s]={resolve:i,reject:o},this.targetWindow?this.targetWindow.postMessage(r({runtimeId:this.runtimeId,clientId:this.clientId,requestId:s,eventType:e,eventName:t},n),this.baseUrl):!u.default.silentError&&console.error("Target window not found!")},e.prototype.handleEvent=function(e){var t;return i(this,void 0,void 0,function(){var n;return o(this,function(r){return e.origin===this.origin||this.baseUrl.includes(e.origin)?(e.data.clientId!==this.clientId||(this.debug&&console.log(e),e.source&&(this.targetWindow=e.source),e.data.eventType===h.default.Response&&(this.debug&&console.log("[FramedClient][Response]"),n=e.data,e.data.eventName===l.default.SkypeTokenAuth?n.requestId in this.requestCallbacks&&(this.requestCallbacks[n.requestId].resolve(),delete this.requestCallbacks[n.requestId]):e.data.eventName===l.default.CreateObject||e.data.eventName===l.default.UploadDocument?n.eventStatus===d.default.Success?n.requestId in this.requestCallbacks&&(this.requestCallbacks[n.requestId].resolve(n.response),delete this.requestCallbacks[n.requestId]):n.requestId in this.requestCallbacks&&(this.requestCallbacks[n.requestId].reject(),delete this.requestCallbacks[n.requestId]):e.data.eventName===l.default.GetViewStatus||e.data.eventName===l.default.GetView?n.requestId in this.requestCallbacks&&(this.requestCallbacks[n.requestId].resolve(n.response),delete this.requestCallbacks[n.requestId]):e.data.eventName===l.default.SendTelemetry&&(null===(t=this.logger)||void 0===t||t.log(n.logLevel,n.logData.Event,n.logData)))),[2]):[2]})})},e.prototype.dispose=function(){var e;null===(e=document.getElementById(this.iframeId))||void 0===e||e.remove(),this.requestCallbacks={},this.loadIframeState=s.NotLoaded},e.prototype.loadIframe=function(){return i(this,void 0,void 0,function(){var e=this;return o(this,function(t){return[2,new Promise(function(t,n){var r,i,o;if(null===(r=e.scenarioMarker)||void 0===r||r.startScenario(c.default.LoadIframe,{AMSClientRuntimeId:e.runtimeId}),e.debug&&console.log("[FramedClient][loadIframe]"),e.debug&&console.time("ams:loadIframe"),e.loadIframeState===s.Loading||e.loadIframeState===s.Loaded)return null===(i=e.scenarioMarker)||void 0===i||i.completeScenario(c.default.LoadIframe,{AMSClientRuntimeId:e.runtimeId}),void t();if(document.getElementById(e.iframeId))return e.loadIframeState=s.Loaded,null===(o=e.scenarioMarker)||void 0===o||o.completeScenario(c.default.LoadIframe,{AMSClientRuntimeId:e.runtimeId}),void t();var a=document.createElement("iframe");a.id=e.iframeId,a.src=e.baseUrl+"/"+m+"/iframe.html?clientId="+e.clientId+"&debug="+e.debug+"&telemetry=true",e.loadIframeState=s.Loading,a.addEventListener("load",function(){var n;e.debug&&console.log("iframe loaded!"),e.loadIframeState=s.Loaded,null===(n=e.scenarioMarker)||void 0===n||n.completeScenario(c.default.LoadIframe,{AMSClientRuntimeId:e.runtimeId}),t()}),a.addEventListener("error",function(){var t;e.loadIframeState=s.Failed,null===(t=e.scenarioMarker)||void 0===t||t.failScenario(c.default.LoadIframe,{AMSClientRuntimeId:e.runtimeId}),n()}),document.head.append(a),e.debug&&console.timeEnd("ams:loadIframe")})]})})},e}();t.default=v},1052:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.Text="Text",e.RichText="RichText",e.RichTextHtml="RichText/Html",e.ControlTyping="Control/Typing",e.ControlClearTyping="Control/ClearTyping",e.LiveState="Control/LiveState",e}();t.default=n},1111:e=>{"use strict";const t=new Set(["ENOTFOUND","ENETUNREACH","UNABLE_TO_GET_ISSUER_CERT","UNABLE_TO_GET_CRL","UNABLE_TO_DECRYPT_CERT_SIGNATURE","UNABLE_TO_DECRYPT_CRL_SIGNATURE","UNABLE_TO_DECODE_ISSUER_PUBLIC_KEY","CERT_SIGNATURE_FAILURE","CRL_SIGNATURE_FAILURE","CERT_NOT_YET_VALID","CERT_HAS_EXPIRED","CRL_NOT_YET_VALID","CRL_HAS_EXPIRED","ERROR_IN_CERT_NOT_BEFORE_FIELD","ERROR_IN_CERT_NOT_AFTER_FIELD","ERROR_IN_CRL_LAST_UPDATE_FIELD","ERROR_IN_CRL_NEXT_UPDATE_FIELD","OUT_OF_MEM","DEPTH_ZERO_SELF_SIGNED_CERT","SELF_SIGNED_CERT_IN_CHAIN","UNABLE_TO_GET_ISSUER_CERT_LOCALLY","UNABLE_TO_VERIFY_LEAF_SIGNATURE","CERT_CHAIN_TOO_LONG","CERT_REVOKED","INVALID_CA","PATH_LENGTH_EXCEEDED","INVALID_PURPOSE","CERT_UNTRUSTED","CERT_REJECTED","HOSTNAME_MISMATCH"]);e.exports=e=>!t.has(e&&e.code)},1132:(e,t,n)=>{var r=n(5901),i=n(9291),o=n(7122),s=n(1869);e.exports=function(e){return r(e)||i(e)||o(e)||s()},e.exports.__esModule=!0,e.exports.default=e.exports},1136:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.ConversationProperties="/v1/users/ME/conversations/ALL/properties",e.ConversationMessages="/v1/users/ME/conversations/ALL/messages",e.Threads="/v1/threads/ALL",e.Contacts="/v1/users/ME/contacts/ALL",e}();t.default=n},1219:(e,t,n)=>{"use strict";function r(e){let t="";for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return btoa(t)}function i(e){const t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}n.r(t),n.d(t,{MapperTypeNames:()=>S,ServiceClient:()=>j,XML_ATTRKEY:()=>o,XML_CHARKEY:()=>s,authorizeRequestOnClaimChallenge:()=>F,authorizeRequestOnTenantChallenge:()=>G,createClientPipeline:()=>N,createSerializer:()=>d,deserializationPolicy:()=>_,deserializationPolicyName:()=>k,serializationPolicy:()=>D,serializationPolicyName:()=>M});const o="$",s="_",a=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/,c=/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/i;function u(e,t){const n=e.parsedHeaders;if("HEAD"===e.request.method)return{...n,body:e.parsedBody};const r=t&&t.bodyMapper,i=Boolean(r?.nullable),o=r?.type.name;if("Stream"===o)return{...n,blobBody:e.blobBody,readableStreamBody:e.readableStreamBody};const s="Composite"===o&&r.type.modelProperties||{},a=Object.keys(s).some(e=>""===s[e].serializedName);if("Sequence"===o||a){const t=e.parsedBody??[];for(const n of Object.keys(s))s[n].serializedName&&(t[n]=e.parsedBody?.[n]);if(n)for(const e of Object.keys(n))t[e]=n[e];return!i||e.parsedBody||n||0!==Object.getOwnPropertyNames(s).length?t:null}return function(e){const t={...e.headers,...e.body};return e.hasNullableType&&0===Object.getOwnPropertyNames(t).length?e.shouldWrapBody?{body:null}:null:e.shouldWrapBody?{...e.headers,body:e.body}:t}({body:e.parsedBody,headers:n,hasNullableType:i,shouldWrapBody:(c=e.parsedBody,u=o,"Composite"!==u&&"Dictionary"!==u&&("string"==typeof c||"number"==typeof c||"boolean"==typeof c||null!==u?.match(/^(Date|DateTime|DateTimeRfc1123|UnixTime|ByteArray|Base64Url)$/i)||null==c))});var c,u}class l{modelMappers;isXML;constructor(e={},t=!1){this.modelMappers=e,this.isXML=t}validateConstraints(e,t,n){const r=(e,r)=>{throw new Error(`"${n}" with value "${t}" should satisfy the constraint "${e}": ${r}.`)};if(e.constraints&&null!=t){const{ExclusiveMaximum:n,ExclusiveMinimum:i,InclusiveMaximum:o,InclusiveMinimum:s,MaxItems:a,MaxLength:c,MinItems:u,MinLength:l,MultipleOf:d,Pattern:h,UniqueItems:p}=e.constraints;if(void 0!==n&&t>=n&&r("ExclusiveMaximum",n),void 0!==i&&t<=i&&r("ExclusiveMinimum",i),void 0!==o&&t>o&&r("InclusiveMaximum",o),void 0!==s&&t<s&&r("InclusiveMinimum",s),void 0!==a&&t.length>a&&r("MaxItems",a),void 0!==c&&t.length>c&&r("MaxLength",c),void 0!==u&&t.length<u&&r("MinItems",u),void 0!==l&&t.length<l&&r("MinLength",l),void 0!==d&&t%d!==0&&r("MultipleOf",d),h){const e="string"==typeof h?new RegExp(h):h;"string"==typeof t&&null!==t.match(e)||r("Pattern",h)}p&&t.some((e,t,n)=>n.indexOf(e)!==t)&&r("UniqueItems",p)}}serialize(e,t,n,i={xml:{}}){const u={xml:{rootName:i.xml.rootName??"",includeRoot:i.xml.includeRoot??!1,xmlCharKey:i.xml.xmlCharKey??s}};let l={};const d=e.type.name;n||(n=e.serializedName),null!==d.match(/^Sequence$/i)&&(l=[]),e.isConstant&&(t=e.defaultValue);const{required:m,nullable:C}=e;if(m&&C&&void 0===t)throw new Error(`${n} cannot be undefined.`);if(m&&!C&&null==t)throw new Error(`${n} cannot be null or undefined.`);if(!m&&!1===C&&null===t)throw new Error(`${n} cannot be null.`);return null==t||null!==d.match(/^any$/i)?l=t:null!==d.match(/^(Number|String|Boolean|Object|Stream|Uuid)$/i)?l=function(e,t,n){if(null!=n)if(null!==e.match(/^Number$/i)){if("number"!=typeof n)throw new Error(`${t} with value ${n} must be of type number.`)}else if(null!==e.match(/^String$/i)){if("string"!=typeof n.valueOf())throw new Error(`${t} with value "${n}" must be of type string.`)}else if(null!==e.match(/^Uuid$/i)){if("string"!=typeof n.valueOf()||(r=n,!c.test(r)))throw new Error(`${t} with value "${n}" must be of type string and a valid uuid.`)}else if(null!==e.match(/^Boolean$/i)){if("boolean"!=typeof n)throw new Error(`${t} with value ${n} must be of type boolean.`)}else if(null!==e.match(/^Stream$/i)){const e=typeof n;if(!("string"===e||"function"==typeof n.pipe||"function"==typeof n.tee||n instanceof ArrayBuffer||ArrayBuffer.isView(n)||("function"==typeof Blob||"object"==typeof Blob)&&n instanceof Blob||"function"===e))throw new Error(`${t} must be a string, Blob, ArrayBuffer, ArrayBufferView, ReadableStream, or () => ReadableStream.`)}var r;return n}(d,n,t):null!==d.match(/^Enum$/i)?l=function(e,t,n){if(!t)throw new Error(`Please provide a set of allowedValues to validate ${e} as an Enum Type.`);if(!t.some(e=>"string"==typeof e.valueOf()?e.toLowerCase()===n.toLowerCase():e===n))throw new Error(`${n} is not a valid value for ${e}. The valid values are: ${JSON.stringify(t)}.`);return n}(n,e.type.allowedValues,t):null!==d.match(/^(Date|DateTime|TimeSpan|DateTimeRfc1123|UnixTime)$/i)?l=function(e,t,n){if(null!=t)if(null!==e.match(/^Date$/i)){if(!(t instanceof Date||"string"==typeof t.valueOf()&&!isNaN(Date.parse(t))))throw new Error(`${n} must be an instanceof Date or a string in ISO8601 format.`);t=t instanceof Date?t.toISOString().substring(0,10):new Date(t).toISOString().substring(0,10)}else if(null!==e.match(/^DateTime$/i)){if(!(t instanceof Date||"string"==typeof t.valueOf()&&!isNaN(Date.parse(t))))throw new Error(`${n} must be an instanceof Date or a string in ISO8601 format.`);t=t instanceof Date?t.toISOString():new Date(t).toISOString()}else if(null!==e.match(/^DateTimeRfc1123$/i)){if(!(t instanceof Date||"string"==typeof t.valueOf()&&!isNaN(Date.parse(t))))throw new Error(`${n} must be an instanceof Date or a string in RFC-1123 format.`);t=t instanceof Date?t.toUTCString():new Date(t).toUTCString()}else if(null!==e.match(/^UnixTime$/i)){if(!(t instanceof Date||"string"==typeof t.valueOf()&&!isNaN(Date.parse(t))))throw new Error(`${n} must be an instanceof Date or a string in RFC-1123/ISO8601 format for it to be serialized in UnixTime/Epoch format.`);t=function(e){if(e)return"string"==typeof e.valueOf()&&(e=new Date(e)),Math.floor(e.getTime()/1e3)}(t)}else if(null!==e.match(/^TimeSpan$/i)&&!function(e){return a.test(e)}(t))throw new Error(`${n} must be a string in ISO 8601 format. Instead was "${t}".`);return t}(d,t,n):null!==d.match(/^ByteArray$/i)?l=function(e,t){if(null!=t){if(!(t instanceof Uint8Array))throw new Error(`${e} must be of type Uint8Array.`);t=r(t)}return t}(n,t):null!==d.match(/^Base64Url$/i)?l=function(e,t){if(null!=t){if(!(t instanceof Uint8Array))throw new Error(`${e} must be of type Uint8Array.`);t=function(e){if(e){if(!(e instanceof Uint8Array))throw new Error("Please provide an input of type Uint8Array for converting to Base64Url.");return function(e){let t=e.length;for(;t-1>=0&&"="===e[t-1];)--t;return e.substr(0,t)}(r(e)).replace(/\+/g,"-").replace(/\//g,"_")}}(t)}return t}(n,t):null!==d.match(/^Sequence$/i)?l=function(e,t,n,r,i,s){if(!Array.isArray(n))throw new Error(`${r} must be of type Array.`);let a=t.type.element;if(!a||"object"!=typeof a)throw new Error(`element" metadata for an Array must be defined in the mapper and it must of type "object" in ${r}.`);"Composite"===a.type.name&&a.type.className&&(a=e.modelMappers[a.type.className]??a);const c=[];for(let t=0;t<n.length;t++){const u=e.serialize(a,n[t],r,s);if(i&&a.xmlNamespace){const e=a.xmlNamespacePrefix?`xmlns:${a.xmlNamespacePrefix}`:"xmlns";"Composite"===a.type.name?(c[t]={...u},c[t][o]={[e]:a.xmlNamespace}):(c[t]={},c[t][s.xml.xmlCharKey]=u,c[t][o]={[e]:a.xmlNamespace})}else c[t]=u}return c}(this,e,t,n,Boolean(this.isXML),u):null!==d.match(/^Dictionary$/i)?l=function(e,t,n,r,i,s){if("object"!=typeof n)throw new Error(`${r} must be of type object.`);const a=t.type.value;if(!a||"object"!=typeof a)throw new Error(`"value" metadata for a Dictionary must be defined in the mapper and it must of type "object" in ${r}.`);const c={};for(const t of Object.keys(n)){const o=e.serialize(a,n[t],r,s);c[t]=g(a,o,i,s)}if(i&&t.xmlNamespace){const e=t.xmlNamespacePrefix?`xmlns:${t.xmlNamespacePrefix}`:"xmlns",n=c;return n[o]={[e]:t.xmlNamespace},n}return c}(this,e,t,n,Boolean(this.isXML),u):null!==d.match(/^Composite$/i)&&(l=function(e,t,n,r,i,s){if(y(e,t)&&(t=v(e,t,n,"clientName")),null!=n){const a={},c=f(e,t,r);for(const u of Object.keys(c)){const l=c[u];if(l.readOnly)continue;let d,p=a;if(e.isXML)d=l.xmlIsWrapped?l.xmlName:l.xmlElementName||l.xmlName;else{const e=h(l.serializedName);d=e.pop();for(const t of e){null==p[t]&&(void 0!==n[u]&&null!==n[u]||void 0!==l.defaultValue)&&(p[t]={}),p=p[t]}}if(null!=p){if(i&&t.xmlNamespace){const e=t.xmlNamespacePrefix?`xmlns:${t.xmlNamespacePrefix}`:"xmlns";p[o]={...p[o],[e]:t.xmlNamespace}}const a=""!==l.serializedName?r+"."+l.serializedName:r;let c=n[u];const h=y(e,t);h&&h.clientName===u&&null==c&&(c=t.serializedName);const f=e.serialize(l,c,a,s);if(void 0!==f&&null!=d){const e=g(l,f,i,s);i&&l.xmlIsAttribute?(p[o]=p[o]||{},p[o][d]=f):i&&l.xmlIsWrapped?p[d]={[l.xmlElementName]:e}:p[d]=e}}}const u=function(e,t,n){const r=t.type.additionalProperties;if(!r&&t.type.className){const r=p(e,t,n);return r?.type.additionalProperties}return r}(e,t,r);if(u){const t=Object.keys(c);for(const i in n)t.every(e=>e!==i)&&(a[i]=e.serialize(u,n[i],r+'["'+i+'"]',s))}return a}return n}(this,e,t,n,Boolean(this.isXML),u)),l}deserialize(e,t,n,r={xml:{}}){const a={xml:{rootName:r.xml.rootName??"",includeRoot:r.xml.includeRoot??!1,xmlCharKey:r.xml.xmlCharKey??s},ignoreUnknownProperties:r.ignoreUnknownProperties??!1};if(null==t)return this.isXML&&"Sequence"===e.type.name&&!e.xmlIsWrapped&&(t=[]),void 0!==e.defaultValue&&(t=e.defaultValue),t;let c;const u=e.type.name;if(n||(n=e.serializedName),null!==u.match(/^Composite$/i))c=function(e,t,n,r,i){const a=i.xml.xmlCharKey??s;y(e,t)&&(t=v(e,t,n,"serializedName"));const c=f(e,t,r);let u={};const l=[];for(const s of Object.keys(c)){const d=c[s],p=h(c[s].serializedName);l.push(p[0]);const{serializedName:f,xmlName:g,xmlElementName:m}=d;let v=r;""!==f&&void 0!==f&&(v=r+"."+f);const y=d.headerCollectionPrefix;if(y){const t={};for(const r of Object.keys(n))r.startsWith(y)&&(t[r.substring(y.length)]=e.deserialize(d.type.value,n[r],v,i)),l.push(r);u[s]=t}else if(e.isXML)if(d.xmlIsAttribute&&n[o])u[s]=e.deserialize(d,n[o][g],v,i);else if(d.xmlIsMsText)void 0!==n[a]?u[s]=n[a]:"string"==typeof n&&(u[s]=n);else{const t=m||g||f;if(d.xmlIsWrapped){const t=n[g],r=t?.[m]??[];u[s]=e.deserialize(d,r,v,i),l.push(g)}else{const r=n[t];u[s]=e.deserialize(d,r,v,i),l.push(t)}}else{let r,o=n,a=0;for(const e of p){if(!o)break;a++,o=o[e]}null===o&&a<p.length&&(o=void 0),r=o;const l=t.type.polymorphicDiscriminator;let h;if(l&&s===l.clientName&&null==r&&(r=t.serializedName),Array.isArray(n[s])&&""===c[s].serializedName){r=n[s];const t=e.deserialize(d,r,v,i);for(const[e,n]of Object.entries(u))Object.prototype.hasOwnProperty.call(t,e)||(t[e]=n);u=t}else void 0===r&&void 0===d.defaultValue||(h=e.deserialize(d,r,v,i),u[s]=h)}}const d=t.type.additionalProperties;if(d){const t=e=>{for(const t in c)if(h(c[t].serializedName)[0]===e)return!1;return!0};for(const o in n)t(o)&&(u[o]=e.deserialize(d,n[o],r+'["'+o+'"]',i))}else if(n&&!i.ignoreUnknownProperties)for(const e of Object.keys(n))void 0!==u[e]||l.includes(e)||m(e,i)||(u[e]=n[e]);return u}(this,e,t,n,a);else{if(this.isXML){const e=a.xml.xmlCharKey;void 0!==t[o]&&void 0!==t[e]&&(t=t[e])}null!==u.match(/^Number$/i)?(c=parseFloat(t),isNaN(c)&&(c=t)):null!==u.match(/^Boolean$/i)?c="true"===t||"false"!==t&&t:null!==u.match(/^(String|Enum|Object|Stream|Uuid|TimeSpan|any)$/i)?c=t:null!==u.match(/^(Date|DateTime|DateTimeRfc1123)$/i)?c=new Date(t):null!==u.match(/^UnixTime$/i)?c=function(e){if(e)return new Date(1e3*e)}(t):null!==u.match(/^ByteArray$/i)?c=i(t):null!==u.match(/^Base64Url$/i)?c=function(e){if(e){if(e&&"string"!=typeof e.valueOf())throw new Error("Please provide an input of type string for converting to Uint8Array");return i(e=e.replace(/-/g,"+").replace(/_/g,"/"))}}(t):null!==u.match(/^Sequence$/i)?c=function(e,t,n,r,i){let o=t.type.element;if(!o||"object"!=typeof o)throw new Error(`element" metadata for an Array must be defined in the mapper and it must of type "object" in ${r}`);if(n){Array.isArray(n)||(n=[n]),"Composite"===o.type.name&&o.type.className&&(o=e.modelMappers[o.type.className]??o);const t=[];for(let s=0;s<n.length;s++)t[s]=e.deserialize(o,n[s],`${r}[${s}]`,i);return t}return n}(this,e,t,n,a):null!==u.match(/^Dictionary$/i)&&(c=function(e,t,n,r,i){const o=t.type.value;if(!o||"object"!=typeof o)throw new Error(`"value" metadata for a Dictionary must be defined in the mapper and it must of type "object" in ${r}`);if(n){const t={};for(const s of Object.keys(n))t[s]=e.deserialize(o,n[s],r,i);return t}return n}(this,e,t,n,a))}return e.isConstant&&(c=e.defaultValue),c}}function d(e={},t=!1){return new l(e,t)}function h(e){const t=[];let n="";if(e){const r=e.split(".");for(const e of r)"\\"===e.charAt(e.length-1)?n+=e.substr(0,e.length-1)+".":(n+=e,t.push(n),n="")}return t}function p(e,t,n){const r=t.type.className;if(!r)throw new Error(`Class name for model "${n}" is not provided in the mapper "${JSON.stringify(t,void 0,2)}".`);return e.modelMappers[r]}function f(e,t,n){let r=t.type.modelProperties;if(!r){const i=p(e,t,n);if(!i)throw new Error(`mapper() cannot be null or undefined for model "${t.type.className}".`);if(r=i?.type.modelProperties,!r)throw new Error(`modelProperties cannot be null or undefined in the mapper "${JSON.stringify(i)}" of type "${t.type.className}" for object "${n}".`)}return r}function g(e,t,n,r){if(!n||!e.xmlNamespace)return t;const i=e.xmlNamespacePrefix?`xmlns:${e.xmlNamespacePrefix}`:"xmlns",s={[i]:e.xmlNamespace};if(["Composite"].includes(e.type.name)){if(t[o])return t;{const e={...t};return e[o]=s,e}}const a={};return a[r.xml.xmlCharKey]=t,a[o]=s,a}function m(e,t){return[o,t.xml.xmlCharKey].includes(e)}function v(e,t,n,r){const i=y(e,t);if(i){let o=i[r];if(o){"serializedName"===r&&(o=o.replace(/\\/gi,""));const i=n[o],s=t.type.uberParent??t.type.className;if("string"==typeof i&&s){const n=function(e,t,n){const r=[n];for(;r.length;){const n=r.shift(),i=t===n?t:n+"."+t;if(Object.prototype.hasOwnProperty.call(e,i))return e[i];for(const[t,i]of Object.entries(e))t.startsWith(n+".")&&i.type.uberParent===n&&i.type.className&&r.push(i.type.className)}}(e.modelMappers.discriminators,i,s);n&&(t=n)}}}return t}function y(e,t){return t.type.polymorphicDiscriminator||C(e,t.type.uberParent)||C(e,t.type.className)}function C(e,t){return t&&e.modelMappers[t]&&e.modelMappers[t].type.polymorphicDiscriminator}const S={Base64Url:"Base64Url",Boolean:"Boolean",ByteArray:"ByteArray",Composite:"Composite",Date:"Date",DateTime:"DateTime",DateTimeRfc1123:"DateTimeRfc1123",Dictionary:"Dictionary",Enum:"Enum",Number:"Number",Object:"Object",Sequence:"Sequence",String:"String",Stream:"Stream",TimeSpan:"TimeSpan",UnixTime:"UnixTime"};var T=n(3893);const E={operationRequestMap:new WeakMap};function b(e,t,n){let r=t.parameterPath;const i=t.mapper;let o;if("string"==typeof r&&(r=[r]),Array.isArray(r)){if(r.length>0)if(i.isConstant)o=i.defaultValue;else{let t=I(e,r);!t.propertyFound&&n&&(t=I(n,r));let s=!1;t.propertyFound||(s=i.required||"options"===r[0]&&2===r.length),o=s?i.defaultValue:t.propertyValue}}else{i.required&&(o={});for(const t in r){const s=i.type.modelProperties[t],a=b(e,{parameterPath:r[t],mapper:s},n);void 0!==a&&(o||(o={}),o[t]=a)}}return o}function I(e,t){const n={propertyFound:!1};let r=0;for(;r<t.length;++r){const n=t[r];if(!e||!(n in e))break;e=e[n]}return r===t.length&&(n.propertyValue=e,n.propertyFound=!0),n}const w=Symbol.for("@azure/core-client original request");function R(e){if(function(e){return w in e}(e))return R(e[w]);let t=E.operationRequestMap.get(e);return t||(t={},E.operationRequestMap.set(e,t)),t}const A=["application/json","text/json"],O=["application/xml","application/atom+xml"],k="deserializationPolicy";function _(e={}){const t=e.expectedContentTypes?.json??A,n=e.expectedContentTypes?.xml??O,r=e.parseXML,i=e.serializerOptions,o={xml:{rootName:i?.xml.rootName??"",includeRoot:i?.xml.includeRoot??!1,xmlCharKey:i?.xml.xmlCharKey??s}};return{name:k,async sendRequest(e,i){const s=await i(e);return async function(e,t,n,r,i){const o=await async function(e,t,n,r,i){if(!n.request.streamResponseStatusCodes?.has(n.status)&&n.bodyAsText){const o=n.bodyAsText,s=n.headers.get("Content-Type")||"",a=s?s.split(";").map(e=>e.toLowerCase()):[];try{if(0===a.length||a.some(t=>-1!==e.indexOf(t)))return n.parsedBody=JSON.parse(o),n;if(a.some(e=>-1!==t.indexOf(e))){if(!i)throw new Error("Parsing XML not supported.");const e=await i(o,r.xml);return n.parsedBody=e,n}}catch(e){const t=`Error "${e}" occurred while parsing the response body - ${n.bodyAsText}.`,r=e.code||T.RestError.PARSE_ERROR;throw new T.RestError(t,{code:r,statusCode:n.status,request:n.request,response:n})}}return n}(e,t,n,r,i);if(!function(e){const t=R(e.request),n=t?.shouldDeserialize;let r;return r=void 0===n||("boolean"==typeof n?n:n(e)),r}(o))return o;const s=R(o.request),a=s?.operationSpec;if(!a||!a.responses)return o;const c=function(e){let t;const n=R(e.request),r=n?.operationSpec;return r&&(t=n?.operationResponseGetter?n?.operationResponseGetter(r,e):r.responses[e.status]),t}(o),{error:u,shouldReturnResponse:l}=function(e,t,n,r){const i=200<=e.status&&e.status<300,o=function(e){const t=Object.keys(e.responses);return 0===t.length||1===t.length&&"default"===t[0]}(t)?i:!!n;if(o){if(!n)return{error:null,shouldReturnResponse:!1};if(!n.isError)return{error:null,shouldReturnResponse:!1}}const s=n??t.responses.default,a=e.request.streamResponseStatusCodes?.has(e.status)?`Unexpected status code: ${e.status}`:e.bodyAsText,c=new T.RestError(a,{statusCode:e.status,request:e.request,response:e});if(!(s||e.parsedBody?.error?.code&&e.parsedBody?.error?.message))throw c;const u=s?.bodyMapper,l=s?.headersMapper;try{if(e.parsedBody){const n=e.parsedBody;let i;if(u){let e=n;if(t.isXML&&u.type.name===S.Sequence){e=[];const t=u.xmlElementName;"object"==typeof n&&t&&(e=n[t])}i=t.serializer.deserialize(u,e,"error.response.parsedBody",r)}const o=n.error||i||n;c.code=o.code,o.message&&(c.message=o.message),u&&(c.response.parsedBody=i)}e.headers&&l&&(c.response.parsedHeaders=t.serializer.deserialize(l,e.headers.toJSON(),"operationRes.parsedHeaders"))}catch(t){c.message=`Error "${t.message}" occurred in deserializing the responseBody - "${e.bodyAsText}" for the default response.`}return{error:c,shouldReturnResponse:!1}}(o,a,c,r);if(u)throw u;if(l)return o;if(c){if(c.bodyMapper){let e=o.parsedBody;a.isXML&&c.bodyMapper.type.name===S.Sequence&&(e="object"==typeof e?e[c.bodyMapper.xmlElementName]:[]);try{o.parsedBody=a.serializer.deserialize(c.bodyMapper,e,"operationRes.parsedBody",r)}catch(e){throw new T.RestError(`Error ${e} occurred in deserializing the responseBody - ${o.bodyAsText}`,{statusCode:o.status,request:o.request,response:o})}}else"HEAD"===a.httpMethod&&(o.parsedBody=n.status>=200&&n.status<300);c.headersMapper&&(o.parsedHeaders=a.serializer.deserialize(c.headersMapper,o.headers.toJSON(),"operationRes.parsedHeaders",{xml:{},ignoreUnknownProperties:!0}))}return o}(t,n,s,o,r)}}}function P(e){const{parameterPath:t,mapper:n}=e;let r;return r="string"==typeof t?t:Array.isArray(t)?t.join("."):n.serializedName,r}const M="serializationPolicy";function D(e={}){const t=e.stringifyXML;return{name:M,async sendRequest(e,n){const r=R(e),i=r?.operationSpec,a=r?.operationArguments;return i&&a&&(function(e,t,n){if(n.headerParameters)for(const r of n.headerParameters){let i=b(t,r);if(null!=i||r.mapper.required){i=n.serializer.serialize(r.mapper,i,P(r));const t=r.mapper.headerCollectionPrefix;if(t)for(const n of Object.keys(i))e.headers.set(t+n,i[n]);else e.headers.set(r.mapper.serializedName||P(r),i)}}const r=t.options?.requestOptions?.customHeaders;if(r)for(const t of Object.keys(r))e.headers.set(t,r[t])}(e,a,i),function(e,t,n,r=function(){throw new Error("XML serialization unsupported!")}){const i=t.options?.serializerOptions,a={xml:{rootName:i?.xml.rootName??"",includeRoot:i?.xml.includeRoot??!1,xmlCharKey:i?.xml.xmlCharKey??s}},c=a.xml.xmlCharKey;if(n.requestBody&&n.requestBody.mapper){e.body=b(t,n.requestBody);const i=n.requestBody.mapper,{required:s,serializedName:u,xmlName:l,xmlElementName:d,xmlNamespace:h,xmlNamespacePrefix:p,nullable:f}=i,g=i.type.name;try{if(void 0!==e.body&&null!==e.body||f&&null===e.body||s){const t=P(n.requestBody);e.body=n.serializer.serialize(i,e.body,t,a);const s=g===S.Stream;if(n.isXML){const t=p?`xmlns:${p}`:"xmlns",n=function(e,t,n,r,i){if(e&&!["Composite","Sequence","Dictionary"].includes(n)){const n={};return n[i.xml.xmlCharKey]=r,n[o]={[t]:e},n}return r}(h,t,g,e.body,a);g===S.Sequence?e.body=r(function(e,t,n,r){if(Array.isArray(e)||(e=[e]),!n||!r)return{[t]:e};const i={[t]:e};return i[o]={[n]:r},i}(n,d||l||u,t,h),{rootName:l||u,xmlCharKey:c}):s||(e.body=r(n,{rootName:l||u,xmlCharKey:c}))}else{if(g===S.String&&(n.contentType?.match("text/plain")||"text"===n.mediaType))return;s||(e.body=JSON.stringify(e.body))}}}catch(e){throw new Error(`Error "${e.message}" occurred in serializing the payload - ${JSON.stringify(u,void 0,"  ")}.`)}}else if(n.formDataParameters&&n.formDataParameters.length>0){e.formData={};for(const r of n.formDataParameters){const i=b(t,r);if(null!=i){const t=r.mapper.serializedName||P(r);e.formData[t]=n.serializer.serialize(r.mapper,i,P(r),a)}}}}(e,a,i,t)),n(e)}}}function N(e={}){const t=(0,T.createPipelineFromOptions)(e??{});return e.credentialOptions&&t.addPolicy((0,T.bearerTokenAuthenticationPolicy)({credential:e.credentialOptions.credential,scopes:e.credentialOptions.credentialScopes})),t.addPolicy(D(e.serializationOptions),{phase:"Serialize"}),t.addPolicy(_(e.deserializationOptions),{phase:"Deserialize"}),t}let x;const U={CSV:",",SSV:" ",Multi:"Multi",TSV:"\t",Pipes:"|"};function L(e,t){let n=e;for(const[e,r]of t)n=n.split(e).join(r);return n}const q=(0,n(4299).KV)("core-client");class j{_endpoint;_requestContentType;_allowInsecureConnection;_httpClient;pipeline;constructor(e={}){if(this._requestContentType=e.requestContentType,this._endpoint=e.endpoint??e.baseUri,e.baseUri&&q.warning("The baseUri option for SDK Clients has been deprecated, please use endpoint instead."),this._allowInsecureConnection=e.allowInsecureConnection,this._httpClient=e.httpClient||(x||(x=(0,T.createDefaultHttpClient)()),x),this.pipeline=e.pipeline||function(e){const t=function(e){if(e.credentialScopes)return e.credentialScopes;if(e.endpoint)return`${e.endpoint}/.default`;if(e.baseUri)return`${e.baseUri}/.default`;if(e.credential&&!e.credentialScopes)throw new Error("When using credentials, the ServiceClientOptions must contain either a endpoint or a credentialScopes. Unable to create a bearerTokenAuthenticationPolicy")}(e),n=e.credential&&t?{credentialScopes:t,credential:e.credential}:void 0;return N({...e,credentialOptions:n})}(e),e.additionalPolicies?.length)for(const{policy:t,position:n}of e.additionalPolicies){const e="perRetry"===n?"Sign":void 0;this.pipeline.addPolicy(t,{afterPhase:e})}}async sendRequest(e){return this.pipeline.sendRequest(this._httpClient,e)}async sendOperationRequest(e,t){const n=t.baseUrl||this._endpoint;if(!n)throw new Error("If operationSpec.baseUrl is not specified, then the ServiceClient must have a endpoint string property that contains the base URL to use.");const r=function(e,t,n,r){const i=function(e,t,n){const r=new Map;if(e.urlParameters?.length)for(const i of e.urlParameters){let o=b(t,i,n);const s=P(i);o=e.serializer.serialize(i.mapper,o,s),i.skipEncoding||(o=encodeURIComponent(o)),r.set(`{${i.mapper.serializedName||s}}`,o)}return r}(t,n,r);let o=!1,s=L(e,i);if(t.path){let e=L(t.path,i);"/{nextLink}"===t.path&&e.startsWith("/")&&(e=e.substring(1)),e.includes("://")?(s=e,o=!0):s=function(e,t){if(!t)return e;const n=new URL(e);let r=n.pathname;r.endsWith("/")||(r=`${r}/`),t.startsWith("/")&&(t=t.substring(1));const i=t.indexOf("?");if(-1!==i){const e=t.substring(0,i),o=t.substring(i+1);r+=e,o&&(n.search=n.search?`${n.search}&${o}`:o)}else r+=t;return n.pathname=r,n.toString()}(s,e)}const{queryParams:a,sequenceParams:c}=function(e,t,n){const r=new Map,i=new Set;if(e.queryParameters?.length)for(const o of e.queryParameters){"Sequence"===o.mapper.type.name&&o.mapper.serializedName&&i.add(o.mapper.serializedName);let s=b(t,o,n);if(null!=s||o.mapper.required){s=e.serializer.serialize(o.mapper,s,P(o));const t=o.collectionFormat?U[o.collectionFormat]:"";if(Array.isArray(s)&&(s=s.map(e=>null==e?"":e)),"Multi"===o.collectionFormat&&0===s.length)continue;!Array.isArray(s)||"SSV"!==o.collectionFormat&&"TSV"!==o.collectionFormat||(s=s.join(t)),o.skipEncoding||(s=Array.isArray(s)?s.map(e=>encodeURIComponent(e)):encodeURIComponent(s)),!Array.isArray(s)||"CSV"!==o.collectionFormat&&"Pipes"!==o.collectionFormat||(s=s.join(t)),r.set(o.mapper.serializedName||P(o),s)}}return{queryParams:r,sequenceParams:i}}(t,n,r);return s=function(e,t,n,r=!1){if(0===t.size)return e;const i=new URL(e),o=function(e){const t=new Map;if(!e||"?"!==e[0])return t;const n=(e=e.slice(1)).split("&");for(const e of n){const[n,r]=e.split("=",2),i=t.get(n);i?Array.isArray(i)?i.push(r):t.set(n,[i,r]):t.set(n,r)}return t}(i.search);for(const[e,i]of t){const t=o.get(e);if(Array.isArray(t))if(Array.isArray(i)){t.push(...i);const n=new Set(t);o.set(e,Array.from(n))}else t.push(i);else t?(Array.isArray(i)?i.unshift(t):n.has(e)&&o.set(e,[t,i]),r||o.set(e,i)):o.set(e,i)}const s=[];for(const[e,t]of o)if("string"==typeof t)s.push(`${e}=${t}`);else if(Array.isArray(t))for(const n of t)s.push(`${e}=${n}`);else s.push(`${e}=${t}`);return i.search=s.length?`?${s.join("&")}`:"",i.toString()}(s,a,c,o),s}(n,t,e,this),i=(0,T.createPipelineRequest)({url:r});i.method=t.httpMethod;const o=R(i);o.operationSpec=t,o.operationArguments=e;const s=t.contentType||this._requestContentType;s&&t.requestBody&&i.headers.set("Content-Type",s);const a=e.options;if(a){const e=a.requestOptions;e&&(e.timeout&&(i.timeout=e.timeout),e.onUploadProgress&&(i.onUploadProgress=e.onUploadProgress),e.onDownloadProgress&&(i.onDownloadProgress=e.onDownloadProgress),void 0!==e.shouldDeserialize&&(o.shouldDeserialize=e.shouldDeserialize),e.allowInsecureConnection&&(i.allowInsecureConnection=!0)),a.abortSignal&&(i.abortSignal=a.abortSignal),a.tracingOptions&&(i.tracingOptions=a.tracingOptions)}this._allowInsecureConnection&&(i.allowInsecureConnection=!0),void 0===i.streamResponseStatusCodes&&(i.streamResponseStatusCodes=function(e){const t=new Set;for(const n in e.responses){const r=e.responses[n];r.bodyMapper&&r.bodyMapper.type.name===S.Stream&&t.add(Number(n))}return t}(t));try{const e=await this.sendRequest(i),n=u(e,t.responses[e.status]);return a?.onResponse&&a.onResponse(e,n),n}catch(e){if("object"==typeof e&&e?.response){const n=e.response,r=u(n,t.responses[e.statusCode]||t.responses.default);e.details=r,a?.onResponse&&a.onResponse(n,r,e)}throw e}}}async function F(e){const{scopes:t,response:n}=e,r=e.logger||q,i=n.headers.get("WWW-Authenticate");if(!i)return r.info("The WWW-Authenticate header was missing. Failed to perform the Continuous Access Evaluation authentication flow."),!1;const o=function(e){return`, ${e.trim()}`.split(", Bearer ").filter(e=>e).map(e=>`${e.trim()}, `.split('", ').filter(e=>e).map(e=>(([e,t])=>({[e]:t}))(e.trim().split('="'))).reduce((e,t)=>({...e,...t}),{}))}(i)||[],s=o.find(e=>e.claims);if(!s)return r.info('The WWW-Authenticate header was missing the necessary "claims" to perform the Continuous Access Evaluation authentication flow.'),!1;const a=await e.getAccessToken(s.scope?[s.scope]:t,{claims:(c=s.claims,atob(c))});var c;return!!a&&(e.request.headers.set("Authorization",`${a.tokenType??"Bearer"} ${a.token}`),!0)}const B="authorization",G=async e=>{const t={abortSignal:(n=e.request).abortSignal,requestOptions:{timeout:n.timeout},tracingOptions:n.tracingOptions};var n;const r=function(e){const t=e.headers.get("WWW-Authenticate");if(401===e.status&&t)return t}(e.response);if(r){const n=function(e){return`${e.slice(7).trim()} `.split(" ").filter(e=>e).map(e=>(([e,t])=>({[e]:t}))(e.trim().split("="))).reduce((e,t)=>({...e,...t}),{})}(r),i=function(e,t){if(!t.resource_id)return e.scopes;const n=new URL(t.resource_id);n.pathname="/.default";let r=n.toString();return"https://disk.azure.com/.default"===r&&(r="https://disk.azure.com//.default"),[r]}(e,n),o=function(e){const t=new URL(e.authorization_uri).pathname.split("/")[1];if(t&&/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/.test(t))return t}(n);if(!o)return!1;const s=await e.getAccessToken(i,{...t,tenantId:o});return!!s&&(e.request.headers.set(B,`${s.tokenType??"Bearer"} ${s.token}`),!0)}return!1}},1243:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1739),o=n(1317),s=n(8065),a=n(7428),c=function(){function e(e){this.runtimeId="",this.sdkVersion="",this.logger=e,this.sdkVersion=o.sdkVersion,this.telemetryEvents=new Map}return e.prototype.setRuntimeId=function(e){this.runtimeId=e},e.prototype.startScenario=function(e,t){if(void 0===t&&(t={}),!this.telemetryEvents.has(e)){var n=new a.default;n.start(),this.telemetryEvents.set(e,n)}var o=r({AMSClientRuntimeId:this.runtimeId,Event:s.startEvent(e),AMSClientVersion:this.sdkVersion},t);this.logger.log(i.default.INFO,e,o)},e.prototype.failScenario=function(e,t){if(void 0===t&&(t={}),this.telemetryEvents.has(e)){var n=this.telemetryEvents.get(e);this.telemetryEvents.delete(e);var o=r({AMSClientRuntimeId:this.runtimeId,Event:s.failEvent(e),AMSClientVersion:this.sdkVersion,ElapsedTimeInMilliseconds:n.stop()},t);this.logger.log(i.default.ERROR,e,o)}else console.warn("'"+e+"' event has not started.")},e.prototype.completeScenario=function(e,t){if(void 0===t&&(t={}),this.telemetryEvents.has(e)){var n=this.telemetryEvents.get(e);this.telemetryEvents.delete(e);var o=r({AMSClientRuntimeId:this.runtimeId,Event:s.completeEvent(e),AMSClientVersion:this.sdkVersion,ElapsedTimeInMilliseconds:n.stop()},t);this.logger.log(i.default.INFO,e,o)}else console.warn("'"+e+"' event has not started.")},e}();t.default=c},1278:e=>{"use strict";e.exports={rE:"0.1.5"}},1317:(e,t)=>{t.baseUrl="https://comms.omnichannelengagementhub.com/ams",t.sdkVersion="0.1.11"},1344:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseLowerCaseString=void 0;var n=function(e){return String(e).toLowerCase()};t.parseLowerCaseString=n,t.default={parseLowerCaseString:n}},1395:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.waitTimeBetweenRetriesConfigs=void 0,t.waitTimeBetweenRetriesConfigs={getChatConfig:1e3,getLWIDetails:3e3,getChatToken:1e3,sessionInit:1e3,sessionClose:1e3,getReconnectableChats:1e3,getReconnectAvailability:1e3,submitPostChatResponse:1e3,getSurveyInviteLink:1e3,getChatTranscripts:1e3,emailTranscript:1e3,fetchDataMaskingInfo:1e3,makeSecondaryChannelEventRequest:1e3,getAgentAvailability:1e3,sendTypingIndicator:1e3,validateAuthChatRecordTimeout:1e3,getPersistentChatHistory:1e3}},1427:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4938),i=n(7028),o=n(2546),s=n(6522),a=n(9143),c=n(4628),u=n(2301),l=function(){function e(){}return e.initialize=function(e,t){if(void 0===t&&(t={}),!this._isInitialized)return this._isInitialized=!0,o.default.defaultTenantToken=e,this._overrideValuesFromConfig(t),this._config.disableCookiesUsage&&!this._config.propertyStorageOverride&&(o.default.sessionEnabled=!1),u.default.addPropertyStorageOverride(this._config.propertyStorageOverride),u.default.autoCollect(o.default.semanticContext,this._config.disableCookiesUsage,this._config.userAgent),a.default.initialize(this._config),o.default.loggingEnabled=!0,this._config.enableAutoUserSession&&(this.getLogger().logSession(i.AWTSessionState.Started),window.addEventListener("beforeunload",this.flushAndTeardown)),this.getLogger()},e.getSemanticContext=function(){return o.default.semanticContext},e.flush=function(e){this._isInitialized&&!this._isDestroyed&&a.default.flush(e)},e.flushAndTeardown=function(){this._isInitialized&&!this._isDestroyed&&(this._config.enableAutoUserSession&&this.getLogger().logSession(i.AWTSessionState.Ended),a.default.flushAndTeardown(),o.default.loggingEnabled=!1,this._isDestroyed=!0)},e.pauseTransmission=function(){this._isInitialized&&!this._isDestroyed&&a.default.pauseTransmission()},e.resumeTransmision=function(){this._isInitialized&&!this._isDestroyed&&a.default.resumeTransmision()},e.setTransmitProfile=function(e){this._isInitialized&&!this._isDestroyed&&a.default.setTransmitProfile(e)},e.loadTransmitProfiles=function(e){this._isInitialized&&!this._isDestroyed&&a.default.loadTransmitProfiles(e)},e.setContext=function(e,t,n){void 0===n&&(n=r.AWTPropertyType.Unspecified),o.default.logManagerContext.setProperty(e,t,n)},e.setContextWithPii=function(e,t,n,i){void 0===i&&(i=r.AWTPropertyType.Unspecified),o.default.logManagerContext.setPropertyWithPii(e,t,n,i)},e.setContextWithCustomerContent=function(e,t,n,i){void 0===i&&(i=r.AWTPropertyType.Unspecified),o.default.logManagerContext.setPropertyWithCustomerContent(e,t,n,i)},e.getLogger=function(e){var t=e;return t&&t!==o.default.defaultTenantToken||(t=""),this._loggers[t]||(this._loggers[t]=new s.default(t)),this._loggers[t]},e.addNotificationListener=function(e){c.default.addNotificationListener(e)},e.removeNotificationListener=function(e){c.default.removeNotificationListener(e)},e._overrideValuesFromConfig=function(e){e.collectorUri&&(this._config.collectorUri=e.collectorUri),e.cacheMemorySizeLimitInNumberOfEvents>0&&(this._config.cacheMemorySizeLimitInNumberOfEvents=e.cacheMemorySizeLimitInNumberOfEvents),e.httpXHROverride&&e.httpXHROverride.sendPOST&&(this._config.httpXHROverride=e.httpXHROverride),e.propertyStorageOverride&&e.propertyStorageOverride.getProperty&&e.propertyStorageOverride.setProperty&&(this._config.propertyStorageOverride=e.propertyStorageOverride),e.userAgent&&(this._config.userAgent=e.userAgent),e.disableCookiesUsage&&(this._config.disableCookiesUsage=e.disableCookiesUsage),e.canSendStatEvent&&(this._config.canSendStatEvent=e.canSendStatEvent),e.enableAutoUserSession&&"undefined"!=typeof window&&window.addEventListener&&(this._config.enableAutoUserSession=e.enableAutoUserSession),e.clockSkewRefreshDurationInMins>0&&(this._config.clockSkewRefreshDurationInMins=e.clockSkewRefreshDurationInMins)},e._loggers={},e._isInitialized=!1,e._isDestroyed=!1,e._config={collectorUri:"https://browser.pipe.aria.microsoft.com/Collector/3.0/",cacheMemorySizeLimitInNumberOfEvents:1e4,disableCookiesUsage:!1,canSendStatEvent:function(e){return!0},clockSkewRefreshDurationInMins:0},e}();t.default=l},1524:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isCoreServicesOrgUrl=t.createCoreServicesOrgUrl=t.getCoreServicesGeoName=t.nonProductionDynamicsLocationCode=t.unqOrgUrlPattern=t.coreServicesOrgUrlPrefix=t.CoreServicesGeoNamesMapping=void 0,t.CoreServicesGeoNamesMapping={crm:"us",crm2:"br",crm3:"ca",crm4:"eu",crm5:"as",crm6:"au",crm7:"jp",crm8:"in",crm9:"gov",crm10:"preprod",crm11:"uk",crm12:"fr",crm14:"za",crm15:"ae",crm16:"de",crm17:"ch",crm19:"no",crm20:"sg",crm21:"kr",crm22:"se",crmtest:"test"},t.coreServicesOrgUrlPrefix="https://m-",t.unqOrgUrlPattern=/http[s]*:\/\/[\w-]*-(crmtest|crm[\d]*).[\w.]*/,t.nonProductionDynamicsLocationCode=["crm10","crmtest"],t.getCoreServicesGeoName=function(e){var n;return null!==(n=t.CoreServicesGeoNamesMapping[e])&&void 0!==n?n:""},t.createCoreServicesOrgUrl=function(e,t){var n="omnichannelengagementhub.com";return"gov"===t&&(n="omnichannelengagementhub.us"),"https://m-".concat(e,".").concat(t,".").concat(n)},t.isCoreServicesOrgUrl=function(e){return e.startsWith(t.coreServicesOrgUrlPrefix)}},1533:e=>{"use strict";e.exports={rE:"1.5.4"}},1545:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4938);t.AWTPropertyType=r.AWTPropertyType,t.AWTPiiKind=r.AWTPiiKind,t.AWTEventPriority=r.AWTEventPriority,t.AWTEventsDroppedReason=r.AWTEventsDroppedReason,t.AWTEventsRejectedReason=r.AWTEventsRejectedReason,t.AWTCustomerContentKind=r.AWTCustomerContentKind;var i=n(7028);t.AWTUserIdType=i.AWTUserIdType,t.AWTSessionState=i.AWTSessionState;var o=n(4782);t.AWT_BEST_EFFORT=o.AWT_BEST_EFFORT,t.AWT_NEAR_REAL_TIME=o.AWT_NEAR_REAL_TIME,t.AWT_REAL_TIME=o.AWT_REAL_TIME;var s=n(8805);t.AWTEventProperties=s.default;var a=n(6522);t.AWTLogger=a.default;var c=n(1427);t.AWTLogManager=c.default;var u=n(4487);t.AWTTransmissionManager=u.default;var l=n(2672);t.AWTSerializer=l.default;var d=n(875);t.AWTSemanticContext=d.default,t.AWT_COLLECTOR_URL_UNITED_STATES="https://us.pipe.aria.microsoft.com/Collector/3.0/",t.AWT_COLLECTOR_URL_GERMANY="https://de.pipe.aria.microsoft.com/Collector/3.0/",t.AWT_COLLECTOR_URL_JAPAN="https://jp.pipe.aria.microsoft.com/Collector/3.0/",t.AWT_COLLECTOR_URL_AUSTRALIA="https://au.pipe.aria.microsoft.com/Collector/3.0/",t.AWT_COLLECTOR_URL_EUROPE="https://eu.pipe.aria.microsoft.com/Collector/3.0/",t.AWT_COLLECTOR_URL_USGOV_DOD="https://pf.pipe.aria.microsoft.com/Collector/3.0",t.AWT_COLLECTOR_URL_USGOV_DOJ="https://tb.pipe.aria.microsoft.com/Collector/3.0"},1590:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.ChatSDKError=t.ChatSDKErrorName=void 0,function(e){e.ChatAdapterInitializationFailure="ChatAdapterInitializationFailure",e.UnsupportedLiveChatVersion="UnsupportedLiveChatVersion",e.OmnichannelClientInitializationFailure="OmnichannelClientInitializationFailure",e.MessagingClientCreationFailure="MessagingClientCreationFailure",e.ChatConfigRetrievalFailure="ChatConfigRetrievalFailure",e.UninitializedChatSDK="UninitializedChatSDK",e.ChatTokenRetrievalFailure="ChatTokenRetrievalFailure",e.ScriptLoadFailure="ScriptLoadFailure",e.UnsupportedPlatform="UnsupportedPlatform",e.FeatureDisabled="FeatureDisabled",e.ClosedConversation="ClosedConversation",e.InvalidConversation="InvalidConversation",e.AuthenticatedChatConversationRetrievalFailure="AuthenticatedChatConversationRetrievalFailure",e.PersistentChatConversationRetrievalFailure="PersistentChatConversationRetrievalFailure",e.WidgetUseOutsideOperatingHour="WidgetUseOutsideOperatingHour",e.ConversationInitializationFailure="ConversationInitializationFailure",e.ConversationClosureFailure="ConversationClosureFailure",e.MessagingClientInitializationFailure="MessagingClientInitializationFailure",e.MessagingClientConversationJoinFailure="MessagingClientConversationJoinFailure",e.LiveChatTranscriptRetrievalFailure="LiveChatTranscriptRetrievalFailure",e.ConversationDetailsRetrievalFailure="ConversationDetailsRetrievalFailure",e.AuthContactIdNotFoundFailure="AuthContactIdNotFoundFailure",e.GetAuthTokenNotFound="GetAuthTokenNotFound",e.GetAuthTokenFailed="GetAuthTokenFailed",e.UndefinedAuthToken="UndefinedAuthToken",e.UnknownAMSLoadState="UnknownAMSLoadState",e.ChatSDKSendMessageFailed="ChatSDKSendMessageFailed",e.AttachmentClientNotLoaded="AttachmentClientNotLoaded",e.NotPersistentChatEnabled="NotPersistentChatEnabled",e.AuthenticatedUserTokenNotFound="AuthenticatedUserTokenNotFound"}(n||(t.ChatSDKErrorName=n={}));var r=function(){function e(e,t,n){this.message=e,this.httpResponseStatusCode=t,this.exceptionDetails=n}return e.prototype.toString=function(){return this.message},e}();t.ChatSDKError=r},1649:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.ValidateOmnichannelConfig="ValidateOmnichannelConfig",e.ValidateSDKConfig="ValidateSDKConfig",e.InitializeChatSDK="InitializeChatSDK",e.InitializeChatSDKParallel="InitializeChatSDKParallel",e.InitializeMessagingClient="InitializeMessagingClient ",e.InitializeComponents="InitializeComponents",e.InitializeLoadChatConfig="InitializeLoadChatConfig",e.StartChat="StartChat",e.EndChat="EndChat",e.CloseChatSession="CloseChatSession",e.GetLiveChatConfig="GetLiveChatConfig",e.GetAuthToken="GetAuthToken",e.GetPreChatSurvey="GetPreChatSurvey",e.GetChatToken="GetChatToken",e.GetConversationDetails="GetConversationDetails",e.GetCurrentLiveChatContext="GetCurrentLiveChatContext",e.GetMessages="GetMessages",e.SendMessages="SendMessages",e.SendTypingEvent="SendTypingEvent",e.OnAgentEndSession="OnAgentEndSession",e.OnNewMessage="OnNewMessage",e.OnTypingEvent="OnTypingEvent",e.UploadFileAttachment="UploadFileAttachment",e.DownloadFileAttachment="DownloadFileAttachment",e.EmailLiveChatTranscript="EmailLiveChatTranscript",e.GetLiveChatTranscript="GetLiveChatTranscript",e.CreateIC3Adapter="CreateChatAdapter",e.CreateACSAdapter="CreateACSAdapter",e.CreateDirectLine="CreateDirectLine",e.GetVoiceVideoCalling="GetVoiceVideoCalling",e.GetIC3Client="GetIC3Client",e.InitializeVoiceVideoCallingSDK="InitializeVoiceVideoCallingSDK",e.AcceptVoiceCall="AcceptVoiceCall",e.AcceptVideoCall="AcceptVideoCall",e.RejectCall="RejectCall",e.StopCall="StopCall",e.OnCallDisconnected="OnCallDisconnected",e.UpdateChatToken="UpdateChatToken",e.GetChatReconnectContext="GetChatReconnectContext",e.GetPostChatSurveyContext="GetPostChatSurveyContext",e.GetAgentAvailability="GetAgentAvailability",e.GetGeolocation="GetGeolocation",e.GetChatReconnectContextWithReconnectId="GetChatReconnectContextWithReconnectId",e.GetChatReconnectContextWithAuthToken="GetChatReconnectContextWithAuthToken",e.StartPolling="StartPolling",e.StopPolling="StopPolling",e.MessageReceived="MessageReceived",e.GetPersistentChatHistory="GetPersistentChatHistory"}(n||(n={})),t.default=n},1659:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.INFO="INFO",e.DEBUG="DEBUG",e.WARN="WARN",e.ERROR="ERROR"}(n||(n={})),t.default=n},1739:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.INFO="INFO",e.DEBUG="DEBUG",e.WARN="WARN",e.ERROR="ERROR",e.LOG="LOG"}(n||(n={})),t.default=n},1753:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Active="Active",e.Closed="Closed",e.Open="Open",e.Waiting="Waiting",e.WrapUp="WrapUp"}(n||(n={})),t.default=n},1770:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.None="None",e.Success="Success",e.Failure="Failure"}(n||(n={})),t.default=n},1780:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this._killedTokenDictionary={}}return e.prototype.setKillSwitchTenants=function(e,t){if(e&&t)try{var n=e.split(",");if("this-request-only"===t)return n;for(var r=1e3*parseInt(t,10),i=0;i<n.length;++i)this._killedTokenDictionary[n[i]]=Date.now()+r}catch(e){return[]}return[]},e.prototype.isTenantKilled=function(e){return void 0!==this._killedTokenDictionary[e]&&this._killedTokenDictionary[e]>Date.now()||(delete this._killedTokenDictionary[e],!1)},e}();t.default=n},1791:(e,t,n)=>{var r=n(5172),i=n(5546);e.exports=function e(t,n){function o(e,i,s,a){try{var c=t[e](i),u=c.value;return u instanceof r?n.resolve(u.v).then(function(e){o("next",e,s,a)},function(e){o("throw",e,s,a)}):n.resolve(u).then(function(e){c.value=e,s(c)},function(e){return o("throw",e,s,a)})}catch(e){a(e)}}var s;this.next||(i(e.prototype),i(e.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),i(this,"_invoke",function(e,t,r){function i(){return new n(function(t,n){o(e,r,t,n)})}return s=s?s.then(i,i):i()},!0)},e.exports.__esModule=!0,e.exports.default=e.exports},1869:e=>{e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},1908:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.INFO="INFO",e.DEBUG="DEBUG",e.WARN="WARN",e.ERROR="ERROR",e.LOG="LOG"}(n||(n={})),t.default=n},1916:(e,t,n)=>{"use strict";var r=n(4994);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(6425));t.default=function(e,t){try{if(i.default.isAxiosError(e)&&e.code==t)return!0}catch(e){return!1}return!1}},1982:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return function(){return function(e){return function(t){var n=JSON.parse(JSON.stringify(t));if(n&&n.channelData&&n.channelData.tags){var r=n.channelData.tags;if("string"==typeof r)try{n.channelData.tags=JSON.parse(r)}catch(e){n.channelData.tags=r.split(",")}}return e(n)}}}}},2044:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Customer="Customer",e.Agent="__agent__",e.System="__system__"}(n||(n={})),t.default=n},2084:e=>{"use strict";e.exports={rE:"0.1.11"}},2246:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.IFrame=0,e.Page=1,e}();t.default=n},2301:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3465),i="MicrosoftApplicationsTelemetryDeviceId",o="MicrosoftApplicationsTelemetryFirstLaunchTime",s="MSIE",a="Chrome",c="Firefox",u="Safari",l="Edge",d="Electron",h="SkypeShell",p="PhantomJS",f="Windows",g="Mac OS X",m="Android",v=/(windows|win32)/i,y=/ arm;/i,C=/windows\sphone\s\d+\.\d+/i,S=/(macintosh|mac os x)/i,T=/(iPad|iPhone|iPod)(?=.*like Mac OS X)/i,E=/(linux|joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)/i,b=/android/i,I=/CrOS/i,w={5.1:"XP","6.0":"Vista",6.1:"7",6.2:"8",6.3:"8.1","10.0":"10"},R="([\\d,.]+)",A="Unknown",O="undefined",k=function(){function e(){}return e.addPropertyStorageOverride=function(e){return!!e&&(this._propertyStorage=e,!0)},e.autoCollect=function(e,t,n){if(this._semanticContext=e,this._disableCookies=t,this._autoCollect(),n||typeof navigator===O||(n=navigator.userAgent||""),this._autoCollectFromUserAgent(n),this._disableCookies&&!this._propertyStorage)return this._deleteCookie(i),void this._deleteCookie(o);(this._propertyStorage||this._areCookiesAvailable&&!this._disableCookies)&&this._autoCollectDeviceId()},e.checkAndSaveDeviceId=function(e){if(e){var t=this._getData(i),n=this._getData(o);t!==e&&(n=r.getISOString(new Date)),this._saveData(i,e),this._saveData(o,n),this._setFirstLaunchTime(n)}},e._autoCollectDeviceId=function(){var e=this._getData(i);e||(e=r.newGuid()),this._semanticContext.setDeviceId(e)},e._autoCollect=function(){typeof document!==O&&document.documentElement&&this._semanticContext.setAppLanguage(document.documentElement.lang),typeof navigator!==O&&this._semanticContext.setUserLanguage(navigator.userLanguage||navigator.language);var e=(new Date).getTimezoneOffset(),t=e%60,n=(e-t)/60,r="+";n>0&&(r="-"),n=Math.abs(n),t=Math.abs(t),this._semanticContext.setUserTimeZone(r+(n<10?"0"+n:n.toString())+":"+(t<10?"0"+t:t.toString()))},e._autoCollectFromUserAgent=function(e){if(e){var t=this._getBrowserName(e);this._semanticContext.setDeviceBrowserName(t),this._semanticContext.setDeviceBrowserVersion(this._getBrowserVersion(e,t));var n=this._getOsName(e);this._semanticContext.setDeviceOsName(n),this._semanticContext.setDeviceOsVersion(this._getOsVersion(e,n))}},e._getBrowserName=function(e){return this._userAgentContainsString("OPR/",e)?"Opera":this._userAgentContainsString(p,e)?p:this._userAgentContainsString(l,e)||this._userAgentContainsString("Edg",e)?l:this._userAgentContainsString(d,e)?d:this._userAgentContainsString(a,e)?a:this._userAgentContainsString("Trident",e)?s:this._userAgentContainsString(c,e)?c:this._userAgentContainsString(u,e)?u:this._userAgentContainsString(h,e)?h:A},e._setFirstLaunchTime=function(e){if(!isNaN(e)){var t=new Date;t.setTime(parseInt(e,10)),e=r.getISOString(t)}this.firstLaunchTime=e},e._userAgentContainsString=function(e,t){return t.indexOf(e)>-1},e._getBrowserVersion=function(e,t){if(t===s)return this._getIeVersion(e);if(t===l){var n=this._getOtherVersion(t,e);return n===A?this._getOtherVersion("Edg",e):n}return this._getOtherVersion(t,e)},e._getIeVersion=function(e){var t=e.match(new RegExp(s+" "+R));if(t)return t[1];var n=e.match(new RegExp("rv:"+R));return n?n[1]:void 0},e._getOtherVersion=function(e,t){e===u&&(e="Version");var n=t.match(new RegExp(e+"/"+R));return n?n[1]:A},e._getOsName=function(e){return e.match(C)?"Windows Phone":e.match(y)?"Windows RT":e.match(T)?"iOS":e.match(b)?m:e.match(E)?"Linux":e.match(S)?g:e.match(v)?f:e.match(I)?"Chrome OS":A},e._getOsVersion=function(e,t){return t===f?this._getGenericOsVersion(e,"Windows NT"):t===m?this._getGenericOsVersion(e,t):t===g?this._getMacOsxVersion(e):A},e._getGenericOsVersion=function(e,t){var n=e.match(new RegExp(t+" "+R));return n?w[n[1]]?w[n[1]]:n[1]:A},e._getMacOsxVersion=function(e){var t=e.match(new RegExp(g+" ([\\d,_,.]+)"));if(t){var n=t[1].replace(/_/g,".");if(n){var r=this._getDelimiter(n);return r?n.split(r)[0]:n}}return A},e._getDelimiter=function(e){return e.indexOf(".")>-1?".":e.indexOf("_")>-1?"_":null},e._saveData=function(e,t){if(this._propertyStorage)this._propertyStorage.setProperty(e,t);else if(this._areCookiesAvailable){var n=new Date;n.setTime(n.getTime()+31536e6);var r="expires="+n.toUTCString();document.cookie=e+"="+t+"; "+r}},e._getData=function(e){if(this._propertyStorage)return this._propertyStorage.getProperty(e)||"";if(this._areCookiesAvailable){e+="=";for(var t=document.cookie.split(";"),n=0;n<t.length;n++){for(var r=t[n],i=0;" "===r.charAt(i);)i++;if(0===(r=r.substring(i)).indexOf(e))return r.substring(e.length,r.length)}}return""},e._deleteCookie=function(e){this._areCookiesAvailable&&(document.cookie=e+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;")},e._disableCookies=!1,e._areCookiesAvailable=typeof document!==O&&typeof document.cookie!==O,e}();t.default=k},2343:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.GET="get",e.POST="post",e.PUT="put",e.DELETE="delete"}(n||(n={})),t.default=n},2546:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(8805),i=n(875),o=function(){function e(){}return e.logManagerContext=new r.default,e.sessionEnabled=!0,e.loggingEnabled=!1,e.defaultTenantToken="",e.semanticContext=new i.default(!0,e.logManagerContext),e}();t.default=o},2654:(e,t,n)=>{"use strict";n.r(t),n.d(t,{AzureCommunicationTokenCredential:()=>c,createCommunicationAccessKeyCredentialPolicy:()=>v,createCommunicationAuthPolicy:()=>T,createIdentifierFromRawId:()=>A.jh,deserializeCommunicationIdentifier:()=>O.r,getIdentifierKind:()=>A.QW,getIdentifierRawId:()=>A.Zp,isCommunicationUserIdentifier:()=>A.LM,isKeyCredential:()=>w,isMicrosoftTeamsAppIdentifier:()=>A.rx,isMicrosoftTeamsUserIdentifier:()=>A.fC,isPhoneNumberIdentifier:()=>A.zL,isUnknownIdentifier:()=>A.iT,parseClientArguments:()=>R,parseConnectionString:()=>b,serializeCommunicationIdentifier:()=>O.w});class r extends Error{}r.prototype.name="InvalidTokenError";const i=e=>{const{exp:t}=function(e,t){if("string"!=typeof e)throw new r("Invalid token specified: must be a string");t||(t={});const n=!0===t.header?0:1,i=e.split(".")[n];if("string"!=typeof i)throw new r(`Invalid token specified: missing part #${n+1}`);let o;try{o=function(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return function(e){return decodeURIComponent(atob(e).replace(/(.)/g,(e,t)=>{let n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n}))}(t)}catch(e){return atob(t)}}(i)}catch(e){throw new r(`Invalid token specified: invalid base64 for part #${n+1} (${e.message})`)}try{return JSON.parse(o)}catch(e){throw new r(`Invalid token specified: invalid json for part #${n+1} (${e.message})`)}}(e);return{token:e,expiresOnTimestamp:1e3*t}},o={token:"",expiresOnTimestamp:-10};class s{constructor(e){this.expiringSoonIntervalInMs=6e5,this.refreshAfterLifetimePercentage=.5,this.activeTokenFetching=null,this.activeTokenUpdating=null,this.disposed=!1;const{tokenRefresher:t,token:n,refreshProactively:r}=e;this.refresh=t,this.currentToken=n?i(n):o,this.refreshProactively=null!=r&&r,this.refreshProactively&&this.scheduleRefresh()}async getToken(e){if(!this.isTokenExpiringSoon(this.currentToken))return this.currentToken;if(!this.isTokenValid(this.currentToken)){const t=this.updateTokenAndReschedule(null==e?void 0:e.abortSignal);await t}return this.currentToken}dispose(){this.disposed=!0,this.activeTokenFetching=null,this.activeTokenUpdating=null,this.currentToken=o,this.activeTimeout&&clearTimeout(this.activeTimeout)}async updateTokenAndReschedule(e){if(this.activeTokenUpdating)return this.activeTokenUpdating;this.activeTokenUpdating=this.refreshTokenAndReschedule(e);try{await this.activeTokenUpdating}finally{this.activeTokenUpdating=null}}async refreshTokenAndReschedule(e){const t=await this.refreshToken(e);if(!this.isTokenValid(t))throw new Error("The token returned from the tokenRefresher is expired.");this.currentToken=t,this.refreshProactively&&this.scheduleRefresh()}async refreshToken(e){try{return this.activeTokenFetching||(this.activeTokenFetching=this.refresh(e)),i(await this.activeTokenFetching)}finally{this.activeTokenFetching=null}}scheduleRefresh(){if(this.disposed)return;this.activeTimeout&&clearTimeout(this.activeTimeout);const e=this.currentToken.expiresOnTimestamp-Date.now();let t=null;t=this.isTokenExpiringSoon(this.currentToken)?e*this.refreshAfterLifetimePercentage:e-this.expiringSoonIntervalInMs,this.activeTimeout=setTimeout(()=>this.updateTokenAndReschedule(),t)}isTokenValid(e){return e&&Date.now()<e.expiresOnTimestamp}isTokenExpiringSoon(e){return!e||Date.now()>=e.expiresOnTimestamp-this.expiringSoonIntervalInMs}}class a{constructor(e){this.token=e}async getToken(){return this.token}dispose(){}}class c{constructor(e){this.disposed=!1,this.tokenCredential="string"==typeof e?new a(i(e)):new s(e)}async getToken(e){this.throwIfDisposed();const t=await this.tokenCredential.getToken(e);return this.throwIfDisposed(),t}dispose(){this.disposed=!0,this.tokenCredential.dispose()}throwIfDisposed(){if(this.disposed)throw new Error("User credential is disposed")}}const u=e=>(new TextEncoder).encode(e);function l(e){if("function"!=typeof btoa)throw new Error("Your browser environment is missing the global `btoa` function");const t=new Uint8Array(e);let n="";for(const e of t)n+=String.fromCharCode(e);return btoa(n)}var d;const h=null===(d=null===globalThis||void 0===globalThis?void 0:globalThis.crypto)||void 0===d?void 0:d.subtle,p=async e=>{const t=u(e);return l(await h.digest("SHA-256",t))},f=async(e,t)=>{const n={name:"HMAC",hash:{name:"SHA-256"}},r=u(t),i=function(e){if("function"!=typeof atob)throw new Error("Your browser environment is missing the global `atob` function");const t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}(e),o=h,s=await o.importKey("raw",i,n,!1,["sign"]);return l(await o.sign(n,s,r))};var g=n(70);const m="CommunicationAccessKeyCredentialPolicy";function v(e){return{name:m,async sendRequest(t,n){var r;const i=t.method.toUpperCase(),o=(new Date).toUTCString(),s=await p((null===(r=t.body)||void 0===r?void 0:r.toString())||""),a="x-ms-date",c=`${a};host;x-ms-content-sha256`,u=new URL(t.url),l=u.searchParams.toString(),d=l?`${u.pathname}?${l}`:u.pathname,h=u.port,m=h?`${u.host}:${h}`:u.host,v=`${i}\n${d}\n${o};${m};${s}`,y=await f(e.key,v);return g.isNode&&t.headers.set("Host",m||""),t.headers.set(a,o),t.headers.set("x-ms-content-sha256",s),t.headers.set("Authorization",`HMAC-SHA256 SignedHeaders=${c}&Signature=${y}`),n(t)}}}var y=n(3893);class C{_key;get key(){return this._key}constructor(e){if(!e)throw new Error("key must be a non-empty string");this._key=e}update(e){this._key=e}}function S(e){const t=e;return t&&"function"==typeof t.getToken&&(void 0===t.signRequest||t.getToken.length>0)}function T(e){if(S(e)){const t={credential:e,scopes:["https://communication.azure.com//.default"]};return(0,y.bearerTokenAuthenticationPolicy)(t)}return v(e)}const E=/endpoint=(.*);accesskey=(.*)/i,b=e=>{const t=(e=>{const t=e.match(E);if((null==t?void 0:t[1])&&t[2])return{endpoint:t[1],credential:new C(t[2])}})(e);if(t)return t;throw new Error(`Invalid connection string ${e}`)},I=e=>{if(!(e=>{var t;const n=new URL(e);return!!(null===(t=n.protocol)||void 0===t?void 0:t.match(/^http[s]?/))&&void 0!==n.host&&""!==n.host&&(void 0===n.pathname||""===n.pathname||"/"===n.pathname)})(e))throw new Error(`Invalid endpoint url ${e}`)},w=e=>{const t=e;return t&&"string"==typeof t.key&&void 0===t.getToken},R=(e,t)=>{if(w(t)||S(t))return I(e),{url:e,credential:t};{const{endpoint:t,credential:n}=b(e);return I(t),{url:t,credential:n}}};var A=n(7084),O=n(9941)},2672:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(8369),i=n(4938),o=n(4628),s=n(3465),a=2936012,c=function(){function e(){}return e.getPayloadBlob=function(e,t){var n,c=!1,u=new r.IO.MemoryStream,l=new r.CompactBinaryProtocolWriter(u);for(var d in l._WriteFieldBegin(r._BondDataType._BT_MAP,3,null),l._WriteMapContainerBegin(t,r._BondDataType._BT_STRING,r._BondDataType._BT_LIST),e)if(c)n||(n={}),n[d]=e[d],delete e[d];else if(e.hasOwnProperty(d)){l._WriteString(d);var h=e[d];l._WriteContainerBegin(1,r._BondDataType._BT_STRUCT),l._WriteFieldBegin(r._BondDataType._BT_STRING,2,null),l._WriteString("act_default_source"),l._WriteFieldBegin(r._BondDataType._BT_STRING,5,null),l._WriteString(s.newGuid()),l._WriteFieldBegin(r._BondDataType._BT_INT64,6,null),l._WriteInt64(s.numberToBondInt64(Date.now())),l._WriteFieldBegin(r._BondDataType._BT_LIST,8,null);var p=u._GetBuffer().length+1;l._WriteContainerBegin(e[d].length,r._BondDataType._BT_STRUCT);for(var f=u._GetBuffer().length-p,g=0;g<h.length;++g){var m=u._GetBuffer().length;if(this.writeEvent(h[g],l),u._GetBuffer().length-m>a)o.default.eventsRejected([h[g]],i.AWTEventsRejectedReason.SizeLimitExceeded),h.splice(g--,1),u._GetBuffer().splice(m),this._addNewDataPackageSize(h.length,u,f,p);else if(u._GetBuffer().length>a){u._GetBuffer().splice(m),n||(n={}),e[d]=h.splice(0,g),n[d]=h,this._addNewDataPackageSize(e[d].length,u,f,p),c=!0;break}}l._WriteStructEnd(!1)}return l._WriteStructEnd(!1),{payloadBlob:u._GetBuffer(),remainingRequest:n}},e._addNewDataPackageSize=function(e,t,n,i){for(var o=r._Encoding._Varint_GetBytes(r.Number._ToUInt32(e)),s=0;s<n;++s){if(!(s<o.length)){t._GetBuffer().slice(i+s,n-s);break}t._GetBuffer()[i+s]=o[s]}},e.writeEvent=function(e,t){t._WriteFieldBegin(r._BondDataType._BT_STRING,1,null),t._WriteString(e.id),t._WriteFieldBegin(r._BondDataType._BT_INT64,3,null),t._WriteInt64(s.numberToBondInt64(e.timestamp)),t._WriteFieldBegin(r._BondDataType._BT_STRING,5,null),t._WriteString(e.type),t._WriteFieldBegin(r._BondDataType._BT_STRING,6,null),t._WriteString(e.name);var n={},o=0,a={},c=0,u={},l=0,d={},h=0,p={},f=0,g={},m=0,v={},y=0;for(var C in e.properties)if(e.properties.hasOwnProperty(C))if((T=e.properties[C]).cc>0)v[C]=T,y++;else if(T.pii>0)g[C]=T,m++;else switch(T.type){case i.AWTPropertyType.String:n[C]=T.value,o++;break;case i.AWTPropertyType.Int64:a[C]=T.value,c++;break;case i.AWTPropertyType.Double:u[C]=T.value,l++;break;case i.AWTPropertyType.Boolean:d[C]=T.value,h++;break;case i.AWTPropertyType.Date:p[C]=T.value,f++}if(o)for(var C in t._WriteFieldBegin(r._BondDataType._BT_MAP,13,null),t._WriteMapContainerBegin(o,r._BondDataType._BT_STRING,r._BondDataType._BT_STRING),n)if(n.hasOwnProperty(C)){var S=n[C];t._WriteString(C),t._WriteString(S.toString())}if(m)for(var C in t._WriteFieldBegin(r._BondDataType._BT_MAP,30,null),t._WriteMapContainerBegin(m,r._BondDataType._BT_STRING,r._BondDataType._BT_STRUCT),g)if(g.hasOwnProperty(C)){var T=g[C];t._WriteString(C),t._WriteFieldBegin(r._BondDataType._BT_INT32,1,null),t._WriteInt32(1),t._WriteFieldBegin(r._BondDataType._BT_INT32,2,null),t._WriteInt32(T.pii),t._WriteFieldBegin(r._BondDataType._BT_STRING,3,null),t._WriteString(T.value.toString()),t._WriteStructEnd(!1)}if(h)for(var C in t._WriteFieldBegin(r._BondDataType._BT_MAP,31,null),t._WriteMapContainerBegin(h,r._BondDataType._BT_STRING,r._BondDataType._BT_BOOL),d)d.hasOwnProperty(C)&&(S=d[C],t._WriteString(C),t._WriteBool(S));if(f)for(var C in t._WriteFieldBegin(r._BondDataType._BT_MAP,32,null),t._WriteMapContainerBegin(f,r._BondDataType._BT_STRING,r._BondDataType._BT_INT64),p)p.hasOwnProperty(C)&&(S=p[C],t._WriteString(C),t._WriteInt64(s.numberToBondInt64(S)));if(c)for(var C in t._WriteFieldBegin(r._BondDataType._BT_MAP,33,null),t._WriteMapContainerBegin(c,r._BondDataType._BT_STRING,r._BondDataType._BT_INT64),a)a.hasOwnProperty(C)&&(S=a[C],t._WriteString(C),t._WriteInt64(s.numberToBondInt64(S)));if(l)for(var C in t._WriteFieldBegin(r._BondDataType._BT_MAP,34,null),t._WriteMapContainerBegin(l,r._BondDataType._BT_STRING,r._BondDataType._BT_DOUBLE),u)u.hasOwnProperty(C)&&(S=u[C],t._WriteString(C),t._WriteDouble(S));if(y)for(var C in t._WriteFieldBegin(r._BondDataType._BT_MAP,36,null),t._WriteMapContainerBegin(y,r._BondDataType._BT_STRING,r._BondDataType._BT_STRUCT),v)v.hasOwnProperty(C)&&(T=v[C],t._WriteString(C),t._WriteFieldBegin(r._BondDataType._BT_INT32,1,null),t._WriteInt32(T.cc),t._WriteFieldBegin(r._BondDataType._BT_STRING,2,null),t._WriteString(T.value.toString()),t._WriteStructEnd(!1));t._WriteStructEnd(!1)},e.base64Encode=function(e){return r._Encoding._Base64_GetString(e)},e}();t.default=c},2698:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.SupportedAdaptiveCards=void 0,function(e){e.Adaptive="application/vnd.microsoft.card.adaptive",e.Audio="application/vnd.microsoft.card.audio",e.Hero="application/vnd.microsoft.card.hero",e.Receipt="application/vnd.microsoft.card.receipt",e.Thumbnail="application/vnd.microsoft.card.thumbnail",e.Signin="application/vnd.microsoft.card.signin",e.OAuth="application/vnd.microsoft.card.oauth",e.Video="application/vnd.microsoft.card.video"}(n||(t.SupportedAdaptiveCards=n={}))},2902:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultLocaleString=t.defaultLocaleId=t.getLocaleIdFromString=t.getLocaleStringFromId=t.isCustomerMessage=t.isSystemMessage=t.PersonType=t.MessageType=t.DeliveryMode=t.MessageContentType=t.ChatSDKError=t.ChatSDKErrorName=t.uuidv4=t.OCSDKProvider=t.IC3SDKProvider=t.OmnichannelChatSDK=void 0;var r=n(1590);Object.defineProperty(t,"ChatSDKError",{enumerable:!0,get:function(){return r.ChatSDKError}}),Object.defineProperty(t,"ChatSDKErrorName",{enumerable:!0,get:function(){return r.ChatSDKErrorName}});var i=n(7912);Object.defineProperty(t,"OCSDKProvider",{enumerable:!0,get:function(){return i.SDKProvider}}),Object.defineProperty(t,"uuidv4",{enumerable:!0,get:function(){return i.uuidv4}});var o=n(4564);Object.defineProperty(t,"defaultLocaleId",{enumerable:!0,get:function(){return o.defaultLocaleId}}),Object.defineProperty(t,"defaultLocaleString",{enumerable:!0,get:function(){return o.defaultLocaleString}}),Object.defineProperty(t,"getLocaleIdFromString",{enumerable:!0,get:function(){return o.getLocaleIdFromString}}),Object.defineProperty(t,"getLocaleStringFromId",{enumerable:!0,get:function(){return o.getLocaleStringFromId}});var s=n(3428);Object.defineProperty(t,"isCustomerMessage",{enumerable:!0,get:function(){return s.isCustomerMessage}}),Object.defineProperty(t,"isSystemMessage",{enumerable:!0,get:function(){return s.isSystemMessage}});var a=n(9376);t.DeliveryMode=a.default;var c=n(9);Object.defineProperty(t,"IC3SDKProvider",{enumerable:!0,get:function(){return c.SDKProvider}});var u=n(3311);t.MessageContentType=u.default;var l=n(7516);t.MessageType=l.default;var d=n(322);t.OmnichannelChatSDK=d.default;var h=n(8990);t.PersonType=h.default,t.default={OmnichannelChatSDK:d.default,ic3sdk:{IC3SDKProvider:c.SDKProvider},ocsdk:{OCSDKProvider:i.SDKProvider,uuidv4:i.uuidv4}}},2950:(e,t,n)=>{"use strict";var r=n(4994);t.Ay=b;var i=r(n(4756)),o=r(n(3738)),s=r(n(9293)),a=r(n(3693)),c=r(n(1111));function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach(function(t){(0,a.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var d="axios-retry";function h(e){return!e.response&&Boolean(e.code)&&!["ERR_CANCELED","ECONNABORTED"].includes(e.code)&&(0,c.default)(e)}var p=["get","head","options"],f=p.concat(["put","delete"]);function g(e){return"ECONNABORTED"!==e.code&&(!e.response||e.response.status>=500&&e.response.status<=599)}function m(e){return!!e.config&&g(e)&&-1!==f.indexOf(e.config.method)}function v(e){return h(e)||m(e)}var y={retries:3,retryCondition:v,retryDelay:function(){return 0},shouldResetTimeout:!1,onRetry:function(){}};function C(e,t){var n=function(e,t){return l(l(l({},y),t),e[d])}(e,t);return n.retryCount=n.retryCount||0,e[d]=n,n}function S(e,t){e.defaults.agent===t.agent&&delete t.agent,e.defaults.httpAgent===t.httpAgent&&delete t.httpAgent,e.defaults.httpsAgent===t.httpsAgent&&delete t.httpsAgent}function T(e,t){return E.apply(this,arguments)}function E(){return(E=(0,s.default)(i.default.mark(function e(t,n){var r,s,a,c;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.retries,s=t.retryCondition,a=t.retryCount<r&&s(n),"object"!==(0,o.default)(a)){e.next=13;break}return e.prev=3,e.next=6,a;case 6:return c=e.sent,e.abrupt("return",!1!==c);case 10:return e.prev=10,e.t0=e.catch(3),e.abrupt("return",!1);case 13:return e.abrupt("return",a);case 14:case"end":return e.stop()}},e,null,[[3,10]])}))).apply(this,arguments)}function b(e,t){var n=e.interceptors.request.use(function(e){return C(e,t).lastRequestTime=Date.now(),e}),r=e.interceptors.response.use(null,function(){var n=(0,s.default)(i.default.mark(function n(r){var o,s,a,c,u,l,d,h;return i.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(o=r.config){n.next=3;break}return n.abrupt("return",Promise.reject(r));case 3:return s=C(o,t),n.next=6,T(s,r);case 6:if(!n.sent){n.next=21;break}if(s.retryCount+=1,a=s.retryDelay,c=s.shouldResetTimeout,u=s.onRetry,l=a(s.retryCount,r),S(e,o),c||!o.timeout||!s.lastRequestTime){n.next=17;break}if(d=Date.now()-s.lastRequestTime,!((h=o.timeout-d-l)<=0)){n.next=16;break}return n.abrupt("return",Promise.reject(r));case 16:o.timeout=h;case 17:return o.transformRequest=[function(e){return e}],n.next=20,u(s.retryCount,r,o);case 20:return n.abrupt("return",new Promise(function(t){return setTimeout(function(){return t(e(o))},l)}));case 21:return n.abrupt("return",Promise.reject(r));case 22:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}());return{requestInterceptorId:n,responseInterceptorId:r}}b.isNetworkError=h,b.isSafeRequestError=function(e){return!!e.config&&g(e)&&-1!==p.indexOf(e.config.method)},b.isIdempotentRequestError=m,b.isNetworkOrIdempotentRequestError=v,b.exponentialDelay=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,n=Math.pow(2,e)*t;return n+.2*n*Math.random()},b.isRetryableError=g},3009:function(e,t,n){var r;e.exports=(r=n(9021),function(e){var t=r,n=t.lib,i=n.WordArray,o=n.Hasher,s=t.algo,a=[],c=[];!function(){function t(t){for(var n=e.sqrt(t),r=2;r<=n;r++)if(!(t%r))return!1;return!0}function n(e){return 4294967296*(e-(0|e))|0}for(var r=2,i=0;i<64;)t(r)&&(i<8&&(a[i]=n(e.pow(r,.5))),c[i]=n(e.pow(r,1/3)),i++),r++}();var u=[],l=s.SHA256=o.extend({_doReset:function(){this._hash=new i.init(a.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],i=n[1],o=n[2],s=n[3],a=n[4],l=n[5],d=n[6],h=n[7],p=0;p<64;p++){if(p<16)u[p]=0|e[t+p];else{var f=u[p-15],g=(f<<25|f>>>7)^(f<<14|f>>>18)^f>>>3,m=u[p-2],v=(m<<15|m>>>17)^(m<<13|m>>>19)^m>>>10;u[p]=g+u[p-7]+v+u[p-16]}var y=r&i^r&o^i&o,C=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),S=h+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&l^~a&d)+c[p]+u[p];h=d,d=l,l=a,a=s+S|0,s=o,o=i,i=r,r=S+(C+y)|0}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+o|0,n[3]=n[3]+s|0,n[4]=n[4]+a|0,n[5]=n[5]+l|0,n[6]=n[6]+d|0,n[7]=n[7]+h|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;return n[i>>>5]|=128<<24-i%32,n[14+(i+64>>>9<<4)]=e.floor(r/4294967296),n[15+(i+64>>>9<<4)]=r,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=o._createHelper(l),t.HmacSHA256=o._createHmacHelper(l)}(Math),r.SHA256)},3022:(e,t,n)=>{"use strict";var r=n(4994);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(7383)),o=r(n(4579)),s=r(n(3693)),a=r(n(5701)),c=function(){function e(t){(0,i.default)(this,e),(0,s.default)(this,"logger",void 0),this.logger=t}return(0,o.default)(e,[{key:"log",value:function(e,t,n,r){if(this.isLoggingEnabled()){var i=a.default.GETTELEMETRYEVENTDATA(t,n,r);this.logEvent(e,i)}}},{key:"logEvent",value:function(e,t){this.isLoggingEnabled()&&this.logger.logClientSdkTelemetryEvent(e,t)}},{key:"isLoggingEnabled",value:function(){return!this.isNullOrUndefined(this.logger)}},{key:"isNullOrUndefined",value:function(e){return null==e}}]),e}();t.default=c},3136:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ResourceType=t.FileSharingProtocolType=t.Role=t.PersonType=t.MessageType=t.DeliveryMode=t.MessageContentType=void 0;var n=function(){function e(){}return e.RichText="RichText",e.Text="Text",e}();t.MessageContentType=n;var r=function(){function e(){}return e.Bridged="bridged",e.Unbridged="unbridged",e}();t.DeliveryMode=r;var i,o,s,a=function(){function e(){}return e.UserMessage="UserMessage",e.SwiftCard="SwiftCard",e.Typing="Control/Typing",e.ClearTyping="Control/ClearTyping",e.LiveState="Control/LiveState",e}();t.MessageType=a,function(e){e[e.Unknown=0]="Unknown",e[e.User=1]="User",e[e.Bot=2]="Bot"}(i||(t.PersonType=i={})),function(e){e.Bot="bot",e.Agent="agent",e.System="system",e.User="user",e.Unknown="unknown"}(o||(t.Role=o={})),function(e){e[e.AmsBasedFileSharing=0]="AmsBasedFileSharing"}(s||(t.FileSharingProtocolType=s={}));var c=function(){function e(){}return e.NewMessage="NewMessage",e.MessageUpdate="MessageUpdate",e.UserPresence="UserPresence",e.ConversationUpdate="ConversationUpdate",e.ThreadUpdate="ThreadUpdate",e}();t.ResourceType=c},3290:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3465),i=n(4628),o=n(4938),s=function(){function e(){}return e.initialize=function(e){var t=this;this._sendStats=e,this._isInitalized=!0,i.default.addNotificationListener({eventsSent:function(e){t._addStat("records_sent_count",e.length,e[0].apiKey)},eventsDropped:function(e,n){switch(n){case o.AWTEventsDroppedReason.NonRetryableStatus:t._addStat("d_send_fail",e.length,e[0].apiKey),t._addStat("records_dropped_count",e.length,e[0].apiKey);break;case o.AWTEventsDroppedReason.MaxRetryLimit:t._addStat("d_retry_limit",e.length,e[0].apiKey),t._addStat("records_dropped_count",e.length,e[0].apiKey);break;case o.AWTEventsDroppedReason.QueueFull:t._addStat("d_queue_full",e.length,e[0].apiKey)}},eventsRejected:function(e,n){switch(n){case o.AWTEventsRejectedReason.InvalidEvent:t._addStat("r_inv",e.length,e[0].apiKey);break;case o.AWTEventsRejectedReason.KillSwitch:t._addStat("r_kl",e.length,e[0].apiKey);break;case o.AWTEventsRejectedReason.SizeLimitExceeded:t._addStat("r_size",e.length,e[0].apiKey)}t._addStat("r_count",e.length,e[0].apiKey)},eventsRetrying:null}),setTimeout(function(){return t.flush()},6e4)},e.teardown=function(){this._isInitalized&&(this.flush(),this._isInitalized=!1)},e.eventReceived=function(t){e._addStat("records_received_count",1,t)},e.flush=function(){var e=this;if(this._isInitalized){for(var t in this._stats)this._stats.hasOwnProperty(t)&&this._sendStats(this._stats[t],t);this._stats={},setTimeout(function(){return e.flush()},6e4)}},e._addStat=function(e,t,n){if(this._isInitalized&&n!==r.StatsApiKey){var i=r.getTenantId(n);this._stats[i]||(this._stats[i]={}),this._stats[i][e]?this._stats[i][e]=this._stats[i][e]+t:this._stats[i][e]=t}},e._isInitalized=!1,e._stats={},e}();t.default=s},3311:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.RichText="RichText",e.Text="Text",e}();t.default=n},3316:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.None="None",e.Request="Request",e.Response="Response"}(n||(n={})),t.default=n},3336:(e,t,n)=>{"use strict";n.d(t,{If:()=>f.I,gE:()=>r.g,Z4:()=>d,g8:()=>l,Wq:()=>i.W,Bd:()=>p.Bd,Qg:()=>p.Qg,N6:()=>p.N6,bJ:()=>s.b,qx:()=>p.qx,tX:()=>p.tX,Gv:()=>o.G,lV:()=>p.lV,p7:()=>p.p7,N4:()=>h.N,Al:()=>a.Al,SW:()=>a.SW});var r=n(4953),i=n(5967),o=n(8603),s=n(6276),a=n(8208);let c;function u(){if(c)return c;if(!self.crypto||!self.crypto.subtle)throw new Error("Your browser environment does not support cryptography functions.");return c=self.crypto.subtle,c}async function l(e,t,n){const r=u(),i=(0,a.Al)(e,"base64"),o=(0,a.Al)(t,"utf-8"),s=await r.importKey("raw",i,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),c=await r.sign({name:"HMAC",hash:{name:"SHA-256"}},s,o);return(0,a.SW)(new Uint8Array(c),n)}async function d(e,t){const n=(0,a.Al)(e,"utf-8"),r=await u().digest({name:"SHA-256"},n);return(0,a.SW)(new Uint8Array(r),t)}var h=n(5641),p=n(369),f=n(5513)},3355:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7145),i=n(8405),o=n(4746),s=function(){function e(e,t,n,r){this.isPolling=!1,this._ic3Info=e,this._onNewData=t,this._onError=n,this.callbackOnFailure=r}return e.prototype.start=function(){return this.isPolling||(this.isPolling=!0,this.startPolling()),Promise.resolve()},e.prototype.stop=function(){return this.isPolling=!1,Promise.resolve()},Object.defineProperty(e.prototype,"onNewData",{get:function(){return this._onNewData},set:function(e){this._onNewData=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onError",{get:function(){return this._onError},set:function(e){this._onError=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"setCallbackOnFailure",{set:function(e){this.setCallbackOnFailure=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ic3Info",{get:function(){return this._ic3Info},set:function(e){this._ic3Info=e},enumerable:!1,configurable:!0}),e.prototype.startPolling=function(){var e=this;this.isPolling&&this.poll().then(function(t){e.isPolling&&e._onNewData&&e._onNewData(t)}).catch(function(t){e._onError&&e._onError(t)}).then(function(){e.startPolling()})},e.prototype.poll=function(){var e=r.default.getV1PollUrl(this._ic3Info.RegionGtms,this._ic3Info.subscriptionId);return i.default.poll(e,this._ic3Info.RegistrationToken,this.callbackOnEachRequestCompleted.bind(this))},e.prototype.callbackOnEachRequestCompleted=function(e){this.callbackOnFailure(e,o.default.pollRequestLog)},e}();t.default=s},3364:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4372),i=function(){function e(){}return e.isNullOrEmptyString=function(t){return e.isNullOrUndefined(t)||""===t},e.isNullOrUndefinedOrEmptyArray=function(t){return e.isNullOrUndefined(t)||0===t.length},e.isNullOrUndefined=function(e){return null==e},e.isPrimitiveString=function(e){return"string"==typeof e},e.convertStringToBoolean=function(t){return!e.isNullOrUndefined(t)&&"true"===t.toLowerCase()},e.sanitizeUrlWithBackSlash=function(e){return e.endsWith("/")?e:e+"/"},e.getRegistrationTokenValue=function(e){var t=e.match(/registrationToken=(.+); expires=(\d+)/);return t&&t.length>=2?r.default.RegistrationTokenHeaderValue+t[1]:""},e.addQueryParametersToPath=function(t,n){var r=t;if(!e.isNullOrUndefined(n))for(var i in r.indexOf("?")>=0||(r+="?"),n)if(n.hasOwnProperty(i)){var o=i+"="+n[i];"?"!==r[r.length-1]&&(o="&"+o),r+=o}return r},e.getResponseHeader=function(t,n){var r;return e.isNullOrUndefined(t)||(r=t.headers[n]),r},e.timer=function(){var e=(new Date).getTime();return{get milliSecondsElapsed(){return(new Date).getTime()-e}}},e.concatArrays=function(t,n){e.isNullOrUndefined(t)||e.isNullOrUndefined(n)||n.forEach(function(e){t.push(e)})},e}();t.default=i},3396:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.TEXT="text",e}();t.default=n},3407:(e,t,n)=>{"use strict";var r;n.d(t,{A:()=>o});var i=new Uint8Array(16);function o(){if(!r&&!(r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(i)}},3428:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.messageContentMetadata=t.isJsonObject=t.getRuntimeId=t.isNotEmpty=t.isClientIdNotFoundErrorMessage=t.getMessageRole=t.isCustomerMessage=t.isSystemMessage=void 0;var r=n(2044),i=n(7516),o=n(7912),s=n(3136);t.isSystemMessage=function(e){var t=e.messageType,n=e.properties,r=t===i.default.UserMessage&&n&&n.tags&&n.tags.includes("system"),o=e.tags&&e.tags.includes("system");return r||o||!1},t.isCustomerMessage=function(e){var t=e.sender,n=t&&t.id&&t.id.includes("contacts/8:"),i=t&&t.displayName&&t.displayName===r.default.Customer;return n||i||!1},t.getMessageRole=function(e){var n,r=e.messageType,o=e.properties,a=e.tags,c=r===i.default.UserMessage&&(!o.tags||0===Object.keys(o.tags).length)&&a&&0===a.length,u=r===i.default.UserMessage&&(null===(n=null==o?void 0:o.tags)||void 0===n?void 0:n.includes("public"))||a&&a.includes("public");return c?s.Role.Bot:u?s.Role.Agent:(0,t.isSystemMessage)(e)?s.Role.System:(0,t.isCustomerMessage)(e)?s.Role.User:s.Role.Unknown},t.isClientIdNotFoundErrorMessage=function(e){var t,n,r;return 401===(null===(t=null==e?void 0:e.response)||void 0===t?void 0:t.status)&&"UserId not found"===(null===(r=null===(n=null==e?void 0:e.response)||void 0===n?void 0:n.headers)||void 0===r?void 0:r.message)},t.isNotEmpty=function(e){return null!=e&&""!==e.trim()},t.getRuntimeId=function(e){return null!==e&&(0,t.isNotEmpty)(e)?e:(0,o.uuidv4)()},t.isJsonObject=function(e){try{return JSON.parse(e),!0}catch(e){return!1}},t.messageContentMetadata=function(e){if(!e||0===e.length)return"0";var t=null==e?void 0:e.charAt(0),n=null==e?void 0:e.charAt((null==e?void 0:e.length)-1),r=null==e?void 0:e.length;return"".concat(t).concat(r).concat(n)}},3449:(e,t,n)=>{"use strict";n.r(t),n.d(t,{NIL:()=>w,parse:()=>d,stringify:()=>s.A,v1:()=>u,v3:()=>S,v4:()=>T.A,v5:()=>I,validate:()=>l.A,version:()=>R});var r,i,o=n(3407),s=n(8823),a=0,c=0;const u=function(e,t,n){var u=t&&n||0,l=t||new Array(16),d=(e=e||{}).node||r,h=void 0!==e.clockseq?e.clockseq:i;if(null==d||null==h){var p=e.random||(e.rng||o.A)();null==d&&(d=r=[1|p[0],p[1],p[2],p[3],p[4],p[5]]),null==h&&(h=i=16383&(p[6]<<8|p[7]))}var f=void 0!==e.msecs?e.msecs:Date.now(),g=void 0!==e.nsecs?e.nsecs:c+1,m=f-a+(g-c)/1e4;if(m<0&&void 0===e.clockseq&&(h=h+1&16383),(m<0||f>a)&&void 0===e.nsecs&&(g=0),g>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");a=f,c=g,i=h;var v=(1e4*(268435455&(f+=122192928e5))+g)%4294967296;l[u++]=v>>>24&255,l[u++]=v>>>16&255,l[u++]=v>>>8&255,l[u++]=255&v;var y=f/4294967296*1e4&268435455;l[u++]=y>>>8&255,l[u++]=255&y,l[u++]=y>>>24&15|16,l[u++]=y>>>16&255,l[u++]=h>>>8|128,l[u++]=255&h;for(var C=0;C<6;++C)l[u+C]=d[C];return t||(0,s.A)(l)};var l=n(8227);const d=function(e){if(!(0,l.A)(e))throw TypeError("Invalid UUID");var t,n=new Uint8Array(16);return n[0]=(t=parseInt(e.slice(0,8),16))>>>24,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=255&t,n[4]=(t=parseInt(e.slice(9,13),16))>>>8,n[5]=255&t,n[6]=(t=parseInt(e.slice(14,18),16))>>>8,n[7]=255&t,n[8]=(t=parseInt(e.slice(19,23),16))>>>8,n[9]=255&t,n[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,n[11]=t/4294967296&255,n[12]=t>>>24&255,n[13]=t>>>16&255,n[14]=t>>>8&255,n[15]=255&t,n};function h(e,t,n){function r(e,r,i,o){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t}(e)),"string"==typeof r&&(r=d(r)),16!==r.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var a=new Uint8Array(16+e.length);if(a.set(r),a.set(e,r.length),(a=n(a))[6]=15&a[6]|t,a[8]=63&a[8]|128,i){o=o||0;for(var c=0;c<16;++c)i[o+c]=a[c];return i}return(0,s.A)(a)}try{r.name=e}catch(e){}return r.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",r.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",r}function p(e){return 14+(e+64>>>9<<4)+1}function f(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function g(e,t,n,r,i,o){return f((s=f(f(t,e),f(r,o)))<<(a=i)|s>>>32-a,n);var s,a}function m(e,t,n,r,i,o,s){return g(t&n|~t&r,e,t,i,o,s)}function v(e,t,n,r,i,o,s){return g(t&r|n&~r,e,t,i,o,s)}function y(e,t,n,r,i,o,s){return g(t^n^r,e,t,i,o,s)}function C(e,t,n,r,i,o,s){return g(n^(t|~r),e,t,i,o,s)}const S=h("v3",48,function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var n=0;n<t.length;++n)e[n]=t.charCodeAt(n)}return function(e){for(var t=[],n=32*e.length,r="0123456789abcdef",i=0;i<n;i+=8){var o=e[i>>5]>>>i%32&255,s=parseInt(r.charAt(o>>>4&15)+r.charAt(15&o),16);t.push(s)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[p(t)-1]=t;for(var n=1732584193,r=-271733879,i=-1732584194,o=271733878,s=0;s<e.length;s+=16){var a=n,c=r,u=i,l=o;n=m(n,r,i,o,e[s],7,-680876936),o=m(o,n,r,i,e[s+1],12,-389564586),i=m(i,o,n,r,e[s+2],17,606105819),r=m(r,i,o,n,e[s+3],22,-1044525330),n=m(n,r,i,o,e[s+4],7,-176418897),o=m(o,n,r,i,e[s+5],12,1200080426),i=m(i,o,n,r,e[s+6],17,-1473231341),r=m(r,i,o,n,e[s+7],22,-45705983),n=m(n,r,i,o,e[s+8],7,1770035416),o=m(o,n,r,i,e[s+9],12,-1958414417),i=m(i,o,n,r,e[s+10],17,-42063),r=m(r,i,o,n,e[s+11],22,-1990404162),n=m(n,r,i,o,e[s+12],7,1804603682),o=m(o,n,r,i,e[s+13],12,-40341101),i=m(i,o,n,r,e[s+14],17,-1502002290),n=v(n,r=m(r,i,o,n,e[s+15],22,1236535329),i,o,e[s+1],5,-165796510),o=v(o,n,r,i,e[s+6],9,-1069501632),i=v(i,o,n,r,e[s+11],14,643717713),r=v(r,i,o,n,e[s],20,-373897302),n=v(n,r,i,o,e[s+5],5,-701558691),o=v(o,n,r,i,e[s+10],9,38016083),i=v(i,o,n,r,e[s+15],14,-660478335),r=v(r,i,o,n,e[s+4],20,-405537848),n=v(n,r,i,o,e[s+9],5,568446438),o=v(o,n,r,i,e[s+14],9,-1019803690),i=v(i,o,n,r,e[s+3],14,-187363961),r=v(r,i,o,n,e[s+8],20,1163531501),n=v(n,r,i,o,e[s+13],5,-1444681467),o=v(o,n,r,i,e[s+2],9,-51403784),i=v(i,o,n,r,e[s+7],14,1735328473),n=y(n,r=v(r,i,o,n,e[s+12],20,-1926607734),i,o,e[s+5],4,-378558),o=y(o,n,r,i,e[s+8],11,-2022574463),i=y(i,o,n,r,e[s+11],16,1839030562),r=y(r,i,o,n,e[s+14],23,-35309556),n=y(n,r,i,o,e[s+1],4,-1530992060),o=y(o,n,r,i,e[s+4],11,1272893353),i=y(i,o,n,r,e[s+7],16,-155497632),r=y(r,i,o,n,e[s+10],23,-1094730640),n=y(n,r,i,o,e[s+13],4,681279174),o=y(o,n,r,i,e[s],11,-358537222),i=y(i,o,n,r,e[s+3],16,-722521979),r=y(r,i,o,n,e[s+6],23,76029189),n=y(n,r,i,o,e[s+9],4,-640364487),o=y(o,n,r,i,e[s+12],11,-421815835),i=y(i,o,n,r,e[s+15],16,530742520),n=C(n,r=y(r,i,o,n,e[s+2],23,-995338651),i,o,e[s],6,-198630844),o=C(o,n,r,i,e[s+7],10,1126891415),i=C(i,o,n,r,e[s+14],15,-1416354905),r=C(r,i,o,n,e[s+5],21,-57434055),n=C(n,r,i,o,e[s+12],6,1700485571),o=C(o,n,r,i,e[s+3],10,-1894986606),i=C(i,o,n,r,e[s+10],15,-1051523),r=C(r,i,o,n,e[s+1],21,-2054922799),n=C(n,r,i,o,e[s+8],6,1873313359),o=C(o,n,r,i,e[s+15],10,-30611744),i=C(i,o,n,r,e[s+6],15,-1560198380),r=C(r,i,o,n,e[s+13],21,1309151649),n=C(n,r,i,o,e[s+4],6,-145523070),o=C(o,n,r,i,e[s+11],10,-1120210379),i=C(i,o,n,r,e[s+2],15,718787259),r=C(r,i,o,n,e[s+9],21,-343485551),n=f(n,a),r=f(r,c),i=f(i,u),o=f(o,l)}return[n,r,i,o]}(function(e){if(0===e.length)return[];for(var t=8*e.length,n=new Uint32Array(p(t)),r=0;r<t;r+=8)n[r>>5]|=(255&e[r/8])<<r%32;return n}(e),8*e.length))});var T=n(8562);function E(e,t,n,r){switch(e){case 0:return t&n^~t&r;case 1:case 3:return t^n^r;case 2:return t&n^t&r^n&r}}function b(e,t){return e<<t|e>>>32-t}const I=h("v5",80,function(e){var t=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var r=unescape(encodeURIComponent(e));e=[];for(var i=0;i<r.length;++i)e.push(r.charCodeAt(i))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var o=e.length/4+2,s=Math.ceil(o/16),a=new Array(s),c=0;c<s;++c){for(var u=new Uint32Array(16),l=0;l<16;++l)u[l]=e[64*c+4*l]<<24|e[64*c+4*l+1]<<16|e[64*c+4*l+2]<<8|e[64*c+4*l+3];a[c]=u}a[s-1][14]=8*(e.length-1)/Math.pow(2,32),a[s-1][14]=Math.floor(a[s-1][14]),a[s-1][15]=8*(e.length-1)&4294967295;for(var d=0;d<s;++d){for(var h=new Uint32Array(80),p=0;p<16;++p)h[p]=a[d][p];for(var f=16;f<80;++f)h[f]=b(h[f-3]^h[f-8]^h[f-14]^h[f-16],1);for(var g=n[0],m=n[1],v=n[2],y=n[3],C=n[4],S=0;S<80;++S){var T=Math.floor(S/20),I=b(g,5)+E(T,m,v,y)+C+t[T]+h[S]>>>0;C=y,y=v,v=b(m,30)>>>0,m=g,g=I}n[0]=n[0]+g>>>0,n[1]=n[1]+m>>>0,n[2]=n[2]+v>>>0,n[3]=n[3]+y>>>0,n[4]=n[4]+C>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,255&n[0],n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,255&n[1],n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,255&n[2],n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,255&n[3],n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,255&n[4]]}),w="00000000-0000-0000-0000-000000000000",R=function(e){if(!(0,l.A)(e))throw TypeError("Invalid UUID");return parseInt(e.substr(14,1),16)}},3465:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(8217),i=n(4938),o=/[xy]/g,s=null;t.EventNameAndTypeRegex=/^[a-zA-Z]([a-zA-Z0-9]|_){2,98}[a-zA-Z0-9]$/,t.EventNameDotRegex=/\./g,t.PropertyNameRegex=/^[a-zA-Z](([a-zA-Z0-9|_|\.]){0,98}[a-zA-Z0-9])?$/,t.StatsApiKey="a387cfcf60114a43a7699f9fbb49289e-9bceb9fe-1c06-460f-96c5-6a0b247358bc-7238";var a=s,c=s,u=s;function l(e){return"string"==typeof e}function d(e){return"number"==typeof e}function h(e){return"boolean"==typeof e}function p(e){return e instanceof Date}function f(e){return 1e4*(e+621355968e5)}function g(){return!("undefined"==typeof navigator||!navigator.product)&&"ReactNative"===navigator.product}function m(){return"object"==typeof self&&"ServiceWorkerGlobalScope"===self.constructor.name}function v(e){return e<10?"0"+e:e.toString()}function y(e){return void 0===e||e===s||""===e}t.numberToBondInt64=function(e){var t=new r.Int64("0");return t.low=4294967295&e,t.high=Math.floor(e/4294967296),t},t.newGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(o,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},t.isString=l,t.isNumber=d,t.isBoolean=h,t.isDate=p,t.msToTicks=f,t.getTenantId=function(e){var t=e.indexOf("-");return t>-1?e.substring(0,t):""},t.isBeaconsSupported=function(){return a===s&&(a="undefined"!=typeof navigator&&Boolean(navigator.sendBeacon)),a},t.isUint8ArrayAvailable=function(){return c===s&&(c="undefined"!=typeof Uint8Array&&!function(){if("undefined"!=typeof navigator&&navigator.userAgent){var e=navigator.userAgent.toLowerCase();if((e.indexOf("safari")>=0||e.indexOf("firefox")>=0)&&e.indexOf("chrome")<0)return!0}return!1}()&&!g()),c},t.isPriority=function(e){return!(!d(e)||!(e>=1&&e<=3||5===e))},t.sanitizeProperty=function(e,n){return!t.PropertyNameRegex.test(e)||y(n)?s:(y(n.value)&&(n={value:n,type:i.AWTPropertyType.Unspecified}),n.type=function(e,t){switch(t=function(e){return!!(d(e)&&e>=0&&e<=4)}(t)?t:i.AWTPropertyType.Unspecified,t){case i.AWTPropertyType.Unspecified:return function(e){switch(typeof e){case"string":return i.AWTPropertyType.String;case"boolean":return i.AWTPropertyType.Boolean;case"number":return i.AWTPropertyType.Double;case"object":return p(e)?i.AWTPropertyType.Date:s}return s}(e);case i.AWTPropertyType.String:return l(e)?t:s;case i.AWTPropertyType.Boolean:return h(e)?t:s;case i.AWTPropertyType.Date:return p(e)&&NaN!==e.getTime()?t:s;case i.AWTPropertyType.Int64:return d(e)&&e%1==0?t:s;case i.AWTPropertyType.Double:return d(e)?t:s}return s}(n.value,n.type),n.type?(p(n.value)&&(n.value=f(n.value.getTime())),n.pii>0&&n.cc>0?s:n.pii?d(r=n.pii)&&r>=0&&r<=13?n:s:n.cc?function(e){return!!(d(e)&&e>=0&&e<=1)}(n.cc)?n:s:n):s);var r},t.getISOString=function(e){return e.getUTCFullYear()+"-"+v(e.getUTCMonth()+1)+"-"+v(e.getUTCDate())+"T"+v(e.getUTCHours())+":"+v(e.getUTCMinutes())+":"+v(e.getUTCSeconds())+"."+(((t=e.getUTCMilliseconds())<10?"00"+t:t<100?"0"+t:t.toString())+"Z");var t},t.useXDomainRequest=function(){if(u===s){var e=new XMLHttpRequest;u=void 0===e.withCredentials&&"undefined"!=typeof XDomainRequest}return u},t.useFetchRequest=function(){return g()||m()},t.isReactNative=g,t.isServiceWorkerGlobalScope=m},3480:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uuidv4=void 0,t.uuidv4=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}},3511:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return new Promise(function(t){return setTimeout(t,e)})}},3547:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var s,a,c,u,l,d=n(3712),h=n(9812);!function(e){e.Create="Create",e.Upload="Upload"}(s||(s={})),function(e){e.CreateDocumentType="sharing/file",e.UploadDocumentType="original",e.CreateImageType="pish/image",e.UploadImageType="imgpsh"}(a||(a={})),function(e){e.Accept="Accept",e.AcceptEncoding="Accept-Encoding",e.BehaviorOverride="BehaviorOverride",e.Authorization="Authorization",e.ClientVersion="X-MS-Client-Version",e.ContentType="Content-Type"}(c||(c={})),function(e){e.applicationFormUrlEncoded="application/x-www-form-urlencoded",e.applicationJson="application/json"}(u||(u={})),function(e){e.Expired="expired",e.Failed="failed",e.InProgress="in progress",e.Malware="malware",e.Ready="ready"}(l||(l={}));var p=["image/jpeg","image/png","image/gif","image/heic","image/webp"],f=function(e){e.regionGTMS||(e.regionGTMS={ams:"https://us-api.asm.skype.com"})},g=function(e){var t;return(t={})[c.Authorization]="skype_token "+e,t[c.ClientVersion]="os=Windows; osVer=10; proc=Win32; lcid=en-us; deviceType=1; country=IN; clientName=swc; clientVer=912/0.106.0.34//swc",t},m=function(e){return e&&e.length>0?e:p},v=function(e,t,n){return m(n).includes(e.toLowerCase())?t===s.Create?a.CreateImageType:a.UploadImageType:t===s.Create?a.CreateDocumentType:a.UploadDocumentType};t.default={skypeTokenAuth:function(e){return i(void 0,void 0,void 0,function(){var t,n,r,i,s,a;return o(this,function(o){switch(o.label){case 0:d.default.debug&&console.log("[API][skypeTokenAuth]"),f(e),t=(e.amsEndpoint||(null===(a=e.regionGTMS)||void 0===a?void 0:a.ams))+"/v1/skypetokenauth",(s={})[c.Authorization]="skype_token "+e.token,s[c.Accept]=u.applicationJson,s[c.BehaviorOverride]="redirectAs404",s[c.ContentType]=u.applicationFormUrlEncoded,n={headers:s,method:"POST",body:"skypetoken="+e.token},o.label=1;case 1:return o.trys.push([1,3,,4]),[4,fetch(t,n)];case 2:if(!(r=o.sent()).ok)throw new h.AMSError("AMSAuth: "+r.status+" "+r.statusText,t);return[2,r];case 3:if(i=o.sent(),!d.default.silentError&&console.log(i),i instanceof h.AMSError)throw i;throw new h.AMSError(i.message||"AMSAuth",t,i);case 4:return[2]}})})},createObject:function(e,t,n,a){return i(void 0,void 0,void 0,function(){var i,l,p,m,y,C,S,T,E,b,I;return o(this,function(o){switch(o.label){case 0:d.default.debug&&console.log("[API][createObject]"),(E={})[e]=["read"],i=E,l=v(t.type,s.Create,a),p={filename:t.name,permissions:i,type:l},f(n),m=(n.amsEndpoint||(null===(I=null==n?void 0:n.regionGTMS)||void 0===I?void 0:I.ams))+"/v1/objects",y=r(r({},g(n.token)),((b={})[c.ContentType]=u.applicationJson,b)),C={headers:y,method:"POST",body:JSON.stringify(p),credentials:"include"},o.label=1;case 1:return o.trys.push([1,4,,5]),[4,fetch(m,C)];case 2:if(!(S=o.sent()).ok)throw new h.AMSError("AMSCreateObjectFailed: "+S.status+" "+S.statusText,m);return[4,S.json()];case 3:return[2,o.sent()];case 4:if(T=o.sent(),!d.default.silentError&&console.log(T),T instanceof h.AMSError)throw T;throw new h.AMSError(T.message||"AMSCreateObjectFailed",m,T);case 5:return[2]}})})},uploadDocument:function(e,t,n,a){return i(void 0,void 0,void 0,function(){var i,l,p,m,y,C,S,T;return o(this,function(o){switch(o.label){case 0:d.default.debug&&console.log("[API][uploadDocument]"),f(n),i=v(t.type,s.Upload,a),l=(n.amsEndpoint||(null===(T=null==n?void 0:n.regionGTMS)||void 0===T?void 0:T.ams))+"/v1/objects/"+e+"/content/"+i,p=r(r({},g(n.token)),((S={})[c.ContentType]=u.applicationFormUrlEncoded,S)),m={headers:p,method:"PUT",body:t.data?t.data:t},o.label=1;case 1:return o.trys.push([1,3,,4]),[4,fetch(l,m)];case 2:if(!(y=o.sent()).ok)throw new h.AMSError("AMSUploadDocumentFailed: "+y.status+" "+y.statusText,l);return[2,{name:t.name,size:t.size,type:t.type,id:e,url:l,fileSharingProtocolType:0}];case 3:if(C=o.sent(),!d.default.silentError&&console.log(C),C instanceof h.AMSError)throw C;throw new h.AMSError(C.message||"AMSUploadDocumentFailed",l,C);case 4:return[2]}})})},getViewStatus:function(e,t,n){return i(void 0,void 0,void 0,function(){var r,i,s,a,c,u,p,v;return o(this,function(o){switch(o.label){case 0:d.default.debug&&console.log("[API][getViewStatus]"),f(t),r=(t.amsEndpoint||(null===(v=null==t?void 0:t.regionGTMS)||void 0===v?void 0:v.ams))+"/v1/objects/"+e.id+"/views/"+(m(n).includes(e.type)?"imgpsh_fullsize_anim":"original")+"/status",i=g(t.token),s={headers:i,method:"GET"},o.label=1;case 1:return o.trys.push([1,4,,5]),[4,fetch(r,s)];case 2:return[4,o.sent().json()];case 3:if(a=o.sent(),c=a.content_state,u=a.view_state,!a.view_location)throw new h.AMSError("view_location is empty",r);if(u&&u!==l.Ready.toString()&&!d.default.silentError&&console.error("view_state is not ready"),c===l.Expired.toString())throw new h.AMSError("content_state is expired",r);return[2,a];case 4:if(p=o.sent(),!d.default.silentError&&console.log(p),p instanceof h.AMSError)throw p;throw new h.AMSError(p.message||"AMSGetViewStatusFailed",r,p);case 5:return[2]}})})},getView:function(e,t,n,r){return i(void 0,void 0,void 0,function(){var i,s,a,u;return o(this,function(o){switch(o.label){case 0:d.default.debug&&console.log("[API][getView]"),f(n),i=t,s=g(n.token),m(r).includes(e.type)&&(s[c.Accept]="image/webp,image/ *,*/*;q=0.8",s[c.AcceptEncoding]="gzip, deflate, sdch, br"),a={headers:s,method:"GET"},o.label=1;case 1:return o.trys.push([1,4,,5]),[4,fetch(i,a)];case 2:return[4,o.sent().blob()];case 3:return[2,o.sent()];case 4:throw u=o.sent(),!d.default.silentError&&console.log(u),new h.AMSError(u.message||"AMSGetViewFailed",i,u);case 5:return[2]}})})}}},3570:(e,t,n)=>{"use strict";var r=n(4994);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(7383)),o=r(n(4579)),s=function(){function e(){(0,i.default)(this,e)}return(0,o.default)(e,null,[{key:"OCSDKLOAD",get:function(){return"oc:sdk:load"}}]),e}();t.default=s},3588:function(e,t){"use strict";var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},n.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.debug=!1,this.debug=!1,this.logger=e}return e.prototype.setDebug=function(e){this.debug=e},e.prototype.log=function(e,t,r){var i,o=n({Event:t},r);this.debug&&console.log(o),null===(i=this.logger)||void 0===i||i.logClientSdkTelemetryEvent(e,o)},e}();t.default=r},3659:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.NewMessage="NewMessage",e.MessageUpdate="MessageUpdate",e.UserPresence="UserPresence",e.ConversationUpdate="ConversationUpdate",e.ThreadUpdate="ThreadUpdate",e}();t.default=n},3677:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultChatSDKConfig=void 0;var r={dataMasking:{disable:!1,maskingCharacter:"#"},telemetry:{disable:!1,ariaTelemetryKey:n(4736).ariaTelemetryKey},persistentChat:{disable:!0,tokenUpdateTime:216e5},chatReconnect:{disable:!0},useCreateConversation:{disable:!1}};t.defaultChatSDKConfig=r,t.default=function(e){var t,n;e.dataMasking&&("boolean"!=typeof(t=e.dataMasking).disable&&(t.disable=r.dataMasking.disable),"string"==typeof t.maskingCharacter&&1===t.maskingCharacter.length||(t.maskingCharacter=r.dataMasking.maskingCharacter)),e.persistentChat&&("number"==typeof(n=e.persistentChat).tokenUpdateTime&&n.tokenUpdateTime||(n.tokenUpdateTime=r.persistentChat.tokenUpdateTime))}},3693:(e,t,n)=>{var r=n(7736);e.exports=function(e,t,n){return(t=r(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},e.exports.__esModule=!0,e.exports.default=e.exports},3712:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.silentError=!0,e.debug=!1,e}();t.default=n},3738:e=>{function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},3770:(e,t,n)=>{const r=n(2950).Ay;e.exports=r,e.exports.default=r},3790:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebSocketMessagePrinter=void 0;var r=n(2698),i=n(3428),o=function(){function e(){}return e.printify=function(e){var t,n,o,s={};return e&&(s.id=e.id,s.tags=(null===(t=null==e?void 0:e.metadata)||void 0===t?void 0:t.tags)?e.metadata.tags.replace(/"/g,"").split(",").filter(function(e){return e.length>0}):[],s.bot=!(null===(o=null===(n=null==e?void 0:e.metadata)||void 0===n?void 0:n.tags)||void 0===o?void 0:o.includes("public")),s.card=Object.values(r.SupportedAdaptiveCards).some(function(t){var n;return null===(n=null==e?void 0:e.message)||void 0===n?void 0:n.includes(t)}),!s.card&&(null==e?void 0:e.message)&&(s.content=(0,i.messageContentMetadata)(null==e?void 0:e.message)),s.created=e.createdOn),s},e}();t.WebSocketMessagePrinter=o},3843:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(4746),c=n(4372),u=n(2343),l=n(8688),d=n(9362),h=n(8247),p=n(5719),f=n(1659),g=n(9305),m=n(7767),v=n(3659),y=n(7145),C=n(3943),S=n(3364),T=function(e){function t(t,n){var r=e.call(this,t)||this;return r.debug&&console.debug("IC3Core/Constructor"),r.protocolType=g.default.IC3V1SDK,r.hostType=n,r.ic3Initializer=new d.default,r}return i(t,e),t.prototype.startPolling=function(){e.prototype.startPolling.call(this)},t.prototype.stopPolling=function(){e.prototype.stopPolling.call(this)},t.prototype.setup=function(t){return e.prototype.setup.call(this,t)},t.prototype.initialize=function(t){var n=this;return e.prototype.initialize.call(this,t).then(function(){var e;return null===(e=n.ic3Initializer)||void 0===e?void 0:e.setup(n.logger).then(function(){return n.setSkypeTokenCookie()}).then(function(){var e;return null===(e=n.ic3Initializer)||void 0===e?void 0:e.setIc3Info(n.ic3Info)}).then(function(){var e;return null===(e=n.ic3Initializer)||void 0===e?void 0:e.initializeIC3(n.handlePollData.bind(n))}).then(function(e){n.ic3Info=e})})},t.prototype.update=function(t){var n=this;return e.prototype.update.call(this,t).then(function(){var e;return e={RegionGtms:t.regionGtms,SkypeToken:t.token,visitor:t.visitor},n.updateToken(e)})},t.prototype.dispose=function(){var e;return o(this,void 0,void 0,function(){return s(this,function(t){return null===(e=this.ic3Initializer)||void 0===e||e.stopPolling(),this.heartBeatTimer&&clearInterval(this.heartBeatTimer),Promise.resolve(),[2]})})},t.prototype.joinConversation=function(t,n){var r=this,i=S.default.timer();return e.prototype.joinConversation.call(this,t,n).then(function(e){return r.getThreadRequest(e.id).then(function(n){return r.internalConversationsData[e.id]={id:t,members:n.members},e}).catch(function(n){var o=i.milliSecondsElapsed;return r.logger&&r.logger.log(f.default.WARN,h.default.JoinConversationV1GetThreadRequestFailed,{Description:"Unable to retrieve thread: "+n,ElapsedTimeInMilliseconds:o,EndpointUrl:r.EndpointUrl,EndpointId:r.ic3Info.endpointId}),r.internalConversationsData[e.id]={id:t,members:[]},e})})},t.prototype.sendMessage=function(t,n){return e.prototype.sendMessage.call(this,t,n)},t.prototype.sendFileMessage=function(t,n,r){return e.prototype.sendFileMessage.call(this,t,n,r)},t.prototype.getMessages=function(t){return e.prototype.getMessages.call(this,t)},t.prototype.registerOnNewMessage=function(t,n){return e.prototype.registerOnNewMessage.call(this,t,n)},t.prototype.registerOnThreadUpdate=function(t,n){return e.prototype.registerOnThreadUpdate.call(this,t,n)},t.prototype.disconnectFromConversation=function(t){return e.prototype.disconnectFromConversation.call(this,t)},t.prototype.setSkypeTokenCookie=function(){var e=this.ic3Info.RegionGtms.ams.concat(a.default.skypeTokenAuthURL),t=m.default.getDefaultBaseIC3Headers();t[c.default.ContentTypeHeader]=a.default.ContentTypeForm;var n={data:a.default.skypeTokenConstantForData+this.ic3Info.SkypeToken,enableExponentialBackoff:!0,useXHRWithCredentials:!0,headers:t,redirect404RetryCount:a.default.retryCount,retryCount:a.default.retryCount,shouldRedirectOn404:!1,shouldResetOnFailure:!1,shouldRetryOnFailure:C.default.shouldRetryOnFailure,timeBetweenRetry:a.default.timeBetweenOperationRetry,type:u.default.POST,url:e};return p.HttpClient.MakeRequest(n)},t.prototype.getThreadRequest=function(e){var t=y.default.getThreadUrl(e,this.ic3Info.RegionGtms),n=m.default.getDefaultBaseIC3Headers();n[c.default.RegistrationTokenHeader]=this.ic3Info.RegistrationToken;var r={enableExponentialBackoff:!0,headers:n,redirect404RetryCount:a.default.retryCount,retryCount:a.default.retryCount,shouldRedirectOn404:!0,shouldRetryOnFailure:C.default.shouldRetryOnFailure,timeBetweenRetry:a.default.timeBetweenOperationRetry,type:u.default.GET,url:t};return p.HttpClient.MakeRequest(r)},t.prototype.newMessageReceived=function(t,n,r){e.prototype.onNewMessage.call(this,t,n,r)},t.prototype.newThreadUpdate=function(t,n){e.prototype.onThreadUpdate.call(this,t,n)},t.prototype.handleNewMessageEvent=function(e){var t;t=e.resource&&e.resource.conversationid?e.resource.conversationid:e.resource.conversationLink?C.default.getConversationIdFromUrl(e.resource.conversationLink):C.default.getConversationIdFromUrl(e.resourceLink);var n=this.conversations.findIndex(function(e){return e.id===t}),r=this.conversations[n];this.newMessageReceived(r,e.resource,e.resourceType)},t.prototype.handleConversationUpdateEvent=function(e){e.resourceType,v.default.ConversationUpdate},t.prototype.handleThreadUpdate=function(e){if(e.resourceType===v.default.ThreadUpdate){var t;t=e.resource&&e.resource.id?e.resource.id:e.resource.messages?C.default.getConversationIdFromUrl(e.resource.messages):C.default.getConversationIdFromUrl(e.resourceLink);var n=this.conversations.findIndex(function(e){return e.id===t}),r=this.conversations[n];this.newThreadUpdate(r,e.resource)}},t.prototype.handlePollData=function(e){if(e&&e.eventMessages)for(var t=0,n=e.eventMessages;t<n.length;t++){var r=n[t];this.handlePollEventMessage(r)}},t.prototype.handlePollEventMessage=function(e){e.resourceType===v.default.NewMessage||e.resourceType===v.default.MessageUpdate?this.handleNewMessageEvent(e):e.resourceType===v.default.ThreadUpdate?this.handleThreadUpdate(e):e.resourceType===v.default.ConversationUpdate&&this.handleConversationUpdateEvent(e)},t.prototype.updateToken=function(e){return o(this,void 0,void 0,function(){var t,n,r,i,o,a,c,u,l,p,g=this;return s(this,function(s){switch(s.label){case 0:return this.logger&&this.logger.log(f.default.INFO,h.default.UpdateToken,{EndpointUrl:this.EndpointUrl,EndpointId:this.ic3Info.endpointId}),t=[],n=function(e){e&&e.eventMessages&&S.default.concatArrays(t,e.eventMessages)},r=[],i=function(e){e&&e.eventMessages&&S.default.concatArrays(r,e.eventMessages)},o=this.ic3Initializer,a=new d.default,c=this.updateTokenClearTimeoutHandle,u=this.ic3Info,o.getPoller().onNewData=n,this.logger?[4,a.setup(this.logger)]:[3,2];case 1:s.sent(),s.label=2;case 2:return[2,a.setIc3Info(e).then(function(){return a.initializeIC3(i)}).then(function(e){l=e}).then(function(){return g.getMatchingIC3EventIndex(t,r)}).then(function(e){p=e}).then(function(){return o.reset(!0)}).then(function(){return g.syncPollingData(t,r,p)}).then(function(){g.ic3Info=l,g.ic3Initializer=a,g.ic3Initializer.getPoller().onNewData=g.handlePollData.bind(g)}).catch(function(e){throw g.updateTokenClearTimeoutHandle!==c&&(clearTimeout(g.updateTokenClearTimeoutHandle),g.updateTokenClearTimeoutHandle=c),g.ic3Info=u,g.ic3Initializer.getPoller().onNewData=g.handlePollData.bind(g),g.ic3Initializer.getPoller().start(),new Error("Update token failed: "+(e&&e.message))})]}})})},t.prototype.getMatchingIC3EventIndex=function(e,t,n){var r=this;return new Promise(function(i,o){if((n=n||0)===a.default.stabilizePollMaxRetryCount)i({newPollIndex:-1,previousPollIndex:-1});else{for(var s=0,c=0;s<e.length&&c<t.length;){var u=e[s],l=t[c];if(u.time===l.time)return void i({newPollIndex:c,previousPollIndex:s});new Date(u.time)<new Date(u.time)?s++:c++}setTimeout(function(){r.getMatchingIC3EventIndex(e,t,n+1).then(function(e){i(e)}).catch(function(e){o(e)})},a.default.timeBetweenStabilizingPoll)}})},t.prototype.syncPollingData=function(e,t,n){this.logger&&this.logger.log(f.default.INFO,h.default.SyncingPollData,{EndpointUrl:this.EndpointUrl,EndpointId:this.ic3Info.endpointId});var r=n.previousPollIndex,i=n.newPollIndex+1;-1===n.previousPollIndex&&-1===n.newPollIndex&&(r=e.length-1,i=0);for(var o=0;o<=r;o++)this.handlePollEventMessage(e[o]);for(o=i;o<t.length;o++)this.handlePollEventMessage(t[o])},t}(l.default);t.default=T},3893:(e,t,n)=>{"use strict";n.r(t),n.d(t,{RestError:()=>He,agentPolicy:()=>je,agentPolicyName:()=>qe,auxiliaryAuthenticationHeaderPolicy:()=>Et,auxiliaryAuthenticationHeaderPolicyName:()=>Ct,bearerTokenAuthenticationPolicy:()=>gt,bearerTokenAuthenticationPolicyName:()=>lt,createDefaultHttpClient:()=>Qe,createEmptyPipeline:()=>X,createFile:()=>Ie,createFileFromStream:()=>be,createHttpHeaders:()=>Ye,createPipelineFromOptions:()=>Xe,createPipelineRequest:()=>Ze,decompressResponsePolicy:()=>ke,decompressResponsePolicyName:()=>Oe,defaultRetryPolicy:()=>_e,exponentialRetryPolicy:()=>tt,exponentialRetryPolicyName:()=>et,formDataPolicy:()=>Me,formDataPolicyName:()=>Pe,getDefaultProxySettings:()=>Ne,isRestError:()=>Ve,logPolicy:()=>ue,logPolicyName:()=>ce,multipartPolicy:()=>Ae,multipartPolicyName:()=>Re,ndJsonPolicy:()=>yt,ndJsonPolicyName:()=>vt,proxyPolicy:()=>xe,proxyPolicyName:()=>De,redirectPolicy:()=>de,redirectPolicyName:()=>le,retryPolicy:()=>at,setClientRequestIdPolicy:()=>Le,setClientRequestIdPolicyName:()=>Ue,systemErrorRetryPolicy:()=>rt,systemErrorRetryPolicyName:()=>nt,throttlingRetryPolicy:()=>ot,throttlingRetryPolicyName:()=>it,tlsPolicy:()=>Be,tlsPolicyName:()=>Fe,tracingPolicy:()=>Ke,tracingPolicyName:()=>We,userAgentPolicy:()=>ve,userAgentPolicyName:()=>me});class r extends Error{constructor(e){super(e),this.name="AbortError"}}var i=n(4424);function o(e){return e.toLowerCase()}class s{_headersMap;constructor(e){if(this._headersMap=new Map,e)for(const t of Object.keys(e))this.set(t,e[t])}set(e,t){this._headersMap.set(o(e),{name:e,value:String(t).trim()})}get(e){return this._headersMap.get(o(e))?.value}has(e){return this._headersMap.has(o(e))}delete(e){this._headersMap.delete(o(e))}toJSON(e={}){const t={};if(e.preserveCase)for(const e of this._headersMap.values())t[e.name]=e.value;else for(const[e,n]of this._headersMap)t[e]=n.value;return t}toString(){return JSON.stringify(this.toJSON({preserveCase:!0}))}[Symbol.iterator](){return function*(e){for(const t of e.values())yield[t.name,t.value]}(this._headersMap)}}function a(e){return new s(e)}var c=n(5641);class u{url;method;headers;timeout;withCredentials;body;multipartBody;formData;streamResponseStatusCodes;enableBrowserStreams;proxySettings;disableKeepAlive;abortSignal;requestId;allowInsecureConnection;onUploadProgress;onDownloadProgress;requestOverrides;authSchemes;constructor(e){this.url=e.url,this.body=e.body,this.headers=e.headers??a(),this.method=e.method??"GET",this.timeout=e.timeout??0,this.multipartBody=e.multipartBody,this.formData=e.formData,this.disableKeepAlive=e.disableKeepAlive??!1,this.proxySettings=e.proxySettings,this.streamResponseStatusCodes=e.streamResponseStatusCodes,this.withCredentials=e.withCredentials??!1,this.abortSignal=e.abortSignal,this.onUploadProgress=e.onUploadProgress,this.onDownloadProgress=e.onDownloadProgress,this.requestId=e.requestId||(0,c.N)(),this.allowInsecureConnection=e.allowInsecureConnection??!1,this.enableBrowserStreams=e.enableBrowserStreams??!1,this.requestOverrides=e.requestOverrides,this.authSchemes=e.authSchemes}}const l=new Set(["Deserialize","Serialize","Retry","Sign"]);class d{_policies=[];_orderedPolicies;constructor(e){this._policies=e?.slice(0)??[],this._orderedPolicies=void 0}addPolicy(e,t={}){if(t.phase&&t.afterPhase)throw new Error("Policies inside a phase cannot specify afterPhase.");if(t.phase&&!l.has(t.phase))throw new Error(`Invalid phase name: ${t.phase}`);if(t.afterPhase&&!l.has(t.afterPhase))throw new Error(`Invalid afterPhase name: ${t.afterPhase}`);this._policies.push({policy:e,options:t}),this._orderedPolicies=void 0}removePolicy(e){const t=[];return this._policies=this._policies.filter(n=>!(e.name&&n.policy.name===e.name||e.phase&&n.options.phase===e.phase)||(t.push(n.policy),!1)),this._orderedPolicies=void 0,t}sendRequest(e,t){return this.getOrderedPolicies().reduceRight((e,t)=>n=>t.sendRequest(n,e),t=>e.sendRequest(t))(t)}getOrderedPolicies(){return this._orderedPolicies||(this._orderedPolicies=this.orderPolicies()),this._orderedPolicies}clone(){return new d(this._policies)}static create(){return new d}orderPolicies(){const e=[],t=new Map;function n(e){return{name:e,policies:new Set,hasRun:!1,hasAfterPolicies:!1}}const r=n("Serialize"),i=n("None"),o=n("Deserialize"),s=n("Retry"),a=n("Sign"),c=[r,i,o,s,a];function u(e){return"Retry"===e?s:"Serialize"===e?r:"Deserialize"===e?o:"Sign"===e?a:i}for(const e of this._policies){const n=e.policy,r=e.options,i=n.name;if(t.has(i))throw new Error("Duplicate policy names not allowed in pipeline");const o={policy:n,dependsOn:new Set,dependants:new Set};r.afterPhase&&(o.afterPhase=u(r.afterPhase),o.afterPhase.hasAfterPolicies=!0),t.set(i,o),u(r.phase).policies.add(o)}for(const e of this._policies){const{policy:n,options:r}=e,i=n.name,o=t.get(i);if(!o)throw new Error(`Missing node for policy ${i}`);if(r.afterPolicies)for(const e of r.afterPolicies){const n=t.get(e);n&&(o.dependsOn.add(n),n.dependants.add(o))}if(r.beforePolicies)for(const e of r.beforePolicies){const n=t.get(e);n&&(n.dependsOn.add(o),o.dependants.add(n))}}function l(n){n.hasRun=!0;for(const r of n.policies)if((!r.afterPhase||r.afterPhase.hasRun&&!r.afterPhase.policies.size)&&0===r.dependsOn.size){e.push(r.policy);for(const e of r.dependants)e.dependsOn.delete(r);t.delete(r.policy.name),n.policies.delete(r)}}function d(){for(const e of c){if(l(e),e.policies.size>0&&e!==i)return void(i.hasRun||l(i));e.hasAfterPolicies&&l(i)}}let h=0;for(;t.size>0;){h++;const t=e.length;if(d(),e.length<=t&&h>1)throw new Error("Cannot satisfy policy dependencies due to requirements cycle.")}return e}}var h=n(6276);const p=Symbol();var f=n(5513);const g=new f.I;class m extends Error{static REQUEST_SEND_ERROR="REQUEST_SEND_ERROR";static PARSE_ERROR="PARSE_ERROR";code;statusCode;request;response;details;constructor(e,t={}){super(e),this.name="RestError",this.code=t.code,this.statusCode=t.statusCode,Object.defineProperty(this,"request",{value:t.request,enumerable:!1}),Object.defineProperty(this,"response",{value:t.response,enumerable:!1});const n=this.request?.agent?{maxFreeSockets:this.request.agent.maxFreeSockets,maxSockets:this.request.agent.maxSockets}:void 0;Object.defineProperty(this,p,{value:()=>`RestError: ${this.message} \n ${g.sanitize({...this,request:{...this.request,agent:n},response:this.response})}`,enumerable:!1}),Object.setPrototypeOf(this,m.prototype)}}var v=n(8208);function y(e){return Boolean(e&&"function"==typeof e.getReader&&"function"==typeof e.tee)}function C(e){if(e.buffer instanceof ArrayBuffer&&0===e.byteOffset&&e.byteLength===e.buffer.byteLength)return e.buffer;const t=new ArrayBuffer(e.byteLength),n=new Uint8Array(t),r=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);return n.set(r),n.buffer}class S{async sendRequest(e){if("https:"!==new URL(e.url).protocol&&!e.allowInsecureConnection)throw new Error(`Cannot connect to ${e.url} while allowInsecureConnection is false.`);if(e.proxySettings)throw new Error("HTTP proxy is not supported in browser environment");try{return await async function(e){const{abortController:t,abortControllerCleanup:n}=function(e){const t=new AbortController;let n,i;if(e.abortSignal){if(e.abortSignal.aborted)throw new r("The operation was aborted. Request has already been canceled.");i=e=>{"abort"===e.type&&t.abort()},e.abortSignal.addEventListener("abort",i),n=()=>{i&&e.abortSignal?.removeEventListener("abort",i)}}return e.timeout>0&&setTimeout(()=>{t.abort()},e.timeout),{abortController:t,abortControllerCleanup:n}}(e);try{const r=function(e){const t=new Headers;for(const[n,r]of e)t.append(n,r);return t}(e.headers),{streaming:o,body:s}=function(e){const t="function"==typeof e.body?e.body():e.body;if(n=t,Boolean(n&&"function"==typeof n.pipe))throw new Error("Node streams are not supported in browser environment.");var n;return y(t)?{streaming:!0,body:T(t,{onProgress:e.onUploadProgress})}:"object"==typeof t&&t&&"buffer"in t?{streaming:!1,body:C(t)}:void 0===t?{streaming:!1}:{streaming:!1,body:t}}(e),c={body:s,method:e.method,headers:r,signal:t.signal,..."credentials"in Request.prototype?{credentials:e.withCredentials?"include":"same-origin"}:{},..."cache"in Request.prototype?{cache:"no-store"}:{}};o&&(c.duplex="half");const u=await fetch(e.url,{...c,...e.requestOverrides});return i=e.body,("function"==typeof Blob||"object"==typeof Blob)&&i instanceof Blob&&e.onUploadProgress&&e.onUploadProgress({loadedBytes:e.body.size}),async function(e,t,n){const r=function(e){const t=a();for(const[n,r]of e.headers)t.set(n,r);return t}(e),i={request:t,headers:r,status:e.status},o=y(e.body)?T(e.body,{onProgress:t.onDownloadProgress,onEnd:n}):e.body;if(t.streamResponseStatusCodes?.has(Number.POSITIVE_INFINITY)||t.streamResponseStatusCodes?.has(i.status))if(t.enableBrowserStreams)i.browserStreamBody=o??void 0;else{const e=new Response(o);i.blobBody=e.blob(),n?.()}else{const e=new Response(o);i.bodyAsText=await e.text(),n?.()}return i}(u,e,n)}catch(e){throw n?.(),e}var i}(e)}catch(t){throw function(e,t){return e&&"AbortError"===e?.name?e:new m(`Error sending request: ${e.message}`,{code:e?.code??m.REQUEST_SEND_ERROR,request:t})}(t,e)}}}function T(e,t={}){let n=0;const{onProgress:r,onEnd:i}=t;if(function(e){return void 0!==e.pipeThrough&&void 0!==self.TransformStream}(e))return e.pipeThrough(new TransformStream({transform(e,t){null!==e?(t.enqueue(e),n+=e.length,r&&r({loadedBytes:n})):t.terminate()},flush(){i?.()}}));{const t=e.getReader();return new ReadableStream({async pull(e){const{done:o,value:s}=await t.read();if(o||!s)return i?.(),e.close(),void t.releaseLock();n+=s?.length??0,e.enqueue(s),r&&r({loadedBytes:n})},cancel:e=>(i?.(),t.cancel(e))})}}const E=(0,i.KV)("ts-http-runtime"),b="logPolicy";var I=n(4953);const w="The operation was aborted.";function R(e,t,n){return new Promise((i,o)=>{let s,a;const c=()=>o(new r(n?.abortErrorMsg?n?.abortErrorMsg:w)),u=()=>{n?.abortSignal&&a&&n.abortSignal.removeEventListener("abort",a)};if(a=()=>(s&&clearTimeout(s),u(),c()),n?.abortSignal&&n.abortSignal.aborted)return c();s=setTimeout(()=>{u(),i(t)},e),n?.abortSignal&&n.abortSignal.addEventListener("abort",a)})}function A(e,t){const n=e.headers.get(t);if(!n)return;const r=Number(n);return Number.isNaN(r)?void 0:r}const O="Retry-After",k=["retry-after-ms","x-ms-retry-after-ms",O];function _(e){if(e&&[429,503].includes(e.status))try{for(const t of k){const n=A(e,t);if(0===n||n)return n*(t===O?1e3:1)}const t=e.headers.get(O);if(!t)return;const n=Date.parse(t)-Date.now();return Number.isFinite(n)?Math.max(0,n):void 0}catch{return}}function P(){return{name:"throttlingRetryStrategy",retry({response:e}){const t=_(e);return Number.isFinite(t)?{retryAfterInMs:t}:{skipStrategy:!0}}}}const M=1e3,D=64e3;function N(e={}){const t=e.retryDelayInMs??M,n=e.maxRetryDelayInMs??D;return{name:"exponentialRetryStrategy",retry({retryCount:r,response:i,responseError:o}){const s=!!(d=o)&&("ETIMEDOUT"===d.code||"ESOCKETTIMEDOUT"===d.code||"ECONNREFUSED"===d.code||"ECONNRESET"===d.code||"ENOENT"===d.code||"ENOTFOUND"===d.code),a=s&&e.ignoreSystemErrors,c=function(e){return Boolean(e&&void 0!==e.status&&(e.status>=500||408===e.status)&&501!==e.status&&505!==e.status)}(i),u=c&&e.ignoreHttpStatusCodes,l=i&&(function(e){return Number.isFinite(_(e))}(i)||!c);var d;return l||u||a?{skipStrategy:!0}:!o||s||c?(0,I.g)(r,{retryDelayInMs:t,maxRetryDelayInMs:n}):{errorToThrow:o}}}}const x=3,U=(0,i.KV)("ts-http-runtime retryPolicy"),L="retryPolicy";function q(e,t={maxRetries:x}){const n=t.logger||U;return{name:L,async sendRequest(i,o){let s,a,c=-1;e:for(;;){c+=1,s=void 0,a=void 0;try{n.info(`Retry ${c}: Attempting to send request`,i.requestId),s=await o(i),n.info(`Retry ${c}: Received a response from request`,i.requestId)}catch(e){if(n.error(`Retry ${c}: Received an error from request`,i.requestId),a=e,!e||"RestError"!==a.name)throw e;s=a.response}if(i.abortSignal?.aborted)throw n.error(`Retry ${c}: Request aborted.`),new r;if(c>=(t.maxRetries??x)){if(n.info(`Retry ${c}: Maximum retries reached. Returning the last received response, or throwing the last received error.`),a)throw a;if(s)return s;throw new Error("Maximum retries reached with no response or error to throw")}n.info(`Retry ${c}: Processing ${e.length} retry strategies.`);t:for(const t of e){const e=t.logger||n;e.info(`Retry ${c}: Processing retry strategy ${t.name}.`);const r=t.retry({retryCount:c,response:s,responseError:a});if(r.skipStrategy){e.info(`Retry ${c}: Skipped.`);continue t}const{errorToThrow:o,retryAfterInMs:u,redirectTo:l}=r;if(o)throw e.error(`Retry ${c}: Retry strategy ${t.name} throws error:`,o),o;if(u||0===u){e.info(`Retry ${c}: Retry strategy ${t.name} retries after ${u}`),await R(u,void 0,{abortSignal:i.abortSignal});continue e}if(l){e.info(`Retry ${c}: Retry strategy ${t.name} redirects to ${l}`),i.url=l;continue e}}if(a)throw n.info("None of the retry strategies could work with the received error. Throwing it."),a;if(s)return n.info("None of the retry strategies could work with the received response. Returning it."),s}}}}const j="defaultRetryPolicy";var F=n(369);const B="formDataPolicy";async function G(e){if(e instanceof Blob||e instanceof Uint8Array)return e;if(y(e))return new Response(e).blob();throw new Error("Unsupported source type. Only Blob, Uint8Array, and ReadableStream are supported in browser.")}function H(e){return"resize"in e.buffer?e:e.map(e=>e)}function V(e){let t="";for(const[n,r]of e)t+=`${n}: ${r}\r\n`;return t}function z(e){return e instanceof Uint8Array?e.byteLength:"function"==typeof e.stream?-1===e.size?void 0:e.size:void 0}const W="multipartPolicy",K=70,$=new Set("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'()+,-./:=?");function J(){return{name:W,async sendRequest(e,t){if(!e.multipartBody)return t(e);if(e.body)throw new Error("multipartBody and regular body cannot be set at the same time");let n=e.multipartBody.boundary;const r=e.headers.get("Content-Type")??"multipart/mixed",i=r.match(/^(multipart\/[^ ;]+)(?:; *boundary=(.+))?$/);if(!i)throw new Error(`Got multipart request body, but content-type header was not multipart: ${r}`);const[,o,s]=i;if(s&&n&&s!==n)throw new Error(`Multipart boundary was specified as ${s} in the header, but got ${n} in the request body`);return n??=s,n?function(e){if(e.length>K)throw new Error(`Multipart boundary "${e}" exceeds maximum length of 70 characters`);if(Array.from(e).some(e=>!$.has(e)))throw new Error(`Multipart boundary "${e}" contains invalid characters`)}(n):n=`----AzSDKFormBoundary${(0,c.N)()}`,e.headers.set("Content-Type",`${o}; boundary=${n}`),await async function(e,t,n){const r=[(0,v.Al)(`--${n}`,"utf-8"),...t.flatMap(e=>[(0,v.Al)("\r\n","utf-8"),(0,v.Al)(V(e.headers),"utf-8"),(0,v.Al)("\r\n","utf-8"),e.body,(0,v.Al)(`\r\n--${n}`,"utf-8")]),(0,v.Al)("--\r\n\r\n","utf-8")],i=function(e){let t=0;for(const n of e){const e=z(n);if(void 0===e)return;t+=e}return t}(r);i&&e.headers.set("Content-Length",i),e.body=await async function(e){const t=[];for(const n of e){const e=await G("function"==typeof n?n():n);e instanceof Blob?t.push(e):t.push(new Blob([H(e)]))}return new Blob(t)}(r)}(e,e.multipartBody.parts,n),e.multipartBody=void 0,t(e)}}}function X(){return d.create()}var Q=n(4299);const Y=(0,Q.KV)("core-rest-pipeline"),Z="agentPolicy",ee="systemErrorRetryPolicy",te="throttlingRetryPolicy",ne="proxyPolicy is not supported in browser environment",re="redirectPolicy",ie=["GET","HEAD"];function oe(e={}){const{maxRetries:t=20}=e;return{name:re,async sendRequest(e,n){const r=await n(e);return se(n,r,t)}}}async function se(e,t,n,r=0){const{request:i,status:o,headers:s}=t,a=s.get("location");if(a&&(300===o||301===o&&ie.includes(i.method)||302===o&&ie.includes(i.method)||303===o&&"POST"===i.method||307===o)&&r<n){const t=new URL(a,i.url);i.url=t.toString(),303===o&&(i.method="GET",i.headers.delete("Content-Length"),delete i.body),i.headers.delete("Authorization");const s=await e(i);return se(e,s,n,r+1)}return t}const ae="tlsPolicy",ce=b;function ue(e={}){return function(e={}){const t=e.logger??E.info,n=new f.I({additionalAllowedHeaderNames:e.additionalAllowedHeaderNames,additionalAllowedQueryParameters:e.additionalAllowedQueryParameters});return{name:b,async sendRequest(e,r){if(!t.enabled)return r(e);t(`Request: ${n.sanitize(e)}`);const i=await r(e);return t(`Response status code: ${i.status}`),t(`Headers: ${n.sanitize(i.headers)}`),i}}}({logger:Y.info,...e})}const le=re;function de(e={}){return oe(e)}const he="1.22.2",pe=3;async function fe(e){const t=new Map;t.set("core-rest-pipeline",he),await async function(e){const t=globalThis.navigator;let n="unknown";if(t?.userAgentData){const r=await t.userAgentData.getHighEntropyValues(["architecture","platformVersion"]);n=`${r.platform} ${r.platformVersion}; ${r.architecture}`;const i=function(e){const t=["Google Chrome","Microsoft Edge","Opera","Brave","Chromium"];for(const n of t){const t=e.find(e=>e.brand===n);if(t)return t}}(t.userAgentData.brands);i&&e.set(i.brand,`${i.version} (${n})`)}else if(t?.platform){n=t.platform;const r=function(e){const t=[{name:"Firefox",regex:/Firefox\/([\d.]+)/},{name:"Safari",regex:/Version\/([\d.]+).*Safari/}];for(const n of t){const t=e.match(n.regex);if(t)return{brand:n.name,version:t[1]}}}(t.userAgent);r&&e.set(r.brand,`${r.version} (${n})`)}else"string"==typeof globalThis.EdgeRuntime&&e.set("EdgeRuntime",`${globalThis.EdgeRuntime} (${n})`)}(t);const n=function(e){const t=[];for(const[n,r]of e){const e=r?`${n}/${r}`:n;t.push(e)}return t.join(" ")}(t);return e?`${e} ${n}`:n}const ge="x-ms-useragent",me="userAgentPolicy";function ve(e={}){const t=fe(e.userAgentPrefix);return{name:me,sendRequest:async(e,n)=>(e.headers.has(ge)||e.headers.set(ge,await t),n(e))}}var ye=n(70);const Ce={arrayBuffer:()=>{throw new Error("Not implemented")},bytes:()=>{throw new Error("Not implemented")},slice:()=>{throw new Error("Not implemented")},text:()=>{throw new Error("Not implemented")}},Se=Symbol("rawContent");function Te(e){return"function"==typeof e[Se]}function Ee(e){return Te(e)?e[Se]():e}function be(e,t,n={}){return{...Ce,type:n.type??"",lastModified:n.lastModified??(new Date).getTime(),webkitRelativePath:n.webkitRelativePath??"",size:n.size??-1,name:t,stream:()=>{const t=e();if(n=t,Boolean(n&&"function"==typeof n.pipe))throw new Error("Not supported: a Node stream was provided as input to createFileFromStream.");var n;return t},[Se]:e}}function Ie(e,t,n={}){return ye.isNodeLike?{...Ce,type:n.type??"",lastModified:n.lastModified??(new Date).getTime(),webkitRelativePath:n.webkitRelativePath??"",size:e.byteLength,name:t,arrayBuffer:async()=>e.buffer,stream:()=>new Blob([we(e)]).stream(),[Se]:()=>e}:new File([we(e)],t,n)}function we(e){return"resize"in e.buffer?e:e.map(e=>e)}const Re=W;function Ae(){const e=J();return{name:Re,sendRequest:async(t,n)=>{if(t.multipartBody)for(const e of t.multipartBody.parts)Te(e.body)&&(e.body=Ee(e.body));return e.sendRequest(t,n)}}}const Oe="decompressResponsePolicy";function ke(){return function(){throw new Error("decompressResponsePolicy is not supported in browser environment")}()}function _e(e={}){return function(e={}){return{name:j,sendRequest:q([P(),N(e)],{maxRetries:e.maxRetries??x}).sendRequest}}(e)}const Pe=B;function Me(){return{name:B,async sendRequest(e,t){if(F.qx&&"undefined"!=typeof FormData&&e.body instanceof FormData&&(e.formData=function(e){const t={};for(const[n,r]of e.entries())t[n]??=[],t[n].push(r);return t}(e.body),e.body=void 0),e.formData){const t=e.headers.get("Content-Type");t&&-1!==t.indexOf("application/x-www-form-urlencoded")?e.body=function(e){const t=new URLSearchParams;for(const[n,r]of Object.entries(e))if(Array.isArray(r))for(const e of r)t.append(n,e.toString());else t.append(n,r.toString());return t.toString()}(e.formData):await async function(e,t){const n=t.headers.get("Content-Type");if(n&&!n.startsWith("multipart/form-data"))return;t.headers.set("Content-Type",n??"multipart/form-data");const r=[];for(const[t,n]of Object.entries(e))for(const e of Array.isArray(n)?n:[n])if("string"==typeof e)r.push({headers:a({"Content-Disposition":`form-data; name="${t}"`}),body:(0,v.Al)(e,"utf-8")});else{if(null==e||"object"!=typeof e)throw new Error(`Unexpected value for key ${t}: ${e}. Value should be serialized to string first.`);{const n=e.name||"blob",i=a();i.set("Content-Disposition",`form-data; name="${t}"; filename="${n}"`),i.set("Content-Type",e.type||"application/octet-stream"),r.push({headers:i,body:e})}}t.multipartBody={parts:r}}(e.formData,e),e.formData=void 0}return t(e)}}}const De="proxyPolicy";function Ne(e){return function(){throw new Error(ne)}()}function xe(e,t){return function(){throw new Error(ne)}()}const Ue="setClientRequestIdPolicy";function Le(e="x-ms-client-request-id"){return{name:Ue,sendRequest:async(t,n)=>(t.headers.has(e)||t.headers.set(e,t.requestId),n(t))}}const qe=Z;function je(e){return function(e){return{name:Z,sendRequest:async(t,n)=>(t.agent||(t.agent=e),n(t))}}(e)}const Fe=ae;function Be(e){return function(e){return{name:ae,sendRequest:async(t,n)=>(t.tlsSettings||(t.tlsSettings=e),n(t))}}(e)}var Ge=n(4401);const He=m;function Ve(e){return function(e){return e instanceof m||(0,h.b)(e)&&"RestError"===e.name}(e)}var ze=n(3336);const We="tracingPolicy";function Ke(e={}){const t=fe(e.userAgentPrefix),n=new ze.If({additionalAllowedQueryParameters:e.additionalAllowedQueryParameters}),r=function(){try{return(0,Ge.y)({namespace:"",packageName:"@azure/core-rest-pipeline",packageVersion:he})}catch(e){return void Y.warning(`Error when creating the TracingClient: ${(0,ye.getErrorMessage)(e)}`)}}();return{name:We,async sendRequest(e,i){if(!r)return i(e);const o=await t,s={"http.url":n.sanitizeUrl(e.url),"http.method":e.method,"http.user_agent":o,requestId:e.requestId};o&&(s["http.user_agent"]=o);const{span:a,tracingContext:c}=function(e,t,n){try{const{span:r,updatedOptions:i}=e.startSpan(`HTTP ${t.method}`,{tracingOptions:t.tracingOptions},{spanKind:"client",spanAttributes:n});if(!r.isRecording())return void r.end();const o=e.createRequestHeaders(i.tracingOptions.tracingContext);for(const[e,n]of Object.entries(o))t.headers.set(e,n);return{span:r,tracingContext:i.tracingOptions.tracingContext}}catch(e){return void Y.warning(`Skipping creating a tracing span due to an error: ${(0,ye.getErrorMessage)(e)}`)}}(r,e,s)??{};if(!a||!c)return i(e);try{const t=await r.withContext(c,i,e);return function(e,t){try{e.setAttribute("http.status_code",t.status);const n=t.headers.get("x-ms-request-id");n&&e.setAttribute("serviceRequestId",n),t.status>=400&&e.setStatus({status:"error"}),e.end()}catch(e){Y.warning(`Skipping tracing span processing due to an error: ${(0,ye.getErrorMessage)(e)}`)}}(a,t),t}catch(e){throw function(e,t){try{e.setStatus({status:"error",error:(0,ye.isError)(t)?t:void 0}),Ve(t)&&t.statusCode&&e.setAttribute("http.status_code",t.statusCode),e.end()}catch(e){Y.warning(`Skipping tracing span processing due to an error: ${(0,ye.getErrorMessage)(e)}`)}}(a,e),e}}}}function $e(e){if(e instanceof AbortSignal)return{abortSignal:e};if(e.aborted)return{abortSignal:AbortSignal.abort(e.reason)};const t=new AbortController;let n=!0;function r(){n&&(e.removeEventListener("abort",i),n=!1)}function i(){t.abort(e.reason),r()}return e.addEventListener("abort",i),{abortSignal:t.signal,cleanup:r}}const Je="wrapAbortSignalLikePolicy";function Xe(e){const t=X();return ye.isNodeLike&&(e.agent&&t.addPolicy(je(e.agent)),e.tlsOptions&&t.addPolicy(Be(e.tlsOptions)),t.addPolicy(xe(e.proxyOptions)),t.addPolicy(ke())),t.addPolicy({name:Je,sendRequest:async(e,t)=>{if(!e.abortSignal)return t(e);const{abortSignal:n,cleanup:r}=$e(e.abortSignal);e.abortSignal=n;try{return await t(e)}finally{r?.()}}}),t.addPolicy(Me(),{beforePolicies:[Re]}),t.addPolicy(ve(e.userAgentOptions)),t.addPolicy(Le(e.telemetryOptions?.clientRequestIdHeaderName)),t.addPolicy(Ae(),{afterPhase:"Deserialize"}),t.addPolicy(_e(e.retryOptions),{phase:"Retry"}),t.addPolicy(Ke({...e.userAgentOptions,...e.loggingOptions}),{afterPhase:"Retry"}),ye.isNodeLike&&t.addPolicy(de(e.redirectOptions),{afterPhase:"Retry"}),t.addPolicy(ue(e.loggingOptions),{afterPhase:"Sign"}),t}function Qe(){const e=new S;return{async sendRequest(t){const{abortSignal:n,cleanup:r}=t.abortSignal?$e(t.abortSignal):{};try{return t.abortSignal=n,await e.sendRequest(t)}finally{r?.()}}}}function Ye(e){return a(e)}function Ze(e){return function(e){return new u(e)}(e)}const et="exponentialRetryPolicy";function tt(e={}){return function(e={}){return q([N({...e,ignoreSystemErrors:!0})],{maxRetries:e.maxRetries??x})}(e)}const nt=ee;function rt(e={}){return function(e={}){return{name:ee,sendRequest:q([N({...e,ignoreHttpStatusCodes:!0})],{maxRetries:e.maxRetries??x}).sendRequest}}(e)}const it=te;function ot(e={}){return function(e={}){return{name:te,sendRequest:q([P()],{maxRetries:e.maxRetries??x}).sendRequest}}(e)}const st=(0,Q.KV)("core-rest-pipeline retryPolicy");function at(e,t={maxRetries:pe}){return q(e,{logger:st,...t})}const ct={forcedRefreshWindowInMs:1e3,retryIntervalInMs:3e3,refreshWindowInMs:12e4};function ut(e,t){let n,r=null,i=null;const o={...ct,...t},s={get isRefreshing(){return null!==r},get shouldRefresh(){return!s.isRefreshing&&(!!(i?.refreshAfterTimestamp&&i.refreshAfterTimestamp<Date.now())||(i?.expiresOnTimestamp??0)-o.refreshWindowInMs<Date.now())},get mustRefresh(){return null===i||i.expiresOnTimestamp-o.forcedRefreshWindowInMs<Date.now()}};function a(t,a){return s.isRefreshing||(r=async function(e,t,n){async function r(){if(!(Date.now()<n)){const t=await e();if(null===t)throw new Error("Failed to refresh access token.");return t}try{return await e()}catch{return null}}let i=await r();for(;null===i;)await(0,ye.delay)(t),i=await r();return i}(()=>e.getToken(t,a),o.retryIntervalInMs,i?.expiresOnTimestamp??Date.now()).then(e=>(r=null,i=e,n=a.tenantId,i)).catch(e=>{throw r=null,i=null,n=void 0,e})),r}return async(e,t)=>{const r=Boolean(t.claims),o=n!==t.tenantId;return r&&(i=null),o||r||s.mustRefresh?a(e,t):(s.shouldRefresh&&a(e,t),i)}}const lt="bearerTokenAuthenticationPolicy";async function dt(e,t){try{return[await t(e),void 0]}catch(e){if(Ve(e)&&e.response)return[e.response,e];throw e}}async function ht(e){const{scopes:t,getAccessToken:n,request:r}=e,i={abortSignal:r.abortSignal,tracingOptions:r.tracingOptions,enableCae:!0},o=await n(t,i);o&&e.request.headers.set("Authorization",`Bearer ${o.token}`)}function pt(e){return 401===e.status&&e.headers.has("WWW-Authenticate")}async function ft(e,t){const{scopes:n}=e,r=await e.getAccessToken(n,{enableCae:!0,claims:t});return!!r&&(e.request.headers.set("Authorization",`${r.tokenType??"Bearer"} ${r.token}`),!0)}function gt(e){const{credential:t,scopes:n,challengeCallbacks:r}=e,i=e.logger||Y,o={authorizeRequest:r?.authorizeRequest?.bind(r)??ht,authorizeRequestOnChallenge:r?.authorizeRequestOnChallenge?.bind(r)},s=t?ut(t):()=>Promise.resolve(null);return{name:lt,async sendRequest(e,t){if(!e.url.toLowerCase().startsWith("https://"))throw new Error("Bearer token authentication is not permitted for non-TLS protected (non-https) URLs.");let r,a,c;if(await o.authorizeRequest({scopes:Array.isArray(n)?n:[n],request:e,getAccessToken:s,logger:i}),[r,a]=await dt(e,t),pt(r)){let u=mt(r.headers.get("WWW-Authenticate"));if(u){let o;try{o=atob(u)}catch(e){return i.warning(`The WWW-Authenticate header contains "claims" that cannot be parsed. Unable to perform the Continuous Access Evaluation authentication flow. Unparsable claims: ${u}`),r}c=await ft({scopes:Array.isArray(n)?n:[n],response:r,request:e,getAccessToken:s,logger:i},o),c&&([r,a]=await dt(e,t))}else if(o.authorizeRequestOnChallenge&&(c=await o.authorizeRequestOnChallenge({scopes:Array.isArray(n)?n:[n],request:e,response:r,getAccessToken:s,logger:i}),c&&([r,a]=await dt(e,t)),pt(r)&&(u=mt(r.headers.get("WWW-Authenticate")),u))){let o;try{o=atob(u)}catch(e){return i.warning(`The WWW-Authenticate header contains "claims" that cannot be parsed. Unable to perform the Continuous Access Evaluation authentication flow. Unparsable claims: ${u}`),r}c=await ft({scopes:Array.isArray(n)?n:[n],response:r,request:e,getAccessToken:s,logger:i},o),c&&([r,a]=await dt(e,t))}}if(a)throw a;return r}}}function mt(e){if(!e)return;const t=function(e){const t=/(\w+)\s+((?:\w+=(?:"[^"]*"|[^,]*),?\s*)+)/g,n=/(\w+)="([^"]*)"/g,r=[];let i;for(;null!==(i=t.exec(e));){const e=i[1],t=i[2],o={};let s;for(;null!==(s=n.exec(t));)o[s[1]]=s[2];r.push({scheme:e,params:o})}return r}(e);return t.find(e=>"Bearer"===e.scheme&&e.params.claims&&"insufficient_claims"===e.params.error)?.params.claims}const vt="ndJsonPolicy";function yt(){return{name:vt,async sendRequest(e,t){if("string"==typeof e.body&&e.body.startsWith("[")){const t=JSON.parse(e.body);Array.isArray(t)&&(e.body=t.map(e=>JSON.stringify(e)+"\n").join(""))}return t(e)}}}const Ct="auxiliaryAuthenticationHeaderPolicy",St="x-ms-authorization-auxiliary";async function Tt(e){const{scopes:t,getAccessToken:n,request:r}=e,i={abortSignal:r.abortSignal,tracingOptions:r.tracingOptions};return(await n(t,i))?.token??""}function Et(e){const{credentials:t,scopes:n}=e,r=e.logger||Y,i=new WeakMap;return{name:Ct,async sendRequest(e,o){if(!e.url.toLowerCase().startsWith("https://"))throw new Error("Bearer token authentication for auxiliary header is not permitted for non-TLS protected (non-https) URLs.");if(!t||0===t.length)return r.info(`${Ct} header will not be set due to empty credentials.`),o(e);const s=[];for(const o of t){let t=i.get(o);t||(t=ut(o),i.set(o,t)),s.push(Tt({scopes:Array.isArray(n)?n:[n],request:e,getAccessToken:t,logger:r}))}const a=(await Promise.all(s)).filter(e=>Boolean(e));return 0===a.length?(r.warning(`None of the auxiliary tokens are valid. ${St} header will not be set.`),o(e)):(e.headers.set(St,a.map(e=>`Bearer ${e}`).join(", ")),o(e))}}}},3943:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(4746),o=n(9376),s=n(5881),a=n(4665),c=n(3311),u=n(1052),l=n(7516),d=n(8990),h=n(7145),p=n(4478),f=n(3364),g=function(){function e(){}return e.createMessageData=function(t){var n=t.contentType===c.default.Text?u.default.Text:u.default.RichTextHtml,r=t.content,i=e.createBaseMessageData(n,t.contentType.toString(),r);return i.properties=this.getMessageProperties(t),f.default.isNullOrUndefined(t.sender.displayName)||(i.imdisplayname=t.sender.displayName),i},e.createBaseMessageData=function(e,t,n){return{"Has-Mentions":"false",clientmessageid:Date.now().toString(),composetime:(new Date).toISOString(),content:n,contenttype:t,messagetype:e}},e.getMessageProperties=function(e){var t={};if(t.deliveryMode=e.deliveryMode.toString(),e.tags){var n=[];e.tags.forEach(function(e){n.push(e)}),t.tags=n.join()}return t},e.createTypingStatusThreadMessageData=function(t,n){var i="";switch(t){case p.default.Typing:i=u.default.ControlTyping;break;case p.default.ClearTyping:i=u.default.ControlClearTyping}var o=e.createBaseMessageData(i,c.default.Text,"");return f.default.isNullOrUndefined(n)||(o=r(r({},n),o)),o},e.createBotMessageData=function(e,t){var n={conversation:{id:e},value:t};return JSON.stringify(n)},e.createFileMessage=function(t,n,r){var i=u.default.Text,o=c.default.Text.toString().toLowerCase(),s=e.createBaseMessageData(i,o.toString(),"");return s.amsreferences=JSON.stringify([t.id]),s.properties=JSON.stringify(this.createFileMessageProperties(t,n,r)),f.default.isNullOrUndefined(r.sender.displayName)||(s.imdisplayname=r.sender.displayName),s},e.createFileMessageProperties=function(e,t,n){var r={};if(r.deliveryMode=n.deliveryMode.toString(),r.files=JSON.stringify([this.createFileProperty(e,t)]),r.importance="",r.subject="",n.tags){var i=[];n.tags.forEach(function(e){i.push(e)}),r.tags=i.join()}return r},e.createFileProperty=function(t,n){var r=!!e.isDocumentTypeImage(t.type);return{"@type":"http://schema.skype.com/File",type:t.type,itemid:"",baseUrl:"",providerData:"",version:2,id:t.id,title:t.name,state:"active",objectUrl:h.default.getAmsObjectViewUrl(t.id,n.RegionGtms,r),fileName:t.name,fileType:e.getNameAndExtension(t.name).extension,botFileProperties:{url:h.default.getAmsObjectViewUrl(t.id,n.RegionGtms,r)},fileInfo:{fileUrl:h.default.getAmsObjectContentUrl(t.id,n.RegionGtms,r),siteUrl:"",serverRelativeUrl:""},filePreview:{previewUrl:""}}},e.getNameAndExtension=function(e){var t=(e||"").split("."),n="",r="";return t.length>1?(r=t.pop().toLowerCase(),n=t.join(".")):(r="",n=t[0]),{name:n,extension:r}},e.createIRawMessage=function(t,n,r){var i,a,c={clientmessageid:t.clientmessageid,content:t.content,contentType:e.getMessageContentType(t),deliveryMode:f.default.isNullOrUndefined(t.properties)||t.properties.deliveryMode!==o.default.Bridged?o.default.Unbridged:o.default.Bridged,messageType:e.getMessageType(t),properties:t.properties,sender:{displayName:t.imdisplayname,id:t.from,type:e.getPersonType(t.from)},timestamp:new Date(Date.parse(t.originalarrivaltime))};(r&&(c.resourceType=r),f.default.isNullOrUndefined(t.properties)||f.default.isNullOrEmptyString(t.properties.tags))||(i=t.properties.tags.split(","),c.tags=i);if(!f.default.isNullOrUndefined(t.properties)&&!f.default.isNullOrEmptyString(t.properties.files)&&(a=JSON.parse(t.properties.files)).length>0){var u=a[0].id;f.default.isNullOrUndefined(u)&&t.amsreferences&&(u=t.amsreferences[0]);var l=e.getFileUrl(a[0],u,n),d={fileSharingProtocolType:s.default.AmsBasedFileSharing,id:u,name:a[0].fileName,size:a[0].version,type:a[0].fileType,url:l};c.fileMetadata=d}return c},e.createIRawThread=function(e){return{id:e.id,members:e.members,messages:e.messages,properties:e.properties,rosterVersion:e.rosterVersion,type:e.type,version:e.version}},e.getConversationIdFromUrl=function(e){var t=e&&e.match(/\/(\d+:[^\/]*)[\/]?/);return t&&t[1]?t[1]:void 0},e.isSystemMessage=function(t){var n=!1;return f.default.isNullOrEmptyString(t.messagetype)||(n=e.getSystemMessageTypes().reduce(function(e,n){return e||0===t.messagetype.toLowerCase().indexOf(n.toLowerCase())},n)),n},e.getPersonType=function(e){var t=d.default.Unknown,n=e.split("/").pop();return 0===n.indexOf("28:")?t=d.default.Bot:0===n.indexOf("19:")&&(t=d.default.User),t},e.isImageType=function(e){switch(e.toLowerCase()){case"jpeg":case"jpg":case"gif":case"png":case"bmp":case"tiff":case"jfif":return!0;default:return!1}},e.getMessageType=function(e){var t;switch(e.messagetype){case l.default.Typing:t=l.default.Typing;break;case l.default.ClearTyping:t=l.default.ClearTyping;break;default:t=l.default.UserMessage}return t},e.getMessageContentType=function(e){var t=e.contenttype?e.contenttype:e.messagetype;return t===u.default.Text.toLowerCase()||t.indexOf(i.default.TextPlainMimeType)>=0?c.default.Text:c.default.RichText},e.getSystemMessageTypes=function(){return["ThreadActivity"]},e.getFileUrl=function(t,n,r){var i,o=t.fileInfo;if(o&&o.fileUrl)i=o.fileUrl;else if(n){var s=e.isImageType(t.fileType);i=h.default.getAmsObjectContentUrl(n,r.RegionGtms,s)}return i},e.isDocumentTypeImage=function(e){return-1!==e.indexOf(i.default.Image)},e.getDomainRegexp=function(){return new RegExp(/^(https?:.+?\.microsoft\.com)/i)},e.parseDomain=function(t){var n=t.match(e.getDomainRegexp());return n?n[1]:null},e.parseChatServiceHostUrl=function(t){return e.parseDomain(t)},e.shouldRetryOnFailure=function(e){return e!==a.default.Accepted&&e!==a.default.Created},e}();t.default=g},3990:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(8217),i=n(884),o=n(9974);t._Utf8_GetBytes=function(e){for(var t=[],n=0;n<e.length;++n){var r=e.charCodeAt(n);r<128?t.push(r):r<2048?t.push(192|r>>6,128|63&r):r<55296||r>=57344?t.push(224|r>>12,128|r>>6&63,128|63&r):(r=65536+((1023&r)<<10|1023&e.charCodeAt(++n)),t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r))}return t},t._Base64_GetString=function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=[],r=e.length%3,i=function(e){return[t.charAt(e>>18&63),t.charAt(e>>12&63),t.charAt(e>>6&63),t.charAt(63&e)].join("")},o=0,s=e.length-r;o<s;o+=3){var a=(e[o]<<16)+(e[o+1]<<8)+e[o+2];n.push(i(a))}switch(r){case 1:a=e[e.length-1],n.push(t.charAt(a>>2)),n.push(t.charAt(a<<4&63)),n.push("==");break;case 2:var c=(e[e.length-2]<<8)+e[e.length-1];n.push(t.charAt(c>>10)),n.push(t.charAt(c>>4&63)),n.push(t.charAt(c<<2&63)),n.push("=")}return n.join("")},t._Varint_GetBytes=function(e){for(var t=[];4294967168&e;)t.push(127&e|128),e>>>=7;return t.push(127&e),t},t._Varint64_GetBytes=function(e){for(var t=e.low,n=e.high,r=[];n||4294967168&t;)r.push(127&t|128),t=(127&n)<<25|t>>>7,n>>>=7;return r.push(127&t),r},t._Double_GetBytes=function(e){if(o.BrowserChecker._IsDataViewSupport()){var t=new DataView(new ArrayBuffer(8));t.setFloat64(0,e,!0);for(var n=[],r=0;r<8;++r)n.push(t.getUint8(r));return n}return i.FloatUtils._ConvertNumberToArray(e,!0)},t._Zigzag_EncodeZigzag32=function(e){return(e=r.Number._ToInt32(e))<<1^e>>31},t._Zigzag_EncodeZigzag64=function(e){var t=e.low,n=e.high,i=n<<1|t>>>31,o=t<<1;2147483648&n&&(i=~i,o=~o);var s=new r.UInt64("0");return s.low=o,s.high=i,s}},4046:e=>{"use strict";e.exports={rE:"2.3.1"}},4049:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={getChatTokenRetryCount:5,getChatTokenTimeBetweenRetriesOnFailure:2e3,getChatTokenRetryOn429:!0,useUnauthReconnectIdSigQueryParam:!1}},4140:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(9140),o=n(7030),s=n(8185),a=function(){function e(e){this.omnichannelConfig=e,this.runtimeId="",this.telemetry=null,this.debug=!1,this.telemetryEvents=new Map,this.scenarioType=o.default.EVENTS}return e.prototype.setDebug=function(e){var t;this.debug=e,null===(t=this.telemetry)||void 0===t||t.setDebug(e)},e.prototype.setScenarioType=function(e){this.scenarioType=e},e.prototype.setRuntimeId=function(e){this.runtimeId=e},e.prototype.useTelemetry=function(e){this.debug&&console.log("[ScenarioMarker][useTelemetry]"),this.telemetry=e},e.prototype.startScenario=function(e,t){var n;if(void 0===t&&(t={}),this.debug&&console.log("[ScenarioMarker][startScenario]"),!this.telemetryEvents.has(e)){var o=new s.default;o.start(),this.telemetryEvents.set(e,o)}var a=r({ChatSDKRuntimeId:this.runtimeId,Event:(0,i.startEvent)(e),OrgId:this.omnichannelConfig.orgId,OrgUrl:this.omnichannelConfig.orgUrl,WidgetId:this.omnichannelConfig.widgetId},t);null===(n=this.telemetry)||void 0===n||n.info(a,this.scenarioType)},e.prototype.singleRecord=function(e,t){var n,i=r({ChatSDKRuntimeId:this.runtimeId,Event:e,OrgId:this.omnichannelConfig.orgId,OrgUrl:this.omnichannelConfig.orgUrl,WidgetId:this.omnichannelConfig.widgetId},t);null===(n=this.telemetry)||void 0===n||n.info(i,this.scenarioType)},e.prototype.failScenario=function(e,t){var n;if(void 0===t&&(t={}),this.debug&&console.log("[ScenarioMarker][failScenario]"),this.telemetryEvents.has(e)){var o=this.telemetryEvents.get(e);this.telemetryEvents.delete(e);var s=r({ChatSDKRuntimeId:this.runtimeId,Event:(0,i.failEvent)(e),OrgId:this.omnichannelConfig.orgId,OrgUrl:this.omnichannelConfig.orgUrl,WidgetId:this.omnichannelConfig.widgetId,ElapsedTimeInMilliseconds:o.stop()},t);null===(n=this.telemetry)||void 0===n||n.error(s,this.scenarioType)}else console.warn("'".concat(e,"' event has not started."))},e.prototype.completeScenario=function(e,t){var n;if(void 0===t&&(t={}),this.debug&&console.log("[ScenarioMarker][completeScenario]"),this.telemetryEvents.has(e)){var o=this.telemetryEvents.get(e);this.telemetryEvents.delete(e);var s=r({ChatSDKRuntimeId:this.runtimeId,Event:(0,i.completeEvent)(e),OrgId:this.omnichannelConfig.orgId,OrgUrl:this.omnichannelConfig.orgUrl,WidgetId:this.omnichannelConfig.widgetId,ElapsedTimeInMilliseconds:o.stop()},t);null===(n=this.telemetry)||void 0===n||n.info(s,this.scenarioType)}else console.warn("'".concat(e,"' event has not started."))},e}();t.default=a},4154:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(772),s=n(1649),a=n(4897);t.default=function(e,t,n,c,u,l){return r(void 0,void 0,void 0,function(){var r,d;return i(this,function(i){switch(i.label){case 0:if(e||a.default.throwUninitializedChatSDK(t,s.default.StopPolling),n!==o.default.V2)return[3,4];t.startScenario(s.default.StopPolling),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,null==l?void 0:l.stopPolling()];case 2:return i.sent(),t.completeScenario(s.default.StopPolling),[3,4];case 3:return r=i.sent(),d={errorObject:"".concat(r)},t.failScenario(s.default.StopPolling,{RequestId:c,ChatId:u,ExceptionDetails:JSON.stringify(d)}),[3,4];case 4:return[2]}})})}},4240:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.WidgetUseOutsideOperatingHour=705]="WidgetUseOutsideOperatingHour",e[e.WidgetNotFound=701]="WidgetNotFound"}(n||(n={})),t.default=n},4273:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={IC3:"IC3",DirectLine:"DirectLine",ACS:"ACS"}},4296:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4938),i=n(7367),o=n(9143),s=n(8686),a=n(4628),c=n(3465),u=function(){function e(e,t,n,o){this._queueSizeLimit=t,this._isCurrentlyUploadingNow=!1,this._uploadNowQueue=[],this._shouldDropEventsOnPause=!1,this._paused=!1,this._queueSize=0,this._outboundQueue=[],this._inboundQueues={},this._inboundQueues[r.AWTEventPriority.High]=[],this._inboundQueues[r.AWTEventPriority.Normal]=[],this._inboundQueues[r.AWTEventPriority.Low]=[],this._addEmptyQueues(),this._batcher=new s.default(this._outboundQueue,500),this._httpManager=new i.default(this._outboundQueue,e,this,n,o)}return e.prototype.addEvent=function(e){c.isPriority(e.priority)||(e.priority=r.AWTEventPriority.Normal),e.priority===r.AWTEventPriority.Immediate_sync?this._httpManager.sendSynchronousRequest(this._batcher.addEventToBatch(e),e.apiKey):this._queueSize<this._queueSizeLimit||this._dropEventWithPriorityOrLess(e.priority)?this._addEventToProperQueue(e):a.default.eventsDropped([e],r.AWTEventsDroppedReason.QueueFull)},e.prototype.sendEventsForPriorityAndAbove=function(e){this._batchEvents(e),this._httpManager.sendQueuedRequests()},e.prototype.hasEvents=function(){return(this._inboundQueues[r.AWTEventPriority.High][0].length>0||this._inboundQueues[r.AWTEventPriority.Normal][0].length>0||this._inboundQueues[r.AWTEventPriority.Low][0].length>0||this._batcher.hasBatch())&&this._httpManager.hasIdleConnection()},e.prototype.addBackRequest=function(e){if(!this._paused||!this._shouldDropEventsOnPause){for(var t in e)if(e.hasOwnProperty(t))for(var n=0;n<e[t].length;++n)e[t][n].sendAttempt<6?this.addEvent(e[t][n]):a.default.eventsDropped([e[t][n]],r.AWTEventsDroppedReason.MaxRetryLimit);o.default.scheduleTimer()}},e.prototype.teardown=function(){this._paused||(this._batchEvents(r.AWTEventPriority.Low),this._httpManager.teardown())},e.prototype.uploadNow=function(e){var t=this;this._addEmptyQueues(),this._isCurrentlyUploadingNow?this._uploadNowQueue.push(e):(this._isCurrentlyUploadingNow=!0,setTimeout(function(){return t._uploadNow(e)},0))},e.prototype.pauseTransmission=function(){this._paused=!0,this._httpManager.pause(),this._shouldDropEventsOnPause&&(this._queueSize-=this._inboundQueues[r.AWTEventPriority.High][0].length+this._inboundQueues[r.AWTEventPriority.Normal][0].length+this._inboundQueues[r.AWTEventPriority.Low][0].length,this._inboundQueues[r.AWTEventPriority.High][0]=[],this._inboundQueues[r.AWTEventPriority.Normal][0]=[],this._inboundQueues[r.AWTEventPriority.Low][0]=[],this._httpManager.removeQueuedRequests())},e.prototype.resumeTransmission=function(){this._paused=!1,this._httpManager.resume()},e.prototype.shouldDropEventsOnPause=function(e){this._shouldDropEventsOnPause=e},e.prototype._removeFirstQueues=function(){this._inboundQueues[r.AWTEventPriority.High].shift(),this._inboundQueues[r.AWTEventPriority.Normal].shift(),this._inboundQueues[r.AWTEventPriority.Low].shift()},e.prototype._addEmptyQueues=function(){this._inboundQueues[r.AWTEventPriority.High].push([]),this._inboundQueues[r.AWTEventPriority.Normal].push([]),this._inboundQueues[r.AWTEventPriority.Low].push([])},e.prototype._addEventToProperQueue=function(e){this._paused&&this._shouldDropEventsOnPause||(this._queueSize++,this._inboundQueues[e.priority][this._inboundQueues[e.priority].length-1].push(e))},e.prototype._dropEventWithPriorityOrLess=function(e){for(var t=r.AWTEventPriority.Low;t<=e;){if(this._inboundQueues[t][this._inboundQueues[t].length-1].length>0)return a.default.eventsDropped([this._inboundQueues[t][this._inboundQueues[t].length-1].shift()],r.AWTEventsDroppedReason.QueueFull),!0;t++}return!1},e.prototype._batchEvents=function(e){for(var t=r.AWTEventPriority.High;t>=e;){for(;this._inboundQueues[t][0].length>0;){var n=this._inboundQueues[t][0].pop();this._queueSize--,this._batcher.addEventToBatch(n)}t--}this._batcher.flushBatch()},e.prototype._uploadNow=function(e){var t=this;this.hasEvents()&&this.sendEventsForPriorityAndAbove(r.AWTEventPriority.Low),this._checkOutboundQueueEmptyAndSent(function(){t._removeFirstQueues(),null!=e&&e(),t._uploadNowQueue.length>0?setTimeout(function(){return t._uploadNow(t._uploadNowQueue.shift())},0):(t._isCurrentlyUploadingNow=!1,t.hasEvents()&&o.default.scheduleTimer())})},e.prototype._checkOutboundQueueEmptyAndSent=function(e){var t=this;this._httpManager.isCompletelyIdle()?e():setTimeout(function(){return t._checkOutboundQueueEmptyAndSent(e)},250)},e}();t.default=u},4299:(e,t,n)=>{"use strict";n.d(t,{KV:()=>i});const r=(0,n(4424).MX)({logLevelEnvVarName:"AZURE_LOG_LEVEL",namespace:"azure"});function i(e){return r.createClientLogger(e)}r.logger},4372:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.LocationHeader="location",e.SetRegistrationTokenHeader="set-registrationtoken",e.RegistrationTokenHeader="RegistrationToken",e.RegistrationTokenHeaderValue="registrationToken=",e.ContentTypeHeader="content-type",e.AuthenticationHeader="authentication",e.BehaviorOverrideHeader="behavioroverride",e.SkypeTokenHeaderValue="skypetoken=",e.SetEndpointProperty="supportsMessageProperties",e}();t.default=n},4373:e=>{e.exports=function(e){var t=Object(e),n=[];for(var r in t)n.unshift(r);return function e(){for(;n.length;)if((r=n.pop())in t)return e.value=r,e.done=!1,e;return e.done=!0,e}},e.exports.__esModule=!0,e.exports.default=e.exports},4401:(e,t,n)=>{"use strict";n.d(t,{y:()=>c});const r={span:Symbol.for("@azure/core-tracing span"),namespace:Symbol.for("@azure/core-tracing namespace")};function i(e={}){let t=new o(e.parentContext);return e.span&&(t=t.setValue(r.span,e.span)),e.namespace&&(t=t.setValue(r.namespace,e.namespace)),t}class o{_contextMap;constructor(e){this._contextMap=e instanceof o?new Map(e._contextMap):new Map}setValue(e,t){const n=new o(this);return n._contextMap.set(e,t),n}getValue(e){return this._contextMap.get(e)}deleteValue(e){const t=new o(this);return t._contextMap.delete(e),t}}const s={instrumenterImplementation:void 0};function a(){return s.instrumenterImplementation||(s.instrumenterImplementation={createRequestHeaders:()=>({}),parseTraceparentHeader:()=>{},startSpan:(e,t)=>({span:{end:()=>{},isRecording:()=>!1,recordException:()=>{},setAttribute:()=>{},setStatus:()=>{},addEvent:()=>{}},tracingContext:i({parentContext:t.tracingContext})}),withContext:(e,t,...n)=>t(...n)}),s.instrumenterImplementation}function c(e){const{namespace:t,packageName:n,packageVersion:i}=e;function o(e,o,s){const c=a().startSpan(e,{...s,packageName:n,packageVersion:i,tracingContext:o?.tracingOptions?.tracingContext});let u=c.tracingContext;const l=c.span;return u.getValue(r.namespace)||(u=u.setValue(r.namespace,t)),l.setAttribute("az.namespace",u.getValue(r.namespace)),{span:l,updatedOptions:Object.assign({},o,{tracingOptions:{...o?.tracingOptions,tracingContext:u}})}}function s(e,t,...n){return a().withContext(e,t,...n)}return{startSpan:o,withSpan:async function(e,t,n,r){const{span:i,updatedOptions:a}=o(e,t,r);try{const e=await s(a.tracingOptions.tracingContext,()=>Promise.resolve(n(a,i)));return i.setStatus({status:"success"}),e}catch(e){throw i.setStatus({status:"error",error:e}),e}finally{i.end()}},withContext:s,parseTraceparentHeader:function(e){return a().parseTraceparentHeader(e)},createRequestHeaders:function(e){return a().createRequestHeaders(e)}}}},4424:(e,t,n)=>{"use strict";n.d(t,{KV:()=>E,MX:()=>S});const r="undefined"!=typeof process&&process.env&&process.env.DEBUG||void 0;let i,o=[],s=[];const a=[];r&&u(r);const c=Object.assign(e=>h(e),{enable:u,enabled:l,disable:function(){const e=i||"";return u(""),e},log:function(...e){if(e.length>0){const t=String(e[0]);t.includes(":error")?console.error(...e):t.includes(":warning")?console.warn(...e):t.includes(":info")?console.info(...e):(t.includes(":verbose"),console.debug(...e))}}});function u(e){i=e,o=[],s=[];const t=e.split(",").map(e=>e.trim());for(const e of t)e.startsWith("-")?s.push(e.substring(1)):o.push(e);for(const e of a)e.enabled=l(e.namespace)}function l(e){if(e.endsWith("*"))return!0;for(const t of s)if(d(e,t))return!1;for(const t of o)if(d(e,t))return!0;return!1}function d(e,t){if(-1===t.indexOf("*"))return e===t;let n=t;if(-1!==t.indexOf("**")){const e=[];let r="";for(const n of t)"*"===n&&"*"===r||(r=n,e.push(n));n=e.join("")}let r=0,i=0;const o=n.length,s=e.length;let a=-1,c=-1;for(;r<s&&i<o;)if("*"!==n[i]){if(n[i]!==e[r]){if(a>=0){if(i=a+1,r=c+1,r===s)return!1;for(;e[r]!==n[i];)if(r++,r===s)return!1;c=r,r++,i++;continue}return!1}i++,r++}else{if(a=i,i++,i===o)return!0;for(;e[r]!==n[i];)if(r++,r===s)return!1;c=r,r++,i++}const u=r===e.length,l=i===n.length,d=i===n.length-1&&"*"===n[i];return u&&(l||d)}function h(e){const t=Object.assign(function(...n){t.enabled&&(n.length>0&&(n[0]=`${e} ${n[0]}`),t.log(...n))},{enabled:l(e),destroy:p,log:c.log,namespace:e,extend:f});return a.push(t),t}function p(){const e=a.indexOf(this);return e>=0&&(a.splice(e,1),!0)}function f(e){const t=h(`${this.namespace}:${e}`);return t.log=this.log,t}const g=c,m=["verbose","info","warning","error"],v={verbose:400,info:300,warning:200,error:100};function y(e,t){t.log=(...t)=>{e.log(...t)}}function C(e){return m.includes(e)}function S(e){const t=new Set,n="undefined"!=typeof process&&process.env&&process.env[e.logLevelEnvVarName]||void 0;let r;const i=g(e.namespace);function o(e){if(e&&!C(e))throw new Error(`Unknown log level '${e}'. Acceptable values: ${m.join(",")}`);r=e;const n=[];for(const e of t)s(e)&&n.push(e.namespace);g.enable(n.join(","))}function s(e){return Boolean(r&&v[e.level]<=v[r])}function a(e,n){const r=Object.assign(e.extend(n),{level:n});if(y(e,r),s(r)){const e=g.disable();g.enable(e+","+r.namespace)}return t.add(r),r}return i.log=(...e)=>{g.log(...e)},n&&(C(n)?o(n):console.error(`${e.logLevelEnvVarName} set to unknown log level '${n}'; logging is not enabled. Acceptable values: ${m.join(", ")}.`)),{setLogLevel:o,getLogLevel:function(){return r},createClientLogger:function(e){const t=i.extend(e);return y(i,t),{error:a(t,"error"),warning:a(t,"warning"),info:a(t,"info"),verbose:a(t,"verbose")}},logger:i}}const T=S({logLevelEnvVarName:"TYPESPEC_RUNTIME_LOG_LEVEL",namespace:"typeSpecRuntime"});function E(e){return T.createClientLogger(e)}T.logger},4478:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Typing=0]="Typing",e[e.ClearTyping=1]="ClearTyping"}(n||(n={})),t.default=n},4479:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uuidv4=void 0,t.uuidv4=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}},4487:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9143),i=function(){function e(){}return e.setEventsHandler=function(e){r.default.setEventsHandler(e)},e.getEventsHandler=function(){return r.default.getEventsHandler()},e.scheduleTimer=function(){r.default.scheduleTimer()},e}();t.default=i},4564:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultLocaleString=t.defaultLocaleId=t.getLocaleIdFromString=t.getLocaleStringFromId=void 0;var n={1025:"ar-sa",1026:"bg-bg",1027:"ca-es",1029:"cs-cz",1030:"da-dk",1031:"de-de",1032:"el-gr",1033:"en-us",3082:"es-es",1061:"et-ee",1069:"eu-es",1035:"fi-fi",1036:"fr-fr",1110:"gl-es",1037:"he-il",1081:"hi-in",1050:"hr-hr",1038:"hu-hu",1057:"id-id",1040:"it-it",1041:"ja-jp",1087:"kk-kz",1042:"ko-kr",1063:"lt-lt",1062:"lv-lv",1086:"ms-my",1044:"nb-no",1043:"nl-nl",1045:"pl-pl",1046:"pt-br",2070:"pt-pt",1048:"ro-ro",1049:"ru-ru",1051:"sk-sk",1060:"sl-si",3098:"sr-cyrl-cs",2074:"sr-latn-cs",1053:"sv-se",1054:"th-th",1055:"tr-tr",1058:"uk-ua",1066:"vi-vn",2052:"zh-cn",3076:"zh-hk",1028:"zh-tw"};t.getLocaleStringFromId=function(e){var r=Object.keys(n).find(function(t){return t===e});return r?n[r]:t.defaultLocaleString},t.getLocaleIdFromString=function(e){var r=Object.keys(n).find(function(t){return n[t]===e});return null!=r?r:t.defaultLocaleId},t.defaultLocaleId="1033",t.defaultLocaleString="en-us"},4569:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(!e)return"";var t=e.split(".");if(t.length>2)return"."+t[t.length-1];if(2==t.length){var n=t[0],r=t[1];return!n&&r?"":n&&!r?".":"."+t[t.length-1]}return""}},4579:(e,t,n)=>{var r=n(7736);function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,r(i.key),i)}}e.exports=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports},4628:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.addNotificationListener=function(e){this.listeners.push(e)},e.removeNotificationListener=function(e){for(var t=this.listeners.indexOf(e);t>-1;)this.listeners.splice(t,1),t=this.listeners.indexOf(e)},e.eventsSent=function(e){for(var t=this,n=function(n){r.listeners[n].eventsSent&&setTimeout(function(){return t.listeners[n].eventsSent(e)},0)},r=this,i=0;i<this.listeners.length;++i)n(i)},e.eventsDropped=function(e,t){for(var n=this,r=function(r){i.listeners[r].eventsDropped&&setTimeout(function(){return n.listeners[r].eventsDropped(e,t)},0)},i=this,o=0;o<this.listeners.length;++o)r(o)},e.eventsRetrying=function(e){for(var t=this,n=function(n){r.listeners[n].eventsRetrying&&setTimeout(function(){return t.listeners[n].eventsRetrying(e)},0)},r=this,i=0;i<this.listeners.length;++i)n(i)},e.eventsRejected=function(e,t){for(var n=this,r=function(r){i.listeners[r].eventsRejected&&setTimeout(function(){return n.listeners[r].eventsRejected(e,t)},0)},i=this,o=0;o<this.listeners.length;++o)r(o)},e.listeners=[],e}();t.default=n},4633:(e,t,n)=>{var r=n(5172),i=n(6993),o=n(5869),s=n(887),a=n(1791),c=n(4373),u=n(579);function l(){"use strict";var t=i(),n=t.m(l),d=(Object.getPrototypeOf?Object.getPrototypeOf(n):n.__proto__).constructor;function h(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))}var p={throw:1,return:2,break:3,continue:3};function f(e){var t,n;return function(r){t||(t={stop:function(){return n(r.a,2)},catch:function(){return r.v},abrupt:function(e,t){return n(r.a,p[e],t)},delegateYield:function(e,i,o){return t.resultName=i,n(r.d,u(e),o)},finish:function(e){return n(r.f,e)}},n=function(e,n,i){r.p=t.prev,r.n=t.next;try{return e(n,i)}finally{t.next=r.n}}),t.resultName&&(t[t.resultName]=r.v,t.resultName=void 0),t.sent=r.v,t.next=r.n;try{return e.call(this,t)}finally{r.p=t.prev,r.n=t.next}}}return(e.exports=l=function(){return{wrap:function(e,n,r,i){return t.w(f(e),n,r,i&&i.reverse())},isGeneratorFunction:h,mark:t.m,awrap:function(e,t){return new r(e,t)},AsyncIterator:a,async:function(e,t,n,r,i){return(h(t)?s:o)(f(e),t,n,r,i)},keys:c,values:u}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=l,e.exports.__esModule=!0,e.exports.default=e.exports},4665:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.OK=200,e.Created=201,e.Accepted=202,e.NoContent=204,e.Unauthorized=401,e.Forbidden=403,e.Redirect=404,e.TooManyRequests=429,e.InternalServerError=500,e.ServiceUnavailable=503,e.NotFound=729,e}();t.default=n},4736:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.callingBundleVersion=t.ariaTelemetryKey=t.webChatDirectLineVersion=t.webChatACSAdapterVersion=t.webChatIC3AdapterVersion=t.ic3ClientVersion=t.omnichannelChatSdkVersion=void 0,t.omnichannelChatSdkVersion="1.11.7-0",t.ic3ClientVersion="2021.08.14.1",t.webChatIC3AdapterVersion="0.1.0-master.2dba07b",t.webChatACSAdapterVersion="0.0.1-beta.5",t.webChatDirectLineVersion="0.15.1",t.callingBundleVersion="1.0.20240809-2",t.ariaTelemetryKey="c7655518acf1403f93ff6b9f77942f0a-d01a02fd-6b50-4de3-a566-62eda11f93bc-7083"},4746:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.NewMessageEvent="NewMessage",e.MessageUpdateEvent="MessageUpdate",e.ThreadUpdateEvent="ThreadUpdate",e.ConversationUpdateEvent="ConversationUpdate",e.HttpLongPoll="HttpLongPoll",e.ContentTypeJson="application/json",e.ContentTypeTextPlain="text/plain;charset=UTF-8",e.ContentTypeForm="application/x-www-form-urlencoded",e.RedirectAs404="redirectAs404",e.NoCache="no-cache",e.User="user",e.Web="web",e.ClientInfoValue="os=Windows; osVer=10; proc=Win32; lcid=en-us; deviceType=1; country=IN; clientName=swc; clientVer=912/0.106.0.34//swc",e.TextPlainMimeType="text/plain",e.SwcName="SWC",e.Image="image",e.ClientVersion="937/0.123.0.9",e.DelayForAms=50,e.Reset_Flag="reset_ic3_needed",e.Malware="malware",e.Ready="ready",e.InProgress="in progress",e.Failed="failed",e.Expired="expired",e.ImageView="imgpsh_fullsize_anim",e.FileView="original",e.DocumentTypeImage="pish/image",e.DocumentTypeFile="sharing/file",e.ImageContent="imgpsh",e.FileContent="original",e.AMSAcceptHeaderValue="image/webp,image/ *,*/*;q=0.8",e.AMSAcceptEncodingHeaderValue="gzip, deflate, sdch, br",e.AMSAuthorizationSkypeTokenValue="skype_token ",e.stabilizePollMaxRetryCount=50,e.timeBetweenStabilizingPoll=1e3,e.retryCount=2,e.retry404Count=3,e.retryOtherCount=3,e.liveStateRetryCount=3,e.timeBetweenOperationRetry=1e3,e.heartBeatDuration=3e4,e.endpointRequestLog="Endpoint request",e.subscriptionRequestLog="Subscription request",e.setPropertiesRequestLog="Set message properties request",e.unsubscribeRequestLog="Unsubscribe from endpoint request",e.pollRequestLog="Polling",e.oldInitializer="Old initializer",e.newInitializer="New Initializer",e.skypeTokenAuthURL="/v1/skypetokenauth",e.skypeTokenConstantForData="skypetoken=",e}();t.default=n},4756:(e,t,n)=>{var r=n(4633)();e.exports=r;try{regeneratorRuntime=r}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}},4757:(e,t,n)=>{"use strict";var r=n(4994);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(7383)),o=r(n(4579)),s=r(n(6009)),a=r(n(3022)),c=r(n(5096)),u=function(){function e(){(0,i.default)(this,e)}return(0,o.default)(e,null,[{key:"getSDK",value:function(e,t,n){var r=new a.default(n);return new c.default({channelId:e.channelId||s.default.defaultChannelId,orgId:e.orgId,orgUrl:e.orgUrl,widgetId:e.widgetId},t||{},r)}}]),e}();t.default=u},4782:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AWT_REAL_TIME="REAL_TIME",t.AWT_NEAR_REAL_TIME="NEAR_REAL_TIME",t.AWT_BEST_EFFORT="BEST_EFFORT"},4786:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.LiveChat=19235e4]="LiveChat",e[e.PersistentChat=192350001]="PersistentChat"}(n||(n={})),t.default=n},4810:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=["orgUrl","orgId","widgetId"];t.default=function(e){if(!e)throw new Error("OmnichannelConfiguration not found");for(var t=0,r=n;t<r.length;t++){var i=r[t];if(!Reflect.has(e,i))throw new Error("Missing '".concat(i,"' in OmnichannelConfiguration"));var o=Reflect.get(e,i);if(!o||"string"==typeof o&&0===o.trim().length||0===o.length)throw new Error("Empty '".concat(i,"' in OmnichannelConfiguration"))}}},4897:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.throwAuthContactIdNotFoundFailure=t.throwLiveChatTranscriptRetrievalFailure=t.throwChatAdapterInitializationFailure=t.throwMessagingClientConversationJoinFailure=t.throwMessagingClientInitializationFailure=t.throwConversationClosureFailure=t.throwConversationInitializationFailure=t.throwWidgetUseOutsideOperatingHour=t.throwPersistentChatConversationRetrievalFailure=t.throwAuthenticatedChatConversationRetrievalFailure=t.throwClosedConversation=t.throwInvalidConversation=t.throwChatTokenRetrievalFailure=t.throwNotPersistentChatEnabled=t.throwUninitializedChatSDK=t.throwMessagingClientCreationFailure=t.throwUnsupportedLiveChatVersionFailure=t.throwChatConfigRetrievalFailure=t.throwOmnichannelClientInitializationFailure=t.throwFeatureDisabled=t.throwUnsupportedPlatform=t.throwScriptLoadFailure=t.throwAMSLoadFailure=t.throwChatSDKError=void 0;var i=n(1590);t.throwChatSDKError=function(e,t,n,o,s,a){var c,u;void 0===s&&(s={});var l={response:e};if(t)if("object"==typeof t&&null!==t&&"response"in t){var d=t,h=d.message,p=d.code,f=d.response;l.errorObject=JSON.stringify({status:null==f?void 0:f.status,headers:null==f?void 0:f.headers,data:null==f?void 0:f.data,message:h,code:p})}else l.errorObject=String(t);throw a&&(l.message=a,console.error(a)),n.failScenario(o,r(r({},s),{ExceptionDetails:JSON.stringify(l)})),new i.ChatSDKError(e,(null==t?void 0:t.isAxiosError)&&(null===(c=null==t?void 0:t.response)||void 0===c?void 0:c.status)?null===(u=null==t?void 0:t.response)||void 0===u?void 0:u.status:void 0,l)},t.throwAMSLoadFailure=function(e,n,r){(0,t.throwChatSDKError)(i.ChatSDKErrorName.AttachmentClientNotLoaded,void 0,e,n,{},r)},t.throwScriptLoadFailure=function(e,n,r){(0,t.throwChatSDKError)(i.ChatSDKErrorName.ScriptLoadFailure,e,n,r)},t.throwUnsupportedPlatform=function(e,n,r,o){void 0===o&&(o={}),(0,t.throwChatSDKError)(i.ChatSDKErrorName.UnsupportedPlatform,void 0,e,n,o,r)},t.throwFeatureDisabled=function(e,n,r){(0,t.throwChatSDKError)(i.ChatSDKErrorName.FeatureDisabled,void 0,e,n,{},r)},t.throwOmnichannelClientInitializationFailure=function(e,n,r){(0,t.throwChatSDKError)(i.ChatSDKErrorName.OmnichannelClientInitializationFailure,e,n,r)},t.throwChatConfigRetrievalFailure=function(e,n,r){(0,t.throwChatSDKError)(i.ChatSDKErrorName.ChatConfigRetrievalFailure,e,n,r)},t.throwUnsupportedLiveChatVersionFailure=function(e,n,r){(0,t.throwChatSDKError)(i.ChatSDKErrorName.UnsupportedLiveChatVersion,e,n,r)},t.throwMessagingClientCreationFailure=function(e,n,r){(0,t.throwChatSDKError)(i.ChatSDKErrorName.MessagingClientCreationFailure,e,n,r)},t.throwUninitializedChatSDK=function(e,n){(0,t.throwChatSDKError)(i.ChatSDKErrorName.UninitializedChatSDK,void 0,e,n)},t.throwNotPersistentChatEnabled=function(e,n,r){(0,t.throwChatSDKError)(i.ChatSDKErrorName.NotPersistentChatEnabled,void 0,e,n,r,"Persistent chat is not enabled for this chat widget")},t.throwChatTokenRetrievalFailure=function(e,n,r,o){(0,t.throwChatSDKError)(i.ChatSDKErrorName.ChatTokenRetrievalFailure,e,n,r,o)},t.throwInvalidConversation=function(e,n,r){(0,t.throwChatSDKError)(i.ChatSDKErrorName.InvalidConversation,void 0,e,n,r,"Conversation not found")},t.throwClosedConversation=function(e,n,r){(0,t.throwChatSDKError)(i.ChatSDKErrorName.ClosedConversation,void 0,e,n,r)},t.throwAuthenticatedChatConversationRetrievalFailure=function(e,n,r,o){(0,t.throwChatSDKError)(i.ChatSDKErrorName.AuthenticatedChatConversationRetrievalFailure,e,n,r,o)},t.throwPersistentChatConversationRetrievalFailure=function(e,n,r,o){(0,t.throwChatSDKError)(i.ChatSDKErrorName.PersistentChatConversationRetrievalFailure,e,n,r,o)},t.throwWidgetUseOutsideOperatingHour=function(e,n,r,o){(0,t.throwChatSDKError)(i.ChatSDKErrorName.WidgetUseOutsideOperatingHour,e,n,r,o,"Widget used outside of operating hours")},t.throwConversationInitializationFailure=function(e,n,r,o){(0,t.throwChatSDKError)(i.ChatSDKErrorName.ConversationInitializationFailure,e,n,r,o)},t.throwConversationClosureFailure=function(e,n,r,o){(0,t.throwChatSDKError)(i.ChatSDKErrorName.ConversationClosureFailure,e,n,r,o)},t.throwMessagingClientInitializationFailure=function(e,n,r,o){(0,t.throwChatSDKError)(i.ChatSDKErrorName.MessagingClientInitializationFailure,e,n,r,o)},t.throwMessagingClientConversationJoinFailure=function(e,n,r,o){(0,t.throwChatSDKError)(i.ChatSDKErrorName.MessagingClientConversationJoinFailure,e,n,r,o)},t.throwChatAdapterInitializationFailure=function(e,n,r){(0,t.throwChatSDKError)(i.ChatSDKErrorName.ChatAdapterInitializationFailure,e,n,r)},t.throwLiveChatTranscriptRetrievalFailure=function(e,n,r,o){(0,t.throwChatSDKError)(i.ChatSDKErrorName.LiveChatTranscriptRetrievalFailure,e,n,r,o)},t.throwAuthContactIdNotFoundFailure=function(e,n,r,o){(0,t.throwChatSDKError)(i.ChatSDKErrorName.AuthContactIdNotFoundFailure,e,n,r,o)},t.default={throwChatSDKError:t.throwChatSDKError,throwScriptLoadFailure:t.throwScriptLoadFailure,throwUnsupportedPlatform:t.throwUnsupportedPlatform,throwFeatureDisabled:t.throwFeatureDisabled,throwOmnichannelClientInitializationFailure:t.throwOmnichannelClientInitializationFailure,throwUnsupportedLiveChatVersionFailure:t.throwUnsupportedLiveChatVersionFailure,throwChatConfigRetrievalFailure:t.throwChatConfigRetrievalFailure,throwMessagingClientCreationFailure:t.throwMessagingClientCreationFailure,throwUninitializedChatSDK:t.throwUninitializedChatSDK,throwChatTokenRetrievalFailure:t.throwChatTokenRetrievalFailure,throwInvalidConversation:t.throwInvalidConversation,throwClosedConversation:t.throwClosedConversation,throwAuthenticatedChatConversationRetrievalFailure:t.throwAuthenticatedChatConversationRetrievalFailure,throwPersistentChatConversationRetrievalFailure:t.throwPersistentChatConversationRetrievalFailure,throwWidgetUseOutsideOperatingHour:t.throwWidgetUseOutsideOperatingHour,throwConversationInitializationFailure:t.throwConversationInitializationFailure,throwConversationClosureFailure:t.throwConversationClosureFailure,throwMessagingClientInitializationFailure:t.throwMessagingClientInitializationFailure,throwMessagingClientConversationJoinFailure:t.throwMessagingClientConversationJoinFailure,throwChatAdapterInitializationFailure:t.throwChatAdapterInitializationFailure,throwLiveChatTranscriptRetrievalFailure:t.throwLiveChatTranscriptRetrievalFailure,throwAuthContactIdNotFoundFailure:t.throwAuthContactIdNotFoundFailure,throwNotPersistentChatEnabled:t.throwNotPersistentChatEnabled}},4938:(e,t)=>{"use strict";var n,r,i,o,s,a;Object.defineProperty(t,"__esModule",{value:!0}),(a=t.AWTPropertyType||(t.AWTPropertyType={}))[a.Unspecified=0]="Unspecified",a[a.String=1]="String",a[a.Int64=2]="Int64",a[a.Double=3]="Double",a[a.Boolean=4]="Boolean",a[a.Date=5]="Date",(s=t.AWTPiiKind||(t.AWTPiiKind={}))[s.NotSet=0]="NotSet",s[s.DistinguishedName=1]="DistinguishedName",s[s.GenericData=2]="GenericData",s[s.IPV4Address=3]="IPV4Address",s[s.IPv6Address=4]="IPv6Address",s[s.MailSubject=5]="MailSubject",s[s.PhoneNumber=6]="PhoneNumber",s[s.QueryString=7]="QueryString",s[s.SipAddress=8]="SipAddress",s[s.SmtpAddress=9]="SmtpAddress",s[s.Identity=10]="Identity",s[s.Uri=11]="Uri",s[s.Fqdn=12]="Fqdn",s[s.IPV4AddressLegacy=13]="IPV4AddressLegacy",(o=t.AWTCustomerContentKind||(t.AWTCustomerContentKind={}))[o.NotSet=0]="NotSet",o[o.GenericContent=1]="GenericContent",(i=t.AWTEventPriority||(t.AWTEventPriority={}))[i.Low=1]="Low",i[i.Normal=2]="Normal",i[i.High=3]="High",i[i.Immediate_sync=5]="Immediate_sync",(r=t.AWTEventsDroppedReason||(t.AWTEventsDroppedReason={}))[r.NonRetryableStatus=1]="NonRetryableStatus",r[r.QueueFull=3]="QueueFull",r[r.MaxRetryLimit=4]="MaxRetryLimit",(n=t.AWTEventsRejectedReason||(t.AWTEventsRejectedReason={}))[n.InvalidEvent=1]="InvalidEvent",n[n.SizeLimitExceeded=2]="SizeLimitExceeded",n[n.KillSwitch=3]="KillSwitch"},4949:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.SurveyProvider=void 0,function(e){e[e.CustomerVoice=60099e4]="CustomerVoice",e[e.MicrosoftCopilotStudio=600990001]="MicrosoftCopilotStudio"}(n||(t.SurveyProvider=n={}))},4953:(e,t,n)=>{"use strict";n.d(t,{g:()=>i});var r=n(5967);function i(e,t){const n=t.retryDelayInMs*Math.pow(2,e),i=Math.min(t.maxRetryDelayInMs,n);return{retryAfterInMs:i/2+(0,r.W)(0,i/2)}}},4994:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.__esModule=!0,e.exports.default=e.exports},5004:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=["crm4.omnichannelengagementhub.com","crm12.omnichannelengagementhub.com","crm16.omnichannelengagementhub.com","crm17.omnichannelengagementhub.com","crm19.omnichannelengagementhub.com","crm11.omnichannelengagementhub.com","eu.omnichannelengagementhub.com","fr.omnichannelengagementhub.com","de.omnichannelengagementhub.com","ch.omnichannelengagementhub.com","uk.omnichannelengagementhub.com"]},5066:(e,t,n)=>{"use strict";var r=n(4994);Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserInfo=t.UNKNOWN_VERSION=void 0;var i=r(n(7383)),o=r(n(4579)),s=r(n(3693)),a=n(86),c="([\\d,.]+)";t.UNKNOWN_VERSION="U";var u=function(){function e(){(0,i.default)(this,e)}return(0,o.default)(e,null,[{key:"getUserAgent",value:function(){return this.userAgent()}},{key:"userAgentContainsString",value:function(e){return this.getUserAgent().indexOf(e)>-1}},{key:"isChrome",value:function(){return this.userAgentContainsString(a.BrowserVendor.CHROME)&&!this.userAgentContainsString(a.BrowserVendor.EDGE)&&!this.userAgentContainsString(a.BrowserVendor.EDGE_CHROMIUM)}},{key:"isIe",value:function(){return this.userAgentContainsString("Trident")}},{key:"isEdge",value:function(){return this.userAgentContainsString(a.BrowserVendor.EDGE)||this.userAgentContainsString(a.BrowserVendor.EDGE_CHROMIUM)}},{key:"isOpera",value:function(){return this.userAgentContainsString("OPR/")}},{key:"getBrowserName",value:function(){return this.isOpera()?a.BrowserVendor.OPERA:this.isEdge()?a.BrowserVendor.EDGE:this.isChrome()?a.BrowserVendor.CHROME:this.userAgentContainsString(a.BrowserVendor.FIREFOX)?a.BrowserVendor.FIREFOX:this.userAgentContainsString(a.BrowserVendor.SAFARI)?a.BrowserVendor.SAFARI:this.isIe()?a.BrowserVendor.IE:a.BrowserVendor.UNKNOWN}},{key:"getBrowserVersion",value:function(){var e=this;return this.isIe()?function(){var t=e.getUserAgent(),n=t.match(new RegExp(a.BrowserVendor.IE+" "+c));if(n)return n[1];var r=t.match(new RegExp("rv:"+c));return r?r[1]:void 0}():function(t){t===a.BrowserVendor.SAFARI&&(t="Version"),t===a.BrowserVendor.OPERA&&(t="OPR"),t===a.BrowserVendor.EDGE&&(t="Edge?");var n=e.getUserAgent().match(new RegExp(t+"/"+c));return n?n[1]:"U"}(this.getBrowserName())}}]),e}();t.BrowserInfo=u,(0,s.default)(u,"userAgent",function(){return window.navigator.userAgent})},5082:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(4746),s=n(4372),a=n(2343),c=n(5719),u=n(7145),l=n(7767),d=n(514),h=n(7535),p=n(3943),f=function(){function e(){}return e.getDocumentTypeFromContentType=function(e){return p.default.isDocumentTypeImage(e)?o.default.DocumentTypeImage:o.default.DocumentTypeFile},e.createNewDocument=function(t,n,h){return r(this,void 0,void 0,function(){var r,p,f,g,m,v;return i(this,function(i){return(v={})[t]=[d.default[d.default.read]],r=v,p={filename:n.name,permissions:r,type:e.getDocumentTypeFromContentType(n.type)},f=u.default.getAmsObjectsUrl(h.RegionGtms),(g=l.default.getDefaultAMSHeaders(h.SkypeToken))[s.default.ContentTypeHeader]=o.default.ContentTypeJson,m={data:JSON.stringify(p),headers:g,type:a.default.POST,url:f},[2,c.HttpClient.MakeRequest(m)]})})},e.uploadDocument=function(e,t,n){return r(this,void 0,void 0,function(){var r,o,s,d;return i(this,function(i){return console.log("AmsHelper.ts uploadDocument(): "+e+", "+t+", "+n),r=p.default.isDocumentTypeImage(t.type),o=u.default.getAmsObjectContentUrl(e,n.RegionGtms,r),s=l.default.getDefaultAMSHeaders(n.SkypeToken),d={data:t.data,headers:s,processData:!1,type:a.default.PUT,url:o},[2,c.HttpClient.MakeRequest(d)]})})},e.getFileStatus=function(e,t){var n=p.default.isImageType(e.type),r=u.default.getAmsStatusUrl(e.id,t.RegionGtms,n);return this.getViewStatus(r,t).then(function(e){return e.scan&&e.scan.status===o.default.Malware?h.default.Error:e.view_state===o.default.Ready?h.default.Success:e.scan&&e.scan.status===o.default.InProgress||e.view_state&&e.view_state!==o.default.Failed?h.default.InProgress:h.default.Error}).catch(function(){return Promise.reject({})})},e.downloadDocument=function(e,t){var n=this,r=p.default.isImageType(e.type),i=u.default.getAmsStatusUrl(e.id,t.RegionGtms,r);return new Promise(function(e){n.getViewUri(i,t).then(function(n){var i=new Headers;i.append("Authorization","skype_token "+t.SkypeToken),i.append("X-MS-Client-Version",o.default.ClientVersion),r&&(i.append("accept",o.default.AMSAcceptHeaderValue),i.append("Accept-Encoding",o.default.AMSAcceptEncodingHeaderValue));var s={headers:i,method:a.default.GET};return fetch(n,s).then(function(t){e(t.blob())}).catch(function(){return Promise.reject({})})})})},e.getViewUri=function(e,t){var n=this;return this.getViewStatus(e,t).then(function(r){var i=r.scan&&r.scan.status===o.default.Malware;return!r.view_location||r.view_state===o.default.Failed||i?Promise.reject({}):r.view_state&&r.view_state!==o.default.Ready?n.getViewUri(e,t):r.content_state===o.default.Expired?Promise.reject({}):Promise.resolve(r.view_location)}).catch(function(){return Promise.reject("")})},e.getViewStatus=function(e,t){var n=this;return console.log("AmsHelper.ts getViewStatus(): "+e+", "+t),new Promise(function(e){setTimeout(e,o.default.DelayForAms)}).then(function(){var r={headers:l.default.getDefaultAMSViewHeaders(t.SkypeToken),type:a.default.GET,url:e};return c.HttpClient.MakeRequest(r).then(function(e){return e.status_location&&!e.view_state?n.getViewStatus(e.status_location,t):Promise.resolve(e)}).catch(function(e){return 401===e.status||403===e.status?Promise.reject("unauthorized"):Promise.reject({})})})},e}();t.default=f},5096:(e,t,n)=>{"use strict";var r=n(4994),i=n(3738);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(n(4756)),s=r(n(9293)),a=r(n(3738)),c=r(n(7383)),u=r(n(4579)),l=r(n(3693)),d=n(86),h=r(n(6425)),p=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==i(e)&&"function"!=typeof e)return{default:e};var n=D(t);if(n&&n.has(e))return n.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var a=o?Object.getOwnPropertyDescriptor(e,s):null;a&&(a.get||a.set)?Object.defineProperty(r,s,a):r[s]=e[s]}return r.default=e,n&&n.set(e,r),r}(n(470)),f=n(5066),g=r(n(6009)),m=n(8536),v=n(5162),y=r(n(9956)),C=r(n(103)),S=n(6868),T=n(656),E=n(8654),b=r(n(8644)),I=r(n(6984)),w=r(n(3009)),R=n(9839),A=n(7387),O=n(13),k=r(n(1916)),_=r(n(6638)),P=n(4479),M=n(1395);function D(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(D=function(e){return e?n:t})(e)}function N(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?N(Object(n),!0).forEach(function(t){(0,l.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function U(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var L=function(){function e(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.defaultConfiguration,i=arguments.length>2?arguments[2]:void 0;(0,c.default)(this,e),this.omnichannelConfiguration=t,this.configuration=r,this.logger=i,(0,l.default)(this,"liveChatVersion",void 0),(0,l.default)(this,"sessionId",void 0),(0,l.default)(this,"ocUserAgent",void 0),(0,l.default)(this,"HTTPTimeOutErrorMessage","".concat(d.SDKError.ClientHTTPTimeoutErrorName,": ").concat(d.SDKError.ClientHTTPTimeoutErrorMessage)),(0,l.default)(this,"setAuthCodeNonce",function(e){null!=e&&e.authcodenonce&&(n.configuration.authCodeNonce=null==e?void 0:e.authcodenonce)}),(0,l.default)(this,"setSessionIdHeader",function(e,t){e&&(t[I.default.ocSessionId]=e)}),(0,l.default)(this,"setRequestIdHeader",function(e,t){e&&(t[I.default.requestId]=e)}),(0,l.default)(this,"setCorrelationIdInHeader",function(e,t){e&&(t[I.default.correlationId]=e)}),Object.keys(this.configuration).length&&"object"===(0,a.default)(r)||(this.configuration=e.defaultConfiguration);for(var o=0,s=Object.keys(e.defaultConfiguration);o<s.length;o++){var u=s[o];this.configuration.hasOwnProperty(u)||(this.configuration["".concat(u)]=e.defaultConfiguration["".concat(u)])}for(var h=0,p=Object.keys(e.defaultConfiguration.requestTimeoutConfig);h<p.length;h++){var f=p[h];this.configuration.requestTimeoutConfig.hasOwnProperty(f)||(this.configuration.requestTimeoutConfig["".concat(f)]=e.defaultConfiguration.requestTimeoutConfig["".concat(f)])}var m=t.channelId;if(!Object.values(d.ChannelId).includes(m))throw new Error("Invalid channelId");var v,y=Object.keys(t),C=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return U(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?U(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}(g.default.requiredOmnichannelConfigurationParameters);try{for(C.s();!(v=C.n()).done;){var S=v.value;if(!y.includes(S))throw new Error("Missing '".concat(S,"' in OmnichannelConfiguration"))}}catch(e){C.e(e)}finally{C.f()}this.ocUserAgent=this.configuration.ocUserAgent,this.liveChatVersion=d.LiveChatVersion.V2}var t,n,r,i,M,D,N,L,q,j,F,B,G,H,V,z,W,K,$;return(0,u.default)(e,[{key:"getLcwFcsDetails",value:($=(0,s.default)(o.default.mark(function e(){var t,n,r,i,s,a,c,u,l,f,g,m,v,y;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=R.Timer.TIMER(),this.logWithLogger(S.LogLevel.INFO,d.OCSDKTelemetryEvent.GETLCWFCSDETAILSSTARTED,"Get LCW FCS details started",""),n="/".concat(b.default.LcwFcsDetailsPath,"/").concat(this.omnichannelConfiguration.orgId),r="GET",i="".concat(this.omnichannelConfiguration.orgUrl).concat(n),s=h.default.create(),(0,p.default)(s,{retries:this.configuration.maxRequestRetriesOnFailure,waitTimeInMsBetweenRetries:this.configuration.waitTimeBetweenRetriesConfig.getChatConfig}),a={},(0,A.addOcUserAgentHeader)(this.ocUserAgent,a),c=R.Timer.TIMER(),e.prev=10,e.next=13,s.get(i,{headers:a,timeout:null!==(u=this.configuration.defaultRequestTimeout)&&void 0!==u?u:this.configuration.requestTimeoutConfig.getChatConfig});case 13:return l=e.sent,f=c.milliSecondsElapsed,g=t.milliSecondsElapsed,m=l.data,this.logWithLogger(S.LogLevel.INFO,d.OCSDKTelemetryEvent.GETLCWFCSDETAILSSUCCEEDED,"Get LCW FCS details succeeded","",l,g,n,r,void 0,void 0,a,f),e.abrupt("return",m);case 21:throw e.prev=21,e.t0=e.catch(10),v=c.milliSecondsElapsed,y=t.milliSecondsElapsed,this.logWithLogger(S.LogLevel.ERROR,d.OCSDKTelemetryEvent.GETLCWFCSDETAILSFAILED,"Get LCW FCS details failed","",void 0,y,n,r,e.t0,void 0,a,v),e.t0;case 27:case"end":return e.stop()}},e,this,[[10,21]])})),function(){return $.apply(this,arguments)})},{key:"getChatConfig",value:(K=(0,s.default)(o.default.mark(function e(t){var n,r,i,s,a,c,u,l,f,m,v,y,C,T,E,I=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=I.length>1&&void 0!==I[1]&&I[1],r=R.Timer.TIMER(),this.logWithLogger(S.LogLevel.INFO,d.OCSDKTelemetryEvent.GETCHATCONFIGFSTARTED,"Get Chat config started",t),t||(t=(0,P.uuidv4)()),i="/".concat(b.default.LiveChatConfigPath,"/").concat(this.omnichannelConfiguration.orgId,"/").concat(this.omnichannelConfiguration.widgetId,"?requestId=").concat(t,"&channelId=").concat(this.omnichannelConfiguration.channelId),s="GET",a="".concat(this.omnichannelConfiguration.orgUrl).concat(i),c=h.default.create(),(0,p.default)(c,{retries:this.configuration.maxRequestRetriesOnFailure,waitTimeInMsBetweenRetries:this.configuration.waitTimeBetweenRetriesConfig.getChatConfig}),u={},this.addDefaultHeaders(t,u),n&&(u=x(x({},g.default.bypassCacheHeaders),u)),l=R.Timer.TIMER(),e.prev=13,e.next=16,c.get(a,{headers:u,timeout:null!==(f=this.configuration.defaultRequestTimeout)&&void 0!==f?f:this.configuration.requestTimeoutConfig.getChatConfig});case 16:return m=e.sent,v=l.milliSecondsElapsed,y=r.milliSecondsElapsed,(C=m.data).LiveChatVersion&&(this.liveChatVersion=C.LiveChatVersion),C.headers={},m.headers&&m.headers.date&&(C.headers.date=m.headers.date),this.logWithLogger(S.LogLevel.INFO,d.OCSDKTelemetryEvent.GETCHATCONFIGSUCCEEDED,"Get Chat config succeeded",t,m,y,i,s,void 0,void 0,u,v),e.abrupt("return",C);case 27:return e.prev=27,e.t0=e.catch(13),T=l.milliSecondsElapsed,E=r.milliSecondsElapsed,this.logWithLogger(S.LogLevel.ERROR,d.OCSDKTelemetryEvent.GETCHATCONFIGFAILED,"Get Chat config failed",t,void 0,E,i,s,e.t0,void 0,u,T),e.abrupt("return",Promise.reject(e.t0));case 33:case"end":return e.stop()}},e,this,[[13,27]])})),function(e){return K.apply(this,arguments)})},{key:"getLWIDetails",value:(W=(0,s.default)(o.default.mark(function e(t){var n,r,i,a,c,u,l,f,m,v,y,C,T=this,E=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=E.length>1&&void 0!==E[1]?E[1]:{},i=R.Timer.TIMER(),this.logWithLogger(S.LogLevel.INFO,d.OCSDKTelemetryEvent.GETLWISTATUSSTARTED,"Get LWI Details Started",t),t||(t=(0,P.uuidv4)()),a="/".concat(b.default.LiveChatLiveWorkItemDetailsPath,"/").concat(this.omnichannelConfiguration.orgId,"/").concat(this.omnichannelConfiguration.widgetId,"/").concat(t),c=h.default.create(),(0,p.axiosRetryHandlerWithNotFound)(c,{headerOverwrites:[I.default.authCodeNonce],retries:this.configuration.maxRequestRetriesOnFailure,waitTimeInMsBetweenRetries:this.configuration.waitTimeBetweenRetriesConfig.getLWIDetails}),u=r.authenticatedUserToken,l=r.reconnectId,f=g.default.defaultHeaders,u&&(a="/".concat(b.default.LiveChatAuthLiveWorkItemDetailsPath,"/").concat(this.omnichannelConfiguration.orgId,"/").concat(this.omnichannelConfiguration.widgetId,"/").concat(t),f[I.default.authenticatedUserToken]=u,f[I.default.authCodeNonce]=this.configuration.authCodeNonce),this.addDefaultHeaders(t,f),m=!u&&!0===this.configuration.useUnauthReconnectIdSigQueryParam,l&&(m||(a+="/".concat(l))),v={channelId:this.omnichannelConfiguration.channelId},l&&m&&(v.sig=l),y="".concat(this.omnichannelConfiguration.orgUrl).concat(a),C={headers:f,method:"GET",url:y,params:v,timeout:null!==(n=this.configuration.defaultRequestTimeout)&&void 0!==n?n:this.configuration.requestTimeoutConfig.getLWIDetails},e.abrupt("return",new Promise(function(){var e=(0,s.default)(o.default.mark(function e(n,r){var s,u,l,h,p,m,v,y;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=R.Timer.TIMER(),e.prev=1,e.next=4,c(C);case 4:u=e.sent,l=s.milliSecondsElapsed,h=i.milliSecondsElapsed,p=u.data,m=u.headers,T.setAuthCodeNonce(m),T.logWithLogger(S.LogLevel.INFO,d.OCSDKTelemetryEvent.GETLWISTATUSSUCCEEDED,"Get LWI Details succeeded",t,u,h,a,"GET",void 0,void 0,f,l),n(p),e.next=20;break;case 13:e.prev=13,e.t0=e.catch(1),v=s.milliSecondsElapsed,y=i.milliSecondsElapsed,T.logWithLogger(S.LogLevel.ERROR,d.OCSDKTelemetryEvent.GETLWISTATUSFAILED,"Get LWI Details failed",t,void 0,y,a,"GET",e.t0,void 0,f,v),(0,k.default)(e.t0,g.default.axiosTimeoutErrorCode)&&r(new Error(T.HTTPTimeOutErrorMessage)),r(e.t0);case 20:case"end":return e.stop()}},e,null,[[1,13]])}));return function(t,n){return e.apply(this,arguments)}}()));case 19:case"end":return e.stop()}},e,this)})),function(e){return W.apply(this,arguments)})},{key:"getChatToken",value:(z=(0,s.default)(o.default.mark(function e(t){var n,r,i,a,c,u,l,f,m,v,y,C,T,E,b,w,A,_,M=this,D=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=D.length>1&&void 0!==D[1]?D[1]:{},i=D.length>2&&void 0!==D[2]?D[2]:0,a=R.Timer.TIMER(),c=r.reconnectId,u=r.authenticatedUserToken,l=r.currentLiveChatVersion,f=r.refreshToken,m=r.MsOcBotApplicationId,v=!!(m&&m.length>0),this.logWithLogger(S.LogLevel.INFO,d.OCSDKTelemetryEvent.GETCHATTOKENSTARTED,"Get Chat Token Started",t),!(i<0)){e.next=8;break}throw new Error("Invalid currentRetryCount");case 8:return t||(t=(0,P.uuidv4)()),y=g.default.defaultHeaders,this.addDefaultHeaders(t,y),C=(0,O.createGetChatTokenEndpoint)(l||this.liveChatVersion,!!u,v),u&&(y[I.default.authenticatedUserToken]=u,y[I.default.authCodeNonce]=this.configuration.authCodeNonce),T="/".concat(C,"/").concat(this.omnichannelConfiguration.orgId,"/").concat(this.omnichannelConfiguration.widgetId,"/").concat(t),E=!u&&!0===this.configuration.useUnauthReconnectIdSigQueryParam,c&&(E||(T+="/".concat(c))),b={channelId:this.omnichannelConfiguration.channelId},m&&m.length>0&&(b["Ms-Oc-Bot-Application-Id"]=m),f&&(b.refreshToken="true"),c&&E&&(b.sig=c),w="".concat(this.omnichannelConfiguration.orgUrl).concat(T),A={headers:y,method:"GET",url:w,params:b,timeout:null!==(n=this.configuration.defaultRequestTimeout)&&void 0!==n?n:this.configuration.requestTimeoutConfig.getChatToken},_=h.default.create(),(0,p.default)(_,{headerOverwrites:[I.default.authCodeNonce],retries:i>this.configuration.maxRequestRetriesOnFailure?i:this.configuration.maxRequestRetriesOnFailure,retryOn429:this.configuration.getChatTokenRetryOn429,waitTimeInMsBetweenRetries:this.configuration.waitTimeBetweenRetriesConfig.getChatToken}),e.abrupt("return",new Promise(function(){var e=(0,s.default)(o.default.mark(function e(n,r){var i,s,u,l,h,p,f,m;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=R.Timer.TIMER(),e.prev=1,e.next=4,_(A);case 4:if(s=e.sent,u=i.milliSecondsElapsed,l=a.milliSecondsElapsed,h=s.data,p=s.headers,M.setAuthCodeNonce(p),p&&p[I.default.ocSessionId.toLowerCase()]&&(M.sessionId=p[I.default.ocSessionId.toLowerCase()]),!h){e.next=18;break}if(0!==Object.keys(h).length){e.next=14;break}return r(new Error("Empty data received from getChatToken")),e.abrupt("return");case 14:return h.requestId=t,M.logWithLogger(S.LogLevel.INFO,d.OCSDKTelemetryEvent.GETCHATTOKENSUCCEEDED,"Get Chat Token succeeded",t,s,l,T,"GET",void 0,void 0,y,u),n(h),e.abrupt("return");case 18:if(!c||s.status!==g.default.noContentStatusCode){e.next=21;break}return r(s),e.abrupt("return");case 21:e.next=30;break;case 23:e.prev=23,e.t0=e.catch(1),f=i.milliSecondsElapsed,m=a.milliSecondsElapsed,M.logWithLogger(S.LogLevel.ERROR,d.OCSDKTelemetryEvent.GETCHATTOKENFAILED,"Get Chat Token failed",t,void 0,m,T,"GET",e.t0,void 0,y,f),(0,k.default)(e.t0,g.default.axiosTimeoutErrorCode)&&r(new Error(M.HTTPTimeOutErrorMessage)),r(e.t0);case 30:case"end":return e.stop()}},e,null,[[1,23]])}));return function(t,n){return e.apply(this,arguments)}}()));case 26:case"end":return e.stop()}},e,this)})),function(e){return z.apply(this,arguments)})},{key:"getReconnectableChats",value:(V=(0,s.default)(o.default.mark(function e(t){var n,r,i,a,c,u,l,p,f,m=this;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=R.Timer.TIMER(),i=t.authenticatedUserToken,this.logWithLogger(S.LogLevel.INFO,d.OCSDKTelemetryEvent.GETRECONNECTABLECHATSSTARTED,"Get Reconnectable chat Started"),a=null==t?void 0:t.requestId,c="/".concat(b.default.LiveChatGetReconnectableChatsPath,"/").concat(this.omnichannelConfiguration.orgId,"/").concat(this.omnichannelConfiguration.widgetId,"/").concat(a,"?channelId=").concat(this.omnichannelConfiguration.channelId),(u=g.default.defaultHeaders)[I.default.authenticatedUserToken]=i,u[I.default.authCodeNonce]=this.configuration.authCodeNonce,this.addDefaultHeaders(a,u),l="".concat(this.omnichannelConfiguration.orgUrl).concat(c),p={headers:u,method:"GET",url:l,timeout:null!==(n=this.configuration.defaultRequestTimeout)&&void 0!==n?n:this.configuration.requestTimeoutConfig.getReconnectableChats},f=h.default.create(),e.abrupt("return",new Promise(function(){var e=(0,s.default)(o.default.mark(function e(t,n){var i,s,l,h,v,y,C,T;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=R.Timer.TIMER(),e.prev=1,e.next=4,f(p);case 4:if(s=e.sent,l=i.milliSecondsElapsed,h=r.milliSecondsElapsed,v=s.data,y=s.headers,m.setAuthCodeNonce(y),!v){e.next=13;break}return m.logWithLogger(S.LogLevel.INFO,d.OCSDKTelemetryEvent.GETRECONNECTABLECHATSSUCCEEDED,"Get Reconnectable Chats Succeeded and old session returned",a,s,h,c,"GET",void 0,void 0,u,l),t(v),e.abrupt("return");case 13:return t(),e.abrupt("return");case 17:return e.prev=17,e.t0=e.catch(1),C=i.milliSecondsElapsed,T=r.milliSecondsElapsed,m.logWithLogger(S.LogLevel.ERROR,d.OCSDKTelemetryEvent.GETRECONNECTABLECHATSFAILED,"Get Reconnectable Chats failed",a,void 0,T,c,"GET",e.t0,void 0,u,C),(0,k.default)(e.t0,g.default.axiosTimeoutErrorCode)&&n(new Error(m.HTTPTimeOutErrorMessage)),n(e.t0),e.abrupt("return");case 25:case"end":return e.stop()}},e,null,[[1,17]])}));return function(t,n){return e.apply(this,arguments)}}()));case 14:case"end":return e.stop()}},e,this)})),function(e){return V.apply(this,arguments)})},{key:"getReconnectAvailability",value:(H=(0,s.default)(o.default.mark(function e(t){var n,r,i,a,c,u,l,p,f,m=this,v=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=v.length>1&&void 0!==v[1]?v[1]:{},i=R.Timer.TIMER(),this.logWithLogger(S.LogLevel.INFO,d.OCSDKTelemetryEvent.GETRECONNECTAVAILABILITYSTARTED,"Get Reconnectable availability Started"),a="/".concat(b.default.LiveChatReconnectAvailabilityPath,"/").concat(this.omnichannelConfiguration.orgId,"/").concat(this.omnichannelConfiguration.widgetId,"/").concat(t),c=g.default.defaultHeaders,this.addDefaultHeaders(null==r?void 0:r.requestId,c),u="".concat(this.omnichannelConfiguration.orgUrl).concat(a),p={headers:c,method:l="GET",url:u,timeout:null!==(n=this.configuration.defaultRequestTimeout)&&void 0!==n?n:this.configuration.requestTimeoutConfig.getReconnectAvailability},f=h.default.create(),e.abrupt("return",new Promise(function(){var e=(0,s.default)(o.default.mark(function e(t,n){var s,u,h,v,y,C,T;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=R.Timer.TIMER(),e.prev=1,e.next=4,f(p);case 4:if(u=e.sent,h=s.milliSecondsElapsed,v=i.milliSecondsElapsed,!(y=u.data)){e.next=12;break}return m.logWithLogger(S.LogLevel.INFO,d.OCSDKTelemetryEvent.GETRECONNECTAVAILABILITYSUCCEEDED,"Get Reconnect availability succeeded",null==r?void 0:r.requestId,u,v,a,l,void 0,void 0,c,h),t(y),e.abrupt("return");case 12:return m.logWithLogger(S.LogLevel.WARN,d.OCSDKTelemetryEvent.GETRECONNECTAVAILABILITYSUCCEEDED,"Get Reconnect availability didn't send any valid data",null==r?void 0:r.requestId,u,v,a,l,void 0,void 0,c,h),t(),e.abrupt("return");case 17:return e.prev=17,e.t0=e.catch(1),C=s.milliSecondsElapsed,T=i.milliSecondsElapsed,m.logWithLogger(S.LogLevel.ERROR,d.OCSDKTelemetryEvent.GETRECONNECTAVAILABILITYFAILED,"Get Reconnect Availability failed",null==r?void 0:r.requestId,void 0,T,a,l,e.t0,void 0,c,C),(0,k.default)(e.t0,g.default.axiosTimeoutErrorCode)&&n(new Error(m.HTTPTimeOutErrorMessage)),n(e.t0),e.abrupt("return");case 25:case"end":return e.stop()}},e,null,[[1,17]])}));return function(t,n){return e.apply(this,arguments)}}()));case 11:case"end":return e.stop()}},e,this)})),function(e){return H.apply(this,arguments)})},{key:"getAgentAvailability",value:(G=(0,s.default)(o.default.mark(function e(t){var n,r,i,a,c,u,l,T,A,O,_,P,M,D,N,x=this,U=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=U.length>1&&void 0!==U[1]?U[1]:{},i=R.Timer.TIMER(),this.logWithLogger(S.LogLevel.INFO,d.OCSDKTelemetryEvent.GETAGENTAVAILABILITYSTARTED,"Get agent availability Started",t),a="/".concat(b.default.GetAgentAvailabilityPath,"/").concat(this.omnichannelConfiguration.orgId,"/").concat(this.omnichannelConfiguration.widgetId,"/").concat(t,"?channelId=lcw"),c=h.default.create(),(0,p.default)(c,{headerOverwrites:[I.default.authCodeNonce],retries:this.configuration.maxRequestRetriesOnFailure,waitTimeInMsBetweenRetries:this.configuration.waitTimeBetweenRetriesConfig.getAgentAvailability}),u=r.authenticatedUserToken,l=r.initContext,T=r.getContext,A=g.default.defaultHeaders,u&&(A[I.default.authenticatedUserToken]=u,A[I.default.authCodeNonce]=this.configuration.authCodeNonce),this.addDefaultHeaders(t,A),O=l||{},_={orgId:this.omnichannelConfiguration.orgId,widgetId:this.omnichannelConfiguration.widgetId},O&&O.customContextData&&(P=m.CustomContextData.sort(O.customContextData),Object.assign(_,{customContext:P})),O.portalcontactid&&Object.assign(_,{portalcontactid:O.portalcontactid}),O.cacheKey=(0,w.default)(JSON.stringify(_)).toString(y.default),!T||window.document){e.next=17;break}return e.abrupt("return",Promise.reject(new Error("getContext is only supported on web browsers")));case 17:if(T&&(O.browser=f.BrowserInfo.getBrowserName(),O.device=v.DeviceInfo.getDeviceType(),O.originurl=window.location.href,O.os=E.OSInfo.getOsType()),O.locale||(O.locale=g.default.defaultLocale),!O.locale||C.default.supportedLocales.includes(O.locale)){e.next=21;break}return e.abrupt("return",Promise.reject(new Error("Unsupported locale: '".concat(O.locale,"'"))));case 21:return M="".concat(this.omnichannelConfiguration.orgUrl).concat(a),N={data:O,headers:A,method:D="POST",url:M,timeout:null!==(n=this.configuration.defaultRequestTimeout)&&void 0!==n?n:this.configuration.requestTimeoutConfig.getAgentAvailability},e.abrupt("return",new Promise(function(){var e=(0,s.default)(o.default.mark(function e(n,r){var s,u,l,h,p,f,m,v;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=R.Timer.TIMER(),e.prev=1,e.next=4,c(N);case 4:u=e.sent,l=s.milliSecondsElapsed,h=i.milliSecondsElapsed,p=u.data,f=u.headers,x.setAuthCodeNonce(f),p&&(x.logWithLogger(S.LogLevel.INFO,d.OCSDKTelemetryEvent.GETAGENTAVAILABILITYSUCCEEDED,"Get agent availability succeeded",t,u,h,a,D,void 0,void 0,A,l),n(p)),e.next=21;break;case 12:if(e.prev=12,e.t0=e.catch(1),m=s.milliSecondsElapsed,v=i.milliSecondsElapsed,x.logWithLogger(S.LogLevel.ERROR,d.OCSDKTelemetryEvent.GETAGENTAVAILABILITYFAILED,"Get agent availability failed",t,void 0,v,a,D,e.t0,void 0,A,m),!(0,k.default)(e.t0,g.default.axiosTimeoutErrorCode)){e.next=20;break}return r(new Error(x.HTTPTimeOutErrorMessage)),e.abrupt("return");case 20:r(e.t0);case 21:case"end":return e.stop()}},e,null,[[1,12]])}));return function(t,n){return e.apply(this,arguments)}}()));case 25:case"end":return e.stop()}},e,this)})),function(e){return G.apply(this,arguments)})},{key:"sessionInit",value:(B=(0,s.default)(o.default.mark(function e(t){var n,r,i,a,c,u,m,y,T,w,A,O,P,M,D,N,U,L,q=this,j=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=j.length>1&&void 0!==j[1]?j[1]:{},i=R.Timer.TIMER(),this.logWithLogger(S.LogLevel.INFO,d.OCSDKTelemetryEvent.SESSIONINITSTARTED,"Session Init Started",t),a=h.default.create(),(0,p.default)(a,{retries:this.configuration.maxRequestRetriesOnFailure,waitTimeInMsBetweenRetries:this.configuration.waitTimeBetweenRetriesConfig.sessionInit,shouldRetry:function(e){return(0,_.default)(e,!0)},headerOverwrites:[I.default.authCodeNonce]}),c=r.reconnectId,u=r.authenticatedUserToken,m=r.initContext,y=r.getContext,T=m||{},w=x({},g.default.defaultHeaders),A=u?b.default.LiveChatAuthSessionInitPath:b.default.LiveChatSessionInitPath,O="/".concat(A,"/").concat(this.omnichannelConfiguration.orgId,"/").concat(this.omnichannelConfiguration.widgetId,"/").concat(t),u&&Object.assign(w,(P={},(0,l.default)(P,I.default.authenticatedUserToken,u),(0,l.default)(P,I.default.authCodeNonce,this.configuration.authCodeNonce),P)),this.addDefaultHeaders(t,w),this.setRequestIdHeader(t,w),M=!u&&!0===this.configuration.useUnauthReconnectIdSigQueryParam,c&&(M||(O+="/".concat(c))),D={channelId:this.omnichannelConfiguration.channelId},c&&M&&(D.sig=c),!y||window.document){e.next=20;break}return e.abrupt("return",Promise.reject(new Error("getContext is only supported on web browsers")));case 20:if(y&&(T.browser=f.BrowserInfo.getBrowserName(),T.device=v.DeviceInfo.getDeviceType(),T.originurl=window.location.href,T.os=E.OSInfo.getOsType()),T.locale||(T.locale=g.default.defaultLocale),!T.locale||C.default.supportedLocales.includes(T.locale)){e.next=24;break}return e.abrupt("return",Promise.reject(new Error("Unsupported locale: '".concat(T.locale,"'"))));case 24:return N="".concat(this.omnichannelConfiguration.orgUrl).concat(O),L={data:T,headers:w,method:U="POST",url:N,params:D,timeout:null!==(n=this.configuration.defaultRequestTimeout)&&void 0!==n?n:this.configuration.requestTimeoutConfig.sessionInit},e.abrupt("return",new Promise(function(){var e=(0,s.default)(o.default.mark(function e(n,r){var s,c,u,l,h,p,f;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=R.Timer.TIMER(),e.prev=1,e.next=4,a(L);case 4:c=e.sent,u=s.milliSecondsElapsed,l=i.milliSecondsElapsed,h=c.headers,q.setAuthCodeNonce(h),q.logWithLogger(S.LogLevel.INFO,d.OCSDKTelemetryEvent.SESSIONINITSUCCEEDED,"Session Init Succeeded",t,c,l,O,U,void 0,T,w,u),n(),e.next=22;break;case 13:if(e.prev=13,e.t0=e.catch(1),p=s.milliSecondsElapsed,f=i.milliSecondsElapsed,q.logWithLogger(S.LogLevel.ERROR,d.OCSDKTelemetryEvent.SESSIONINITFAILED,"Session Init failed",t,void 0,f,O,U,e.t0,T,w,p),!(0,k.default)(e.t0,g.default.axiosTimeoutErrorCode)){e.next=21;break}return r(new Error(q.HTTPTimeOutErrorMessage)),e.abrupt("return");case 21:r(e.t0);case 22:case"end":return e.stop()}},e,null,[[1,13]])}));return function(t,n){return e.apply(this,arguments)}}()));case 28:case"end":return e.stop()}},e,this)})),function(e){return B.apply(this,arguments)})},{key:"createConversation",value:(F=(0,s.default)(o.default.mark(function e(t){var n,r,i,s,a,c,u,m,y,T,w,A,O,P,M,D,N,U,L,q,j,F,B,G,H=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=H.length>1&&void 0!==H[1]?H[1]:{},i=R.Timer.TIMER(),this.logWithLogger(S.LogLevel.INFO,d.OCSDKTelemetryEvent.CREATESESSIONSTARTED,"Create conversation call Started",t),s=h.default.create(),(0,p.default)(s,{retries:this.configuration.maxRequestRetriesOnFailure,waitTimeInMsBetweenRetries:this.configuration.waitTimeBetweenRetriesConfig.sessionInit,shouldRetry:function(e){return(0,_.default)(e,!0)},headerOverwrites:[I.default.authCodeNonce]}),a=r.reconnectId,c=r.authenticatedUserToken,u=r.initContext,m=r.getContext,y=u||{},T=x({},g.default.defaultHeaders),w=c?b.default.LiveChatConnectorAuthPath:b.default.LiveChatConnectorPath,A="/".concat(w,"/").concat(this.omnichannelConfiguration.orgId,"/widgetApp/").concat(this.omnichannelConfiguration.widgetId,"/conversation"),c&&Object.assign(T,(O={},(0,l.default)(O,I.default.authenticatedUserToken,c),(0,l.default)(O,I.default.authCodeNonce,this.configuration.authCodeNonce),O)),this.addDefaultHeaders(t,T),this.setRequestIdHeader(t,T),a&&(y.reconnectId=a),y.channelId=this.omnichannelConfiguration.channelId,!m||window.document){e.next=18;break}return e.abrupt("return",Promise.reject(new Error("getContext is only supported on web browsers")));case 18:if(m&&(y.browser=f.BrowserInfo.getBrowserName(),y.device=v.DeviceInfo.getDeviceType(),y.originurl=window.location.href,y.os=E.OSInfo.getOsType()),y.locale||(y.locale=g.default.defaultLocale),!y.locale||C.default.supportedLocales.includes(y.locale)){e.next=22;break}return e.abrupt("return",Promise.reject(new Error("Unsupported locale: '".concat(y.locale,"'"))));case 22:return P="".concat(this.omnichannelConfiguration.orgUrl).concat(A),D={data:y,headers:T,method:M="POST",url:P,timeout:null!==(n=this.configuration.defaultRequestTimeout)&&void 0!==n?n:this.configuration.requestTimeoutConfig.sessionInit},N=R.Timer.TIMER(),e.prev=26,e.next=29,s(D);case 29:if(U=e.sent,L=N.milliSecondsElapsed,q=i.milliSecondsElapsed,j=U.data,F=U.headers,this.setAuthCodeNonce(F),F&&F[I.default.ocSessionId.toLowerCase()]&&(this.sessionId=F[I.default.ocSessionId.toLowerCase()]),0!==Object.keys(j).length){e.next=37;break}throw new Error("Empty data received from getChatToken");case 37:return j.requestId=t,this.logWithLogger(S.LogLevel.INFO,d.OCSDKTelemetryEvent.CREATESESSIONSUCCEEDED,"Create coversation call Succeeded",t,U,q,A,M,void 0,void 0,T,L),e.abrupt("return",j);case 42:if(e.prev=42,e.t0=e.catch(26),B=N.milliSecondsElapsed,G=i.milliSecondsElapsed,this.logWithLogger(S.LogLevel.ERROR,d.OCSDKTelemetryEvent.CREATESESSIONFAILED,"Create conversation call failed",t,void 0,G,A,M,e.t0,y,T,B),!(0,k.default)(e.t0,g.default.axiosTimeoutErrorCode)){e.next=49;break}throw new Error(this.HTTPTimeOutErrorMessage);case 49:throw e.t0;case 50:case"end":return e.stop()}},e,this,[[26,42]])})),function(e){return F.apply(this,arguments)})},{key:"sessionClose",value:(j=(0,s.default)(o.default.mark(function e(t){var n,r,i,a,c,u,l,f,m,v,y,C,T,E,w=this,A=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=A.length>1&&void 0!==A[1]?A[1]:{},i=R.Timer.TIMER(),this.logWithLogger(S.LogLevel.INFO,d.OCSDKTelemetryEvent.SESSIONCLOSESTARTED,"Session Close Started",t),a="/".concat(b.default.LiveChatSessionClosePath,"/").concat(this.omnichannelConfiguration.orgId,"/").concat(this.omnichannelConfiguration.widgetId,"/").concat(t,"?channelId=").concat(this.omnichannelConfiguration.channelId),c=h.default.create(),(0,p.default)(c,{headerOverwrites:[I.default.authCodeNonce],retries:this.configuration.maxRequestRetriesOnFailure,waitTimeInMsBetweenRetries:this.configuration.waitTimeBetweenRetriesConfig.sessionClose}),u=r.authenticatedUserToken,l=r.isReconnectChat,f=r.isPersistentChat,m=r.chatId,v=g.default.defaultHeaders,(y={}).chatId=m,u&&(a="/".concat(b.default.LiveChatAuthSessionClosePath,"/").concat(this.omnichannelConfiguration.orgId,"/").concat(this.omnichannelConfiguration.widgetId,"/").concat(t,"?channelId=").concat(this.omnichannelConfiguration.channelId),v[I.default.authenticatedUserToken]=u,v[I.default.authCodeNonce]=this.configuration.authCodeNonce),this.addDefaultHeaders(t,v),l&&(a+="&isReconnectChat=true"),f&&(a+="&isPersistentChat=true"),C="".concat(this.omnichannelConfiguration.orgUrl).concat(a),E={data:y,headers:v,method:T="POST",url:C,timeout:null!==(n=this.configuration.defaultRequestTimeout)&&void 0!==n?n:this.configuration.requestTimeoutConfig.sessionClose},e.abrupt("return",new Promise(function(){var e=(0,s.default)(o.default.mark(function e(n,r){var s,u,l,h,p,f,m;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=R.Timer.TIMER(),e.prev=1,e.next=4,c(E);case 4:u=e.sent,l=s.milliSecondsElapsed,h=u.headers,w.setAuthCodeNonce(h),p=i.milliSecondsElapsed,w.logWithLogger(S.LogLevel.INFO,d.OCSDKTelemetryEvent.SESSIONCLOSESUCCEEDED,"Session Close succeeded",t,u,p,a,T,void 0,void 0,v,l),n(),e.next=20;break;case 13:e.prev=13,e.t0=e.catch(1),f=s.milliSecondsElapsed,m=i.milliSecondsElapsed,w.logWithLogger(S.LogLevel.ERROR,d.OCSDKTelemetryEvent.SESSIONCLOSEFAILED,"Session close failed",t,void 0,m,a,T,e.t0,void 0,v,f),e.t0.code===g.default.axiosTimeoutErrorCode&&r(new Error(w.HTTPTimeOutErrorMessage)),r(e.t0);case 20:case"end":return e.stop()}},e,null,[[1,13]])}));return function(t,n){return e.apply(this,arguments)}}()));case 18:case"end":return e.stop()}},e,this)})),function(e){return j.apply(this,arguments)})},{key:"validateAuthChatRecord",value:(q=(0,s.default)(o.default.mark(function e(t,n){var r,i,a,c,u,l,f,m,v,y,C=this;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=R.Timer.TIMER(),this.logWithLogger(S.LogLevel.INFO,d.OCSDKTelemetryEvent.VALIDATEAUTHCHATRECORDSTARTED,"Validate Auth Chat Record Started",t),a=n.authenticatedUserToken,c=n.chatId,u="/".concat(b.default.LiveChatValidateAuthChatMapRecordPath,"/").concat(this.omnichannelConfiguration.orgId,"/").concat(this.omnichannelConfiguration.widgetId,"/").concat(c,"/").concat(t,"?channelId=").concat(this.omnichannelConfiguration.channelId),l=h.default.create(),(0,p.default)(l,{headerOverwrites:[I.default.authCodeNonce],retries:this.configuration.maxRequestRetriesOnFailure,waitTimeInMsBetweenRetries:this.configuration.waitTimeBetweenRetriesConfig.validateAuthChatRecord}),f=g.default.defaultHeaders,a&&(f[I.default.authenticatedUserToken]=a,f[I.default.authCodeNonce]=this.configuration.authCodeNonce),this.addDefaultHeaders(t,f),m="".concat(this.omnichannelConfiguration.orgUrl).concat(u),y={headers:f,method:v="GET",url:m,timeout:null!==(r=this.configuration.defaultRequestTimeout)&&void 0!==r?r:this.configuration.requestTimeoutConfig.validateAuthChatRecordTimeout},e.abrupt("return",new Promise(function(){var e=(0,s.default)(o.default.mark(function e(n,r){var s,a,c,h,p,m,T,E;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=R.Timer.TIMER(),e.prev=1,e.next=4,l(y);case 4:c=e.sent,h=s.milliSecondsElapsed,p=c.headers,C.setAuthCodeNonce(p),m=i.milliSecondsElapsed,!0===(null===(a=c.data)||void 0===a?void 0:a.authChatExist)?(C.logWithLogger(S.LogLevel.INFO,d.OCSDKTelemetryEvent.VALIDATEAUTHCHATRECORDSUCCEEDED,"Validate Auth Chat Record succeeded",t,c,m,u,v,void 0,void 0,f,h),n(c.data)):(C.logWithLogger(S.LogLevel.INFO,d.OCSDKTelemetryEvent.VALIDATEAUTHCHATRECORDFAILED,"Validate Auth Chat Record Failed. Record is not found or request is not authorized",t,c,m,u,v,void 0,void 0,f,h),r(new Error("Validate Auth Chat Record Failed. Record is not found or request is not authorized"))),e.next=19;break;case 12:e.prev=12,e.t0=e.catch(1),T=s.milliSecondsElapsed,E=i.milliSecondsElapsed,C.logWithLogger(S.LogLevel.ERROR,d.OCSDKTelemetryEvent.VALIDATEAUTHCHATRECORDFAILED,"Validate Auth Chat Record failed",t,void 0,E,u,v,e.t0,void 0,f,T),(0,k.default)(e.t0,g.default.axiosTimeoutErrorCode)&&r(new Error(C.HTTPTimeOutErrorMessage)),"Error: Request failed with status code 404"===e.t0.toString()?n({}):r(e.t0);case 19:case"end":return e.stop()}},e,null,[[1,12]])}));return function(t,n){return e.apply(this,arguments)}}()));case 13:case"end":return e.stop()}},e,this)})),function(e,t){return q.apply(this,arguments)})},{key:"submitPostChatResponse",value:(L=(0,s.default)(o.default.mark(function e(t,n){var r,i,a,c,u,l,f,m,v,y,C=this,T=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=T.length>2&&void 0!==T[2]?T[2]:{},a=R.Timer.TIMER(),this.logWithLogger(S.LogLevel.INFO,d.OCSDKTelemetryEvent.SUBMITPOSTCHATSTARTED,"Submit Post Chat Started",t),c="/".concat(b.default.LiveChatSubmitPostChatPath,"/").concat(this.omnichannelConfiguration.orgId,"/").concat(this.omnichannelConfiguration.widgetId,"/").concat(t,"?channelId=").concat(this.omnichannelConfiguration.channelId),u=h.default.create(),(0,p.default)(u,{headerOverwrites:[I.default.authCodeNonce],retries:this.configuration.maxRequestRetriesOnFailure,waitTimeInMsBetweenRetries:this.configuration.waitTimeBetweenRetriesConfig.submitPostChatResponse}),l=i.authenticatedUserToken,f=g.default.defaultHeaders,this.addDefaultHeaders(t,f),l&&(c="/".concat(b.default.LiveChatAuthSubmitPostChatPath,"/").concat(this.omnichannelConfiguration.orgId,"/").concat(this.omnichannelConfiguration.widgetId,"/").concat(t,"?channelId=").concat(this.omnichannelConfiguration.channelId),f[I.default.authenticatedUserToken]=l,f[I.default.authCodeNonce]=this.configuration.authCodeNonce),m="".concat(this.omnichannelConfiguration.orgUrl).concat(c),v="POST",y={data:JSON.stringify(n),headers:f,method:v,url:m,timeout:null!==(r=this.configuration.defaultRequestTimeout)&&void 0!==r?r:this.configuration.requestTimeoutConfig.submitPostChatResponse},e.abrupt("return",new Promise(function(){var e=(0,s.default)(o.default.mark(function e(n,r){var i,s,l,h,p,m,T;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=R.Timer.TIMER(),e.prev=1,e.next=4,u(y);case 4:s=e.sent,l=i.milliSecondsElapsed,h=s.headers,C.setAuthCodeNonce(h),p=a.milliSecondsElapsed,C.logWithLogger(S.LogLevel.INFO,d.OCSDKTelemetryEvent.SUBMITPOSTCHATSUCCEEDED,"Submit Post Chat succeeded",t,s,p,c,v,void 0,void 0,f,l),n(),e.next=20;break;case 13:e.prev=13,e.t0=e.catch(1),m=i.milliSecondsElapsed,T=a.milliSecondsElapsed,C.logWithLogger(S.LogLevel.ERROR,d.OCSDKTelemetryEvent.SUBMITPOSTCHATFAILED,"Submit Post Chat Failed",t,void 0,T,c,v,e.t0,void 0,f,m),(0,k.default)(e.t0,g.default.axiosTimeoutErrorCode)&&r(new Error(C.HTTPTimeOutErrorMessage)),r(e.t0);case 20:case"end":return e.stop()}},e,null,[[1,13]])}));return function(t,n){return e.apply(this,arguments)}}()));case 14:case"end":return e.stop()}},e,this)})),function(e,t){return L.apply(this,arguments)})},{key:"getSurveyInviteLink",value:(N=(0,s.default)(o.default.mark(function e(t,n){var r,i,a,c,u,l,f,m,v,y,C,T=this,E=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=E.length>2&&void 0!==E[2]?E[2]:{},a=R.Timer.TIMER(),this.logger&&this.logger.log(S.LogLevel.INFO,d.OCSDKTelemetryEvent.GETSURVEYINVITELINKSTARTED,{SurveyOwnerId:t},"Get Survey Invite Link Started"),c="/".concat(b.default.LiveChatGetSurveyInviteLinkPath,"/").concat(this.omnichannelConfiguration.orgId,"/").concat(t),u=h.default.create(),(0,p.default)(u,{headerOverwrites:[I.default.authCodeNonce],retries:this.configuration.maxRequestRetriesOnFailure,waitTimeInMsBetweenRetries:this.configuration.waitTimeBetweenRetriesConfig.getSurveyInviteLink}),l=i.authenticatedUserToken,f=i.requestId,m=g.default.defaultHeaders,l&&(c="/".concat(b.default.LiveChatAuthGetSurveyInviteLinkPath,"/").concat(this.omnichannelConfiguration.orgId,"/").concat(t),m[I.default.authenticatedUserToken]=l,m[I.default.authCodeNonce]=this.configuration.authCodeNonce,m[I.default.widgetAppId]=this.omnichannelConfiguration.widgetId),this.addDefaultHeaders(f,m),f&&(m[I.default.requestId]=f),v="".concat(this.omnichannelConfiguration.orgUrl).concat(c),y="POST",C={data:JSON.stringify(n),headers:m,method:y,url:v,timeout:null!==(r=this.configuration.defaultRequestTimeout)&&void 0!==r?r:this.configuration.requestTimeoutConfig.getSurveyInviteLink},e.abrupt("return",new Promise(function(){var e=(0,s.default)(o.default.mark(function e(t,n){var r,i,s,l,h,p,v,E;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=R.Timer.TIMER(),e.prev=1,e.next=4,u(C);case 4:i=e.sent,s=r.milliSecondsElapsed,l=i.data,h=i.headers,T.setAuthCodeNonce(h),p=a.milliSecondsElapsed,T.logWithLogger(S.LogLevel.INFO,d.OCSDKTelemetryEvent.GETSURVEYINVITELINKSUCCEEDED,"Get Survey Invite Link Succeeded",f,i,p,c,y,void 0,void 0,m,s),t(l),e.next=20;break;case 13:e.prev=13,e.t0=e.catch(1),v=r.milliSecondsElapsed,E=a.milliSecondsElapsed,T.logWithLogger(S.LogLevel.ERROR,d.OCSDKTelemetryEvent.GETSURVEYINVITELINKFAILED,"Get Survey Invite Link failed",f,void 0,E,c,y,e.t0,void 0,m,v),(0,k.default)(e.t0,g.default.axiosTimeoutErrorCode)&&n(new Error(T.HTTPTimeOutErrorMessage)),n(e.t0);case 20:case"end":return e.stop()}},e,null,[[1,13]])}));return function(t,n){return e.apply(this,arguments)}}()));case 15:case"end":return e.stop()}},e,this)})),function(e,t){return N.apply(this,arguments)})},{key:"getChatTranscripts",value:(D=(0,s.default)(o.default.mark(function e(t,n,r){var i,a,c,u,l,f,m,v,y,C,T=this,E=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=E.length>3&&void 0!==E[3]?E[3]:{},c=R.Timer.TIMER(),this.logWithLogger(S.LogLevel.INFO,d.OCSDKTelemetryEvent.GETCHATTRANSCRIPTSTARTED,"Get Chat Transcript Started",t),u="/".concat(b.default.LiveChatGetChatTranscriptPath,"/").concat(n,"/").concat(t,"?channelId=").concat(this.omnichannelConfiguration.channelId),l=h.default.create(),(0,p.default)(l,{headerOverwrites:[I.default.authCodeNonce],retries:this.configuration.maxRequestRetriesOnFailure,waitTimeInMsBetweenRetries:this.configuration.waitTimeBetweenRetriesConfig.getChatTranscripts}),f=a.authenticatedUserToken,m=a.currentLiveChatVersion,(v=g.default.defaultHeaders)[I.default.organizationId]=this.omnichannelConfiguration.orgId,v[I.default.widgetAppId]=this.omnichannelConfiguration.widgetId,v[I.default.authorization]=r,this.liveChatVersion===d.LiveChatVersion.V2||m&&m===d.LiveChatVersion.V2?(u="/".concat(b.default.LiveChatv2GetChatTranscriptPath,"/").concat(n,"/").concat(t,"?channelId=").concat(this.omnichannelConfiguration.channelId),f&&(v[I.default.authenticatedUserToken]=f,v[I.default.authCodeNonce]=this.configuration.authCodeNonce,u="/".concat(b.default.LiveChatv2AuthGetChatTranscriptPath,"/").concat(n,"/").concat(t,"?channelId=").concat(this.omnichannelConfiguration.channelId))):f&&(v[I.default.authenticatedUserToken]=f,v[I.default.authCodeNonce]=this.configuration.authCodeNonce,u="/".concat(b.default.LiveChatAuthGetChatTranscriptPath,"/").concat(n,"/").concat(t,"?channelId=").concat(this.omnichannelConfiguration.channelId)),this.addDefaultHeaders(t,v),y="".concat(this.omnichannelConfiguration.orgUrl).concat(u),C={headers:v,method:"GET",url:y,timeout:null!==(i=this.configuration.defaultRequestTimeout)&&void 0!==i?i:this.configuration.requestTimeoutConfig.getChatTranscripts},e.abrupt("return",new Promise(function(){var e=(0,s.default)(o.default.mark(function e(n,r){var i,s,a,h,p,f,m,y;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=R.Timer.TIMER(),e.prev=1,e.next=4,l(C);case 4:s=e.sent,a=i.milliSecondsElapsed,h=c.milliSecondsElapsed,p=s.data,f=s.headers,T.setAuthCodeNonce(f),T.logWithLogger(S.LogLevel.INFO,d.OCSDKTelemetryEvent.GETCHATTRANSCRIPTSUCCEEDED,"Get Chat Transcript succeeded",t,s,h,u,"GET",void 0,void 0,v,a),n(p),e.next=20;break;case 13:e.prev=13,e.t0=e.catch(1),m=i.milliSecondsElapsed,y=c.milliSecondsElapsed,T.logWithLogger(S.LogLevel.ERROR,d.OCSDKTelemetryEvent.GETCHATTRANSCRIPTFAILED,"Get Chat Transcript failed",t,void 0,y,u,"GET",e.t0,void 0,v,m),(0,k.default)(e.t0,g.default.axiosTimeoutErrorCode)&&r(new Error(T.HTTPTimeOutErrorMessage)),r(e.t0);case 20:case"end":return e.stop()}},e,null,[[1,13]])}));return function(t,n){return e.apply(this,arguments)}}()));case 17:case"end":return e.stop()}},e,this)})),function(e,t,n){return D.apply(this,arguments)})},{key:"getPersistentChatHistory",value:(M=(0,s.default)(o.default.mark(function e(t){var n,r,i,a,c,u,l,f,m,v,y,C,T=this,E=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=E.length>1&&void 0!==E[1]?E[1]:{},i=R.Timer.TIMER(),this.logWithLogger(S.LogLevel.INFO,d.OCSDKTelemetryEvent.GETPERSISTENTCHATHISTORYSTARTED,"Get Persistent Chat History Started",t),a=r.authenticatedUserToken,c=r.pageSize,u=r.pageToken,a){e.next=8;break}return this.logWithLogger(S.LogLevel.ERROR,d.OCSDKTelemetryEvent.GETPERSISTENTCHATHISTORYFAILED,"Get Persistent Chat History failed - Missing authenticated user token",t),e.abrupt("return",Promise.reject(new Error("Authenticated user token is required for persistent chat history")));case 8:return l="/".concat(b.default.LiveChatAuthGetPersistentChatHistoryPath,"/").concat(this.omnichannelConfiguration.orgId,"/widgetapp/").concat(this.omnichannelConfiguration.widgetId,"/conversation/history"),f=h.default.create(),(0,p.default)(f,{headerOverwrites:[I.default.authCodeNonce],retries:this.configuration.maxRequestRetriesOnFailure,waitTimeInMsBetweenRetries:this.configuration.waitTimeBetweenRetriesConfig.getPersistentChatHistory}),(m=x({},g.default.defaultHeaders))[I.default.authenticatedUserToken]=a,m[I.default.authCodeNonce]=this.configuration.authCodeNonce,this.addDefaultHeaders(t,m),v={},c&&(v.pageSize=c.toString()),m[I.default.pageToken]=u||"",y="".concat(this.omnichannelConfiguration.orgUrl).concat(l),C={headers:m,method:"GET",url:y,params:v,timeout:null!==(n=this.configuration.defaultRequestTimeout)&&void 0!==n?n:this.configuration.requestTimeoutConfig.getPersistentChatHistory},e.abrupt("return",new Promise(function(){var e=(0,s.default)(o.default.mark(function e(n,r){var s,a,c,u,h,p,v,y;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=R.Timer.TIMER(),e.prev=1,e.next=4,f(C);case 4:a=e.sent,c=s.milliSecondsElapsed,u=i.milliSecondsElapsed,h=a.data,p=a.headers,T.setAuthCodeNonce(p),T.logWithLogger(S.LogLevel.INFO,d.OCSDKTelemetryEvent.GETPERSISTENTCHATHISTORYSUCCEEDED,"Get Persistent Chat History succeeded",t,a,u,l,"GET",void 0,void 0,m,c),n(h),e.next=22;break;case 13:if(e.prev=13,e.t0=e.catch(1),v=s.milliSecondsElapsed,y=i.milliSecondsElapsed,T.logWithLogger(S.LogLevel.ERROR,d.OCSDKTelemetryEvent.GETPERSISTENTCHATHISTORYFAILED,"Get Persistent Chat History failed",t,void 0,y,l,"GET",e.t0,void 0,m,v),!(0,k.default)(e.t0,g.default.axiosTimeoutErrorCode)){e.next=21;break}return r(new Error(T.HTTPTimeOutErrorMessage)),e.abrupt("return");case 21:r(e.t0);case 22:case"end":return e.stop()}},e,null,[[1,13]])}));return function(t,n){return e.apply(this,arguments)}}()));case 22:case"end":return e.stop()}},e,this)})),function(e){return M.apply(this,arguments)})},{key:"emailTranscript",value:(i=(0,s.default)(o.default.mark(function e(t,n,r){var i,a,c,u,l,f,m,v,y,C,T=this,E=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=E.length>3&&void 0!==E[3]?E[3]:{},c=R.Timer.TIMER(),this.logWithLogger(S.LogLevel.INFO,d.OCSDKTelemetryEvent.EMAILTRANSCRIPTSTARTED,"Email Transcript Started",t),u="/".concat(b.default.LiveChatTranscriptEmailRequestPath,"/").concat(t,"?channelId=").concat(this.omnichannelConfiguration.channelId),l=h.default.create(),(0,p.default)(l,{headerOverwrites:[I.default.authCodeNonce],retries:this.configuration.maxRequestRetriesOnFailure,waitTimeInMsBetweenRetries:this.configuration.waitTimeBetweenRetriesConfig.emailTranscript}),f=a.authenticatedUserToken,(m=g.default.defaultHeaders)[I.default.organizationId]=this.omnichannelConfiguration.orgId,m[I.default.widgetAppId]=this.omnichannelConfiguration.widgetId,m[I.default.authorization]=n,f&&(m[I.default.authenticatedUserToken]=f,m[I.default.authCodeNonce]=this.configuration.authCodeNonce,u="/".concat(b.default.LiveChatAuthTranscriptEmailRequestPath,"/").concat(t,"?channelId=").concat(this.omnichannelConfiguration.channelId)),this.addDefaultHeaders(t,m),v="".concat(this.omnichannelConfiguration.orgUrl).concat(u),y="POST",C={data:JSON.stringify(r),headers:m,method:y,url:v,timeout:null!==(i=this.configuration.defaultRequestTimeout)&&void 0!==i?i:this.configuration.requestTimeoutConfig.emailTranscript},e.abrupt("return",new Promise(function(){var e=(0,s.default)(o.default.mark(function e(n,r){var i,s,a,h,p,f,v;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=R.Timer.TIMER(),e.prev=1,e.next=4,l(C);case 4:s=e.sent,a=i.milliSecondsElapsed,h=s.headers,T.setAuthCodeNonce(h),p=c.milliSecondsElapsed,T.logWithLogger(S.LogLevel.INFO,d.OCSDKTelemetryEvent.EMAILTRANSCRIPTSUCCEEDED,"Email Transcript succeeded",t,s,p,u,y,void 0,void 0,m,a),n(),e.next=20;break;case 13:e.prev=13,e.t0=e.catch(1),f=i.milliSecondsElapsed,v=c.milliSecondsElapsed,T.logWithLogger(S.LogLevel.ERROR,d.OCSDKTelemetryEvent.EMAILTRANSCRIPTFAILED,"Email Transcript Failed",t,void 0,v,u,y,e.t0,void 0,m,f),(0,k.default)(e.t0,g.default.axiosTimeoutErrorCode)&&r(new Error(T.HTTPTimeOutErrorMessage)),r(e.t0);case 20:case"end":return e.stop()}},e,null,[[1,13]])}));return function(t,n){return e.apply(this,arguments)}}()));case 17:case"end":return e.stop()}},e,this)})),function(e,t,n){return i.apply(this,arguments)})},{key:"fetchDataMaskingInfo",value:(r=(0,s.default)(o.default.mark(function e(t){var n,r,i,a,c,u,l,f=this;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=R.Timer.TIMER(),this.logWithLogger(S.LogLevel.INFO,d.OCSDKTelemetryEvent.FETCHDATAMASKINGSTARTED,"Fetch Data Masking Started",t),t||(t=(0,P.uuidv4)()),i="/".concat(b.default.LiveChatFetchDataMaskingInfoPath,"/").concat(this.omnichannelConfiguration.orgId),a=h.default.create(),(0,p.default)(a,{retries:this.configuration.maxRequestRetriesOnFailure,waitTimeInMsBetweenRetries:this.configuration.waitTimeBetweenRetriesConfig.fetchDataMaskingInfo}),(c=g.default.defaultHeaders)[I.default.organizationId]=this.omnichannelConfiguration.orgId,c[I.default.requestId]=t,this.addDefaultHeaders(t,c),u="".concat(this.omnichannelConfiguration.orgUrl).concat(i),l={headers:c,method:"GET",url:u,timeout:null!==(n=this.configuration.defaultRequestTimeout)&&void 0!==n?n:this.configuration.requestTimeoutConfig.fetchDataMaskingInfo},e.abrupt("return",new Promise(function(){var e=(0,s.default)(o.default.mark(function e(n,s){var u,h,p,m,v,y,C;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return u=R.Timer.TIMER(),e.prev=1,e.next=4,a(l);case 4:h=e.sent,p=u.milliSecondsElapsed,m=r.milliSecondsElapsed,v=h.data,f.logWithLogger(S.LogLevel.INFO,d.OCSDKTelemetryEvent.FETCHDATAMASKINGSUCCEEDED,"Fetch Data Masking succeeded",t,h,m,i,"GET",void 0,void 0,c,p),n(v),e.next=19;break;case 12:e.prev=12,e.t0=e.catch(1),y=u.milliSecondsElapsed,C=r.milliSecondsElapsed,f.logWithLogger(S.LogLevel.ERROR,d.OCSDKTelemetryEvent.FETCHDATAMASKINGFAILED,"Fetch Data Masking Failed",t,void 0,C,i,"GET",e.t0,void 0,c,y),(0,k.default)(e.t0,g.default.axiosTimeoutErrorCode)&&s(new Error(f.HTTPTimeOutErrorMessage)),s(e.t0);case 19:case"end":return e.stop()}},e,null,[[1,12]])}));return function(t,n){return e.apply(this,arguments)}}()));case 14:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"makeSecondaryChannelEventRequest",value:(n=(0,s.default)(o.default.mark(function e(t,n){var r,i,a,c,u,l,f,m,v,y,C=this,T=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=T.length>2&&void 0!==T[2]?T[2]:{},a=R.Timer.TIMER(),this.logWithLogger(S.LogLevel.INFO,d.OCSDKTelemetryEvent.SECONDARYCHANNELEVENTREQUESTSTARTED,"Secondary Channel Event Request Started",t),c="/".concat(b.default.LiveChatSecondaryChannelEventPath,"/").concat(this.omnichannelConfiguration.orgId,"/").concat(this.omnichannelConfiguration.widgetId,"/").concat(t),u=h.default.create(),(0,p.default)(u,{headerOverwrites:[I.default.authCodeNonce],retries:this.configuration.maxRequestRetriesOnFailure,waitTimeInMsBetweenRetries:this.configuration.waitTimeBetweenRetriesConfig.makeSecondaryChannelEventRequest}),l=i.authenticatedUserToken,(f=g.default.defaultHeaders)[I.default.organizationId]=this.omnichannelConfiguration.orgId,l&&(f[I.default.authenticatedUserToken]=l,f[I.default.authCodeNonce]=this.configuration.authCodeNonce,c="/".concat(b.default.LiveChatAuthSecondaryChannelEventPath,"/").concat(this.omnichannelConfiguration.orgId,"/").concat(this.omnichannelConfiguration.widgetId,"/").concat(t)),this.addDefaultHeaders(t,f),c+="?channelId="+g.default.defaultChannelId,m="".concat(this.omnichannelConfiguration.orgUrl).concat(c),v="POST",y={data:JSON.stringify(n),headers:f,method:v,url:m,timeout:null!==(r=this.configuration.defaultRequestTimeout)&&void 0!==r?r:this.configuration.requestTimeoutConfig.makeSecondaryChannelEventRequest},e.abrupt("return",new Promise(function(){var e=(0,s.default)(o.default.mark(function e(n,r){var i,s,l,h,p,m,T;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=R.Timer.TIMER(),e.prev=1,e.next=4,u(y);case 4:s=e.sent,l=i.milliSecondsElapsed,h=s.headers,C.setAuthCodeNonce(h),p=a.milliSecondsElapsed,C.logWithLogger(S.LogLevel.INFO,d.OCSDKTelemetryEvent.SECONDARYCHANNELEVENTREQUESTSUCCEEDED,"Secondary Channel Event Request Succeeded",t,s,p,c,v,void 0,void 0,f,l),n(),e.next=20;break;case 13:e.prev=13,e.t0=e.catch(1),m=i.milliSecondsElapsed,T=a.milliSecondsElapsed,C.logWithLogger(S.LogLevel.ERROR,d.OCSDKTelemetryEvent.SECONDARYCHANNELEVENTREQUESTFAILED,"Secondary Channel Event Request Failed",t,void 0,T,c,v,e.t0,void 0,f,m),(0,k.default)(e.t0,g.default.axiosTimeoutErrorCode)&&r(new Error(C.HTTPTimeOutErrorMessage)),r(e.t0);case 20:case"end":return e.stop()}},e,null,[[1,13]])}));return function(t,n){return e.apply(this,arguments)}}()));case 16:case"end":return e.stop()}},e,this)})),function(e,t){return n.apply(this,arguments)})},{key:"sendTypingIndicator",value:(t=(0,s.default)(o.default.mark(function e(t,n){var r,i,a,c,u,l,p,f,m,v,y=this,C=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=C.length>2&&void 0!==C[2]?C[2]:{},n&&n===d.LiveChatVersion.V2){e.next=3;break}return e.abrupt("return",Promise.resolve());case 3:if(a=R.Timer.TIMER(),c=i.customerDisplayName,n&&n===d.LiveChatVersion.V2){e.next=7;break}throw new Error("Typing indicator is only supported on v2");case 7:return u="/".concat(b.default.SendTypingIndicatorPath,"/").concat(t),l=h.default.create(),(p=g.default.defaultHeaders)[I.default.organizationId]=this.omnichannelConfiguration.orgId,c&&(p[g.default.customerDisplayName]=c),this.addDefaultHeaders(t,p),f="".concat(this.omnichannelConfiguration.orgUrl).concat(u),v={headers:p,method:m="POST",url:f,timeout:null!==(r=this.configuration.defaultRequestTimeout)&&void 0!==r?r:this.configuration.requestTimeoutConfig.sendTypingIndicator},e.abrupt("return",new Promise(function(){var e=(0,s.default)(o.default.mark(function e(n,r){var i,s,c,h,f,C;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=R.Timer.TIMER(),e.prev=1,e.next=4,l(v);case 4:s=e.sent,c=i.milliSecondsElapsed,h=a.milliSecondsElapsed,y.logWithLogger(S.LogLevel.INFO,d.OCSDKTelemetryEvent.SENDTYPINGINDICATORSUCCEEDED,"Send Typing Indicator Succeeded",t,s,h,u,m,void 0,void 0,p,c),n(),e.next=18;break;case 11:e.prev=11,e.t0=e.catch(1),f=i.milliSecondsElapsed,C=a.milliSecondsElapsed,y.logWithLogger(S.LogLevel.ERROR,d.OCSDKTelemetryEvent.SENDTYPINGINDICATORFAILED,"Send Typing Indicator Failed",t,void 0,C,u,m,e.t0,void 0,p,f),(0,k.default)(e.t0,g.default.axiosTimeoutErrorCode)&&r(new Error(y.HTTPTimeOutErrorMessage)),r(e.t0);case 18:case"end":return e.stop()}},e,null,[[1,11]])}));return function(t,n){return e.apply(this,arguments)}}()));case 17:case"end":return e.stop()}},e,this)})),function(e,n){return t.apply(this,arguments)})},{key:"logWithLogger",value:function(e,t,n,r,i,o,s,a,c,u,l,d){var h,p,f,m;if(this.logger){c&&T.LoggingSanitizer.stripErrorSensitiveProperties(c);var v=void 0;u&&((v=x({},u)).customContextData&&T.LoggingSanitizer.stripCustomContextDataValues(v.customContextData),v.preChatResponse&&T.LoggingSanitizer.stripPreChatResponse(v.preChatResponse),T.LoggingSanitizer.stripGeolocation(v));var y=void 0,C=void 0;if(l&&(y=x({},l),T.LoggingSanitizer.stripRequestHeadersSensitiveProperties(y),l[I.default.authenticatedUserToken]&&window.document&&window.atob))try{var S=l[I.default.authenticatedUserToken].split(".")[1],E=window.atob(S),b=JSON.parse(E),w=b.lwicontexts;if(C={sub:b.sub,exp:b.exp},w){var R=JSON.parse(w);T.LoggingSanitizer.stripCustomContextDataValues(R),C.lwiContexts=R}}catch(e){}var A={RequestId:r,Region:null==i?void 0:i.data.Region,ElapsedTimeInMilliseconds:o,HttpRequestResponseTime:d,TransactionId:null==i?void 0:i.headers[g.default.transactionid],RequestPath:s,RequestMethod:a,ResponseStatusCode:i?i.status:c?null===(h=c.response)||void 0===h?void 0:h.status:void 0,ExceptionDetails:c?(null===(p=c.response)||void 0===p?void 0:p.data)||c:void 0,RequestPayload:v,RequestHeaders:y,ResponseErrorcode:c?null===(f=c.response)||void 0===f||null===(m=f.headers)||void 0===m?void 0:m.errorcode:void 0,AuthTokenDetails:C};this.logger.log(e,t,A,n)}}},{key:"addDefaultHeaders",value:function(e,t){this.setSessionIdHeader(this.sessionId,t),(0,A.addOcUserAgentHeader)(this.ocUserAgent,t),this.setCorrelationIdInHeader(e,t)}}]),e}();t.default=L,(0,l.default)(L,"defaultRequestTimeoutConfig",{getChatConfig:12e4,getLWIDetails:15e3,getChatToken:15e3,sessionInit:15e3,sessionClose:15e3,getReconnectableChats:15e3,getReconnectAvailability:15e3,submitPostChatResponse:15e3,getSurveyInviteLink:15e3,getChatTranscripts:3e4,emailTranscript:5e3,fetchDataMaskingInfo:5e3,makeSecondaryChannelEventRequest:15e3,getAgentAvailability:15e3,sendTypingIndicator:5e3,validateAuthChatRecordTimeout:15e3,getPersistentChatHistory:15e3}),(0,l.default)(L,"defaultConfiguration",{authCodeNonce:(0,P.uuidv4)().substring(0,8),getChatTokenRetryCount:10,getChatTokenTimeBetweenRetriesOnFailure:1e4,getChatTokenRetryOn429:!0,maxRequestRetriesOnFailure:5,defaultRequestTimeout:void 0,requestTimeoutConfig:L.defaultRequestTimeoutConfig,useUnauthReconnectIdSigQueryParam:!1,waitTimeBetweenRetriesConfig:M.waitTimeBetweenRetriesConfigs,ocUserAgent:[]})},5119:e=>{"use strict";e.exports=JSON.parse('{"rE":"0.5.20-main.c747daa"}')},5123:function(e,t){"use strict";var n=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((r=r.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.getAttachmentSizes=t.getAttachments=t.getDataURL=void 0,t.getDataURL=function(e){return n(void 0,void 0,void 0,function(){return r(this,function(t){return[2,new Promise(function(t){var n=new FileReader;n.onloadend=function(){t(n.result)},n.readAsDataURL(e)})]})})},t.getAttachments=function(e){return n(void 0,void 0,void 0,function(){return r(this,function(i){return[2,Promise.all(e.map(function(e){return n(void 0,void 0,void 0,function(){var n;return r(this,function(r){switch(r.label){case 0:return e?[4,(0,t.getDataURL)(e)]:[3,2];case 1:return n=r.sent(),[2,{contentType:e.type,contentUrl:n,name:e.name,thumbnailUrl:e.type.match("(image|video|audio).*")?n:void 0}];case 2:return[2]}})})}))]})})},t.getAttachmentSizes=function(e){return e.map(function(e){return e.size})},t.default={getDataURL:t.getDataURL,getAttachments:t.getAttachments,getAttachmentSizes:t.getAttachmentSizes}},5162:(e,t,n)=>{"use strict";var r=n(4994);Object.defineProperty(t,"__esModule",{value:!0}),t.DeviceInfo=void 0;var i=r(n(7383)),o=r(n(4579)),s=n(86),a=function(){function e(){(0,i.default)(this,e)}return(0,o.default)(e,null,[{key:"getDeviceType",value:function(){return window.navigator.userAgent.match(/(android|ipod|windows phone|wpdesktop|windows ce|blackberry\w*|meego|webos|palm|symbian|pda|\w*?mobile\w*?|\w*?phone\w*?)/i)?s.DeviceType.Mobile:window.navigator.userAgent.match(/tablet|ipad/i)?s.DeviceType.Tablet:s.DeviceType.Desktop}}]),e}();t.DeviceInfo=a},5172:e=>{e.exports=function(e,t){this.v=e,this.k=t},e.exports.__esModule=!0,e.exports.default=e.exports},5274:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},o=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.VoiceVideoCallingProxy=void 0;var s,a,c,u=n(1649);!function(e){e[e.Voice=19237e4]="Voice",e[e.Video=19238e4]="Video",e[e.Cobrowse=19239e4]="Cobrowse"}(s||(s={})),function(e){e.Accept="accept",e.Reject="reject",e.Connect="connect",e.End="end"}(a||(a={})),function(e){e.CallAdded="callAdded",e.LocalVideoStreamAdded="localVideoStreamAdded",e.LocalVideoStreamRemoved="localVideoStreamRemoved",e.RemoteVideoStreamAdded="remoteVideoStreamAdded",e.RemoteVideoStreamRemoved="remoteVideoStreamRemoved",e.CallDisconnected="callDisconnected",e.ParticipantDisconnected="participantDisconnected",e.IncomingCallEnded="incomingCallEnded"}(c||(c={}));var l=function(){function e(){this.debug=!1,this.callClientName="ElevateToVoiceVideo",this.proxy=window["Microsoft.Omnichannel.Calling.SDK"].VoiceVideoCalling,this.proxyInstance=this.proxy.getInstance()}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setDebug=function(e){this.debug=e},e.prototype.useScenarioMarker=function(e){this.scenarioMarker=e},e.prototype.load=function(){return r(this,arguments,void 0,function(e){return void 0===e&&(e={}),i(this,function(t){return e.logger&&(this.logger=e.logger),this.proxyInstance.load(e),[2]})})},e.prototype.isInitialized=function(){return this.proxyInstance.isInitialized()},e.prototype.initialize=function(e){return r(this,void 0,void 0,function(){var t,n,r,o,s,a,c,l,d;return i(this,function(i){switch(i.label){case 0:return this.debug&&console.debug("[VoiceVideoCallingProxy] VoiceVideoCallingParams: ".concat(JSON.stringify(e))),this.callingParams=e,null===(n=this.scenarioMarker)||void 0===n||n.startScenario(u.default.InitializeVoiceVideoCallingSDK),this.debug&&console.debug("[VoiceVideoCallingProxy][initialize] _isLoaded: ".concat(this.proxyInstance._isLoaded)),this.proxyInstance._isLoaded?[3,2]:[4,this.proxyInstance.load({logger:this.logger||void 0})];case 1:i.sent(),i.label=2;case 2:return i.trys.push([2,4,,5]),[4,this.proxyInstance.initialize({callClientName:this.callClientName,accesstoken:(null===(o=null===(r=this.callingParams)||void 0===r?void 0:r.chatToken.voiceVideoCallToken)||void 0===o?void 0:o.Token)||(null===(s=this.callingParams)||void 0===s?void 0:s.chatToken.token),selfVideoHTMLElementId:null===(a=this.callingParams)||void 0===a?void 0:a.selfVideoHTMLElementId,remoteVideoHTMLElementId:null===(c=this.callingParams)||void 0===c?void 0:c.remoteVideoHTMLElementId})];case 3:return i.sent(),null===(l=this.scenarioMarker)||void 0===l||l.completeScenario(u.default.InitializeVoiceVideoCallingSDK),[3,5];case 4:return t=i.sent(),console.log(t),null===(d=this.scenarioMarker)||void 0===d||d.failScenario(u.default.InitializeVoiceVideoCallingSDK),[3,5];case 5:return[2]}})})},e.prototype.addEventListener=function(e,t){var n=this;this.proxyInstance.registerEvent(e,function(r){var i=r.callId;e===c.CallAdded&&(n.callId=i),n.debug&&console.debug("[VoiceVideoCallingProxy][".concat(e,"] callId: ").concat(i)),i===n.callId&&t(r)})},e.prototype.isMicrophoneMuted=function(){var e=this.callClientName,t=this.callId;return this.proxyInstance.isMicrophoneMuted({callClientName:e,callId:t})},e.prototype.acceptCall=function(){return r(this,arguments,void 0,function(e){var t,n,r,o,c,l,d,h,p,f,g;return void 0===e&&(e={}),i(this,function(i){switch(i.label){case 0:n=(t=this).callClientName,r=t.callId,null===(l=this.scenarioMarker)||void 0===l||l.startScenario(e.withVideo?u.default.AcceptVideoCall:u.default.AcceptVoiceCall,{CallId:r||""}),this.debug&&console.debug("[VoiceVideoCallingProxy][acceptCall] callId: ".concat(r)),this.debug&&console.debug(e),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.proxyInstance.acceptCall({callClientName:n,callId:r,withVideo:e.withVideo||!1})];case 2:return i.sent(),[3,4];case 3:return i.sent(),c={response:e.withVideo?"AcceptVideoCallFailed":"AcceptVoiceCallFailed"},null===(d=this.scenarioMarker)||void 0===d||d.failScenario(e.withVideo?u.default.AcceptVideoCall:u.default.AcceptVoiceCall,{CallId:r||"",ExceptionDetails:JSON.stringify(c)}),[3,4];case 4:o={SecondaryChannelType:e.withVideo?s.Video:s.Voice,SecondaryChannelEventType:a.Accept};try{null===(h=this.callingParams)||void 0===h||h.OCClient.makeSecondaryChannelEventRequest(null===(p=this.callingParams)||void 0===p?void 0:p.chatToken.requestId,o),null===(f=this.scenarioMarker)||void 0===f||f.completeScenario(e.withVideo?u.default.AcceptVideoCall:u.default.AcceptVoiceCall,{CallId:r||""}),this.debug&&console.debug("[VoiceVideoCallingProxy][acceptCall][makeSecondaryChannelEventRequest]")}catch(t){c={response:"OCClientMakeSecondaryChannelEventRequestFailed"},null===(g=this.scenarioMarker)||void 0===g||g.failScenario(e.withVideo?u.default.AcceptVideoCall:u.default.AcceptVoiceCall,{CallId:r||"",ExceptionDetails:JSON.stringify(c)}),console.error("[VoiceVideoCallingProxy][acceptCall][makeSecondaryChannelEventRequest] Failure ".concat(t))}return[2]}})})},e.prototype.rejectCall=function(){return r(this,void 0,void 0,function(){var e,t,n,r,o,c,l,d,h,p,f;return i(this,function(i){switch(i.label){case 0:t=(e=this).callClientName,n=e.callId,null===(c=this.scenarioMarker)||void 0===c||c.startScenario(u.default.RejectCall,{CallId:n||""}),this.debug&&console.debug("[VoiceVideoCallingProxy][rejectCall] callId: ".concat(n)),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.proxyInstance.rejectCall({callClientName:t,callId:n})];case 2:return i.sent(),null===(l=this.scenarioMarker)||void 0===l||l.completeScenario(u.default.RejectCall,{CallId:n||""}),[3,4];case 3:return i.sent(),o={response:"RejectCallFailed"},null===(d=this.scenarioMarker)||void 0===d||d.failScenario(u.default.RejectCall,{CallId:n||"",ExceptionDetails:JSON.stringify(o)}),[3,4];case 4:r={SecondaryChannelType:this.isRemoteVideoEnabled()?s.Video:s.Voice,SecondaryChannelEventType:a.Reject};try{null===(h=this.callingParams)||void 0===h||h.OCClient.makeSecondaryChannelEventRequest(null===(p=this.callingParams)||void 0===p?void 0:p.chatToken.requestId,r),this.debug&&console.debug("[VoiceVideoCallingProxy][rejectCall][makeSecondaryChannelEventRequest]")}catch(e){o={response:"OCClientMakeSecondaryChannelEventRequestFailed"},null===(f=this.scenarioMarker)||void 0===f||f.failScenario(u.default.RejectCall,{CallId:n||"",ExceptionDetails:JSON.stringify(o)}),console.error("[VoiceVideoCallingProxy][rejectCall][makeSecondaryChannelEventRequest] Failure ".concat(e))}return[2]}})})},e.prototype.stopCall=function(){return r(this,void 0,void 0,function(){var e,t,n,r,o,s,a,c,l;return i(this,function(i){switch(i.label){case 0:t=(e=this).callClientName,n=e.callId,null===(o=this.scenarioMarker)||void 0===o||o.startScenario(u.default.StopCall,{CallId:n||""}),this.debug&&console.debug("[VoiceVideoCallingProxy][stopCall] callId: ".concat(n)),r=!!(null===(a=null===(s=this.callingParams)||void 0===s?void 0:s.chatToken.voiceVideoCallToken)||void 0===a?void 0:a.Token),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.proxyInstance.stopCall({callClientName:t,callId:n,forEveryone:r})];case 2:return i.sent(),null===(c=this.scenarioMarker)||void 0===c||c.completeScenario(u.default.StopCall,{CallId:n||""}),[3,4];case 3:return i.sent(),null===(l=this.scenarioMarker)||void 0===l||l.failScenario(u.default.StopCall,{CallId:n||""}),[3,4];case 4:return[2]}})})},e.prototype.toggleMute=function(){return r(this,void 0,void 0,function(){var e,t,n;return i(this,function(r){return t=(e=this).callClientName,n=e.callId,[2,this.proxyInstance.toggleMute({callClientName:t,callId:n})]})})},e.prototype.isRemoteVideoEnabled=function(){var e=this.callClientName,t=this.callId;return this.proxyInstance.isRemoteVideoEnabled({callClientName:e,callId:t})},e.prototype.isLocalVideoEnabled=function(){var e=this.callClientName,t=this.callId;return this.proxyInstance.isLocalVideoEnabled({callClientName:e,callId:t})},e.prototype.toggleLocalVideo=function(){return r(this,void 0,void 0,function(){var e,t,n;return i(this,function(r){return t=(e=this).callClientName,n=e.callId,[2,this.proxyInstance.toggleLocalVideo({callClientName:t,callId:n})]})})},e.prototype.isInACall=function(){var e=this.callClientName,t=this.callId;return this.proxyInstance.isInACall({callClientName:e,callId:t})},e.prototype.renderVideoStreams=function(){var e=this.callClientName,t=this.callId;return this.proxyInstance.renderVideoStreams({callClientName:e,callId:t})},e.prototype.disposeVideoRenderers=function(){var e=this.callClientName,t=this.callId;return this.proxyInstance.disposeVideoRenderers({callClientName:e,callId:t})},e.prototype.close=function(){this.debug&&console.debug("[VoiceVideoCallingProxy][close]"),this.proxyInstance.dispose(),this.callingParams=void 0,this.callId=void 0},e.prototype.onCallAdded=function(e){var t=c.CallAdded;this.debug&&console.debug("[VoiceVideoCallingProxy][".concat(t,"]")),this.addEventListener(t,e)},e.prototype.onLocalVideoStreamAdded=function(e){var t=c.LocalVideoStreamAdded;this.debug&&console.debug("[VoiceVideoCallingProxy][".concat(t,"]")),this.addEventListener(t,e)},e.prototype.onLocalVideoStreamRemoved=function(e){var t=c.LocalVideoStreamRemoved;this.debug&&console.debug("[VoiceVideoCallingProxy][".concat(t,"]")),this.addEventListener(t,e)},e.prototype.onRemoteVideoStreamAdded=function(e){var t=c.RemoteVideoStreamAdded;this.debug&&console.debug("[VoiceVideoCallingProxy][".concat(t,"]")),this.addEventListener(t,e)},e.prototype.onRemoteVideoStreamRemoved=function(e){var t=c.RemoteVideoStreamRemoved;this.debug&&console.debug("[VoiceVideoCallingProxy][".concat(t,"]")),this.addEventListener(t,e)},e.prototype.onCallDisconnected=function(e){var t=this,n=c.CallDisconnected;this.debug&&console.debug("[VoiceVideoCallingProxy][".concat(n,"]")),this.addEventListener(n,function(n){return r(t,void 0,void 0,function(){var t,r,o,c,l,d,h;return i(this,function(i){t={SecondaryChannelType:s.Voice,SecondaryChannelEventType:a.End},null===(o=this.scenarioMarker)||void 0===o||o.startScenario(u.default.OnCallDisconnected,{CallId:this.callId||""});try{null===(c=this.callingParams)||void 0===c||c.OCClient.makeSecondaryChannelEventRequest(null===(l=this.callingParams)||void 0===l?void 0:l.chatToken.requestId,t),this.debug&&console.debug("[VoiceVideoCallingProxy][onCallDisconnected][makeSecondaryChannelEventRequest]"),null===(d=this.scenarioMarker)||void 0===d||d.completeScenario(u.default.OnCallDisconnected,{CallId:this.callId||""})}catch(e){console.error("[VoiceVideoCallingProxy][onCallDisconnected][makeSecondaryChannelEventRequest] Failure ".concat(e)),r={response:"OCClientMakeSecondaryChannelEventRequestFailed"},null===(h=this.scenarioMarker)||void 0===h||h.failScenario(u.default.OnCallDisconnected,{CallId:this.callId||"",ExceptionDetails:JSON.stringify(r)})}return this.clearRemoteVideoElementChildren(),e(n),[2]})})})},e.prototype.clearRemoteVideoElementChildren=function(){var e,t;if(null===(e=this.callingParams)||void 0===e?void 0:e.remoteVideoHTMLElementId)for(var n=document.getElementById(null===(t=this.callingParams)||void 0===t?void 0:t.remoteVideoHTMLElementId);null==n?void 0:n.firstChild;)this.debug&&console.debug("[VoiceVideoCallingProxy][clearRemoteVideoElement]"),n.firstChild.remove()},e}();t.VoiceVideoCallingProxy=l,t.default=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r(void 0,o([],e,!0),void 0,function(e){var t;return void 0===e&&(e={}),i(this,function(n){switch(n.label){case 0:return[4,(t=l.getInstance()).load({logger:e.logger||void 0})];case 1:return n.sent(),[2,Promise.resolve(t)]}})})}},5498:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=["gov.omnichannelengagementhub.us","-crm9"]},5513:(e,t,n)=>{"use strict";n.d(t,{I:()=>a});var r=n(8603);const i="REDACTED",o=["x-ms-client-request-id","x-ms-return-client-request-id","x-ms-useragent","x-ms-correlation-request-id","x-ms-request-id","client-request-id","ms-cv","return-client-request-id","traceparent","Access-Control-Allow-Credentials","Access-Control-Allow-Headers","Access-Control-Allow-Methods","Access-Control-Allow-Origin","Access-Control-Expose-Headers","Access-Control-Max-Age","Access-Control-Request-Headers","Access-Control-Request-Method","Origin","Accept","Accept-Encoding","Cache-Control","Connection","Content-Length","Content-Type","Date","ETag","Expires","If-Match","If-Modified-Since","If-None-Match","If-Unmodified-Since","Last-Modified","Pragma","Request-Id","Retry-After","Server","Transfer-Encoding","User-Agent","WWW-Authenticate"],s=["api-version"];class a{allowedHeaderNames;allowedQueryParameters;constructor({additionalAllowedHeaderNames:e=[],additionalAllowedQueryParameters:t=[]}={}){e=o.concat(e),t=s.concat(t),this.allowedHeaderNames=new Set(e.map(e=>e.toLowerCase())),this.allowedQueryParameters=new Set(t.map(e=>e.toLowerCase()))}sanitize(e){const t=new Set;return JSON.stringify(e,(e,n)=>{if(n instanceof Error)return{...n,name:n.name,message:n.message};if("headers"===e)return this.sanitizeHeaders(n);if("url"===e)return this.sanitizeUrl(n);if("query"===e)return this.sanitizeQuery(n);if("body"!==e&&"response"!==e&&"operationSpec"!==e){if(Array.isArray(n)||(0,r.G)(n)){if(t.has(n))return"[Circular]";t.add(n)}return n}},2)}sanitizeUrl(e){if("string"!=typeof e||null===e||""===e)return e;const t=new URL(e);if(!t.search)return e;for(const[e]of t.searchParams)this.allowedQueryParameters.has(e.toLowerCase())||t.searchParams.set(e,i);return t.toString()}sanitizeHeaders(e){const t={};for(const n of Object.keys(e))this.allowedHeaderNames.has(n.toLowerCase())?t[n]=e[n]:t[n]=i;return t}sanitizeQuery(e){if("object"!=typeof e||null===e)return e;const t={};for(const n of Object.keys(e))this.allowedQueryParameters.has(n.toLowerCase())?t[n]=e[n]:t[n]=i;return t}}},5546:e=>{function t(n,r,i,o){var s=Object.defineProperty;try{s({},"",{})}catch(n){s=0}e.exports=t=function(e,n,r,i){function o(n,r){t(e,n,function(e){return this._invoke(n,r,e)})}n?s?s(e,n,{value:r,enumerable:!i,configurable:!i,writable:!i}):e[n]=r:(o("next",0),o("throw",1),o("return",2))},e.exports.__esModule=!0,e.exports.default=e.exports,t(n,r,i,o)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},5590:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)},i=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0});var o=n(44),s=n(4049);t.default=function(e,t){var n=(0,o.getOmnichannelChatSdkVersion)(),a="omnichannel-chat-sdk/".concat(n),c=t?i(i([],t,!0),[a],!1):[a],u=r(r({},s.default),{ocUserAgent:c});return e&&(u.useUnauthReconnectIdSigQueryParam=!0),u}},5641:(e,t,n)=>{"use strict";n.d(t,{N:()=>i});const r="function"==typeof globalThis?.crypto?.randomUUID?globalThis.crypto.randomUUID.bind(globalThis.crypto):function(){let e="";for(let t=0;t<32;t++){const n=Math.floor(16*Math.random());e+=12===t?"4":16===t?3&n|8:n.toString(16),7!==t&&11!==t&&15!==t&&19!==t||(e+="-")}return e};function i(){return r()}},5701:(e,t,n)=>{"use strict";var r=n(4994);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(7383)),o=r(n(4579)),s=function(){function e(){(0,i.default)(this,e)}return(0,o.default)(e,null,[{key:"GETTELEMETRYEVENTDATA",value:function(e,t,n){return{Description:n,ElapsedTimeInMilliseconds:t.ElapsedTimeInMilliseconds,HttpRequestResponseTime:t.HttpRequestResponseTime,Event:e,ExceptionDetails:t.ExceptionDetails,Region:t.Region,RequestId:t.RequestId,TransactionId:t.TransactionId,RequestHeaders:t.RequestHeaders,RequestPayload:t.RequestPayload,RequestPath:t.RequestPath,RequestMethod:t.RequestMethod,ResponseStatusCode:t.ResponseStatusCode,ResponseErrorcode:t.ResponseErrorcode,AuthTokenDetails:t.AuthTokenDetails}}}]),e}();t.default=s},5719:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HttpClient=void 0;var r=n(3364),i=n(4746),o=n(8247),s=n(1659),a=n(4372),c=n(4665),u=n(6425),l=function(){function e(){}return e.MakeRequest=function(t){return new Promise(function(n,o){var s=0,l=t.retryCount||1,d={url:t.url,method:t.type,data:t.data,timeout:t.timeout,headers:t.headers,withCredentials:t.useXHRWithCredentials||!1},h=function(){u.default.request(d).then(function(r){!function(r,i){if(i.status>=400){var o={ResponseText:i.statusText,Status:status};e.logWarning("Requesting "+t.url,i.status,o)}t.callbackOnSuccess&&t.callbackOnSuccess(i),n(r)}(r.data,r)}).catch(function(n){!function(n){var u,d,p,f,g,m,v,y,C,S,T={ErrorThrown:n.message,ResponseText:null===(u=n.response)||void 0===u?void 0:u.statusText,Status:null===(d=n.response)||void 0===d?void 0:d.status},E=function(){var r,i;e.logError("Request to "+t.url+" failed.",(null===(r=n.response)||void 0===r?void 0:r.status)||0,T),o(new Error((null===(i=n.response)||void 0===i?void 0:i.statusText)||""))},b=function(){var r;e.logError("Request to "+t.url+" failed. Resetting endpoint.",(null===(r=n.response)||void 0===r?void 0:r.status)||0,T),t.callbackOnFailure&&t.callbackOnFailure(n),o(new Error(i.default.Reset_Flag))},I=function(){var e;s++;var r=t.timeBetweenRetry||0;(t.enableExponentialBackoff||(null===(e=n.response)||void 0===e?void 0:e.status)===c.default.TooManyRequests)&&(r*=Math.exp(s)),setTimeout(function(){h()},r)},w=null===(p=n.response)||void 0===p?void 0:p.headers[a.default.LocationHeader],R=null===(f=n.response)||void 0===f?void 0:f.headers[a.default.SetRegistrationTokenHeader];(null===(g=n.response)||void 0===g?void 0:g.status)!==c.default.Redirect||r.default.isNullOrEmptyString(w)?(null===(m=n.response)||void 0===m?void 0:m.status)!==c.default.Unauthorized&&(null===(v=n.response)||void 0===v?void 0:v.status)!==c.default.Forbidden||r.default.isNullOrEmptyString(R)?s<=l&&t.shouldRetryOnFailure&&t.shouldRetryOnFailure((null===(C=n.response)||void 0===C?void 0:C.status)||0)||(null===(S=n.response)||void 0===S?void 0:S.status)===c.default.TooManyRequests?I():t.shouldResetOnFailure?b():E():s<=l&&t.shouldRetryOnFailure&&t.shouldRetryOnFailure((null===(y=n.response)||void 0===y?void 0:y.status)||0)?(t.headers&&(t.headers[a.default.RegistrationTokenHeader]=r.default.getRegistrationTokenValue(R)),I()):t.shouldResetOnFailure?b():E():t.shouldRedirectOn404?b():s<=l?(t.url=w,I()):E()}(n)})};h()})},e.isClientError=function(e){if(!e)return!1;var t=e.message,n=!1;return r.default.isNullOrEmptyString(t)||(n=t.search(/Status- 40\d/)>=-1),n},e.setLogger=function(t){e.logger=t},e.logError=function(t,n,r){e.logger&&e.logger.log(s.default.ERROR,o.default.HTTPRequestFailed,{Description:t,ErrorCode:n.toString(),ExceptionDetails:r})},e.logWarning=function(t,n,r){e.logger&&e.logger.log(s.default.INFO,o.default.HTTPRequestUnusualResponse,{Description:t,ErrorCode:n.toString(),ExceptionDetails:r})},e}();t.HttpClient=l},5753:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.AMSViewScanStatus=void 0;var s,a,c,u=n(7708);!function(e){e[e.READ=0]="READ",e[e.WRITE=1]="WRITE"}(s||(s={})),function(e){e.AMSUpload="AMSUpload",e.AMSDownload="AMSDownload",e.GetFileIds="GetFileIds",e.CreateFileIdProperty="CreateFileIdProperty",e.GetFileMetadata="GetFileMetadata",e.CreateFileMetadataProperty="CreateFileMetadataProperty"}(a||(a={})),function(e){e.PASSED="passed",e.MALWARE="malware",e.INPROGRESS="in progress"}(c||(t.AMSViewScanStatus=c={}));var l=["image/jpeg","image/png","image/gif","image/heic","image/webp"],d=function(){function e(e,t,n){var i;if(void 0===t&&(t=null),void 0===n&&(n={}),this.supportedImagesMimeTypes=l,this.logger=t,this.amsClient=e,this.options=n,this.omnichannelChatToken=null,!1===(null===(i=this.options.fileScan)||void 0===i?void 0:i.disabled)){var o=r({},this.options.fileScan);this.fileScanner=new u.default(this.amsClient,o)}}return e.prototype.uploadFiles=function(e){return i(this,void 0,void 0,function(){var t=this;return o(this,function(n){return[2,Promise.all(e.map(function(e){return i(t,void 0,void 0,function(){return o(this,function(t){return[2,this.uploadFileToAMS(e)]})})}))]})})},e.prototype.downloadFiles=function(e){return i(this,void 0,void 0,function(){var t=this;return o(this,function(n){return[2,Promise.all(e.map(function(e){return i(t,void 0,void 0,function(){return o(this,function(t){return[2,this.downloadFileFromAMS(e)]})})}))]})})},e.prototype.updatePermissions=function(){return i(this,void 0,void 0,function(){return o(this,function(e){return[2,void 0]})})},e.prototype.getFileIds=function(e){var t,n,r;if(e&&(e.amsReferences||e.amsreferences)){null===(t=this.logger)||void 0===t||t.startScenario(a.GetFileIds);try{var i=void 0;return(null==e?void 0:e.amsReferences)&&(i=JSON.parse(null==e?void 0:e.amsReferences)),(null==e?void 0:e.amsreferences)&&(i=JSON.parse(null==e?void 0:e.amsreferences)),null===(n=this.logger)||void 0===n||n.completeScenario(a.GetFileIds),i}catch(t){var o={metadata:"".concat(e),errorObject:"".concat(t)};return void(null===(r=this.logger)||void 0===r||r.failScenario(a.GetFileIds,{ExceptionDetails:JSON.stringify(o)}))}}},e.prototype.createFileIdProperty=function(e){var t,n,r;if(e){null===(t=this.logger)||void 0===t||t.startScenario(a.CreateFileIdProperty);try{var i={amsReferences:JSON.stringify(e),amsreferences:JSON.stringify(e)};return null===(n=this.logger)||void 0===n||n.completeScenario(a.CreateFileIdProperty),i}catch(t){var o={fileIds:"".concat(e),errorObject:"".concat(t)};return void(null===(r=this.logger)||void 0===r||r.failScenario(a.CreateFileIdProperty,{ExceptionDetails:JSON.stringify(o)}))}}},e.prototype.getFileMetadata=function(e){var t,n,r;if(e&&e.amsMetadata){null===(t=this.logger)||void 0===t||t.startScenario(a.GetFileMetadata);try{var i=JSON.parse(null==e?void 0:e.amsMetadata);return null===(n=this.logger)||void 0===n||n.completeScenario(a.GetFileMetadata),i}catch(t){var o={metadata:"".concat(e),errorObject:"".concat(t)};return void(null===(r=this.logger)||void 0===r||r.failScenario(a.GetFileMetadata,{ExceptionDetails:JSON.stringify(o)}))}}},e.prototype.createFileMetadataProperty=function(e){var t,n,r;if(e){null===(t=this.logger)||void 0===t||t.startScenario(a.CreateFileMetadataProperty);try{var i={amsMetadata:JSON.stringify(e)};return null===(n=this.logger)||void 0===n||n.completeScenario(a.CreateFileMetadataProperty),i}catch(t){var o={metadata:"".concat(e),errorObject:"".concat(t)};return void(null===(r=this.logger)||void 0===r||r.failScenario(a.CreateFileMetadataProperty,{ExceptionDetails:JSON.stringify(o)}))}}},e.prototype.createBotAttachment=function(e){return e&&Object.keys(e).length,null},e.prototype.uploadFileToAMS=function(e){return i(this,void 0,void 0,function(){var t,n,r,i,s,c,u,l,d,h,p,f;return o(this,function(o){switch(o.label){case 0:if(null===(l=this.logger)||void 0===l||l.startScenario(a.AMSUpload),!e.contentUrl||!e.name)return[3,12];t=void 0,o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.amsClient.fetchBlob(e.contentUrl)];case 2:return t=o.sent(),[3,4];case 3:throw n=o.sent(),u={response:"AMSFetchBlobFailure",errorObject:"".concat(n)},null===(d=this.logger)||void 0===d||d.failScenario(a.AMSUpload,{ExceptionDetails:JSON.stringify(u)}),n;case 4:r=new File([t],e.name,{type:e.contentType}),i=void 0,o.label=5;case 5:return o.trys.push([5,7,,8]),[4,this.amsClient.createObject(this.amsClient.chatToken.chatId,r,this.omnichannelChatToken,this.supportedImagesMimeTypes)];case 6:return i=o.sent(),[3,8];case 7:throw s=o.sent(),u={response:"AMSCreateObjectFailure",errorObject:"".concat(s)},null===(h=this.logger)||void 0===h||h.failScenario(a.AMSUpload,{ExceptionDetails:JSON.stringify(u)}),s;case 8:return o.trys.push([8,10,,11]),[4,this.amsClient.uploadDocument(i.id,r,this.omnichannelChatToken,this.supportedImagesMimeTypes)];case 9:return o.sent(),[3,11];case 10:throw c=o.sent(),u={response:"AMSUploadDocumentFailure",errorObject:"".concat(c)},null===(p=this.logger)||void 0===p||p.failScenario(a.AMSUpload,{ExceptionDetails:JSON.stringify(u)}),c;case 11:return null===(f=this.logger)||void 0===f||f.completeScenario(a.AMSUpload),[2,{fileId:i.id,metadata:{contentType:e.contentType,fileName:e.name}}];case 12:return[2]}})})},e.prototype.downloadFileFromAMS=function(e){return i(this,void 0,void 0,function(){var t,n,r,i,s,u,l,d,h,p,f,g,m,v,y,C;return o(this,function(o){switch(o.label){case 0:if(null===(f=this.logger)||void 0===f||f.startScenario(a.AMSDownload),!(e.fileId&&e.metadata&&e.metadata.fileName))return[3,9];t={id:e.fileId,type:e.metadata.contentType,name:e.metadata.fileName},n=void 0,o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.amsClient.getViewStatus(t,this.omnichannelChatToken,this.supportedImagesMimeTypes)];case 2:return n=o.sent(),[3,4];case 3:return r=o.sent(),h={response:"AMSGetViewStatusFailure",errorObject:"".concat(r)},null===(g=this.logger)||void 0===g||g.failScenario(a.AMSDownload,{ExceptionDetails:JSON.stringify(h)}),[2,void 0];case 4:if(i=void 0,s=n.view_location,u=n.scan,!1===(null===(m=this.options.fileScan)||void 0===m?void 0:m.disabled)&&u&&(null==u?void 0:u.status)!==c.PASSED)return l=new File([i],e.metadata.fileName,{type:e.metadata.contentType}),h={response:"InvalidFileScanResult"},this.fileScanner.addOrUpdateFile(t.id,t,u),null===(v=this.logger)||void 0===v||v.failScenario(a.AMSDownload,{ExceptionDetails:JSON.stringify(h)}),[2,l];o.label=5;case 5:return o.trys.push([5,7,,8]),[4,this.amsClient.getView(t,s,this.omnichannelChatToken,this.supportedImagesMimeTypes)];case 6:return i=o.sent(),[3,8];case 7:return d=o.sent(),h={response:"AMSGetViewFailure",errorObject:"".concat(d)},null===(y=this.logger)||void 0===y||y.failScenario(a.AMSDownload,{ExceptionDetails:JSON.stringify(h)}),[2,void 0];case 8:return p=new File([i],e.metadata.fileName,{type:e.metadata.contentType}),null===(C=this.logger)||void 0===C||C.completeScenario(a.AMSDownload),[2,p];case 9:return[2]}})})},e}();t.default=d},5869:(e,t,n)=>{var r=n(887);e.exports=function(e,t,n,i,o){var s=r(e,t,n,i,o);return s.next().then(function(e){return e.done?e.value:s.next()})},e.exports.__esModule=!0,e.exports.default=e.exports},5881:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.AmsBasedFileSharing=0]="AmsBasedFileSharing"}(n||(n={})),t.default=n},5901:(e,t,n)=>{var r=n(79);e.exports=function(e){if(Array.isArray(e))return r(e)},e.exports.__esModule=!0,e.exports.default=e.exports},5967:(e,t,n)=>{"use strict";function r(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}n.d(t,{W:()=>r})},5970:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.ERR_NETWORK="ERR_NETWORK"}(n||(n={})),t.default=n},6009:(e,t,n)=>{"use strict";var r=n(4994);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(7383)),o=r(n(3693)),s=n(86),a=function e(){(0,i.default)(this,e)};t.default=a,(0,o.default)(a,"requiredOmnichannelConfigurationParameters",["orgUrl","orgId","widgetId"]),(0,o.default)(a,"defaultHeaders",{"Content-Type":"application/json"}),(0,o.default)(a,"bypassCacheHeaders",{"Cache-Control":"no-store, must-revalidate, no-cache","X-Cache-Control":"no-store"}),(0,o.default)(a,"defaultChannelId",s.ChannelId.LCW),(0,o.default)(a,"defaultLocale","en-us"),(0,o.default)(a,"noContentStatusCode",204),(0,o.default)(a,"tooManyRequestsStatusCode",429),(0,o.default)(a,"notFoundStatusCode",404),(0,o.default)(a,"badRequestStatusCode",400),(0,o.default)(a,"outOfOfficeErrorCode",705),(0,o.default)(a,"sensitiveProperties",["AuthenticatedUserToken"]),(0,o.default)(a,"transactionid","transaction-id"),(0,o.default)(a,"customerDisplayName","customerDisplayName"),(0,o.default)(a,"hiddenContentPlaceholder","*content hidden*"),(0,o.default)(a,"axiosTimeoutErrorCode","ECONNABORTED")},6085:(e,t,n)=>{"use strict";n.r(t),n.d(t,{ChatClient:()=>He,ChatThreadClient:()=>Fe});var r={};function i(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function o(e){return this instanceof o?(this.v=e,this):new o(e)}function s(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),s=[];return r=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",function(e){return function(t){return Promise.resolve(t).then(e,l)}}),r[Symbol.asyncIterator]=function(){return this},r;function a(e,t){i[e]&&(r[e]=function(t){return new Promise(function(n,r){s.push([e,t,n,r])>1||c(e,t)})},t&&(r[e]=t(r[e])))}function c(e,t){try{(n=i[e](t)).value instanceof o?Promise.resolve(n.value.v).then(u,l):d(s[0][2],n)}catch(e){d(s[0][3],e)}var n}function u(e){c("next",e)}function l(e){c("throw",e)}function d(e,t){e(t),s.shift(),s.length&&c(s[0][0],s[0][1])}}function a(e){var t,n;return t={},r("next"),r("throw",function(e){throw e}),r("return"),t[Symbol.iterator]=function(){return this},t;function r(r,i){t[r]=e[r]?function(t){return(n=!n)?{value:o(e[r](t)),done:!1}:i?i(t):t}:i}}function c(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise(function(r,i){!function(e,t,n,r){Promise.resolve(r).then(function(t){e({value:t,done:n})},t)}(r,i,(t=e[n](t)).done,t.value)})}}}n.r(r),n.d(r,{AddChatParticipantsRequest:()=>q,AddChatParticipantsResult:()=>j,ChatAttachment:()=>x,ChatError:()=>A,ChatMessage:()=>M,ChatMessageContent:()=>D,ChatMessageReadReceipt:()=>S,ChatMessageReadReceiptsCollection:()=>C,ChatMessagesCollection:()=>P,ChatParticipant:()=>N,ChatParticipantsCollection:()=>L,ChatThreadItem:()=>V,ChatThreadProperties:()=>G,ChatThreadsItemCollection:()=>H,CommunicationErrorResponse:()=>R,CommunicationIdentifierModel:()=>T,CommunicationUserIdentifierModel:()=>E,CreateChatThreadRequest:()=>F,CreateChatThreadResult:()=>B,MicrosoftTeamsAppIdentifierModel:()=>w,MicrosoftTeamsUserIdentifierModel:()=>I,PhoneNumberIdentifierModel:()=>b,SendChatMessageRequest:()=>k,SendChatMessageResult:()=>_,SendReadReceiptRequest:()=>O,SendTypingNotificationRequest:()=>W,UpdateChatMessageRequest:()=>U,UpdateChatThreadRequest:()=>z}),Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var u=n(781),l=n(9941);const d=e=>{const{id:t}=e,n=i(e,["id"]);return Object.assign(Object.assign({},n),{communicationIdentifier:(0,l.w)(t)})},h=e=>{const{communicationIdentifier:t}=e,n=i(e,["communicationIdentifier"]);return Object.assign(Object.assign({},n),{id:(0,l.r)(t)})},p=e=>{const{participants:t,initiatorCommunicationIdentifier:n}=e,r=i(e,["participants","initiatorCommunicationIdentifier"]);let o=Object.assign({},r);if(n){const e=(0,l.r)(n);o=Object.assign(Object.assign({},o),{initiator:e})}return t&&(o=Object.assign(Object.assign({},o),{participants:null==t?void 0:t.map(e=>h(e))})),o},f=e=>{const{content:t,senderCommunicationIdentifier:n}=e,r=i(e,["content","senderCommunicationIdentifier"]);let o=Object.assign({},r);if(t&&(o=Object.assign(Object.assign({},o),{content:p(t)})),n){const e=(0,l.r)(n);o=Object.assign(Object.assign({},o),{sender:e})}return o},g=e=>{const{createdByCommunicationIdentifier:t}=e,n=i(e,["createdByCommunicationIdentifier"]);return t?Object.assign(Object.assign({},n),{createdBy:(0,l.r)(t)}):Object.assign({},n)},m=e=>{const{senderCommunicationIdentifier:t}=e,n=i(e,["senderCommunicationIdentifier"]);return Object.assign(Object.assign({},n),{sender:(0,l.r)(t)})};var v=n(1219);const y=(0,n(4401).y)({namespace:"Azure.Communication",packageName:"@azure/communication-chat",packageVersion:"1.5.4"}),C={type:{name:"Composite",className:"ChatMessageReadReceiptsCollection",modelProperties:{value:{serializedName:"value",required:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatMessageReadReceipt"}}}},nextLink:{serializedName:"nextLink",readOnly:!0,type:{name:"String"}}}}},S={type:{name:"Composite",className:"ChatMessageReadReceipt",modelProperties:{senderCommunicationIdentifier:{serializedName:"senderCommunicationIdentifier",type:{name:"Composite",className:"CommunicationIdentifierModel"}},chatMessageId:{serializedName:"chatMessageId",required:!0,type:{name:"String"}},readOn:{serializedName:"readOn",required:!0,type:{name:"DateTime"}}}}},T={type:{name:"Composite",className:"CommunicationIdentifierModel",modelProperties:{kind:{serializedName:"kind",type:{name:"String"}},rawId:{serializedName:"rawId",type:{name:"String"}},communicationUser:{serializedName:"communicationUser",type:{name:"Composite",className:"CommunicationUserIdentifierModel"}},phoneNumber:{serializedName:"phoneNumber",type:{name:"Composite",className:"PhoneNumberIdentifierModel"}},microsoftTeamsUser:{serializedName:"microsoftTeamsUser",type:{name:"Composite",className:"MicrosoftTeamsUserIdentifierModel"}},microsoftTeamsApp:{serializedName:"microsoftTeamsApp",type:{name:"Composite",className:"MicrosoftTeamsAppIdentifierModel"}}}}},E={type:{name:"Composite",className:"CommunicationUserIdentifierModel",modelProperties:{id:{serializedName:"id",required:!0,type:{name:"String"}}}}},b={type:{name:"Composite",className:"PhoneNumberIdentifierModel",modelProperties:{value:{serializedName:"value",required:!0,type:{name:"String"}}}}},I={type:{name:"Composite",className:"MicrosoftTeamsUserIdentifierModel",modelProperties:{userId:{serializedName:"userId",required:!0,type:{name:"String"}},isAnonymous:{serializedName:"isAnonymous",type:{name:"Boolean"}},cloud:{serializedName:"cloud",type:{name:"String"}}}}},w={type:{name:"Composite",className:"MicrosoftTeamsAppIdentifierModel",modelProperties:{appId:{serializedName:"appId",required:!0,type:{name:"String"}},cloud:{serializedName:"cloud",type:{name:"String"}}}}},R={type:{name:"Composite",className:"CommunicationErrorResponse",modelProperties:{error:{serializedName:"error",type:{name:"Composite",className:"ChatError"}}}}},A={type:{name:"Composite",className:"ChatError",modelProperties:{code:{serializedName:"code",required:!0,type:{name:"String"}},message:{serializedName:"message",required:!0,type:{name:"String"}},target:{serializedName:"target",readOnly:!0,type:{name:"String"}},details:{serializedName:"details",readOnly:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatError"}}}},innerError:{serializedName:"innererror",type:{name:"Composite",className:"ChatError"}}}}},O={type:{name:"Composite",className:"SendReadReceiptRequest",modelProperties:{chatMessageId:{serializedName:"chatMessageId",required:!0,type:{name:"String"}}}}},k={type:{name:"Composite",className:"SendChatMessageRequest",modelProperties:{content:{serializedName:"content",required:!0,type:{name:"String"}},senderDisplayName:{serializedName:"senderDisplayName",type:{name:"String"}},type:{serializedName:"type",type:{name:"Enum",allowedValues:["text","html","topicUpdated","participantAdded","participantRemoved"]}},metadata:{serializedName:"metadata",type:{name:"Dictionary",value:{type:{name:"String"}}}}}}},_={type:{name:"Composite",className:"SendChatMessageResult",modelProperties:{id:{serializedName:"id",required:!0,type:{name:"String"}}}}},P={type:{name:"Composite",className:"ChatMessagesCollection",modelProperties:{value:{serializedName:"value",required:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatMessage"}}}},nextLink:{serializedName:"nextLink",readOnly:!0,type:{name:"String"}}}}},M={type:{name:"Composite",className:"ChatMessage",modelProperties:{id:{serializedName:"id",required:!0,type:{name:"String"}},type:{serializedName:"type",required:!0,type:{name:"Enum",allowedValues:["text","html","topicUpdated","participantAdded","participantRemoved"]}},sequenceId:{serializedName:"sequenceId",required:!0,type:{name:"String"}},version:{serializedName:"version",required:!0,type:{name:"String"}},content:{serializedName:"content",type:{name:"Composite",className:"ChatMessageContent"}},senderDisplayName:{serializedName:"senderDisplayName",type:{name:"String"}},createdOn:{serializedName:"createdOn",required:!0,type:{name:"DateTime"}},senderCommunicationIdentifier:{serializedName:"senderCommunicationIdentifier",type:{name:"Composite",className:"CommunicationIdentifierModel"}},deletedOn:{serializedName:"deletedOn",type:{name:"DateTime"}},editedOn:{serializedName:"editedOn",type:{name:"DateTime"}},metadata:{serializedName:"metadata",type:{name:"Dictionary",value:{type:{name:"String"}}}}}}},D={type:{name:"Composite",className:"ChatMessageContent",modelProperties:{message:{serializedName:"message",type:{name:"String"}},topic:{serializedName:"topic",type:{name:"String"}},participants:{serializedName:"participants",type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatParticipant"}}}},attachments:{serializedName:"attachments",type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatAttachment"}}}},initiatorCommunicationIdentifier:{serializedName:"initiatorCommunicationIdentifier",type:{name:"Composite",className:"CommunicationIdentifierModel"}}}}},N={type:{name:"Composite",className:"ChatParticipant",modelProperties:{communicationIdentifier:{serializedName:"communicationIdentifier",type:{name:"Composite",className:"CommunicationIdentifierModel"}},displayName:{serializedName:"displayName",type:{name:"String"}},shareHistoryTime:{serializedName:"shareHistoryTime",type:{name:"DateTime"}}}}},x={type:{name:"Composite",className:"ChatAttachment",modelProperties:{id:{serializedName:"id",required:!0,type:{name:"String"}},attachmentType:{serializedName:"attachmentType",required:!0,type:{name:"Enum",allowedValues:["image","file"]}},name:{serializedName:"name",type:{name:"String"}},url:{serializedName:"url",type:{name:"String"}},previewUrl:{serializedName:"previewUrl",type:{name:"String"}}}}},U={type:{name:"Composite",className:"UpdateChatMessageRequest",modelProperties:{content:{serializedName:"content",type:{name:"String"}},metadata:{serializedName:"metadata",type:{name:"Dictionary",value:{type:{name:"String"}}}}}}},L={type:{name:"Composite",className:"ChatParticipantsCollection",modelProperties:{value:{serializedName:"value",required:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatParticipant"}}}},nextLink:{serializedName:"nextLink",readOnly:!0,type:{name:"String"}}}}},q={type:{name:"Composite",className:"AddChatParticipantsRequest",modelProperties:{participants:{serializedName:"participants",required:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatParticipant"}}}}}}},j={type:{name:"Composite",className:"AddChatParticipantsResult",modelProperties:{invalidParticipants:{serializedName:"invalidParticipants",readOnly:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatError"}}}}}}},F={type:{name:"Composite",className:"CreateChatThreadRequest",modelProperties:{topic:{serializedName:"topic",required:!0,type:{name:"String"}},participants:{serializedName:"participants",type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatParticipant"}}}}}}},B={type:{name:"Composite",className:"CreateChatThreadResult",modelProperties:{chatThread:{serializedName:"chatThread",type:{name:"Composite",className:"ChatThreadProperties"}},invalidParticipants:{serializedName:"invalidParticipants",readOnly:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatError"}}}}}}},G={type:{name:"Composite",className:"ChatThreadProperties",modelProperties:{id:{serializedName:"id",required:!0,type:{name:"String"}},topic:{serializedName:"topic",required:!0,type:{name:"String"}},createdOn:{serializedName:"createdOn",required:!0,type:{name:"DateTime"}},createdByCommunicationIdentifier:{serializedName:"createdByCommunicationIdentifier",type:{name:"Composite",className:"CommunicationIdentifierModel"}},deletedOn:{serializedName:"deletedOn",type:{name:"DateTime"}}}}},H={type:{name:"Composite",className:"ChatThreadsItemCollection",modelProperties:{value:{serializedName:"value",required:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatThreadItem"}}}},nextLink:{serializedName:"nextLink",readOnly:!0,type:{name:"String"}}}}},V={type:{name:"Composite",className:"ChatThreadItem",modelProperties:{id:{serializedName:"id",required:!0,type:{name:"String"}},topic:{serializedName:"topic",required:!0,type:{name:"String"}},deletedOn:{serializedName:"deletedOn",type:{name:"DateTime"}},lastMessageReceivedOn:{serializedName:"lastMessageReceivedOn",readOnly:!0,type:{name:"DateTime"}}}}},z={type:{name:"Composite",className:"UpdateChatThreadRequest",modelProperties:{topic:{serializedName:"topic",type:{name:"String"}}}}},W={type:{name:"Composite",className:"SendTypingNotificationRequest",modelProperties:{senderDisplayName:{serializedName:"senderDisplayName",type:{name:"String"}}}}},K={parameterPath:"accept",mapper:{defaultValue:"application/json",isConstant:!0,serializedName:"Accept",type:{name:"String"}}},$={parameterPath:"endpoint",mapper:{serializedName:"endpoint",required:!0,type:{name:"String"}},skipEncoding:!0},J={parameterPath:"chatThreadId",mapper:{serializedName:"chatThreadId",required:!0,type:{name:"String"}}},X={parameterPath:["options","maxPageSize"],mapper:{serializedName:"maxPageSize",type:{name:"Number"}}},Q={parameterPath:["options","skip"],mapper:{serializedName:"skip",type:{name:"Number"}}},Y={parameterPath:"apiVersion",mapper:{defaultValue:"2024-03-07",isConstant:!0,serializedName:"api-version",type:{name:"String"}}},Z={parameterPath:["options","contentType"],mapper:{defaultValue:"application/json",isConstant:!0,serializedName:"Content-Type",type:{name:"String"}}},ee={parameterPath:"sendReadReceiptRequest",mapper:O},te={parameterPath:"sendChatMessageRequest",mapper:k},ne={parameterPath:["options","startTime"],mapper:{serializedName:"startTime",type:{name:"DateTime"}}},re={parameterPath:"chatMessageId",mapper:{serializedName:"chatMessageId",required:!0,type:{name:"String"}}},ie={parameterPath:["options","contentType"],mapper:{defaultValue:"application/merge-patch+json",isConstant:!0,serializedName:"Content-Type",type:{name:"String"}}},oe={parameterPath:"updateChatMessageRequest",mapper:U},se={parameterPath:"participantCommunicationIdentifier",mapper:T},ae={parameterPath:"addChatParticipantsRequest",mapper:q},ce={parameterPath:"updateChatThreadRequest",mapper:z},ue={parameterPath:["options","sendTypingNotificationRequest"],mapper:W},le={parameterPath:"nextLink",mapper:{serializedName:"nextLink",required:!0,type:{name:"String"}},skipEncoding:!0},de={parameterPath:"createChatThreadRequest",mapper:F};class he{constructor(e){this.client=e}async listChatReadReceipts(e,t){return y.withSpan("ChatApiClient.listChatReadReceipts",null!=t?t:{},async t=>this.client.sendOperationRequest({chatThreadId:e,options:t},fe))}async sendChatReadReceipt(e,t,n){return y.withSpan("ChatApiClient.sendChatReadReceipt",null!=n?n:{},async n=>this.client.sendOperationRequest({chatThreadId:e,sendReadReceiptRequest:t,options:n},ge))}async sendChatMessage(e,t,n){return y.withSpan("ChatApiClient.sendChatMessage",null!=n?n:{},async n=>this.client.sendOperationRequest({chatThreadId:e,sendChatMessageRequest:t,options:n},me))}async listChatMessages(e,t){return y.withSpan("ChatApiClient.listChatMessages",null!=t?t:{},async t=>this.client.sendOperationRequest({chatThreadId:e,options:t},ve))}async getChatMessage(e,t,n){return y.withSpan("ChatApiClient.getChatMessage",null!=n?n:{},async n=>this.client.sendOperationRequest({chatThreadId:e,chatMessageId:t,options:n},ye))}async updateChatMessage(e,t,n,r){return y.withSpan("ChatApiClient.updateChatMessage",null!=r?r:{},async r=>this.client.sendOperationRequest({chatThreadId:e,chatMessageId:t,updateChatMessageRequest:n,options:r},Ce))}async deleteChatMessage(e,t,n){return y.withSpan("ChatApiClient.deleteChatMessage",null!=n?n:{},async n=>this.client.sendOperationRequest({chatThreadId:e,chatMessageId:t,options:n},Se))}async listChatParticipants(e,t){return y.withSpan("ChatApiClient.listChatParticipants",null!=t?t:{},async t=>this.client.sendOperationRequest({chatThreadId:e,options:t},Te))}async removeChatParticipant(e,t,n){return y.withSpan("ChatApiClient.removeChatParticipant",null!=n?n:{},async n=>this.client.sendOperationRequest({chatThreadId:e,participantCommunicationIdentifier:t,options:n},Ee))}async addChatParticipants(e,t,n){return y.withSpan("ChatApiClient.addChatParticipants",null!=n?n:{},async n=>this.client.sendOperationRequest({chatThreadId:e,addChatParticipantsRequest:t,options:n},be))}async updateChatThreadProperties(e,t,n){return y.withSpan("ChatApiClient.updateChatThreadProperties",null!=n?n:{},async n=>this.client.sendOperationRequest({chatThreadId:e,updateChatThreadRequest:t,options:n},Ie))}async getChatThreadProperties(e,t){return y.withSpan("ChatApiClient.getChatThreadProperties",null!=t?t:{},async t=>this.client.sendOperationRequest({chatThreadId:e,options:t},we))}async sendTypingNotification(e,t){return y.withSpan("ChatApiClient.sendTypingNotification",null!=t?t:{},async t=>this.client.sendOperationRequest({chatThreadId:e,options:t},Re))}async listChatReadReceiptsNext(e,t,n){return y.withSpan("ChatApiClient.listChatReadReceiptsNext",null!=n?n:{},async n=>this.client.sendOperationRequest({chatThreadId:e,nextLink:t,options:n},Ae))}async listChatMessagesNext(e,t,n){return y.withSpan("ChatApiClient.listChatMessagesNext",null!=n?n:{},async n=>this.client.sendOperationRequest({chatThreadId:e,nextLink:t,options:n},Oe))}async listChatParticipantsNext(e,t,n){return y.withSpan("ChatApiClient.listChatParticipantsNext",null!=n?n:{},async n=>this.client.sendOperationRequest({chatThreadId:e,nextLink:t,options:n},ke))}}const pe=v.createSerializer(r,!1),fe={path:"/chat/threads/{chatThreadId}/readReceipts",httpMethod:"GET",responses:{200:{bodyMapper:C},401:{bodyMapper:R,isError:!0},403:{bodyMapper:R,isError:!0},429:{bodyMapper:R,isError:!0},503:{bodyMapper:R,isError:!0}},queryParameters:[X,Q,Y],urlParameters:[$,J],headerParameters:[K],serializer:pe},ge={path:"/chat/threads/{chatThreadId}/readReceipts",httpMethod:"POST",responses:{200:{},401:{bodyMapper:R,isError:!0},403:{bodyMapper:R,isError:!0},429:{bodyMapper:R,isError:!0},503:{bodyMapper:R,isError:!0}},requestBody:ee,queryParameters:[Y],urlParameters:[$,J],headerParameters:[K,Z],mediaType:"json",serializer:pe},me={path:"/chat/threads/{chatThreadId}/messages",httpMethod:"POST",responses:{201:{bodyMapper:_},401:{bodyMapper:R,isError:!0},403:{bodyMapper:R,isError:!0},429:{bodyMapper:R,isError:!0},503:{bodyMapper:R,isError:!0}},requestBody:te,queryParameters:[Y],urlParameters:[$,J],headerParameters:[K,Z],mediaType:"json",serializer:pe},ve={path:"/chat/threads/{chatThreadId}/messages",httpMethod:"GET",responses:{200:{bodyMapper:P},401:{bodyMapper:R,isError:!0},403:{bodyMapper:R,isError:!0},429:{bodyMapper:R,isError:!0},503:{bodyMapper:R,isError:!0}},queryParameters:[X,Y,ne],urlParameters:[$,J],headerParameters:[K],serializer:pe},ye={path:"/chat/threads/{chatThreadId}/messages/{chatMessageId}",httpMethod:"GET",responses:{200:{bodyMapper:M},401:{bodyMapper:R,isError:!0},403:{bodyMapper:R,isError:!0},429:{bodyMapper:R,isError:!0},503:{bodyMapper:R,isError:!0}},queryParameters:[Y],urlParameters:[$,J,re],headerParameters:[K],serializer:pe},Ce={path:"/chat/threads/{chatThreadId}/messages/{chatMessageId}",httpMethod:"PATCH",responses:{204:{},401:{bodyMapper:R,isError:!0},403:{bodyMapper:R,isError:!0},429:{bodyMapper:R,isError:!0},503:{bodyMapper:R,isError:!0}},requestBody:oe,queryParameters:[Y],urlParameters:[$,J,re],headerParameters:[K,ie],mediaType:"json",serializer:pe},Se={path:"/chat/threads/{chatThreadId}/messages/{chatMessageId}",httpMethod:"DELETE",responses:{204:{},401:{bodyMapper:R,isError:!0},403:{bodyMapper:R,isError:!0},429:{bodyMapper:R,isError:!0},503:{bodyMapper:R,isError:!0}},queryParameters:[Y],urlParameters:[$,J,re],headerParameters:[K],serializer:pe},Te={path:"/chat/threads/{chatThreadId}/participants",httpMethod:"GET",responses:{200:{bodyMapper:L},401:{bodyMapper:R,isError:!0},403:{bodyMapper:R,isError:!0},429:{bodyMapper:R,isError:!0},503:{bodyMapper:R,isError:!0}},queryParameters:[X,Q,Y],urlParameters:[$,J],headerParameters:[K],serializer:pe},Ee={path:"/chat/threads/{chatThreadId}/participants/:remove",httpMethod:"POST",responses:{204:{},401:{bodyMapper:R,isError:!0},403:{bodyMapper:R,isError:!0},429:{bodyMapper:R,isError:!0},503:{bodyMapper:R,isError:!0}},requestBody:se,queryParameters:[Y],urlParameters:[$,J],headerParameters:[K,Z],mediaType:"json",serializer:pe},be={path:"/chat/threads/{chatThreadId}/participants/:add",httpMethod:"POST",responses:{201:{bodyMapper:j},401:{bodyMapper:R,isError:!0},403:{bodyMapper:R,isError:!0},429:{bodyMapper:R,isError:!0},503:{bodyMapper:R,isError:!0}},requestBody:ae,queryParameters:[Y],urlParameters:[$,J],headerParameters:[K,Z],mediaType:"json",serializer:pe},Ie={path:"/chat/threads/{chatThreadId}",httpMethod:"PATCH",responses:{204:{},401:{bodyMapper:R,isError:!0},403:{bodyMapper:R,isError:!0},429:{bodyMapper:R,isError:!0},503:{bodyMapper:R,isError:!0}},requestBody:ce,queryParameters:[Y],urlParameters:[$,J],headerParameters:[K,ie],mediaType:"json",serializer:pe},we={path:"/chat/threads/{chatThreadId}",httpMethod:"GET",responses:{200:{bodyMapper:G},401:{bodyMapper:R,isError:!0},403:{bodyMapper:R,isError:!0},429:{bodyMapper:R,isError:!0},503:{bodyMapper:R,isError:!0}},queryParameters:[Y],urlParameters:[$,J],headerParameters:[K],serializer:pe},Re={path:"/chat/threads/{chatThreadId}/typing",httpMethod:"POST",responses:{200:{},401:{bodyMapper:R,isError:!0},403:{bodyMapper:R,isError:!0},429:{bodyMapper:R,isError:!0},503:{bodyMapper:R,isError:!0}},requestBody:ue,queryParameters:[Y],urlParameters:[$,J],headerParameters:[K,Z],mediaType:"json",serializer:pe},Ae={path:"{nextLink}",httpMethod:"GET",responses:{200:{bodyMapper:C},401:{bodyMapper:R,isError:!0},403:{bodyMapper:R,isError:!0},429:{bodyMapper:R,isError:!0},503:{bodyMapper:R,isError:!0}},urlParameters:[$,J,le],headerParameters:[K],serializer:pe},Oe={path:"{nextLink}",httpMethod:"GET",responses:{200:{bodyMapper:P},401:{bodyMapper:R,isError:!0},403:{bodyMapper:R,isError:!0},429:{bodyMapper:R,isError:!0},503:{bodyMapper:R,isError:!0}},urlParameters:[$,J,le],headerParameters:[K],serializer:pe},ke={path:"{nextLink}",httpMethod:"GET",responses:{200:{bodyMapper:L},401:{bodyMapper:R,isError:!0},403:{bodyMapper:R,isError:!0},429:{bodyMapper:R,isError:!0},503:{bodyMapper:R,isError:!0}},urlParameters:[$,J,le],headerParameters:[K],serializer:pe};class _e{constructor(e){this.client=e}async createChatThread(e,t){return y.withSpan("ChatApiClient.createChatThread",null!=t?t:{},async t=>this.client.sendOperationRequest({createChatThreadRequest:e,options:t},Me))}async listChatThreads(e){return y.withSpan("ChatApiClient.listChatThreads",null!=e?e:{},async e=>this.client.sendOperationRequest({options:e},De))}async deleteChatThread(e,t){return y.withSpan("ChatApiClient.deleteChatThread",null!=t?t:{},async t=>this.client.sendOperationRequest({chatThreadId:e,options:t},Ne))}async listChatThreadsNext(e,t){return y.withSpan("ChatApiClient.listChatThreadsNext",null!=t?t:{},async t=>this.client.sendOperationRequest({nextLink:e,options:t},xe))}}const Pe=v.createSerializer(r,!1),Me={path:"/chat/threads",httpMethod:"POST",responses:{201:{bodyMapper:B},401:{bodyMapper:R,isError:!0},403:{bodyMapper:R,isError:!0},429:{bodyMapper:R,isError:!0},503:{bodyMapper:R,isError:!0}},requestBody:de,queryParameters:[Y],urlParameters:[$],headerParameters:[K,Z,{parameterPath:["options","repeatabilityRequestId"],mapper:{serializedName:"repeatability-request-id",type:{name:"String"}}}],mediaType:"json",serializer:Pe},De={path:"/chat/threads",httpMethod:"GET",responses:{200:{bodyMapper:H},401:{bodyMapper:R,isError:!0},403:{bodyMapper:R,isError:!0},429:{bodyMapper:R,isError:!0},503:{bodyMapper:R,isError:!0}},queryParameters:[X,Y,ne],urlParameters:[$],headerParameters:[K],serializer:Pe},Ne={path:"/chat/threads/{chatThreadId}",httpMethod:"DELETE",responses:{204:{},401:{bodyMapper:R,isError:!0},403:{bodyMapper:R,isError:!0},429:{bodyMapper:R,isError:!0},503:{bodyMapper:R,isError:!0}},queryParameters:[Y],urlParameters:[$,J],headerParameters:[K],serializer:Pe},xe={path:"{nextLink}",httpMethod:"GET",responses:{200:{bodyMapper:H},401:{bodyMapper:R,isError:!0},403:{bodyMapper:R,isError:!0},429:{bodyMapper:R,isError:!0},503:{bodyMapper:R,isError:!0}},urlParameters:[$,le],headerParameters:[K],serializer:Pe};class Ue extends v.ServiceClient{constructor(e,t){var n,r;if(void 0===e)throw new Error("'endpoint' cannot be null");t||(t={});const i="azsdk-js-communication-chat/1.5.4",o=t.userAgentOptions&&t.userAgentOptions.userAgentPrefix?`${t.userAgentOptions.userAgentPrefix} ${i}`:`${i}`;super(Object.assign(Object.assign(Object.assign({},{requestContentType:"application/json; charset=utf-8"}),t),{userAgentOptions:{userAgentPrefix:o},endpoint:null!==(r=null!==(n=t.endpoint)&&void 0!==n?n:t.baseUri)&&void 0!==r?r:"{endpoint}"})),this.endpoint=e,this.apiVersion=t.apiVersion||"2024-03-07",this.chatThread=new he(this),this.chat=new _e(this),this.addCustomApiVersionPolicy(t.apiVersion)}addCustomApiVersionPolicy(e){if(!e)return;const t={name:"CustomApiVersionPolicy",async sendRequest(t,n){const r=t.url.split("?");if(r.length>1){const n=r[1].split("&").map(t=>t.indexOf("api-version")>-1?"api-version="+e:t);t.url=r[0]+"?"+n.join("&")}return n(t)}};this.pipeline.addPolicy(t)}}const Le=(0,n(4299).KV)("communication-chat");var qe=n(3893);const je=e=>{const t={credential:{getToken:(t,n)=>e.getToken({abortSignal:null==n?void 0:n.abortSignal})},scopes:[]};return(0,qe.bearerTokenAuthenticationPolicy)(t)};class Fe{constructor(e,t,n,r={}){this.endpoint=e,this.timeOfLastTypingRequest=void 0,this.threadId=t,this.tokenCredential=n;const i=Object.assign(Object.assign({},r),{loggingOptions:{logger:Le.info}});this.client=new Ue(this.endpoint,Object.assign({endpoint:this.endpoint},i));const o=je(this.tokenCredential);this.client.pipeline.addPolicy(o)}getProperties(e={}){return y.withSpan("ChatClient-GetProperties",e,async e=>{const t=await this.client.chatThread.getChatThreadProperties(this.threadId,e);return g(t)})}updateTopic(e,t={}){return y.withSpan("ChatThreadClient-UpdateTopic",t,async t=>{await this.client.chatThread.updateChatThreadProperties(this.threadId,{topic:e},t)})}sendMessage(e,t={}){return y.withSpan("ChatThreadClient-SendMessage",t,async n=>(this.timeOfLastTypingRequest=void 0,await this.client.chatThread.sendChatMessage(this.threadId,Object.assign(Object.assign({},e),t),n)))}getMessage(e,t={}){return y.withSpan("ChatThreadClient-GetMessage",t,async t=>{const n=await this.client.chatThread.getChatMessage(this.threadId,e,t);return f(n)})}listMessagesPage(e){return s(this,arguments,function*(e,t={}){if(!e.continuationToken){const n=yield o(this.client.chatThread.listChatMessages(this.threadId,t));e.continuationToken=n.nextLink,n.value&&(yield yield o(n.value.map(f,this)))}for(;e.continuationToken;){const n=yield o(this.client.chatThread.listChatMessagesNext(this.threadId,e.continuationToken,t));if(e.continuationToken=n.nextLink,!n.value)break;yield yield o(n.value.map(f,this))}})}listMessagesAll(e){return s(this,arguments,function*(){var t,n,r,i;try{for(var s,u=!0,l=c(this.listMessagesPage({},e));!(t=(s=yield o(l.next())).done);u=!0){i=s.value,u=!1;const e=i;yield o(yield*a(c(e)))}}catch(e){n={error:e}}finally{try{u||t||!(r=l.return)||(yield o(r.call(l)))}finally{if(n)throw n.error}}})}listMessages(e={}){const{span:t,updatedOptions:n}=y.startSpan("ChatThreadClient-ListMessages",e);try{const e=this.listMessagesAll(n);return{next:()=>e.next(),[Symbol.asyncIterator](){return this},byPage:(e={})=>this.listMessagesPage(e,n)}}catch(e){throw t.setStatus({status:"error",error:e}),e}finally{t.end()}}deleteMessage(e,t={}){return y.withSpan("ChatThreadClient-DeleteMessage",t,async t=>{await this.client.chatThread.deleteChatMessage(this.threadId,e,t)})}async updateMessage(e,t={}){return y.withSpan("ChatThreadClient-UpdateMessage",t,async n=>{await this.client.chatThread.updateChatMessage(this.threadId,e,t,n)})}async addParticipants(e,t={}){return y.withSpan("ChatThreadClient-AddParticipants",t,async t=>{var n,r;return await this.client.chatThread.addChatParticipants(this.threadId,(n=e,{participants:null===(r=n.participants)||void 0===r?void 0:r.map(e=>d(e))}),t)})}listParticipantsPage(e){return s(this,arguments,function*(e,t={}){if(!e.continuationToken){const n=yield o(this.client.chatThread.listChatParticipants(this.threadId,t));e.continuationToken=n.nextLink,n.value&&(yield yield o(n.value.map(h,this)))}for(;e.continuationToken;){const n=yield o(this.client.chatThread.listChatParticipantsNext(this.threadId,e.continuationToken,t));if(e.continuationToken=n.nextLink,!n.value)break;yield yield o(n.value.map(h,this))}})}listParticipantsAll(e){return s(this,arguments,function*(){var t,n,r,i;try{for(var s,u=!0,l=c(this.listParticipantsPage({},e));!(t=(s=yield o(l.next())).done);u=!0){i=s.value,u=!1;const e=i;yield o(yield*a(c(e)))}}catch(e){n={error:e}}finally{try{u||t||!(r=l.return)||(yield o(r.call(l)))}finally{if(n)throw n.error}}})}listParticipants(e={}){const{span:t,updatedOptions:n}=y.startSpan("ChatThreadClient-ListParticipants",e);try{const e=this.listParticipantsAll(n);return{next:()=>e.next(),[Symbol.asyncIterator](){return this},byPage:(e={})=>this.listParticipantsPage(e,n)}}catch(e){throw t.setStatus({status:"error",error:e}),e}finally{t.end()}}async removeParticipant(e,t={}){return y.withSpan("ChatThreadClient-RemoveParticipant",t,async t=>{await this.client.chatThread.removeChatParticipant(this.threadId,(0,l.w)(e),t)})}async sendTypingNotification(e={}){return y.withSpan("ChatThreadClient-SendTypingNotification",e,async e=>{const t=new Date,{senderDisplayName:n}=e,r=i(e,["senderDisplayName"]);return this.canPostTypingNotification(t)?(this.timeOfLastTypingRequest=t,await this.client.chatThread.sendTypingNotification(this.threadId,Object.assign({sendTypingNotificationRequest:{senderDisplayName:n}},r)),!0):(Le.info(`Typing Notification NOT Send. [thread_id=${this.threadId}]`),!1)})}async sendReadReceipt(e,t={}){return y.withSpan("ChatThreadClient-SendReadReceipt",t,async t=>{await this.client.chatThread.sendChatReadReceipt(this.threadId,e,t)})}listReadReceiptsPage(e){return s(this,arguments,function*(e,t={}){if(!e.continuationToken){const n=yield o(this.client.chatThread.listChatReadReceipts(this.threadId,t));e.continuationToken=n.nextLink,n.value&&(yield yield o(n.value.map(m,this)))}for(;e.continuationToken;){const n=yield o(this.client.chatThread.listChatReadReceiptsNext(this.threadId,e.continuationToken,t));if(e.continuationToken=n.nextLink,!n.value)break;yield yield o(n.value.map(m,this))}})}listReadReceiptsAll(e){return s(this,arguments,function*(){var t,n,r,i;try{for(var s,u=!0,l=c(this.listReadReceiptsPage({},e));!(t=(s=yield o(l.next())).done);u=!0){i=s.value,u=!1;const e=i;yield o(yield*a(c(e)))}}catch(e){n={error:e}}finally{try{u||t||!(r=l.return)||(yield o(r.call(l)))}finally{if(n)throw n.error}}})}listReadReceipts(e={}){const{span:t,updatedOptions:n}=y.startSpan("ChatThreadClient-ListChatReadReceipts",e);try{const e=this.listReadReceiptsAll(n);return{next:()=>e.next(),[Symbol.asyncIterator](){return this},byPage:(e={})=>this.listReadReceiptsPage(e,n)}}catch(e){throw t.setStatus({status:"error",error:e}),e}finally{t.end()}}canPostTypingNotification(e){return!(this.timeOfLastTypingRequest&&e.getTime()-this.timeOfLastTypingRequest.getTime()<8e3)||(Le.info(`Typing interval check failed. [last_request=${this.timeOfLastTypingRequest}]`),!1)}}var Be=n(7007),Ge=n(8562);class He{constructor(e,t,n={}){this.endpoint=e,this.signalingClient=void 0,this.emitter=new Be.EventEmitter,this.isRealtimeNotificationsStarted=!1,this.tokenCredential=t;const r=Object.assign(Object.assign({},n),{loggingOptions:{logger:Le.info}});this.client=new Ue(this.endpoint,Object.assign({endpoint:this.endpoint},r));const i=je(this.tokenCredential);this.client.pipeline.addPolicy(i),this.clientOptions=Object.assign({},n),this.clientOptions.signalingClientOptions=Object.assign(Object.assign({},this.clientOptions.signalingClientOptions),{resourceEndpoint:this.endpoint,gatewayApiVersion:this.client.apiVersion}),this.signalingClient=((e,t,n)=>{var r,i,o,s;return new u.CommunicationSignalingClient(e,t,{resourceEndpoint:null!==(r=null==n?void 0:n.resourceEndpoint)&&void 0!==r?r:void 0,gatewayApiVersion:null!==(i=null==n?void 0:n.gatewayApiVersion)&&void 0!==i?i:void 0,additionalPolicies:null!==(o=null==n?void 0:n.additionalPolicies)&&void 0!==o?o:void 0,userAgentOptions:null!==(s=null==n?void 0:n.userAgentOptions)&&void 0!==s?s:void 0})})(t,Le,this.clientOptions.signalingClientOptions)}getChatThreadClient(e){return new Fe(this.endpoint,e,this.tokenCredential,this.clientOptions)}async createChatThread(e,t={}){return y.withSpan("ChatClient-CreateChatThread",t,async n=>{var r,o;n.idempotencyToken=null!==(r=n.idempotencyToken)&&void 0!==r?r:(0,Ge.A)();const s=(e=>{const{participants:t,idempotencyToken:n}=e,r=i(e,["participants","idempotencyToken"]);return Object.assign({repeatabilityRequestId:n},r)})(n);return(e=>{const{chatThread:t}=e,n=i(e,["chatThread"]);return t?Object.assign(Object.assign({},n),{chatThread:g(t)}):Object.assign({},n)})(await this.client.chat.createChatThread({topic:e.topic,participants:null===(o=t.participants)||void 0===o?void 0:o.map(e=>d(e))},s))})}listChatThreadsPage(e){return s(this,arguments,function*(e,t={}){if(!e.continuationToken){const n=yield o(this.client.chat.listChatThreads(t));e.continuationToken=n.nextLink,n.value&&(yield yield o(n.value))}for(;e.continuationToken;){const n=yield o(this.client.chat.listChatThreadsNext(e.continuationToken,t));if(e.continuationToken=n.nextLink,!n.value)break;yield yield o(n.value)}})}listChatThreadsAll(e){return s(this,arguments,function*(){var t,n,r,i;try{for(var s,u=!0,l=c(this.listChatThreadsPage({},e));!(t=(s=yield o(l.next())).done);u=!0){i=s.value,u=!1;const e=i;yield o(yield*a(c(e)))}}catch(e){n={error:e}}finally{try{u||t||!(r=l.return)||(yield o(r.call(l)))}finally{if(n)throw n.error}}})}listChatThreads(e={}){const{span:t,updatedOptions:n}=y.startSpan("ChatClient-ListChatThreads",e);try{const e=this.listChatThreadsAll(n);return{next:()=>e.next(),[Symbol.asyncIterator](){return this},byPage:(e={})=>this.listChatThreadsPage(e,n)}}catch(e){throw t.setStatus({error:e,status:"error"}),e}finally{t.end()}}async deleteChatThread(e,t={}){return y.withSpan("ChatClient-DeleteChatThread",t,async t=>{await this.client.chat.deleteChatThread(e,t)})}async startRealtimeNotifications(){if(void 0===this.signalingClient)throw new Error("Realtime notifications are not supported in node js.");this.isRealtimeNotificationsStarted||(this.isRealtimeNotificationsStarted=!0,await this.signalingClient.start(),this.subscribeToSignalingEvents())}async stopRealtimeNotifications(){if(void 0===this.signalingClient)throw new Error("Realtime notifications are not supported in node js.");this.isRealtimeNotificationsStarted=!1,await this.signalingClient.stop(),this.emitter.removeAllListeners()}on(e,t){if(void 0===this.signalingClient)throw new Error("Realtime notifications are only supported in the browser.");if(!this.isRealtimeNotificationsStarted&&"realTimeNotificationConnected"!==e&&"realTimeNotificationDisconnected"!==e)throw new Error("You must call startRealtimeNotifications before you can subscribe to events.");this.emitter.on(e,t)}off(e,t){if(void 0===this.signalingClient)throw new Error("Realtime notifications are only supported in the browser.");this.emitter.removeListener(e,t)}subscribeToSignalingEvents(){if(void 0===this.signalingClient)throw new Error("Realtime notifications are only supported in the browser.");this.signalingClient.on("connectionChanged",e=>{e===u.ConnectionState.Connected?this.emitter.emit("realTimeNotificationConnected"):e===u.ConnectionState.Disconnected&&this.emitter.emit("realTimeNotificationDisconnected")}),this.signalingClient.on("chatMessageReceived",e=>{this.emitter.emit("chatMessageReceived",e)}),this.signalingClient.on("chatMessageEdited",e=>{this.emitter.emit("chatMessageEdited",e)}),this.signalingClient.on("chatMessageDeleted",e=>{this.emitter.emit("chatMessageDeleted",e)}),this.signalingClient.on("typingIndicatorReceived",e=>{this.emitter.emit("typingIndicatorReceived",e)}),this.signalingClient.on("readReceiptReceived",e=>{this.emitter.emit("readReceiptReceived",e)}),this.signalingClient.on("chatThreadCreated",e=>{this.emitter.emit("chatThreadCreated",e)}),this.signalingClient.on("chatThreadDeleted",e=>{this.emitter.emit("chatThreadDeleted",e)}),this.signalingClient.on("chatThreadPropertiesUpdated",e=>{this.emitter.emit("chatThreadPropertiesUpdated",e)}),this.signalingClient.on("participantsAdded",e=>{this.emitter.emit("participantsAdded",e)}),this.signalingClient.on("participantsRemoved",e=>{this.emitter.emit("participantsRemoved",e)})}}},6153:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultMessageTags=t.customerMessageTag=t.channelIdTag=void 0,t.channelIdTag="ChannelId-lcw",t.customerMessageTag="FromCustomer",t.defaultMessageTags=[t.channelIdTag,t.customerMessageTag]},6276:(e,t,n)=>{"use strict";n.d(t,{b:()=>i});var r=n(8603);function i(e){if((0,r.G)(e)){const t="string"==typeof e.name,n="string"==typeof e.message;return t&&n}return!1}},6425:(e,t,n)=>{"use strict";function r(e,t){return function(){return e.apply(t,arguments)}}const{toString:i}=Object.prototype,{getPrototypeOf:o}=Object,{iterator:s,toStringTag:a}=Symbol,c=(u=Object.create(null),e=>{const t=i.call(e);return u[t]||(u[t]=t.slice(8,-1).toLowerCase())});var u;const l=e=>(e=e.toLowerCase(),t=>c(t)===e),d=e=>t=>typeof t===e,{isArray:h}=Array,p=d("undefined");function f(e){return null!==e&&!p(e)&&null!==e.constructor&&!p(e.constructor)&&v(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const g=l("ArrayBuffer"),m=d("string"),v=d("function"),y=d("number"),C=e=>null!==e&&"object"==typeof e,S=e=>{if("object"!==c(e))return!1;const t=o(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||a in e||s in e)},T=l("Date"),E=l("File"),b=l("Blob"),I=l("FileList"),w=l("URLSearchParams"),[R,A,O,k]=["ReadableStream","Request","Response","Headers"].map(l);function _(e,t,{allOwnKeys:n=!1}={}){if(null==e)return;let r,i;if("object"!=typeof e&&(e=[e]),h(e))for(r=0,i=e.length;r<i;r++)t.call(null,e[r],r,e);else{if(f(e))return;const i=n?Object.getOwnPropertyNames(e):Object.keys(e),o=i.length;let s;for(r=0;r<o;r++)s=i[r],t.call(null,e[s],s,e)}}function P(e,t){if(f(e))return null;t=t.toLowerCase();const n=Object.keys(e);let r,i=n.length;for(;i-- >0;)if(r=n[i],t===r.toLowerCase())return r;return null}const M="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:n.g,D=e=>!p(e)&&e!==M,N=(x="undefined"!=typeof Uint8Array&&o(Uint8Array),e=>x&&e instanceof x);var x;const U=l("HTMLFormElement"),L=(({hasOwnProperty:e})=>(t,n)=>e.call(t,n))(Object.prototype),q=l("RegExp"),j=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};_(n,(n,i)=>{let o;!1!==(o=t(n,i,e))&&(r[i]=o||n)}),Object.defineProperties(e,r)},F=l("AsyncFunction"),B=(G="function"==typeof setImmediate,H=v(M.postMessage),G?setImmediate:H?(V=`axios@${Math.random()}`,z=[],M.addEventListener("message",({source:e,data:t})=>{e===M&&t===V&&z.length&&z.shift()()},!1),e=>{z.push(e),M.postMessage(V,"*")}):e=>setTimeout(e));var G,H,V,z;const W="undefined"!=typeof queueMicrotask?queueMicrotask.bind(M):"undefined"!=typeof process&&process.nextTick||B;var K={isArray:h,isArrayBuffer:g,isBuffer:f,isFormData:e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||v(e.append)&&("formdata"===(t=c(e))||"object"===t&&v(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&g(e.buffer),t},isString:m,isNumber:y,isBoolean:e=>!0===e||!1===e,isObject:C,isPlainObject:S,isEmptyObject:e=>{if(!C(e)||f(e))return!1;try{return 0===Object.keys(e).length&&Object.getPrototypeOf(e)===Object.prototype}catch(e){return!1}},isReadableStream:R,isRequest:A,isResponse:O,isHeaders:k,isUndefined:p,isDate:T,isFile:E,isBlob:b,isRegExp:q,isFunction:v,isStream:e=>C(e)&&v(e.pipe),isURLSearchParams:w,isTypedArray:N,isFileList:I,forEach:_,merge:function e(){const{caseless:t,skipUndefined:n}=D(this)&&this||{},r={},i=(i,o)=>{const s=t&&P(r,o)||o;S(r[s])&&S(i)?r[s]=e(r[s],i):S(i)?r[s]=e({},i):h(i)?r[s]=i.slice():n&&p(i)||(r[s]=i)};for(let e=0,t=arguments.length;e<t;e++)arguments[e]&&_(arguments[e],i);return r},extend:(e,t,n,{allOwnKeys:i}={})=>(_(t,(t,i)=>{n&&v(t)?e[i]=r(t,n):e[i]=t},{allOwnKeys:i}),e),trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,r)=>{let i,s,a;const c={};if(t=t||{},null==e)return t;do{for(i=Object.getOwnPropertyNames(e),s=i.length;s-- >0;)a=i[s],r&&!r(a,e,t)||c[a]||(t[a]=e[a],c[a]=!0);e=!1!==n&&o(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:c,kindOfTest:l,endsWith:(e,t,n)=>{e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;const r=e.indexOf(t,n);return-1!==r&&r===n},toArray:e=>{if(!e)return null;if(h(e))return e;let t=e.length;if(!y(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[s]).call(e);let r;for(;(r=n.next())&&!r.done;){const n=r.value;t.call(e,n[0],n[1])}},matchAll:(e,t)=>{let n;const r=[];for(;null!==(n=e.exec(t));)r.push(n);return r},isHTMLForm:U,hasOwnProperty:L,hasOwnProp:L,reduceDescriptors:j,freezeMethods:e=>{j(e,(t,n)=>{if(v(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;const r=e[n];v(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(e,t)=>{const n={},r=e=>{e.forEach(e=>{n[e]=!0})};return h(e)?r(e):r(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,n){return t.toUpperCase()+n}),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:P,global:M,isContextDefined:D,isSpecCompliantForm:function(e){return!!(e&&v(e.append)&&"FormData"===e[a]&&e[s])},toJSONObject:e=>{const t=new Array(10),n=(e,r)=>{if(C(e)){if(t.indexOf(e)>=0)return;if(f(e))return e;if(!("toJSON"in e)){t[r]=e;const i=h(e)?[]:{};return _(e,(e,t)=>{const o=n(e,r+1);!p(o)&&(i[t]=o)}),t[r]=void 0,i}}return e};return n(e,0)},isAsyncFn:F,isThenable:e=>e&&(C(e)||v(e))&&v(e.then)&&v(e.catch),setImmediate:B,asap:W,isIterable:e=>null!=e&&v(e[s])};function $(e,t,n,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i,this.status=i.status?i.status:null)}K.inherits($,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:K.toJSONObject(this.config),code:this.code,status:this.status}}});const J=$.prototype,X={};function Q(e){return K.isPlainObject(e)||K.isArray(e)}function Y(e){return K.endsWith(e,"[]")?e.slice(0,-2):e}function Z(e,t,n){return e?e.concat(t).map(function(e,t){return e=Y(e),!n&&t?"["+e+"]":e}).join(n?".":""):t}["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{X[e]={value:e}}),Object.defineProperties($,X),Object.defineProperty(J,"isAxiosError",{value:!0}),$.from=(e,t,n,r,i,o)=>{const s=Object.create(J);K.toFlatObject(e,s,function(e){return e!==Error.prototype},e=>"isAxiosError"!==e);const a=e&&e.message?e.message:"Error",c=null==t&&e?e.code:t;return $.call(s,a,c,n,r,i),e&&null==s.cause&&Object.defineProperty(s,"cause",{value:e,configurable:!0}),s.name=e&&e.name||"Error",o&&Object.assign(s,o),s};const ee=K.toFlatObject(K,{},null,function(e){return/^is[A-Z]/.test(e)});function te(e,t,n){if(!K.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const r=(n=K.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(e,t){return!K.isUndefined(t[e])})).metaTokens,i=n.visitor||u,o=n.dots,s=n.indexes,a=(n.Blob||"undefined"!=typeof Blob&&Blob)&&K.isSpecCompliantForm(t);if(!K.isFunction(i))throw new TypeError("visitor must be a function");function c(e){if(null===e)return"";if(K.isDate(e))return e.toISOString();if(K.isBoolean(e))return e.toString();if(!a&&K.isBlob(e))throw new $("Blob is not supported. Use a Buffer instead.");return K.isArrayBuffer(e)||K.isTypedArray(e)?a&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function u(e,n,i){let a=e;if(e&&!i&&"object"==typeof e)if(K.endsWith(n,"{}"))n=r?n:n.slice(0,-2),e=JSON.stringify(e);else if(K.isArray(e)&&function(e){return K.isArray(e)&&!e.some(Q)}(e)||(K.isFileList(e)||K.endsWith(n,"[]"))&&(a=K.toArray(e)))return n=Y(n),a.forEach(function(e,r){!K.isUndefined(e)&&null!==e&&t.append(!0===s?Z([n],r,o):null===s?n:n+"[]",c(e))}),!1;return!!Q(e)||(t.append(Z(i,n,o),c(e)),!1)}const l=[],d=Object.assign(ee,{defaultVisitor:u,convertValue:c,isVisitable:Q});if(!K.isObject(e))throw new TypeError("data must be an object");return function e(n,r){if(!K.isUndefined(n)){if(-1!==l.indexOf(n))throw Error("Circular reference detected in "+r.join("."));l.push(n),K.forEach(n,function(n,o){!0===(!(K.isUndefined(n)||null===n)&&i.call(t,n,K.isString(o)?o.trim():o,r,d))&&e(n,r?r.concat(o):[o])}),l.pop()}}(e),t}function ne(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(e){return t[e]})}function re(e,t){this._pairs=[],e&&te(e,this,t)}const ie=re.prototype;function oe(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function se(e,t,n){if(!t)return e;const r=n&&n.encode||oe;K.isFunction(n)&&(n={serialize:n});const i=n&&n.serialize;let o;if(o=i?i(t,n):K.isURLSearchParams(t)?t.toString():new re(t,n).toString(r),o){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+o}return e}ie.append=function(e,t){this._pairs.push([e,t])},ie.toString=function(e){const t=e?function(t){return e.call(this,t,ne)}:ne;return this._pairs.map(function(e){return t(e[0])+"="+t(e[1])},"").join("&")};var ae=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){K.forEach(this.handlers,function(t){null!==t&&e(t)})}},ce={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},ue={isBrowser:!0,classes:{URLSearchParams:"undefined"!=typeof URLSearchParams?URLSearchParams:re,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]};const le="undefined"!=typeof window&&"undefined"!=typeof document,de="object"==typeof navigator&&navigator||void 0,he=le&&(!de||["ReactNative","NativeScript","NS"].indexOf(de.product)<0),pe="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,fe=le&&window.location.href||"http://localhost";var ge={...Object.freeze({__proto__:null,hasBrowserEnv:le,hasStandardBrowserWebWorkerEnv:pe,hasStandardBrowserEnv:he,navigator:de,origin:fe}),...ue};function me(e){function t(e,n,r,i){let o=e[i++];if("__proto__"===o)return!0;const s=Number.isFinite(+o),a=i>=e.length;return o=!o&&K.isArray(r)?r.length:o,a?(K.hasOwnProp(r,o)?r[o]=[r[o],n]:r[o]=n,!s):(r[o]&&K.isObject(r[o])||(r[o]=[]),t(e,n,r[o],i)&&K.isArray(r[o])&&(r[o]=function(e){const t={},n=Object.keys(e);let r;const i=n.length;let o;for(r=0;r<i;r++)o=n[r],t[o]=e[o];return t}(r[o])),!s)}if(K.isFormData(e)&&K.isFunction(e.entries)){const n={};return K.forEachEntry(e,(e,r)=>{t(function(e){return K.matchAll(/\w+|\[(\w*)]/g,e).map(e=>"[]"===e[0]?"":e[1]||e[0])}(e),r,n,0)}),n}return null}const ve={transitional:ce,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",r=n.indexOf("application/json")>-1,i=K.isObject(e);if(i&&K.isHTMLForm(e)&&(e=new FormData(e)),K.isFormData(e))return r?JSON.stringify(me(e)):e;if(K.isArrayBuffer(e)||K.isBuffer(e)||K.isStream(e)||K.isFile(e)||K.isBlob(e)||K.isReadableStream(e))return e;if(K.isArrayBufferView(e))return e.buffer;if(K.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(i){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return te(e,new ge.classes.URLSearchParams,{visitor:function(e,t,n,r){return ge.isNode&&K.isBuffer(e)?(this.append(t,e.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)},...t})}(e,this.formSerializer).toString();if((o=K.isFileList(e))||n.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return te(o?{"files[]":e}:e,t&&new t,this.formSerializer)}}return i||r?(t.setContentType("application/json",!1),function(e){if(K.isString(e))try{return(0,JSON.parse)(e),K.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(0,JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||ve.transitional,n=t&&t.forcedJSONParsing,r="json"===this.responseType;if(K.isResponse(e)||K.isReadableStream(e))return e;if(e&&K.isString(e)&&(n&&!this.responseType||r)){const n=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e,this.parseReviver)}catch(e){if(n){if("SyntaxError"===e.name)throw $.from(e,$.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ge.classes.FormData,Blob:ge.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};K.forEach(["delete","get","head","post","put","patch"],e=>{ve.headers[e]={}});var ye=ve;const Ce=K.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Se=Symbol("internals");function Te(e){return e&&String(e).trim().toLowerCase()}function Ee(e){return!1===e||null==e?e:K.isArray(e)?e.map(Ee):String(e)}function be(e,t,n,r,i){return K.isFunction(r)?r.call(this,t,n):(i&&(t=n),K.isString(t)?K.isString(r)?-1!==t.indexOf(r):K.isRegExp(r)?r.test(t):void 0:void 0)}class Ie{constructor(e){e&&this.set(e)}set(e,t,n){const r=this;function i(e,t,n){const i=Te(t);if(!i)throw new Error("header name must be a non-empty string");const o=K.findKey(r,i);(!o||void 0===r[o]||!0===n||void 0===n&&!1!==r[o])&&(r[o||t]=Ee(e))}const o=(e,t)=>K.forEach(e,(e,n)=>i(e,n,t));if(K.isPlainObject(e)||e instanceof this.constructor)o(e,t);else if(K.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim()))o((e=>{const t={};let n,r,i;return e&&e.split("\n").forEach(function(e){i=e.indexOf(":"),n=e.substring(0,i).trim().toLowerCase(),r=e.substring(i+1).trim(),!n||t[n]&&Ce[n]||("set-cookie"===n?t[n]?t[n].push(r):t[n]=[r]:t[n]=t[n]?t[n]+", "+r:r)}),t})(e),t);else if(K.isObject(e)&&K.isIterable(e)){let n,r,i={};for(const t of e){if(!K.isArray(t))throw TypeError("Object iterator must return a key-value pair");i[r=t[0]]=(n=i[r])?K.isArray(n)?[...n,t[1]]:[n,t[1]]:t[1]}o(i,t)}else null!=e&&i(t,e,n);return this}get(e,t){if(e=Te(e)){const n=K.findKey(this,e);if(n){const e=this[n];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(e);)t[r[1]]=r[2];return t}(e);if(K.isFunction(t))return t.call(this,e,n);if(K.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Te(e)){const n=K.findKey(this,e);return!(!n||void 0===this[n]||t&&!be(0,this[n],n,t))}return!1}delete(e,t){const n=this;let r=!1;function i(e){if(e=Te(e)){const i=K.findKey(n,e);!i||t&&!be(0,n[i],i,t)||(delete n[i],r=!0)}}return K.isArray(e)?e.forEach(i):i(e),r}clear(e){const t=Object.keys(this);let n=t.length,r=!1;for(;n--;){const i=t[n];e&&!be(0,this[i],i,e,!0)||(delete this[i],r=!0)}return r}normalize(e){const t=this,n={};return K.forEach(this,(r,i)=>{const o=K.findKey(n,i);if(o)return t[o]=Ee(r),void delete t[i];const s=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,n)=>t.toUpperCase()+n)}(i):String(i).trim();s!==i&&delete t[i],t[s]=Ee(r),n[s]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return K.forEach(this,(n,r)=>{null!=n&&!1!==n&&(t[r]=e&&K.isArray(n)?n.join(", "):n)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join("\n")}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const n=new this(e);return t.forEach(e=>n.set(e)),n}static accessor(e){const t=(this[Se]=this[Se]={accessors:{}}).accessors,n=this.prototype;function r(e){const r=Te(e);t[r]||(function(e,t){const n=K.toCamelCase(" "+t);["get","set","has"].forEach(r=>{Object.defineProperty(e,r+n,{value:function(e,n,i){return this[r].call(this,t,e,n,i)},configurable:!0})})}(n,e),t[r]=!0)}return K.isArray(e)?e.forEach(r):r(e),this}}Ie.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),K.reduceDescriptors(Ie.prototype,({value:e},t)=>{let n=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(e){this[n]=e}}}),K.freezeMethods(Ie);var we=Ie;function Re(e,t){const n=this||ye,r=t||n,i=we.from(r.headers);let o=r.data;return K.forEach(e,function(e){o=e.call(n,o,i.normalize(),t?t.status:void 0)}),i.normalize(),o}function Ae(e){return!(!e||!e.__CANCEL__)}function Oe(e,t,n){$.call(this,null==e?"canceled":e,$.ERR_CANCELED,t,n),this.name="CanceledError"}function ke(e,t,n){const r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new $("Request failed with status code "+n.status,[$.ERR_BAD_REQUEST,$.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}K.inherits(Oe,$,{__CANCEL__:!0});const _e=(e,t,n=3)=>{let r=0;const i=function(e,t){e=e||10;const n=new Array(e),r=new Array(e);let i,o=0,s=0;return t=void 0!==t?t:1e3,function(a){const c=Date.now(),u=r[s];i||(i=c),n[o]=a,r[o]=c;let l=s,d=0;for(;l!==o;)d+=n[l++],l%=e;if(o=(o+1)%e,o===s&&(s=(s+1)%e),c-i<t)return;const h=u&&c-u;return h?Math.round(1e3*d/h):void 0}}(50,250);return function(n,o){let s,a,c=0,u=1e3/o;const l=(n,o=Date.now())=>{c=o,s=null,a&&(clearTimeout(a),a=null),(n=>{const o=n.loaded,s=n.lengthComputable?n.total:void 0,a=o-r,c=i(a);r=o,e({loaded:o,total:s,progress:s?o/s:void 0,bytes:a,rate:c||void 0,estimated:c&&s&&o<=s?(s-o)/c:void 0,event:n,lengthComputable:null!=s,[t?"download":"upload"]:!0})})(...n)};return[(...e)=>{const t=Date.now(),n=t-c;n>=u?l(e,t):(s=e,a||(a=setTimeout(()=>{a=null,l(s)},u-n)))},()=>s&&l(s)]}(0,n)},Pe=(e,t)=>{const n=null!=e;return[r=>t[0]({lengthComputable:n,total:e,loaded:r}),t[1]]},Me=e=>(...t)=>K.asap(()=>e(...t));var De=ge.hasStandardBrowserEnv?((e,t)=>n=>(n=new URL(n,ge.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new URL(ge.origin),ge.navigator&&/(msie|trident)/i.test(ge.navigator.userAgent)):()=>!0,Ne=ge.hasStandardBrowserEnv?{write(e,t,n,r,i,o,s){if("undefined"==typeof document)return;const a=[`${e}=${encodeURIComponent(t)}`];K.isNumber(n)&&a.push(`expires=${new Date(n).toUTCString()}`),K.isString(r)&&a.push(`path=${r}`),K.isString(i)&&a.push(`domain=${i}`),!0===o&&a.push("secure"),K.isString(s)&&a.push(`SameSite=${s}`),document.cookie=a.join("; ")},read(e){if("undefined"==typeof document)return null;const t=document.cookie.match(new RegExp("(?:^|; )"+e+"=([^;]*)"));return t?decodeURIComponent(t[1]):null},remove(e){this.write(e,"",Date.now()-864e5,"/")}}:{write(){},read:()=>null,remove(){}};function xe(e,t,n){let r=!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t);return e&&(r||0==n)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}const Ue=e=>e instanceof we?{...e}:e;function Le(e,t){t=t||{};const n={};function r(e,t,n,r){return K.isPlainObject(e)&&K.isPlainObject(t)?K.merge.call({caseless:r},e,t):K.isPlainObject(t)?K.merge({},t):K.isArray(t)?t.slice():t}function i(e,t,n,i){return K.isUndefined(t)?K.isUndefined(e)?void 0:r(void 0,e,0,i):r(e,t,0,i)}function o(e,t){if(!K.isUndefined(t))return r(void 0,t)}function s(e,t){return K.isUndefined(t)?K.isUndefined(e)?void 0:r(void 0,e):r(void 0,t)}function a(n,i,o){return o in t?r(n,i):o in e?r(void 0,n):void 0}const c={url:o,method:o,data:o,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,withXSRFToken:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:a,headers:(e,t,n)=>i(Ue(e),Ue(t),0,!0)};return K.forEach(Object.keys({...e,...t}),function(r){const o=c[r]||i,s=o(e[r],t[r],r);K.isUndefined(s)&&o!==a||(n[r]=s)}),n}var qe=e=>{const t=Le({},e);let{data:n,withXSRFToken:r,xsrfHeaderName:i,xsrfCookieName:o,headers:s,auth:a}=t;if(t.headers=s=we.from(s),t.url=se(xe(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),a&&s.set("Authorization","Basic "+btoa((a.username||"")+":"+(a.password?unescape(encodeURIComponent(a.password)):""))),K.isFormData(n))if(ge.hasStandardBrowserEnv||ge.hasStandardBrowserWebWorkerEnv)s.setContentType(void 0);else if(K.isFunction(n.getHeaders)){const e=n.getHeaders(),t=["content-type","content-length"];Object.entries(e).forEach(([e,n])=>{t.includes(e.toLowerCase())&&s.set(e,n)})}if(ge.hasStandardBrowserEnv&&(r&&K.isFunction(r)&&(r=r(t)),r||!1!==r&&De(t.url))){const e=i&&o&&Ne.read(o);e&&s.set(i,e)}return t},je="undefined"!=typeof XMLHttpRequest&&function(e){return new Promise(function(t,n){const r=qe(e);let i=r.data;const o=we.from(r.headers).normalize();let s,a,c,u,l,{responseType:d,onUploadProgress:h,onDownloadProgress:p}=r;function f(){u&&u(),l&&l(),r.cancelToken&&r.cancelToken.unsubscribe(s),r.signal&&r.signal.removeEventListener("abort",s)}let g=new XMLHttpRequest;function m(){if(!g)return;const r=we.from("getAllResponseHeaders"in g&&g.getAllResponseHeaders());ke(function(e){t(e),f()},function(e){n(e),f()},{data:d&&"text"!==d&&"json"!==d?g.response:g.responseText,status:g.status,statusText:g.statusText,headers:r,config:e,request:g}),g=null}g.open(r.method.toUpperCase(),r.url,!0),g.timeout=r.timeout,"onloadend"in g?g.onloadend=m:g.onreadystatechange=function(){g&&4===g.readyState&&(0!==g.status||g.responseURL&&0===g.responseURL.indexOf("file:"))&&setTimeout(m)},g.onabort=function(){g&&(n(new $("Request aborted",$.ECONNABORTED,e,g)),g=null)},g.onerror=function(t){const r=new $(t&&t.message?t.message:"Network Error",$.ERR_NETWORK,e,g);r.event=t||null,n(r),g=null},g.ontimeout=function(){let t=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const i=r.transitional||ce;r.timeoutErrorMessage&&(t=r.timeoutErrorMessage),n(new $(t,i.clarifyTimeoutError?$.ETIMEDOUT:$.ECONNABORTED,e,g)),g=null},void 0===i&&o.setContentType(null),"setRequestHeader"in g&&K.forEach(o.toJSON(),function(e,t){g.setRequestHeader(t,e)}),K.isUndefined(r.withCredentials)||(g.withCredentials=!!r.withCredentials),d&&"json"!==d&&(g.responseType=r.responseType),p&&([c,l]=_e(p,!0),g.addEventListener("progress",c)),h&&g.upload&&([a,u]=_e(h),g.upload.addEventListener("progress",a),g.upload.addEventListener("loadend",u)),(r.cancelToken||r.signal)&&(s=t=>{g&&(n(!t||t.type?new Oe(null,e,g):t),g.abort(),g=null)},r.cancelToken&&r.cancelToken.subscribe(s),r.signal&&(r.signal.aborted?s():r.signal.addEventListener("abort",s)));const v=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(r.url);v&&-1===ge.protocols.indexOf(v)?n(new $("Unsupported protocol "+v+":",$.ERR_BAD_REQUEST,e)):g.send(i||null)})},Fe=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let n,r=new AbortController;const i=function(e){if(!n){n=!0,s();const t=e instanceof Error?e:this.reason;r.abort(t instanceof $?t:new Oe(t instanceof Error?t.message:t))}};let o=t&&setTimeout(()=>{o=null,i(new $(`timeout ${t} of ms exceeded`,$.ETIMEDOUT))},t);const s=()=>{e&&(o&&clearTimeout(o),o=null,e.forEach(e=>{e.unsubscribe?e.unsubscribe(i):e.removeEventListener("abort",i)}),e=null)};e.forEach(e=>e.addEventListener("abort",i));const{signal:a}=r;return a.unsubscribe=()=>K.asap(s),a}};const Be=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let r,i=0;for(;i<n;)r=i+t,yield e.slice(i,r),i=r},Ge=(e,t,n,r)=>{const i=async function*(e,t){for await(const n of async function*(e){if(e[Symbol.asyncIterator])return void(yield*e);const t=e.getReader();try{for(;;){const{done:e,value:n}=await t.read();if(e)break;yield n}}finally{await t.cancel()}}(e))yield*Be(n,t)}(e,t);let o,s=0,a=e=>{o||(o=!0,r&&r(e))};return new ReadableStream({async pull(e){try{const{done:t,value:r}=await i.next();if(t)return a(),void e.close();let o=r.byteLength;if(n){let e=s+=o;n(e)}e.enqueue(new Uint8Array(r))}catch(e){throw a(e),e}},cancel:e=>(a(e),i.return())},{highWaterMark:2})},{isFunction:He}=K,Ve=(({Request:e,Response:t})=>({Request:e,Response:t}))(K.global),{ReadableStream:ze,TextEncoder:We}=K.global,Ke=(e,...t)=>{try{return!!e(...t)}catch(e){return!1}},$e=e=>{e=K.merge.call({skipUndefined:!0},Ve,e);const{fetch:t,Request:n,Response:r}=e,i=t?He(t):"function"==typeof fetch,o=He(n),s=He(r);if(!i)return!1;const a=i&&He(ze),c=i&&("function"==typeof We?(u=new We,e=>u.encode(e)):async e=>new Uint8Array(await new n(e).arrayBuffer()));var u;const l=o&&a&&Ke(()=>{let e=!1;const t=new n(ge.origin,{body:new ze,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),d=s&&a&&Ke(()=>K.isReadableStream(new r("").body)),h={stream:d&&(e=>e.body)};i&&["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!h[e]&&(h[e]=(t,n)=>{let r=t&&t[e];if(r)return r.call(t);throw new $(`Response type '${e}' is not supported`,$.ERR_NOT_SUPPORT,n)})});return async e=>{let{url:i,method:s,data:a,signal:u,cancelToken:p,timeout:f,onDownloadProgress:g,onUploadProgress:m,responseType:v,headers:y,withCredentials:C="same-origin",fetchOptions:S}=qe(e),T=t||fetch;v=v?(v+"").toLowerCase():"text";let E=Fe([u,p&&p.toAbortSignal()],f),b=null;const I=E&&E.unsubscribe&&(()=>{E.unsubscribe()});let w;try{if(m&&l&&"get"!==s&&"head"!==s&&0!==(w=await(async(e,t)=>{const r=K.toFiniteNumber(e.getContentLength());return null==r?(async e=>{if(null==e)return 0;if(K.isBlob(e))return e.size;if(K.isSpecCompliantForm(e)){const t=new n(ge.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return K.isArrayBufferView(e)||K.isArrayBuffer(e)?e.byteLength:(K.isURLSearchParams(e)&&(e+=""),K.isString(e)?(await c(e)).byteLength:void 0)})(t):r})(y,a))){let e,t=new n(i,{method:"POST",body:a,duplex:"half"});if(K.isFormData(a)&&(e=t.headers.get("content-type"))&&y.setContentType(e),t.body){const[e,n]=Pe(w,_e(Me(m)));a=Ge(t.body,65536,e,n)}}K.isString(C)||(C=C?"include":"omit");const t=o&&"credentials"in n.prototype,u={...S,signal:E,method:s.toUpperCase(),headers:y.normalize().toJSON(),body:a,duplex:"half",credentials:t?C:void 0};b=o&&new n(i,u);let p=await(o?T(b,S):T(i,u));const f=d&&("stream"===v||"response"===v);if(d&&(g||f&&I)){const e={};["status","statusText","headers"].forEach(t=>{e[t]=p[t]});const t=K.toFiniteNumber(p.headers.get("content-length")),[n,i]=g&&Pe(t,_e(Me(g),!0))||[];p=new r(Ge(p.body,65536,n,()=>{i&&i(),I&&I()}),e)}v=v||"text";let R=await h[K.findKey(h,v)||"text"](p,e);return!f&&I&&I(),await new Promise((t,n)=>{ke(t,n,{data:R,headers:we.from(p.headers),status:p.status,statusText:p.statusText,config:e,request:b})})}catch(t){if(I&&I(),t&&"TypeError"===t.name&&/Load failed|fetch/i.test(t.message))throw Object.assign(new $("Network Error",$.ERR_NETWORK,e,b),{cause:t.cause||t});throw $.from(t,t&&t.code,e,b)}}},Je=new Map,Xe=e=>{let t=e&&e.env||{};const{fetch:n,Request:r,Response:i}=t,o=[r,i,n];let s,a,c=o.length,u=Je;for(;c--;)s=o[c],a=u.get(s),void 0===a&&u.set(s,a=c?new Map:$e(t)),u=a;return a};Xe();const Qe={http:null,xhr:je,fetch:{get:Xe}};K.forEach(Qe,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(e){}Object.defineProperty(e,"adapterName",{value:t})}});const Ye=e=>`- ${e}`,Ze=e=>K.isFunction(e)||null===e||!1===e;var et=function(e,t){e=K.isArray(e)?e:[e];const{length:n}=e;let r,i;const o={};for(let s=0;s<n;s++){let n;if(r=e[s],i=r,!Ze(r)&&(i=Qe[(n=String(r)).toLowerCase()],void 0===i))throw new $(`Unknown adapter '${n}'`);if(i&&(K.isFunction(i)||(i=i.get(t))))break;o[n||"#"+s]=i}if(!i){const e=Object.entries(o).map(([e,t])=>`adapter ${e} `+(!1===t?"is not supported by the environment":"is not available in the build"));throw new $("There is no suitable adapter to dispatch the request "+(n?e.length>1?"since :\n"+e.map(Ye).join("\n"):" "+Ye(e[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return i};function tt(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Oe(null,e)}function nt(e){return tt(e),e.headers=we.from(e.headers),e.data=Re.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1),et(e.adapter||ye.adapter,e)(e).then(function(t){return tt(e),t.data=Re.call(e,e.transformResponse,t),t.headers=we.from(t.headers),t},function(t){return Ae(t)||(tt(e),t&&t.response&&(t.response.data=Re.call(e,e.transformResponse,t.response),t.response.headers=we.from(t.response.headers))),Promise.reject(t)})}const rt="1.13.2",it={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{it[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const ot={};it.transitional=function(e,t,n){function r(e,t){return"[Axios v"+rt+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return(n,i,o)=>{if(!1===e)throw new $(r(i," has been removed"+(t?" in "+t:"")),$.ERR_DEPRECATED);return t&&!ot[i]&&(ot[i]=!0,console.warn(r(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,i,o)}},it.spelling=function(e){return(t,n)=>(console.warn(`${n} is likely a misspelling of ${e}`),!0)};var st={assertOptions:function(e,t,n){if("object"!=typeof e)throw new $("options must be an object",$.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let i=r.length;for(;i-- >0;){const o=r[i],s=t[o];if(s){const t=e[o],n=void 0===t||s(t,o,e);if(!0!==n)throw new $("option "+o+" must be "+n,$.ERR_BAD_OPTION_VALUE);continue}if(!0!==n)throw new $("Unknown option "+o,$.ERR_BAD_OPTION)}},validators:it};const at=st.validators;class ct{constructor(e){this.defaults=e||{},this.interceptors={request:new ae,response:new ae}}async request(e,t){try{return await this._request(e,t)}catch(e){if(e instanceof Error){let t={};Error.captureStackTrace?Error.captureStackTrace(t):t=new Error;const n=t.stack?t.stack.replace(/^.+\n/,""):"";try{e.stack?n&&!String(e.stack).endsWith(n.replace(/^.+\n.+\n/,""))&&(e.stack+="\n"+n):e.stack=n}catch(e){}}throw e}}_request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=Le(this.defaults,t);const{transitional:n,paramsSerializer:r,headers:i}=t;void 0!==n&&st.assertOptions(n,{silentJSONParsing:at.transitional(at.boolean),forcedJSONParsing:at.transitional(at.boolean),clarifyTimeoutError:at.transitional(at.boolean)},!1),null!=r&&(K.isFunction(r)?t.paramsSerializer={serialize:r}:st.assertOptions(r,{encode:at.function,serialize:at.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),st.assertOptions(t,{baseUrl:at.spelling("baseURL"),withXsrfToken:at.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=i&&K.merge(i.common,i[t.method]);i&&K.forEach(["delete","get","head","post","put","patch","common"],e=>{delete i[e]}),t.headers=we.concat(o,i);const s=[];let a=!0;this.interceptors.request.forEach(function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(a=a&&e.synchronous,s.unshift(e.fulfilled,e.rejected))});const c=[];let u;this.interceptors.response.forEach(function(e){c.push(e.fulfilled,e.rejected)});let l,d=0;if(!a){const e=[nt.bind(this),void 0];for(e.unshift(...s),e.push(...c),l=e.length,u=Promise.resolve(t);d<l;)u=u.then(e[d++],e[d++]);return u}l=s.length;let h=t;for(;d<l;){const e=s[d++],t=s[d++];try{h=e(h)}catch(e){t.call(this,e);break}}try{u=nt.call(this,h)}catch(e){return Promise.reject(e)}for(d=0,l=c.length;d<l;)u=u.then(c[d++],c[d++]);return u}getUri(e){return se(xe((e=Le(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}}K.forEach(["delete","get","head","options"],function(e){ct.prototype[e]=function(t,n){return this.request(Le(n||{},{method:e,url:t,data:(n||{}).data}))}}),K.forEach(["post","put","patch"],function(e){function t(t){return function(n,r,i){return this.request(Le(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}ct.prototype[e]=t(),ct.prototype[e+"Form"]=t(!0)});var ut=ct;class lt{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(e){t=e});const n=this;this.promise.then(e=>{if(!n._listeners)return;let t=n._listeners.length;for(;t-- >0;)n._listeners[t](e);n._listeners=null}),this.promise.then=e=>{let t;const r=new Promise(e=>{n.subscribe(e),t=e}).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e(function(e,r,i){n.reason||(n.reason=new Oe(e,r,i),t(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new lt(function(t){e=t}),cancel:e}}}var dt=lt;const ht={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(ht).forEach(([e,t])=>{ht[t]=e});var pt=ht;const ft=function e(t){const n=new ut(t),i=r(ut.prototype.request,n);return K.extend(i,ut.prototype,n,{allOwnKeys:!0}),K.extend(i,n,null,{allOwnKeys:!0}),i.create=function(n){return e(Le(t,n))},i}(ye);ft.Axios=ut,ft.CanceledError=Oe,ft.CancelToken=dt,ft.isCancel=Ae,ft.VERSION=rt,ft.toFormData=te,ft.AxiosError=$,ft.Cancel=ft.CanceledError,ft.all=function(e){return Promise.all(e)},ft.spread=function(e){return function(t){return e.apply(null,t)}},ft.isAxiosError=function(e){return K.isObject(e)&&!0===e.isAxiosError},ft.mergeConfig=Le,ft.AxiosHeaders=we,ft.formToJSON=e=>me(K.isHTMLForm(e)?new FormData(e):e),ft.getAdapter=et,ft.HttpStatusCode=pt,ft.default=ft,e.exports=ft},6469:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.createAMSClientLogger=t.createCallingSDKLogger=t.createACSAdapterLogger=t.createACSClientLogger=t.createOCSDKLogger=t.createIC3ClientLogger=t.AMSClientLogger=t.CallingSDKLogger=t.ACSAdapterLogger=t.ACSClientLogger=t.OCSDKLogger=t.IC3ClientLogger=void 0;var i=n(7969),o=n(1908),s=n(4140),a=n(7030),c=function(){function e(e){this.omnichannelConfig=e,this.debug=!1,this.runtimeId="",this.requestId="",this.chatId="",this.telemetry=null,this.debug=!1}return e.prototype.setDebug=function(e){this.debug=e},e.prototype.setRuntimeId=function(e){this.runtimeId=e},e.prototype.setRequestId=function(e){this.requestId=e},e.prototype.setChatId=function(e){this.chatId=e},e.prototype.useTelemetry=function(e){this.debug&&console.log("[IC3ClientLogger][useTelemetry]"),this.telemetry=e},e.prototype.logClientSdkTelemetryEvent=function(e,t){var n,i,s,c;this.debug&&console.log("[IC3ClientLogger][logClientSdkTelemetryEvent][".concat(e,"]")),this.debug&&console.log(t);var u={ChatSDKRuntimeId:this.runtimeId,OrgId:this.omnichannelConfig.orgId,OrgUrl:this.omnichannelConfig.orgUrl,WidgetId:this.omnichannelConfig.widgetId,RequestId:this.requestId,ChatId:this.chatId},l=r(r({},t),{ExceptionDetails:t.ExceptionDetails?JSON.stringify(t.ExceptionDetails):""});switch(e){case o.default.DEBUG:null===(n=this.telemetry)||void 0===n||n.debug(r(r({},u),l),a.default.IC3CLIENT);break;case o.default.WARN:null===(i=this.telemetry)||void 0===i||i.warn(r(r({},u),l),a.default.IC3CLIENT);break;case o.default.ERROR:null===(s=this.telemetry)||void 0===s||s.error(r(r({},u),l),a.default.IC3CLIENT);break;case o.default.INFO:default:null===(c=this.telemetry)||void 0===c||c.info(r(r({},u),l),a.default.IC3CLIENT)}},e}();t.IC3ClientLogger=c;var u=function(){function e(e){this.omnichannelConfig=e,this.debug=!1,this.runtimeId="",this.requestId="",this.chatId="",this.telemetry=null,this.debug=!1}return e.prototype.setDebug=function(e){this.debug=e},e.prototype.setRuntimeId=function(e){this.runtimeId=e},e.prototype.setRequestId=function(e){this.requestId=e},e.prototype.setChatId=function(e){this.chatId=e},e.prototype.useTelemetry=function(e){this.debug&&console.log("[OCSDKLogger][useTelemetry]"),this.telemetry=e},e.prototype.logClientSdkTelemetryEvent=function(e,t){var n,i,s,c;this.debug&&console.log("[OCSDKLogger][logClientSdkTelemetryEvent][".concat(e,"]")),this.debug&&console.log(t);var u={ChatSDKRuntimeId:this.runtimeId,OrgId:this.omnichannelConfig.orgId,OrgUrl:this.omnichannelConfig.orgUrl,WidgetId:this.omnichannelConfig.widgetId,RequestId:this.requestId,ChatId:this.chatId},l=r(r({},t),{RequestHeaders:t.RequestHeaders?JSON.stringify(t.RequestHeaders):"",RequestPayload:t.RequestPayload?JSON.stringify(t.RequestPayload):"",ExceptionDetails:t.ExceptionDetails?JSON.stringify(t.ExceptionDetails):""});switch(e){case o.default.DEBUG:null===(n=this.telemetry)||void 0===n||n.debug(r(r({},u),l),a.default.OCSDK);break;case o.default.WARN:null===(i=this.telemetry)||void 0===i||i.warn(r(r({},u),l),a.default.OCSDK);break;case o.default.ERROR:null===(s=this.telemetry)||void 0===s||s.error(r(r({},u),l),a.default.OCSDK);break;case o.default.INFO:default:null===(c=this.telemetry)||void 0===c||c.info(r(r({},u),l),a.default.OCSDK)}},e}();t.OCSDKLogger=u;var l=function(){function e(e){this.omnichannelConfig=e,this.debug=!1,this.runtimeId="",this.requestId="",this.chatId="",this.telemetry=null,this.scenarioMarker=null,this.debug=!1,this.scenarioMarker=new s.default(e),this.scenarioMarker.setScenarioType(a.default.ACSCLIENT)}return e.prototype.setDebug=function(e){var t;this.debug=e,null===(t=this.scenarioMarker)||void 0===t||t.setDebug(e)},e.prototype.setRuntimeId=function(e){var t;this.runtimeId=e,null===(t=this.scenarioMarker)||void 0===t||t.setRuntimeId(e)},e.prototype.setRequestId=function(e){this.requestId=e},e.prototype.setChatId=function(e){this.chatId=e},e.prototype.useTelemetry=function(e){var t;this.debug&&console.log("[ACSClientLogger][useTelemetry]"),this.telemetry=e,null===(t=this.scenarioMarker)||void 0===t||t.useTelemetry(this.telemetry)},e.prototype.logClientSdkTelemetryEvent=function(e,t){var n,i,s,c;this.debug&&console.log("[ACSClientLogger][logClientSdkTelemetryEvent][".concat(e,"]")),this.debug&&console.log(t);var u={ChatSDKRuntimeId:this.runtimeId,OrgId:this.omnichannelConfig.orgId,OrgUrl:this.omnichannelConfig.orgUrl,WidgetId:this.omnichannelConfig.widgetId,RequestId:this.requestId,ChatId:this.chatId},l=r(r({},t),{ExceptionDetails:t.ExceptionDetails?JSON.stringify(t.ExceptionDetails):""});switch(e){case o.default.DEBUG:null===(n=this.telemetry)||void 0===n||n.debug(r(r({},u),l),a.default.ACSCLIENT);break;case o.default.WARN:null===(i=this.telemetry)||void 0===i||i.warn(r(r({},u),l),a.default.ACSCLIENT);break;case o.default.ERROR:null===(s=this.telemetry)||void 0===s||s.error(r(r({},u),l),a.default.ACSCLIENT);break;case o.default.INFO:default:null===(c=this.telemetry)||void 0===c||c.info(r(r({},u),l),a.default.ACSCLIENT)}},e.prototype.startScenario=function(e,t){var n;void 0===t&&(t={});var i={RequestId:this.requestId,ChatId:this.chatId};null===(n=this.scenarioMarker)||void 0===n||n.startScenario(e,r(r({},i),t))},e.prototype.failScenario=function(e,t){var n;void 0===t&&(t={});var i={RequestId:this.requestId,ChatId:this.chatId};null===(n=this.scenarioMarker)||void 0===n||n.failScenario(e,r(r({},i),t))},e.prototype.completeScenario=function(e,t){var n;void 0===t&&(t={});var i={RequestId:this.requestId,ChatId:this.chatId};null===(n=this.scenarioMarker)||void 0===n||n.completeScenario(e,r(r({},i),t))},e.prototype.recordIndividualEvent=function(e,t,n){var i,o={RequestId:this.requestId,ChatId:this.chatId,CustomProperties:JSON.stringify(n),Source:t};null===(i=this.scenarioMarker)||void 0===i||i.singleRecord(e,r({},o))},e}();t.ACSClientLogger=l;var d=function(){function e(e){this.omnichannelConfig=e,this.debug=!1,this.runtimeId="",this.requestId="",this.chatId="",this.telemetry=null,this.scenarioMarker=null,this.debug=!1,this.scenarioMarker=new s.default(e),this.scenarioMarker.setScenarioType(a.default.ACSADAPTER)}return e.prototype.setDebug=function(e){var t;this.debug=e,null===(t=this.scenarioMarker)||void 0===t||t.setDebug(e)},e.prototype.setRuntimeId=function(e){var t;this.runtimeId=e,null===(t=this.scenarioMarker)||void 0===t||t.setRuntimeId(this.runtimeId)},e.prototype.setRequestId=function(e){this.requestId=e},e.prototype.setChatId=function(e){this.chatId=e},e.prototype.useTelemetry=function(e){var t;this.debug&&console.log("[ACSAdapterLogger][useTelemetry]"),this.telemetry=e,null===(t=this.scenarioMarker)||void 0===t||t.useTelemetry(this.telemetry)},e.prototype.logEvent=function(e,t){var n,s,c,u;this.debug&&console.log("[ACSAdapterLogger][logClientSdkTelemetryEvent][".concat(e,"]")),this.debug&&console.log(t);var l={ChatSDKRuntimeId:this.runtimeId,OrgId:this.omnichannelConfig.orgId,OrgUrl:this.omnichannelConfig.orgUrl,WidgetId:this.omnichannelConfig.widgetId,RequestId:this.requestId,ChatId:this.chatId};t.CustomProperties&&(t.CustomProperties=JSON.stringify((0,i.redactPII)(t.CustomProperties,!1))),t.ExceptionDetails&&(t.ExceptionDetails=JSON.stringify((0,i.redactPII)(t.ExceptionDetails,!1,!0,i._exceptionDetailPIIKeys))),t.Description&&(t.Description=JSON.stringify((0,i.redactPII)(t.Description,!1,!0)));var d=r(r({},t),{ExceptionDetails:t.ExceptionDetails||""});switch(e){case o.default.DEBUG:null===(n=this.telemetry)||void 0===n||n.debug(r(r({},l),d),a.default.ACSADAPTER);break;case o.default.WARN:null===(s=this.telemetry)||void 0===s||s.warn(r(r({},l),d),a.default.ACSADAPTER);break;case o.default.ERROR:null===(c=this.telemetry)||void 0===c||c.error(r(r({},l),d),a.default.ACSADAPTER);break;case o.default.INFO:default:null===(u=this.telemetry)||void 0===u||u.info(r(r({},l),d),a.default.ACSADAPTER)}},e.prototype.startScenario=function(e,t){var n;void 0===t&&(t={});var i={RequestId:this.requestId,ChatId:this.chatId};null===(n=this.scenarioMarker)||void 0===n||n.startScenario(e,r(r({},i),t))},e.prototype.failScenario=function(e,t){var n;void 0===t&&(t={});var o={RequestId:this.requestId,ChatId:this.chatId};if(t.CustomProperties&&(t.CustomProperties=JSON.stringify((0,i.redactPII)(t.CustomProperties,!1))),t.ExceptionDetails){var s=t.ExceptionDetails;s instanceof Error&&(s=r(r({},s),{name:s.name,message:s.message})),t.ExceptionDetails=JSON.stringify((0,i.redactPII)(s,!1,!0,i._exceptionDetailPIIKeys))}t.Description&&(t.Description=JSON.stringify((0,i.redactPII)(t.Description,!1,!0))),null===(n=this.scenarioMarker)||void 0===n||n.failScenario(e,r(r({},o),t))},e.prototype.completeScenario=function(e,t){var n;void 0===t&&(t={});var i={RequestId:this.requestId,ChatId:this.chatId};null===(n=this.scenarioMarker)||void 0===n||n.completeScenario(e,r(r({},i),t))},e}();t.ACSAdapterLogger=d;var h=function(){function e(e){this.omnichannelConfig=e,this.debug=!1,this.runtimeId="",this.requestId="",this.chatId="",this.telemetry=null,this.debug=!1}return e.prototype.setDebug=function(e){this.debug=e},e.prototype.setRuntimeId=function(e){this.runtimeId=e},e.prototype.setRequestId=function(e){this.requestId=e},e.prototype.setChatId=function(e){this.chatId=e},e.prototype.useTelemetry=function(e){this.debug&&console.log("[CallingSDKLogger][useTelemetry]"),this.telemetry=e},e.prototype.logScenarioOperation=function(e,t,n,r,i,o){},e.prototype.logCallingSdkTelemetryEvent=function(e,t){var n,i,s,c;this.debug&&console.log("[CallingSDKLogger][logClientSdkTelemetryEvent][".concat(e,"]")),this.debug&&console.log(t);var u={ChatSDKRuntimeId:this.runtimeId,OrgId:this.omnichannelConfig.orgId,OrgUrl:this.omnichannelConfig.orgUrl,WidgetId:this.omnichannelConfig.widgetId,RequestId:this.requestId,ChatId:this.chatId},l=r(r({},t),{ExceptionDetails:t.ExceptionDetails?JSON.stringify(t.ExceptionDetails):""});switch(e){case o.default.DEBUG:null===(n=this.telemetry)||void 0===n||n.debug(r(r({},u),l),a.default.CALLINGSDK);break;case o.default.WARN:null===(i=this.telemetry)||void 0===i||i.warn(r(r({},u),l),a.default.CALLINGSDK);break;case o.default.ERROR:null===(s=this.telemetry)||void 0===s||s.error(r(r({},u),l),a.default.CALLINGSDK);break;case o.default.INFO:default:null===(c=this.telemetry)||void 0===c||c.info(r(r({},u),l),a.default.CALLINGSDK)}},e}();t.CallingSDKLogger=h;var p=function(){function e(e){this.omnichannelConfig=e,this.debug=!1,this.runtimeId="",this.requestId="",this.chatId="",this.telemetry=null,this.debug=!1}return e.prototype.setDebug=function(e){this.debug=e},e.prototype.setRuntimeId=function(e){this.runtimeId=e},e.prototype.setRequestId=function(e){this.requestId=e},e.prototype.setChatId=function(e){this.chatId=e},e.prototype.useTelemetry=function(e){this.debug&&console.log("[AMSClientLogger][useTelemetry]"),this.telemetry=e},e.prototype.logClientSdkTelemetryEvent=function(e,t){var n,i,s,c;this.debug&&console.log("[AMSClientLogger][logClientSdkTelemetryEvent][".concat(e,"]")),this.debug&&console.log(t);var u={ChatSDKRuntimeId:this.runtimeId,OrgId:this.omnichannelConfig.orgId,OrgUrl:this.omnichannelConfig.orgUrl,WidgetId:this.omnichannelConfig.widgetId,RequestId:this.requestId,ChatId:this.chatId},l=r(r({},t),{ExceptionDetails:t.ExceptionDetails?JSON.stringify(t.ExceptionDetails):""});switch(e){case o.default.DEBUG:null===(n=this.telemetry)||void 0===n||n.debug(r(r({},u),l),a.default.AMSCLIENT);break;case o.default.WARN:null===(i=this.telemetry)||void 0===i||i.warn(r(r({},u),l),a.default.AMSCLIENT);break;case o.default.ERROR:null===(s=this.telemetry)||void 0===s||s.error(r(r({},u),l),a.default.AMSCLIENT);break;case o.default.INFO:default:null===(c=this.telemetry)||void 0===c||c.info(r(r({},u),l),a.default.AMSCLIENT)}},e}();t.AMSClientLogger=p,t.createIC3ClientLogger=function(e,t){void 0===t&&(t=!1);var n=new c(e);return n.setDebug(t),n},t.createOCSDKLogger=function(e,t){void 0===t&&(t=!1);var n=new u(e);return n.setDebug(t),n},t.createACSClientLogger=function(e,t){void 0===t&&(t=!1);var n=new l(e);return n.setDebug(t),n},t.createACSAdapterLogger=function(e,t){void 0===t&&(t=!1);var n=new d(e);return n.setDebug(t),n},t.createCallingSDKLogger=function(e,t){void 0===t&&(t=!1);var n=new h(e);return n.setDebug(t),n},t.createAMSClientLogger=function(e,t){void 0===t&&(t=!1);var n=new p(e);return n.setDebug(t),n}},6517:e=>{"use strict";e.exports=JSON.parse('{"name":"@microsoft/omnichannel-chat-sdk","version":"1.11.7-main.14ece7b","description":"Microsoft Omnichannel Chat SDK","files":["lib/**/*"],"main":"lib/index.js","types":"lib/index.d.ts","scripts":{"build:tsc":"tsc","postbuild:tsc":"node ./scripts/copy_files.js","prebuild:tsc":"eslint src --ext .ts","test":"npm run test:jsdom && npm run test:node","test:jsdom":"jest --config jest.config.jsdom.js --verbose","test:node":"jest --config jest.config.node.js --verbose","watch":"tsc --watch","lint":"eslint src --ext .ts"},"author":"Microsoft Corporation","license":"MIT","repository":{"type":"git","url":"https://github.com/microsoft/omnichannel-chat-sdk"},"homepage":"https://github.com/microsoft/omnichannel-chat-sdk#readme","keywords":["SDK","chat","livechat","support","bot","headless","customer"],"devDependencies":{"@types/core-js":"^2.5.5","@types/jest":"^29.1.2","@typescript-eslint/eslint-plugin":"^5.4.2","@typescript-eslint/parser":"^5.4.2","eslint":"^7.32.0","jest":"^29.7.0","jest-environment-jsdom":"^29.7.0","ts-jest":"^29.2.5","typescript":"^5.4.2"},"dependencies":{"@azure/communication-chat":"1.5.4","@azure/communication-common":"2.3.1","@microsoft/botframework-webchat-adapter-azure-communication-chat":"^0.0.1-beta.5","@microsoft/ocsdk":"^0.5.20-main.a3b9c5e","@microsoft/omnichannel-amsclient":"^0.1.11","@microsoft/omnichannel-ic3core":"^0.1.5"}}')},6522:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4938),i=n(7028),o=n(8805),s=n(3465),a=n(3290),c=n(4628),u=n(9143),l=n(2546),d=n(8178),h=n(875),p=n(2301),f=function(){function e(e){this._apiKey=e,this._contextProperties=new o.default,this._semanticContext=new h.default(!1,this._contextProperties),this._sessionStartTime=0,this._createInitId()}return e.prototype.setContext=function(e,t,n){void 0===n&&(n=r.AWTPropertyType.Unspecified),this._contextProperties.setProperty(e,t,n)},e.prototype.setContextWithPii=function(e,t,n,i){void 0===i&&(i=r.AWTPropertyType.Unspecified),this._contextProperties.setPropertyWithPii(e,t,n,i)},e.prototype.setContextWithCustomerContent=function(e,t,n,i){void 0===i&&(i=r.AWTPropertyType.Unspecified),this._contextProperties.setPropertyWithCustomerContent(e,t,n,i)},e.prototype.getSemanticContext=function(){return this._semanticContext},e.prototype.logEvent=function(t){if(l.default.loggingEnabled){this._apiKey||(this._apiKey=l.default.defaultTenantToken,this._createInitId());var n=!0;s.isString(t)?t={name:t}:t instanceof o.default&&(t=t.getEvent(),n=!1),a.default.eventReceived(this._apiKey),e._logEvent(e._getInternalEvent(t,this._apiKey,n),this._contextProperties)}},e.prototype.logSession=function(t,n){if(l.default.sessionEnabled){var o={name:"session",type:"session",properties:{}};if(e._addPropertiesToEvent(o,n),o.priority=r.AWTEventPriority.High,t===i.AWTSessionState.Started){if(this._sessionStartTime>0)return;this._sessionStartTime=(new Date).getTime(),this._sessionId=s.newGuid(),this.setContext("Session.Id",this._sessionId),o.properties["Session.State"]="Started"}else{if(t!==i.AWTSessionState.Ended)return;if(0===this._sessionStartTime)return;var a=Math.floor(((new Date).getTime()-this._sessionStartTime)/1e3);o.properties["Session.Id"]=this._sessionId,o.properties["Session.State"]="Ended",o.properties["Session.Duration"]=a.toString(),o.properties["Session.DurationBucket"]=e._getSessionDurationFromTime(a),this._sessionStartTime=0,this.setContext("Session.Id",null),this._sessionId=void 0}o.properties["Session.FirstLaunchTime"]=p.default.firstLaunchTime,this.logEvent(o)}},e.prototype.getSessionId=function(){return this._sessionId},e.prototype.logFailure=function(t,n,i,o,s){if(t&&n){var a={name:"failure",type:"failure",properties:{}};e._addPropertiesToEvent(a,s),a.properties["Failure.Signature"]=t,a.properties["Failure.Detail"]=n,i&&(a.properties["Failure.Category"]=i),o&&(a.properties["Failure.Id"]=o),a.priority=r.AWTEventPriority.High,this.logEvent(a)}},e.prototype.logPageView=function(t,n,r,i,o,s){if(t&&n){var a={name:"pageview",type:"pageview",properties:{}};e._addPropertiesToEvent(a,s),a.properties["PageView.Id"]=t,a.properties["PageView.Name"]=n,r&&(a.properties["PageView.Category"]=r),i&&(a.properties["PageView.Uri"]=i),o&&(a.properties["PageView.ReferrerUri"]=o),this.logEvent(a)}},e.prototype._createInitId=function(){!e._initIdMap[this._apiKey]&&this._apiKey&&(e._initIdMap[this._apiKey]=s.newGuid())},e._addPropertiesToEvent=function(e,t){if(t)for(var n in t instanceof o.default&&(t=t.getEvent()),t.name&&(e.name=t.name),t.priority&&(e.priority=t.priority),t.properties)t.properties.hasOwnProperty(n)&&(e.properties[n]=t.properties[n])},e._getSessionDurationFromTime=function(e){return e<0?"Undefined":e<=3?"UpTo3Sec":e<=10?"UpTo10Sec":e<=30?"UpTo30Sec":e<=60?"UpTo60Sec":e<=180?"UpTo3Min":e<=600?"UpTo10Min":e<=1800?"UpTo30Min":"Above30Min"},e._logEvent=function(e,t){e.name&&s.isString(e.name)?(e.name=e.name.toLowerCase(),e.name=e.name.replace(s.EventNameDotRegex,"_"),e.type&&s.isString(e.type)?e.type=e.type.toLowerCase():e.type="custom",s.EventNameAndTypeRegex.test(e.name)&&s.EventNameAndTypeRegex.test(e.type)?((!s.isNumber(e.timestamp)||e.timestamp<0)&&(e.timestamp=(new Date).getTime()),e.properties||(e.properties={}),this._addContextIfAbsent(e,t.getPropertyMap()),this._addContextIfAbsent(e,l.default.logManagerContext.getPropertyMap()),this._setDefaultProperty(e,"EventInfo.InitId",this._getInitId(e.apiKey)),this._setDefaultProperty(e,"EventInfo.Sequence",this._getSequenceId(e.apiKey)),this._setDefaultProperty(e,"EventInfo.SdkVersion",d.FullVersionString),this._setDefaultProperty(e,"EventInfo.Name",e.name),this._setDefaultProperty(e,"EventInfo.Time",new Date(e.timestamp).toISOString()),s.isPriority(e.priority)||(e.priority=r.AWTEventPriority.Normal),this._sendEvent(e)):c.default.eventsRejected([e],r.AWTEventsRejectedReason.InvalidEvent)):c.default.eventsRejected([e],r.AWTEventsRejectedReason.InvalidEvent)},e._addContextIfAbsent=function(e,t){if(t)for(var n in t)t.hasOwnProperty(n)&&(e.properties[n]||(e.properties[n]=t[n]))},e._setDefaultProperty=function(e,t,n){e.properties[t]={value:n,pii:r.AWTPiiKind.NotSet,type:r.AWTPropertyType.String}},e._sendEvent=function(e){u.default.sendEvent(e)},e._getInternalEvent=function(e,t,n){if(e.properties=e.properties||{},n)for(var r in e.properties)e.properties.hasOwnProperty(r)&&(e.properties[r]=s.sanitizeProperty(r,e.properties[r]),null===e.properties[r]&&delete e.properties[r]);var i=e;return i.id=s.newGuid(),i.apiKey=t,i},e._getInitId=function(t){return e._initIdMap[t]},e._getSequenceId=function(t){return void 0===e._sequenceIdMap[t]&&(e._sequenceIdMap[t]=0),(++e._sequenceIdMap[t]).toString()},e._sequenceIdMap={},e._initIdMap={},e}();t.default=f},6638:(e,t,n)=>{"use strict";var r=n(4994);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(6009)),o=n(3770),s=n(470);t.default=function(e,t){var n,r,a,c,u,l,d;if(null!=e&&null!==(n=e.response)&&void 0!==n&&n.status)switch(e.response.status){case i.default.tooManyRequestsStatusCode:if(!1===t)return!1;break;case i.default.badRequestStatusCode:if(null!==(r=e.response)&&void 0!==r&&null!==(a=r.headers)&&void 0!==a&&a.errorcode&&parseInt(e.response.headers.errorcode)===i.default.outOfOfficeErrorCode)return!1;break;default:return(0,s.isRetryableError)(e)||(0,o.isNetworkError)(e)||0==(null===(c=e.response)||void 0===c?void 0:c.status)||!(null!==(u=e.response)&&void 0!==u&&u.status)}return(0,s.isRetryableError)(e)||(0,o.isNetworkError)(e)||0==(null===(l=e.response)||void 0===l?void 0:l.status)||!(null!==(d=e.response)&&void 0!==d&&d.status)}},6654:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uuidv4=void 0,t.uuidv4=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}},6717:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.Agent="Agent",e.MessageProperties="MessageProperties",e.InviteFree="InviteFree",e}();t.default=n},6789:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MessagePrinterFactory=t.PrinterType=void 0;var r,i=n(6793),o=n(9278),s=n(3790);!function(e){e.Polling="Polling",e.WebSocket="WebSocket",e.Omnichannel="Rest"}(r||(t.PrinterType=r={}));var a=function(){function e(){}var t;return e.getPrinter=function(e){switch(e){case r.Polling:return o.PollingMessagePrinter;case r.WebSocket:return s.WebSocketMessagePrinter;case r.Omnichannel:return i.OmnichannelMessagePrinter;default:throw new Error("Invalid printer type")}},t=e,e.printifyMessage=function(e,n){var i=t.getPrinter(n);switch(n){case r.Polling:case r.WebSocket:case r.Omnichannel:return i.printify(e);default:throw new Error("Invalid printer type")}},e}();t.MessagePrinterFactory=a},6793:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OmnichannelMessagePrinter=void 0;var r=n(2698),i=n(3428),o=function(){function e(){}return e.printify=function(e){var t,n={};return e&&(n.id=e.id,n.tags=null==e?void 0:e.tags,n.bot=!(null===(t=null==e?void 0:e.tags)||void 0===t?void 0:t.find(function(e){return"public"===e})),n.card=Object.values(r.SupportedAdaptiveCards).some(function(t){var n;return null===(n=null==e?void 0:e.content)||void 0===n?void 0:n.includes(t)}),!n.card&&(null==e?void 0:e.content)&&(n.content=(0,i.messageContentMetadata)(null==e?void 0:e.content)),n.created=e.timestamp),n},e}();t.OmnichannelMessagePrinter=o},6824:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Setup="FramedClientSetup",e.Initialize="FramedClientInitialize",e.LoadIframe="FramedClientLoadIframe"}(n||(n={})),t.default=n},6868:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.LogLevel=void 0,t.LogLevel=n,function(e){e.INFO="INFO",e.DEBUG="DEBUG",e.WARN="WARN",e.ERROR="ERROR"}(n||(t.LogLevel=n={}))},6947:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5004),i=n(5498);t.default=function(e){var t=e;e.endsWith("/")&&(t=e.replace("/",""));for(var n=0;n<r.default.length;n++)if(t.endsWith(r.default[n]))return"https://eu-mobile.events.data.microsoft.com/Collector/3.0/";for(n=0;n<i.default.length;n++)if(t.includes(i.default[n]))return"https://tb.pipe.aria.microsoft.com/Collector/3.0/";return"https://browser.pipe.aria.microsoft.com/Collector/3.0/"}},6984:(e,t,n)=>{"use strict";var r=n(4994);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(7383)),o=r(n(3693)),s=function e(){(0,i.default)(this,e)};t.default=s,(0,o.default)(s,"authenticatedUserToken","AuthenticatedUserToken"),(0,o.default)(s,"authorization","Authorization"),(0,o.default)(s,"organizationId","OrganizationId"),(0,o.default)(s,"widgetAppId","widgetAppId"),(0,o.default)(s,"requestId","Request-Id"),(0,o.default)(s,"authCodeNonce","AuthCodeNonce"),(0,o.default)(s,"ocSessionId","Oc-Sessionid"),(0,o.default)(s,"ocUserAgent","Ms-Oc-User-Agent"),(0,o.default)(s,"correlationId","x-ms-client-request-id"),(0,o.default)(s,"pageToken","PageToken")},6993:(e,t,n)=>{var r=n(5546);function i(){var t,n,o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",a=o.toStringTag||"@@toStringTag";function c(e,i,o,s){var a=i&&i.prototype instanceof l?i:l,c=Object.create(a.prototype);return r(c,"_invoke",function(e,r,i){var o,s,a,c=0,l=i||[],d=!1,h={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return o=e,s=0,a=t,h.n=n,u}};function p(e,r){for(s=e,a=r,n=0;!d&&c&&!i&&n<l.length;n++){var i,o=l[n],p=h.p,f=o[2];e>3?(i=f===r)&&(a=o[(s=o[4])?5:(s=3,3)],o[4]=o[5]=t):o[0]<=p&&((i=e<2&&p<o[1])?(s=0,h.v=r,h.n=o[1]):p<f&&(i=e<3||o[0]>r||r>f)&&(o[4]=e,o[5]=r,h.n=f,s=0))}if(i||e>1)return u;throw d=!0,r}return function(i,l,f){if(c>1)throw TypeError("Generator is already running");for(d&&1===l&&p(l,f),s=l,a=f;(n=s<2?t:a)||!d;){o||(s?s<3?(s>1&&(h.n=-1),p(s,a)):h.n=a:h.v=a);try{if(c=2,o){if(s||(i="next"),n=o[i]){if(!(n=n.call(o,a)))throw TypeError("iterator result is not an object");if(!n.done)return n;a=n.value,s<2&&(s=0)}else 1===s&&(n=o.return)&&n.call(o),s<2&&(a=TypeError("The iterator does not provide a '"+i+"' method"),s=1);o=t}else if((n=(d=h.n<0)?a:e.call(r,h))!==u)break}catch(e){o=t,s=1,a=e}finally{c=1}}return{value:n,done:d}}}(e,o,s),!0),c}var u={};function l(){}function d(){}function h(){}n=Object.getPrototypeOf;var p=[][s]?n(n([][s]())):(r(n={},s,function(){return this}),n),f=h.prototype=l.prototype=Object.create(p);function g(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,r(e,a,"GeneratorFunction")),e.prototype=Object.create(f),e}return d.prototype=h,r(f,"constructor",h),r(h,"constructor",d),d.displayName="GeneratorFunction",r(h,a,"GeneratorFunction"),r(f),r(f,a,"Generator"),r(f,s,function(){return this}),r(f,"toString",function(){return"[object Generator]"}),(e.exports=i=function(){return{w:c,m:g}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},7007:e=>{"use strict";var t,n="object"==typeof Reflect?Reflect:null,r=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,e.exports.once=function(e,t){return new Promise(function(n,r){function i(n){e.removeListener(t,o),r(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}g(e,t,o,{once:!0}),"error"!==t&&function(e,t){"function"==typeof e.on&&g(e,"error",t,{once:!0})}(e,i)})},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var s=10;function a(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function u(e,t,n,r){var i,o,s,u;if(a(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),s=o[t]),void 0===s)s=o[t]=n,++e._eventsCount;else if("function"==typeof s?s=o[t]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),(i=c(e))>0&&s.length>i&&!s.warned){s.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=s.length,u=l,console&&console.warn&&console.warn(u)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=l.bind(r);return i.listener=n,r.wrapFn=i,i}function h(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):f(i,i.length)}function p(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function f(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function g(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,function i(o){r.once&&e.removeEventListener(t,i),n(o)})}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");s=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return c(this)},o.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,o=this._events;if(void 0!==o)i=i&&void 0===o.error;else if(!i)return!1;if(i){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var c=o[e];if(void 0===c)return!1;if("function"==typeof c)r(c,this,t);else{var u=c.length,l=f(c,u);for(n=0;n<u;++n)r(l[n],this,t)}return!0},o.prototype.addListener=function(e,t){return u(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return u(this,e,t,!0)},o.prototype.once=function(e,t){return a(t),this.on(e,d(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,d(this,e,t)),this},o.prototype.removeListener=function(e,t){var n,r,i,o,s;if(a(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){s=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},o.prototype.listeners=function(e){return h(this,e,!0)},o.prototype.rawListeners=function(e){return h(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},o.prototype.listenerCount=p,o.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},7028:(e,t)=>{"use strict";var n,r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.AWTUserIdType||(t.AWTUserIdType={}))[r.Unknown=0]="Unknown",r[r.MSACID=1]="MSACID",r[r.MSAPUID=2]="MSAPUID",r[r.ANID=3]="ANID",r[r.OrgIdCID=4]="OrgIdCID",r[r.OrgIdPUID=5]="OrgIdPUID",r[r.UserObjectId=6]="UserObjectId",r[r.Skype=7]="Skype",r[r.Yammer=8]="Yammer",r[r.EmailAddress=9]="EmailAddress",r[r.PhoneNumber=10]="PhoneNumber",r[r.SipAddress=11]="SipAddress",r[r.MUID=12]="MUID",(n=t.AWTSessionState||(t.AWTSessionState={}))[n.Started=0]="Started",n[n.Ended=1]="Ended"},7030:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.EVENTS="occhatsdk_events",e.IC3CLIENT="occhatsdk_ic3clientevents",e.OCSDK="occhatsdk_ocsdkevents",e.ACSCLIENT="occhatsdk_acsclientevents",e.ACSADAPTER="occhatsdk_acsadapterevents",e.CALLINGSDK="occhatsdk_callingsdkevents",e.AMSCLIENT="occhatsdk_amsclientevents",e.UNDEFINED="undefined"}(n||(n={})),t.default=n},7064:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return function(){return function(e){return function(t){var n=JSON.parse(JSON.stringify(t));if(n&&n.channelData&&n.channelData.tags){var r=n.channelData.tags;if("string"==typeof r)return e(t);if(r instanceof Array)n.channelData.tags=r.toString();else if("object"==typeof n.channelData.tags)try{n.channelData.tags=JSON.stringify(r)}catch(e){console.error(e)}}return e(n)}}}}},7084:(e,t,n)=>{"use strict";n.d(t,{LM:()=>r,QW:()=>c,Zp:()=>u,fC:()=>o,iT:()=>a,jh:()=>h,rx:()=>s,zL:()=>i});const r=e=>"string"==typeof e.communicationUserId,i=e=>"string"==typeof e.phoneNumber,o=e=>"string"==typeof e.microsoftTeamsUserId,s=e=>"string"==typeof e.teamsAppId,a=e=>"string"==typeof e.id,c=e=>r(e)?Object.assign(Object.assign({},e),{kind:"communicationUser"}):i(e)?Object.assign(Object.assign({},e),{kind:"phoneNumber"}):o(e)?Object.assign(Object.assign({},e),{kind:"microsoftTeamsUser"}):s(e)?Object.assign(Object.assign({},e),{kind:"microsoftTeamsApp"}):Object.assign(Object.assign({},e),{kind:"unknown"}),u=e=>{const t=c(e);switch(t.kind){case"communicationUser":return t.communicationUserId;case"microsoftTeamsUser":{const{microsoftTeamsUserId:e,rawId:n,cloud:r,isAnonymous:i}=t;if(n)return n;if(i)return`8:teamsvisitor:${e}`;switch(r){case"dod":return`8:dod:${e}`;case"gcch":return`8:gcch:${e}`;case"public":return`8:orgid:${e}`}return`8:orgid:${e}`}case"microsoftTeamsApp":{const{teamsAppId:e,rawId:n,cloud:r}=t;if(n)return n;switch(r){case"dod":return`28:dod:${e}`;case"gcch":return`28:gcch:${e}`}return`28:orgid:${e}`}case"phoneNumber":{const{phoneNumber:e,rawId:n}=t;return n||`4:${e}`}case"unknown":return t.id}},l=(e,t)=>({kind:"microsoftTeamsApp",teamsAppId:e,cloud:t}),d=(e,t,n)=>({kind:"microsoftTeamsUser",microsoftTeamsUserId:e,isAnonymous:n,cloud:t}),h=e=>{if(e.startsWith("4:"))return{kind:"phoneNumber",phoneNumber:`${e.substring(2)}`};const t=e.split(":");if(3!==t.length)return{kind:"unknown",id:e};const n=`${t[0]}:${t[1]}:`,r=t[2];switch(n){case"8:teamsvisitor:":return{kind:"microsoftTeamsUser",microsoftTeamsUserId:r,isAnonymous:!0};case"8:orgid:":return d(r,"public",!1);case"8:dod:":return d(r,"dod",!1);case"8:gcch:":return d(r,"gcch",!1);case"8:acs:":case"8:spool:":case"8:dod-acs:":case"8:gcch-acs:":return{kind:"communicationUser",communicationUserId:e};case"28:orgid:":return l(r,"public");case"28:gcch:":return l(r,"gcch");case"28:dod:":return l(r,"dod")}return{kind:"unknown",id:e}}},7122:(e,t,n)=>{var r=n(79);e.exports=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports},7137:e=>{"use strict";e.exports=JSON.parse('{"name":"@microsoft/botframework-webchat-adapter-azure-communication-chat","version":"0.0.1-beta.5","description":"An adapter for connecting WebChat with Azure Communication Services","main":"dist/chat-adapter","module":"dist-esm/index","types":"types/index","scripts":{"test:unit":"jest","test:unit-coverage":"jest --coverage --coverageReporters=lcov","test:integration":"wait-on http://localhost:8080/ && jest -c jest.integration.config.js","test:integration-debug":"node --inspect-brk ./node_modules/jest/bin/jest.js -c jest.integration.config.js --runInBand","test:debug":"node --inspect-brk ./node_modules/jest/bin/jest.js --runInBand","lint":"eslint  --max-warnings 0 */**/*.{ts,tsx}","lint:fix":"eslint */**/*.{ts,tsx} --fix","build":"tsc && webpack --config webpack.prod.config.js","build:es5":"webpack --config webpack.es5.config.js","build:dev":"webpack --config webpack.dev.config.js","build:debug":"webpack --config webpack.debug.config.js","start":"webpack serve --config webpack.dev.config.js","execute:integrationtest":"concurrently --kill-others --success first \\"npm run start\\"  \\"npm run test:integration\\"","install:chromedriver":"npm i chromedriver --detect_chromedriver_version --no-save","build:package":"npm pack --pack-destination ./package"},"repository":{"type":"git","url":"https://github.com/microsoft/botframework-webchat-adapter-azure-communication-chat"},"author":"Microsoft Corporation","license":"MIT","dependencies":{"@azure/communication-chat":"1.6.0-beta.5","@azure/communication-common":"^2.3.1","core-js":"^3.6.5","http-status-codes":"^2.1.4","redux":"^4.0.5","regenerator-runtime":"^0.13.7","event-target-shim":"^6.0.2"},"devDependencies":{"@azure/communication-identity":"^1.0.0","@babel/cli":"^7.13.8","@babel/core":"^7.26.10","@babel/plugin-proposal-class-properties":"^7.13.8","@babel/plugin-proposal-object-rest-spread":"^7.13.8","@babel/plugin-transform-async-to-generator":"^7.13.8","@babel/plugin-transform-modules-commonjs":"^7.13.8","@babel/plugin-transform-runtime":"^7.13.8","@babel/preset-env":"^7.13.8","@babel/preset-react":"^7.13.8","@babel/preset-typescript":"^7.13.8","@sinonjs/fake-timers":"^9.1.2","@types/core-js":"^2.5.4","@types/jest":"^27.5.0","@types/react":"^16.8.6","@types/react-dom":"^16.8.6","@types/regenerator-runtime":"^0.13.0","@types/selenium-webdriver":"^4.0.10","@types/sinonjs__fake-timers":"^8.1.2","@typescript-eslint/eslint-plugin":"^4.6.0","@typescript-eslint/parser":"^4.6.0","@webpack-cli/serve":"^1.0.1","babel-loader":"^8.2.2","babel-plugin-transform-globalthis":"^1.0.0","botframework-webchat":"^4.18.0","concurrently":"^5.3.0","eslint":"^7.32.0","eslint-config-prettier":"^8.5.0","eslint-plugin-prettier":"^4.0.0","jest":"^29.0.0","jest-environment-jsdom":"^29.0.3","npm-cli-login":"^0.0.10","prettier":"^2.6.2","react":"^16.8.6","react-dom":"^16.8.6","selenium-webdriver":"^4.0.0-alpha.8","string-replace-loader":"^3.0.1","ts-jest":"^29.0.0","ts-loader":"^8.4.0","typescript":"^4.6.3","wait-on":"^7.2.0","webpack":"^5.72.0","webpack-cli":"^4.9.2","webpack-dev-server":"^4.8.1","webpack-merge":"^5.4.0"},"files":["dist","dist-esm","types","src","LICENSE","README.MD","CHANGELOG.MD"]}')},7145:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4746),i=n(4372),o=n(3364),s=function(){function e(){}return e.getV2EndpointUrl=function(e,t){return t.chatService+"/v2/users/ME/endpoints/"+e},e.getThreadUrl=function(e,t){return t.chatService+"/v1/threads/"+e+"?view=msnp24Equivalent"},e.getMessagesUrl=function(e,t){return t.chatService+"/v1/users/ME/conversations/"+e+"/messages"},e.getBotMessagesUrl=function(e,t){return t.chatService+"/v1/agents/"+e+"/invoke"},e.getAmsObjectsUrl=function(e){return o.default.sanitizeUrlWithBackSlash(e.ams)+"v1/objects"},e.getAmsObjectContentUrl=function(e,t,n){void 0===n&&(n=!1);var i=n?r.default.ImageContent:r.default.FileContent;return o.default.sanitizeUrlWithBackSlash(t.ams)+"v1/objects/"+e+"/content/"+i},e.getAmsObjectViewUrl=function(e,t,n){void 0===n&&(n=!1);var i=n?r.default.ImageView:r.default.FileView;return o.default.sanitizeUrlWithBackSlash(t.ams)+"v1/objects/"+e+"/views/"+i},e.getAmsStatusUrl=function(e,t,n){void 0===n&&(n=!1);var i=n?r.default.ImageView:r.default.FileView;return o.default.sanitizeUrlWithBackSlash(t.ams)+"v1/objects/"+e+"/views/"+i+"/status"},e.getV1EndpointUrl=function(e){return e.chatService+"/v1/users/ME/endpoints"},e.getV1DeleteEndpointUrl=function(e,t){return e.chatService+"/v1/users/ME/endpoints/"+t},e.getV1SubscriptionUrl=function(e){return e.chatService+"/v1/users/ME/endpoints/SELF/subscriptions"},e.getV1PollUrl=function(e,t){return e.chatService+"/v1/users/ME/endpoints/SELF/subscriptions/"+t+"/poll"},e.getV1SetPropertiesUrl=function(e){return e.chatService+"/v1/users/ME/endpoints/SELF/properties?name="+i.default.SetEndpointProperty},e}();t.default=s},7187:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDirectLineCDNUrl=t.getACSAdapterCDNUrl=t.getIC3AdapterCDNUrl=t.getIC3ClientCDNUrl=void 0;var r=n(4736),i=function(e){return void 0===e&&(e=r.ic3ClientVersion),"https://comms.omnichannelengagementhub.com/release/".concat(e,"/Scripts/SDK/SDK.min.js")};t.getIC3ClientCDNUrl=i;var o=function(e){return void 0===e&&(e=r.webChatIC3AdapterVersion),"https://webchatic3.blob.core.windows.net/webchat-ic3adapter/".concat(e,"/botframework-webchat-adapter-ic3.production.min.js")};t.getIC3AdapterCDNUrl=o;var s=function(e){return void 0===e&&(e=r.webChatACSAdapterVersion),"https://unpkg.com/acs_webchat-chat-adapter@".concat(e,"/dist/chat-adapter.js")};t.getACSAdapterCDNUrl=s;var a=function(e){return void 0===e&&(e=r.webChatDirectLineVersion),"https://unpkg.com/botframework-directlinejs@".concat(e,"/dist/directline.js")};t.getDirectLineCDNUrl=a,t.default={getIC3ClientCDNUrl:i,getIC3AdapterCDNUrl:o,getACSAdapterCDNUrl:s,getDirectLineCDNUrl:a}},7190:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isCoreServicesOrgUrlDNSError=void 0;var r=n(5970);t.isCoreServicesOrgUrlDNSError=function(e,t,n){return!!(e.isAxiosError&&e.code==r.default.ERR_NETWORK&&t&&n)}},7319:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),(n=t._BondDataType||(t._BondDataType={}))[n._BT_STOP=0]="_BT_STOP",n[n._BT_STOP_BASE=1]="_BT_STOP_BASE",n[n._BT_BOOL=2]="_BT_BOOL",n[n._BT_DOUBLE=8]="_BT_DOUBLE",n[n._BT_STRING=9]="_BT_STRING",n[n._BT_STRUCT=10]="_BT_STRUCT",n[n._BT_LIST=11]="_BT_LIST",n[n._BT_MAP=13]="_BT_MAP",n[n._BT_INT32=16]="_BT_INT32",n[n._BT_INT64=17]="_BT_INT64"},7367:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4938),i=n(2672),o=n(8890),s=n(1780),a=n(9199),c=n(8178),u=n(3465),l=n(4628),d=n(9143),h="POST",p=function(){function e(e,t,n,r,i){var o=this;this._requestQueue=e,this._queueManager=n,this._httpInterface=r,this._urlString="?qsp=true&content-type=application%2Fbond-compact-binary&client-id=NO_AUTH&sdk-version="+c.FullVersionString,this._killSwitch=new s.default,this._paused=!1,this._useBeacons=!1,this._activeConnections=0,this._clockSkewManager=new a.default(i),u.isUint8ArrayAvailable()||(this._urlString+="&content-encoding=base64"),this._urlString=t+this._urlString,this._httpInterface||(this._useBeacons=!u.isReactNative(),this._httpInterface={sendPOST:function(e,t,n,r,i,s){try{if(u.useFetchRequest())fetch(e,{body:t,method:h}).then(function(e){var t={};e.headers&&e.headers.forEach(function(e,n){t[n]=e}),i(e.status,t)}).catch(function(e){r(0,{})});else if(u.useXDomainRequest()){var a=new XDomainRequest;a.open(h,e),a.onload=function(){i(200,null)},a.onerror=function(){r(400,null)},a.ontimeout=function(){n(500,null)},a.send(t)}else{var c=new XMLHttpRequest;c.open(h,e,!s),c.onload=function(){i(c.status,o._convertAllHeadersToMap(c.getAllResponseHeaders()))},c.onerror=function(){r(c.status,o._convertAllHeadersToMap(c.getAllResponseHeaders()))},c.ontimeout=function(){n(c.status,o._convertAllHeadersToMap(c.getAllResponseHeaders()))},c.send(t)}}catch(e){r(400,null)}}})}return e.prototype.hasIdleConnection=function(){return this._activeConnections<2},e.prototype.sendQueuedRequests=function(){for(;this.hasIdleConnection()&&!this._paused&&this._requestQueue.length>0&&this._clockSkewManager.allowRequestSending();)this._activeConnections++,this._sendRequest(this._requestQueue.shift(),0,!1);this.hasIdleConnection()&&d.default.scheduleTimer()},e.prototype.isCompletelyIdle=function(){return 0===this._activeConnections},e.prototype.teardown=function(){for(;this._requestQueue.length>0;)this._sendRequest(this._requestQueue.shift(),0,!0)},e.prototype.pause=function(){this._paused=!0},e.prototype.resume=function(){this._paused=!1,this.sendQueuedRequests()},e.prototype.removeQueuedRequests=function(){this._requestQueue.length=0},e.prototype.sendSynchronousRequest=function(e,t){this._paused&&(e[t][0].priority=r.AWTEventPriority.High),this._activeConnections++,this._sendRequest(e,0,!1,!0)},e.prototype._sendRequest=function(e,t,n,o){var s=this;void 0===o&&(o=!1);try{if(this._paused)return this._activeConnections--,void this._queueManager.addBackRequest(e);var a=0,c="";for(var d in e)e.hasOwnProperty(d)&&(this._killSwitch.isTenantKilled(d)?(l.default.eventsRejected(e[d],r.AWTEventsRejectedReason.KillSwitch),delete e[d]):(c.length>0&&(c+=","),c+=d,a++));if(a>0){var h=i.default.getPayloadBlob(e,a);h.remainingRequest&&this._requestQueue.push(h.remainingRequest);var p=this._urlString+"&x-apikey="+c+"&client-time-epoch-millis="+Date.now().toString();this._clockSkewManager.shouldAddClockSkewHeaders()&&(p=p+"&time-delta-to-apply-millis="+this._clockSkewManager.getClockSkewHeaderValue());var f;for(var d in f=u.isUint8ArrayAvailable()?new Uint8Array(h.payloadBlob):i.default.base64Encode(h.payloadBlob),e)if(e.hasOwnProperty(d))for(var g=0;g<e[d].length;++g)e[d][g].sendAttempt>0?e[d][g].sendAttempt++:e[d][g].sendAttempt=1;if(this._useBeacons&&n&&u.isBeaconsSupported()&&navigator.sendBeacon(p,f))return;this._httpInterface.sendPOST(p,f,function(r,i){s._retryRequestIfNeeded(r,i,e,a,c,t,n,o)},function(r,i){s._retryRequestIfNeeded(r,i,e,a,c,t,n,o)},function(r,i){s._retryRequestIfNeeded(r,i,e,a,c,t,n,o)},n||o)}else n||this._handleRequestFinished(!1,{},n,o)}catch(e){this._handleRequestFinished(!1,{},n,o)}},e.prototype._retryRequestIfNeeded=function(e,t,n,i,s,a,c,u){var h=this,p=!0;if(void 0!==e){if(t){var f=this._killSwitch.setKillSwitchTenants(t["kill-tokens"],t["kill-duration-seconds"]);this._clockSkewManager.setClockSkew(t["time-delta-millis"]);for(var g=0;g<f.length;++g)l.default.eventsRejected(n[f[g]],r.AWTEventsRejectedReason.KillSwitch),delete n[f[g]],i--}else this._clockSkewManager.setClockSkew(null);if(200===e)return void this._handleRequestFinished(!0,n,c,u);(!o.default.shouldRetryForStatus(e)||i<=0)&&(p=!1)}if(p)if(u)this._activeConnections--,n[s][0].priority=r.AWTEventPriority.High,this._queueManager.addBackRequest(n);else if(a<1){for(var m in n)n.hasOwnProperty(m)&&l.default.eventsRetrying(n[m]);setTimeout(function(){return h._sendRequest(n,a+1,!1)},o.default.getMillisToBackoffForRetry(a))}else this._activeConnections--,d.default.backOffTransmission(),this._queueManager.addBackRequest(n);else this._handleRequestFinished(!1,n,c,u)},e.prototype._handleRequestFinished=function(e,t,n,i){for(var o in e&&d.default.clearBackOff(),t)t.hasOwnProperty(o)&&(e?l.default.eventsSent(t[o]):l.default.eventsDropped(t[o],r.AWTEventsDroppedReason.NonRetryableStatus));this._activeConnections--,i||n||this.sendQueuedRequests()},e.prototype._convertAllHeadersToMap=function(e){var t={};if(e)for(var n=e.split("\n"),r=0;r<n.length;++r){var i=n[r].split(": ");t[i[0]]=i[1]}return t},e}();t.default=p},7377:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},s=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0}),t.ACSConversation=void 0;var a,c=n(2654),u=n(6085),l=n(6789),d=n(9037),h=n(2044),p=n(9376),f=n(772),g=n(496),m=n(1649),v=n(7881),y=n(6153);!function(e){e.InitializeACSClient="InitializeACSClient",e.InitializeACSConversation="InitializeACSConversation",e.GetParticipants="GetParticipants",e.RegisterOnNewMessage="RegisterOnNewMessage",e.RegisterOnThreadUpdate="RegisterOnThreadUpdate",e.OnTypingEvent="OnTypingEvent",e.GetMessages="GetMessages",e.SendMessage="SendMessage",e.SendTyping="SendTyping",e.StartPolling="StartPolling",e.StopPolling="StopPolling",e.Disconnect="Disconnect"}(a||(a={}));var C=function(){function e(e,t,n){void 0===n&&(n=null),this.logger=null,this.keepPolling=!1,this.pollingTimer=null,this.logger=n,this.tokenCredential=e,this.chatClient=t,this.eventListeners={}}return e.prototype.startPolling=function(){return i(this,void 0,void 0,function(){var e,t;return o(this,function(n){return null===(e=this.logger)||void 0===e||e.startScenario(a.StartPolling),this.keepPolling=!0,null===(t=this.logger)||void 0===t||t.completeScenario(a.StartPolling),[2]})})},e.prototype.stopPolling=function(){return i(this,void 0,void 0,function(){var e,t;return o(this,function(n){return null===(e=this.logger)||void 0===e||e.startScenario(a.StopPolling),this.keepPolling=!1,null===(t=this.logger)||void 0===t||t.completeScenario(a.StopPolling),[2]})})},e.prototype.initialize=function(e){return i(this,void 0,void 0,function(){var t,n,r,i,s,c,u,l,d;return o(this,function(o){switch(o.label){case 0:null===(s=this.logger)||void 0===s||s.startScenario(a.InitializeACSConversation),this.sessionInfo=e,o.label=1;case 1:return o.trys.push([1,3,,4]),t=this,[4,null===(c=this.chatClient)||void 0===c?void 0:c.getChatThreadClient(e.threadId)];case 2:return t.chatThreadClient=o.sent(),[3,4];case 3:throw n=o.sent(),i={response:"ChatClientGetChatThreadClientFailure",errorObject:"".concat(n)},null===(u=this.logger)||void 0===u||u.failScenario(a.InitializeACSConversation,{ExceptionDetails:JSON.stringify(i)}),new Error(JSON.stringify(i));case 4:return o.trys.push([4,6,,7]),[4,this.chatClient.startRealtimeNotifications()];case 5:return o.sent(),[3,7];case 6:throw r=o.sent(),i={response:"StartRealtimeNotificationsFailed",errorObject:"".concat(r)},null===(l=this.logger)||void 0===l||l.failScenario(a.InitializeACSConversation,{ExceptionDetails:JSON.stringify(i)}),new Error(JSON.stringify(i));case 7:return null===(d=this.logger)||void 0===d||d.completeScenario(a.InitializeACSConversation),[2]}})})},e.prototype.getMessages=function(){return i(this,arguments,void 0,function(e){var t,n,r,i,s,c,u,l,h;return void 0===e&&(e={}),o(this,function(o){switch(o.label){case 0:null===(u=this.logger)||void 0===u||u.startScenario(a.GetMessages),t=[],o.label=1;case 1:return o.trys.push([1,9,,10]),[4,this.chatThreadClient.listMessages()];case 2:return[4,(n=o.sent()).next()];case 3:r=o.sent(),o.label=4;case 4:return r.done?[3,8]:(i=r.value).type===d.default.Text?[3,6]:[4,n.next()];case 5:return r=o.sent(),[3,4];case 6:return!0===(null==e?void 0:e.skipConversion)?t.push(i):t.push((0,v.default)(i,{liveChatVersion:f.default.V2})),[4,n.next()];case 7:return r=o.sent(),[3,4];case 8:return null===(l=this.logger)||void 0===l||l.completeScenario(a.GetMessages),[3,10];case 9:throw s=o.sent(),c={errorObject:"".concat(s)},null===(h=this.logger)||void 0===h||h.failScenario(a.GetMessages,{ExceptionDetails:JSON.stringify(c)}),new Error(a.GetMessages);case 10:return[2,(null==e||e.skipConversion,t)]}})})},e.prototype.getParticipants=function(){return i(this,void 0,void 0,function(){var e,t,n,r,i,s,c,u,l;return o(this,function(o){switch(o.label){case 0:null===(c=this.logger)||void 0===c||c.startScenario(a.GetParticipants),e=[],o.label=1;case 1:return o.trys.push([1,7,,8]),[4,this.chatThreadClient.listParticipants()];case 2:return[4,(t=o.sent()).next()];case 3:n=o.sent(),o.label=4;case 4:return n.done?[3,6]:(r=n.value,e.push(r),[4,t.next()]);case 5:return n=o.sent(),[3,4];case 6:return null===(u=this.logger)||void 0===u||u.completeScenario(a.GetParticipants),[3,8];case 7:throw i=o.sent(),s={errorObject:"".concat(i)},null===(l=this.logger)||void 0===l||l.failScenario(a.GetParticipants,{ExceptionDetails:JSON.stringify(s)}),new Error(a.GetParticipants);case 8:return[2,e]}})})},e.prototype.registerOnNewMessage=function(e){return i(this,arguments,void 0,function(e,t){var n,r,c,u,d,p,f,v,y,C,S,T=this;return void 0===t&&(t={disablePolling:!1}),o(this,function(E){switch(E.label){case 0:null===(f=this.logger)||void 0===f||f.startScenario(a.RegisterOnNewMessage),n=new Set,E.label=1;case 1:return E.trys.push([1,5,,6]),r=function(s){return i(T,void 0,void 0,function(){var i,a,c,u,d,p,f,v,y;return o(this,function(o){switch(o.label){case 0:if(!this.keepPolling)return[3,4];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.getMessages({skipConversion:!0})];case 2:for(i=o.sent(),a=0,c=i.reverse();a<c.length;a++){u=c[a];try{if(p=(d=u).id,d.senderDisplayName===h.default.Customer)continue;n.has(p)||(null===(y=this.logger)||void 0===y||y.recordIndividualEvent(m.default.MessageReceived,g.MessageSource.Polling,l.MessagePrinterFactory.printifyMessage(u,l.PrinterType.Polling)),e(u),n.add(p))}catch(e){console.warn("[ACSClient][registerOnNewMessage] Error occurred while processing messages")}}return[3,4];case 3:return o.sent(),[3,4];case 4:return f=t.pollingInterval||1e4,v=s.next(),this.pollingTimer=setTimeout(function(){r(s)},!0===v.done?f:v.value),[2]}})})},[4,this.startPolling()];case 2:return E.sent(),!1!==t.disablePolling?[3,4]:(c=function(){return o(this,function(e){switch(e.label){case 0:return[5,s([1e3,1e3,2e3,3e3,5e3,8e3,1e4])];case 1:return e.sent(),[2]}})}(),[4,r(c)]);case 3:E.sent(),E.label=4;case 4:return u=function(t){var r,i,o=t.id,s=t.sender.communicationUserId===(null===(r=T.sessionInfo)||void 0===r?void 0:r.id),a=Object.keys(t).includes("editedOn");s||n.has(o)&&!a||(e(t),n.add(o),null===(i=T.logger)||void 0===i||i.recordIndividualEvent(m.default.MessageReceived,g.MessageSource.WebSocket,l.MessagePrinterFactory.printifyMessage(t,l.PrinterType.WebSocket)))},null===(v=this.chatClient)||void 0===v||v.on("chatMessageReceived",u),null===(y=this.chatClient)||void 0===y||y.on("chatMessageEdited",u),this.trackListener("chatMessageReceived",u),this.trackListener("chatMessageEdited",u),null===(C=this.logger)||void 0===C||C.completeScenario(a.RegisterOnNewMessage),[3,6];case 5:throw d=E.sent(),p={errorObject:"".concat(d)},null===(S=this.logger)||void 0===S||S.failScenario(a.RegisterOnNewMessage,{ExceptionDetails:JSON.stringify(p)}),new Error(a.RegisterOnNewMessage);case 6:return[2]}})})},e.prototype.registerOnThreadUpdate=function(e){return i(this,void 0,void 0,function(){var t,n,r,i,s;return o(this,function(o){null===(n=this.logger)||void 0===n||n.startScenario(a.RegisterOnThreadUpdate);try{t=function(t){e(t)},null===(r=this.chatClient)||void 0===r||r.on("participantsRemoved",t),this.trackListener("participantsRemoved",t),null===(i=this.logger)||void 0===i||i.completeScenario(a.RegisterOnThreadUpdate)}catch(e){null===(s=this.logger)||void 0===s||s.failScenario(a.RegisterOnThreadUpdate)}return[2]})})},e.prototype.onTypingEvent=function(e){return i(this,void 0,void 0,function(){var t,n,r,i,s;return o(this,function(o){null===(n=this.logger)||void 0===n||n.startScenario(a.OnTypingEvent);try{t=function(t){var n=t.sender,r=t.recipient;n.communicationUserId!==r.communicationUserId&&e(t)},null===(r=this.chatClient)||void 0===r||r.on("typingIndicatorReceived",t),this.trackListener("typingIndicatorReceived",t),null===(i=this.logger)||void 0===i||i.completeScenario(a.OnTypingEvent)}catch(e){null===(s=this.logger)||void 0===s||s.failScenario(a.OnTypingEvent)}return[2]})})},e.prototype.sendMessage=function(e){return i(this,void 0,void 0,function(){var t,n,i,s,c,u,l,d,g,m,C;return o(this,function(o){switch(o.label){case 0:null===(l=this.logger)||void 0===l||l.startScenario(a.SendMessage),e.metadata||(e.metadata={}),t={content:e.content},n={senderDisplayName:h.default.Customer,metadata:r({deliveryMode:p.default.Bridged,tags:y.defaultMessageTags.join(",")},e.metadata)},o.label=1;case 1:return o.trys.push([1,3,,4]),[4,null===(d=this.chatThreadClient)||void 0===d?void 0:d.sendMessage(t,n)];case 2:return i=o.sent(),null===(g=this.logger)||void 0===g||g.completeScenario(a.SendMessage),(null==i?void 0:i.id)?(s={id:null==i?void 0:i.id,content:e.content,sender:{communicationUserId:null===(m=this.sessionInfo)||void 0===m?void 0:m.id},displayName:n.senderDisplayName,metadata:{tags:y.defaultMessageTags.join(",")},createdOn:new Date(parseInt(null==i?void 0:i.id))||(null==i?void 0:i.id)},[2,(0,v.default)(s,{liveChatVersion:f.default.V2})]):[3,4];case 3:throw c=o.sent(),u={response:"SendMessageFailed",errorObject:"".concat(c)},null===(C=this.logger)||void 0===C||C.failScenario(a.SendMessage,{ExceptionDetails:JSON.stringify(u)}),c;case 4:return[2,{}]}})})},e.prototype.sendTyping=function(){return i(this,void 0,void 0,function(){var e,t,n,r,i,s;return o(this,function(o){switch(o.label){case 0:null===(n=this.logger)||void 0===n||n.startScenario(a.SendTyping),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,null===(r=this.chatThreadClient)||void 0===r?void 0:r.sendTypingNotification()];case 2:return o.sent(),null===(i=this.logger)||void 0===i||i.completeScenario(a.SendTyping),[3,4];case 3:throw e=o.sent(),t={response:"SendTypingFailed",errorObject:"".concat(e)},null===(s=this.logger)||void 0===s||s.failScenario(a.SendTyping,{ExceptionDetails:JSON.stringify(t)}),new Error("SendTypingFailed");case 4:return[2]}})})},e.prototype.sendFileMessage=function(){return i(this,void 0,void 0,function(){return o(this,function(e){return[2,void 0]})})},e.prototype.sendFileData=function(){return i(this,void 0,void 0,function(){return o(this,function(e){return[2,void 0]})})},e.prototype.uploadFile=function(){return i(this,void 0,void 0,function(){return o(this,function(e){return[2,void 0]})})},e.prototype.downloadFile=function(){return i(this,void 0,void 0,function(){return o(this,function(e){return[2,void 0]})})},e.prototype.disconnect=function(){return i(this,void 0,void 0,function(){var e,t,n,r,i,s,c,u,l,d=this;return o(this,function(o){switch(o.label){case 0:null===(c=this.logger)||void 0===c||c.startScenario(a.Disconnect),o.label=1;case 1:for(o.trys.push([1,3,,4]),e=function(e,t){t.forEach(function(t){d.chatClient.off(e,t)})},t=0,n=Object.entries(this.eventListeners);t<n.length;t++)r=n[t],i=r[0],s=r[1],e(i,s);return[4,this.stopPolling()];case 2:return o.sent(),this.pollingTimer&&clearTimeout(this.pollingTimer),null===(u=this.logger)||void 0===u||u.completeScenario(a.Disconnect),[3,4];case 3:return o.sent(),null===(l=this.logger)||void 0===l||l.failScenario(a.Disconnect),[3,4];case 4:return[2]}})})},e.prototype.createParticipantsMapping=function(){return i(this,void 0,void 0,function(){var e,t,n,r,i,s,a;return o(this,function(o){switch(o.label){case 0:return[4,this.getParticipants()];case 1:for(e=o.sent(),t={},n=0,r=e;n<r.length;n++)i=r[n],s=i.id,Object.keys(t).includes(s.communicationUserId)||Object.assign(t,((a={})[s.communicationUserId]=i,a));return[2,t]}})})},e.prototype.trackListener=function(e,t){e in this.eventListeners||(this.eventListeners[e]=[]),this.eventListeners[e].push(t)},e}();t.ACSConversation=C;var S=function(){function e(e){void 0===e&&(e=null),this.logger=null,this.tokenCredential=null,this.chatClient=null,this.logger=e}return e.prototype.initialize=function(e){return i(this,void 0,void 0,function(){var t,n,r,s,l,d,h=this;return o(this,function(p){null===(r=this.logger)||void 0===r||r.startScenario(a.InitializeACSClient),t=function(){return i(h,void 0,void 0,function(){return o(this,function(t){switch(t.label){case 0:return e.tokenRefresher?[4,e.tokenRefresher()]:[3,2];case 1:return[2,t.sent()];case 2:return[2,e.token]}})})};try{this.tokenCredential=new c.AzureCommunicationTokenCredential({token:e.token,tokenRefresher:t,refreshProactively:!0})}catch(e){throw n={response:"CreateTokenCredentialFailure",errorObject:"".concat(e)},null===(s=this.logger)||void 0===s||s.failScenario(a.InitializeACSClient,{ExceptionDetails:JSON.stringify(n)}),new Error(JSON.stringify(n))}try{this.chatClient=new u.ChatClient(e.environmentUrl,this.tokenCredential)}catch(e){throw n={response:"CreateChatClientFailure",errorObject:"".concat(e)},null===(l=this.logger)||void 0===l||l.failScenario(a.InitializeACSClient,{ExceptionDetails:JSON.stringify(n)}),new Error(JSON.stringify(n))}return null===(d=this.logger)||void 0===d||d.completeScenario(a.InitializeACSClient),[2]})})},e.prototype.joinConversation=function(e){return i(this,void 0,void 0,function(){var t;return o(this,function(n){switch(n.label){case 0:return[4,(t=new C(this.tokenCredential,this.chatClient,this.logger)).initialize(e)];case 1:return n.sent(),[2,t]}})})},e.prototype.getChatClient=function(){return this.chatClient},e}();t.default=S},7383:e=>{e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports.default=e.exports},7387:(e,t,n)=>{"use strict";var r=n(4994);Object.defineProperty(t,"__esModule",{value:!0}),t.addOcUserAgentHeader=void 0;var i=r(n(1132)),o=r(n(6984));t.addOcUserAgentHeader=function(e,t){var r=n(5119).rE,s="ocsdk/".concat(r);t["".concat(o.default.ocUserAgent)]=[].concat((0,i.default)(e),[s]).join(" ")}},7428:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.prototype.start=function(){this.timeStart=(new Date).getTime()},e.prototype.stop=function(){return(new Date).getTime()-this.timeStart},e}();t.default=n},7463:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.retrieveRegionBasedUrl=t.isRegionBasedUrlVersionSupported=t.isRegionBasedUrlSupported=t.shouldUseFramedMode=t.isUrlWhitelisted=t.regionBasedUrlSupportedVersions=t.regionBasedSupportedUrls=t.whitelistedUrls=void 0;var r=n(9229);t.whitelistedUrls=["https://oc-cdn-ppe2.azureedge.net","https://oc-cdn-public.azureedge.net","https://oc-cdn-public-sam.azureedge.net","https://oc-cdn-ocuae-uae.azureedge.net","https://oc-cdn-ocfra-fra.azureedge.net","https://oc-cdn-public-ger.azureedge.net","https://oc-cdn-public-che.azureedge.net","https://oc-cdn-public-ind.azureedge.net","https://oc-cdn-public-gbr.azureedge.net","https://oc-cdn-public-apj.azureedge.net","https://oc-cdn-public-oce.azureedge.net","https://oc-cdn-public-jpn.azureedge.net","https://oc-cdn-public-eur.azureedge.net","https://oc-cdn-ocprod.azureedge.net","https://ocprodocprodnamgs.blob.core.usgovcloudapi.net"],t.regionBasedSupportedUrls=["https://oc-cdn-ppe2.azureedge.net","https://oc-cdn-public.azureedge.net","https://oc-cdn-public-sam.azureedge.net","https://oc-cdn-ocuae-uae.azureedge.net","https://oc-cdn-ocfra-fra.azureedge.net","https://oc-cdn-public-ger.azureedge.net","https://oc-cdn-public-che.azureedge.net","https://oc-cdn-public-ind.azureedge.net","https://oc-cdn-public-gbr.azureedge.net","https://oc-cdn-public-apj.azureedge.net","https://oc-cdn-public-oce.azureedge.net","https://oc-cdn-public-jpn.azureedge.net","https://oc-cdn-public-eur.azureedge.net","https://oc-cdn-ocprod.azureedge.net","https://ocprodocprodnamgs.blob.core.usgovcloudapi.net"],t.regionBasedUrlSupportedVersions=["0.1.8","0.1.9","0.1.10"],t.isUrlWhitelisted=function(e){return t.whitelistedUrls.includes(e)},t.shouldUseFramedMode=function(e){if(void 0===e&&(e=!0),(0,r.isBrowser)()&&!1===e){var n=window.location.origin||"";return!(0,t.isUrlWhitelisted)(n)}return(0,r.isBrowser)()},t.isRegionBasedUrlSupported=function(e){return t.regionBasedSupportedUrls.includes(e)},t.isRegionBasedUrlVersionSupported=function(){var e=n(2084).rE;return t.regionBasedUrlSupportedVersions.includes(e)},t.retrieveRegionBasedUrl=function(e){var n=(0,t.isRegionBasedUrlSupported)(e),i=(0,t.isRegionBasedUrlVersionSupported)();return(0,r.isBrowser)()&&e&&n&&i?"".concat(e,"/livechatwidget/v2scripts/ams"):""}},7516:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.UserMessage="UserMessage",e.SwiftCard="SwiftCard",e.Typing="Control/Typing",e.ClearTyping="Control/ClearTyping",e.LiveState="Control/LiveState",e}();t.default=n},7535:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Unknown=0]="Unknown",e[e.InProgress=1]="InProgress",e[e.Success=2]="Success",e[e.Error=3]="Error"}(n||(n={})),t.default=n},7708:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(5753),a=n(9445),c=n(5123),u=function(){function e(e,t){void 0===t&&(t={}),this.scanResults=null,this.amsClient=e,this.scanResults=new Map,this.shouldQueueScan=!1,this.test=!1,this.options=t,this.queueScan()}return e.prototype.queueScan=function(){return i(this,void 0,void 0,function(){var e,t;return o(this,function(n){switch(n.label){case 0:this.shouldQueueScan=!0,n.label=1;case 1:return n.trys.push([1,3,4,8]),[4,this.scanFiles()];case 2:return n.sent(),[3,8];case 3:return e=n.sent(),console.error(e),[3,8];case 4:return[4,a.default.sleep((null===(t=this.options)||void 0===t?void 0:t.pollingInterval)||7e3)];case 5:return n.sent(),this.shouldQueueScan&&!this.test?[4,this.queueScan()]:[3,7];case 6:n.sent(),n.label=7;case 7:return[7];case 8:return[2]}})})},e.prototype.retrieveFileScanResult=function(e){var t;return null===(t=this.scanResults)||void 0===t?void 0:t.get(e)},e.prototype.addOrUpdateFile=function(e,t,n){var i,o=this.retrieveFileScanResult(e);null===(i=this.scanResults)||void 0===i||i.set(e,r(r({},o||{}),{fileMetadata:t,scan:n}))},e.prototype.addNext=function(e,t){var n,i,o=null===(n=this.scanResults)||void 0===n?void 0:n.get(e);o&&(null===(i=this.scanResults)||void 0===i||i.set(e,r(r({},o),{next:t})))},e.prototype.addActivity=function(e,t){var n,i,o=null===(n=this.scanResults)||void 0===n?void 0:n.get(e);o&&(null===(i=this.scanResults)||void 0===i||i.set(e,r(r({},o),{activity:t})))},e.prototype.scanFileCallback=function(e,t){return i(this,void 0,void 0,function(){var n,r,i,c,u,l,d,h,p;return o(this,function(o){switch(o.label){case 0:if(n=e.fileMetadata,r=e.next,i=e.activity,(null==(c=e.scan)?void 0:c.status)!==s.AMSViewScanStatus.INPROGRESS)return[3,10];o.label=1;case 1:return o.trys.push([1,7,,8]),[4,this.amsClient.getViewStatus(n)];case 2:return u=o.sent(),l=u.view_location,d=u.scan,this.addOrUpdateFile(t,e.fileMetadata,d),d.status===s.AMSViewScanStatus.PASSED&&r&&i?[4,this.renderAttachmentActivity(e,l)]:[3,4];case 3:o.sent(),o.label=4;case 4:return d.status===s.AMSViewScanStatus.MALWARE&&r&&i?[4,this.renderMalwareActivity(e)]:[3,6];case 5:o.sent(),o.label=6;case 6:return[3,8];case 7:return h=o.sent(),console.error(h),[3,8];case 8:return[4,a.default.sleep((null===(p=this.options)||void 0===p?void 0:p.scanStatusRetrievalDelay)||1e3)];case 9:o.sent(),o.label=10;case 10:return[2]}})})},e.prototype.scanFiles=function(){var e=this;return new Promise(function(t){return i(e,void 0,void 0,function(){var e,n=this;return o(this,function(r){return null===(e=this.scanResults)||void 0===e||e.forEach(function(e,t){return i(n,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return[4,this.scanFileCallback(e,t)];case 1:return n.sent(),[2]}})})}),t(),[2]})})})},e.prototype.end=function(){this.shouldQueueScan=!1},e.prototype.retrieveFileBlob=function(e,t){return i(this,void 0,void 0,function(){var n,r;return o(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.amsClient.getView(e,t)];case 1:return n=i.sent(),[3,3];case 2:return r=i.sent(),console.error(r),[3,3];case 3:return[2,n]}})})},e.prototype.addAttachmentToActivity=function(e,t){return i(this,void 0,void 0,function(){var n,r,i;return o(this,function(o){switch(o.label){case 0:return[4,c.default.getAttachments([t])];case 1:return n=o.sent(),[4,c.default.getAttachmentSizes([t])];case 2:return r=o.sent(),i=e.attachments.findIndex(function(e){return e.name===t.name}),e.attachments[i]=n[0],e.channelData.attachmentSizes[i]=r[0],[2]}})})},e.prototype.renderAttachmentActivity=function(e,t){return i(this,void 0,void 0,function(){var n,r,i,a,c,u,l,d=this;return o(this,function(o){switch(o.label){case 0:return n=e.fileMetadata,r=e.next,i=e.activity,[4,this.retrieveFileBlob(n,t)];case 1:return a=o.sent(),c=new File([a],n.name,{type:n.type}),[4,this.addAttachmentToActivity(i,c)];case 2:return o.sent(),u=i.attachments.findIndex(function(e){return e.name===c.name}),i.channelData.fileScan[u]={status:s.AMSViewScanStatus.PASSED},u>0&&(l=i.channelData.metadata.amsreferences,JSON.parse(l).forEach(function(e){d.addActivity(e,i)})),r(i),[2]}})})},e.prototype.renderMalwareActivity=function(e){return i(this,void 0,void 0,function(){var t,n,r,i;return o(this,function(o){return t=e.fileMetadata,n=e.next,r=e.activity,i=r.attachments.findIndex(function(e){return e.name===t.name}),r.channelData.fileScan[i]={status:s.AMSViewScanStatus.MALWARE},n(r),[2]})})},e}();t.default=u},7723:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(3588),s=n(1039),a=n(8906),c=n(3712);t.default=function(e){return r(void 0,void 0,void 0,function(){var t,n,r;return i(this,function(i){switch(i.label){case 0:return e.debug&&console.log("[createAMSClient] "+(e.framedMode?"FramedClient":"FramedlessClient")),e.debug&&console.time("createAMSClient"),t=new o.default(e.logger),n={multiClient:e.multiClient||!1,baseUrl:e.baseUrl||""},[4,(r=e.framedMode?new s.default(t,n):new a.default(t)).setup()];case 1:return i.sent(),e.debug&&r.setDebug(e.debug||!1),c.default.debug=e.debug||!1,c.default.silentError=e.silentError||!0,e.debug&&console.timeEnd("createAMSClient"),[2,r]}})})}},7729:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7928),i=n(2246),o=function(){function e(){}return e.getClientBridge=function(e){switch(e.hostType){case i.default.IFrame:throw new Error("Framed bridge not implemented for "+e.hostType+" in IC3Core");case i.default.Page:return new r.default(e.protocolType);default:throw new Error("Client bridge not implemented for "+e.hostType+" in IC3Core")}},e}();t.default=o},7736:(e,t,n)=>{var r=n(3738).default,i=n(9045);e.exports=function(e){var t=i(e,"string");return"symbol"==r(t)?t:t+""},e.exports.__esModule=!0,e.exports.default=e.exports},7767:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4746),i=n(3480),o=function(){function e(){}return e.getDefaultIC3Headers=function(){return{Accept:r.default.ContentTypeJson,BehaviorOverride:r.default.RedirectAs404,ClientInfo:r.default.ClientInfoValue,ContextId:"tcid="+(0,i.uuidv4)(),Expires:0,Pragma:r.default.NoCache,"x-ms-client-type":r.default.Web,"x-ms-user-type":r.default.User}},e.getDefaultBaseIC3Headers=function(){return{Accept:r.default.ContentTypeJson,BehaviorOverride:r.default.RedirectAs404,"content-type":r.default.ContentTypeJson}},e.getDefaultGetMessagesQueryParameters=function(){return{pageSize:20,startTime:0,view:"msnp24Equivalent|supportsMessageProperties"}},e.getDefaultAMSHeaders=function(e){return{Authorization:r.default.AMSAuthorizationSkypeTokenValue+e,"X-MS-Client-Version":r.default.ClientInfoValue}},e.getDefaultAMSViewHeaders=function(e){return{Accept:r.default.AMSAcceptHeaderValue,"Accept-Encoding":r.default.AMSAcceptEncodingHeaderValue,Authorization:r.default.AMSAuthorizationSkypeTokenValue+e,"X-MS-Client-Version":r.default.ClientInfoValue}},e}();t.default=o},7881:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(3136),o=n(772),s=n(3428);t.default=function(e,t){var n={};if(n.liveChatVersion=t.liveChatVersion||o.default.V1,t.debug&&console.log(e),t.liveChatVersion===o.default.V2){var a=e,c=a.id,u=a.content,l=a.metadata,d=a.sender,h=a.senderDisplayName,p=a.createdOn,f=a.editedOn;if(n.id=c,n.messageid=void 0,n.clientmessageid=void 0,n.deliveryMode=void 0,n.properties={},n.content="",n.properties.tags=l&&l.tags?l.tags:[],n.tags=l&&l.tags?l.tags.replace(/\"/g,"").split(",").filter(function(e){return e.length>0}):[],n.timestamp=null!=f?f:p,n.messageType=i.MessageType.UserMessage,n.sender={id:d.communicationUserId,displayName:h,type:i.PersonType.Bot},u?"string"==typeof u?n.content=u:"object"==typeof u&&"string"==typeof(null==u?void 0:u.message)&&(n.content=u.message):e.message&&(n.content=e.message),l&&l["pva:gpt-feedback"]&&(n.citations={text:null==l?void 0:l.Text,"pva:gpt-feedback":l["pva:gpt-feedback"],feedbackLoop:null==l?void 0:l.feedbackLoop,deliveryMode:null==l?void 0:l.deliveryMode}),l&&l.amsMetadata&&l.amsReferences||(null==l?void 0:l.amsreferences))try{var g=JSON.parse(l.amsMetadata),m=JSON.parse(l.amsreferences||(null==l?void 0:l.amsReferences)),v=g[0],y=v.fileName,C=v.contentType;n.fileMetadata={},n.fileMetadata.fileSharingProtocolType=0,n.fileMetadata.id=m[0],n.fileMetadata.name=y,n.fileMetadata.size=0,n.fileMetadata.type=C,n.fileMetadata.url=""}catch(e){}l&&l.OriginalMessageId?n.properties.originalMessageId=l.OriginalMessageId:n.properties.originalMessageId=c,l&&l.customEvent&&l.customEventName&&l.customEventValue&&(n.customEvent={isCustomEvent:Boolean(l.customEvent),customEventName:l.customEventName,customEventValue:l.customEventValue}),n.role=(0,s.getMessageRole)(n)}else{var S=e.clientmessageid;n.id=S,n=r({},e)}return n}},7912:(e,t,n)=>{"use strict";var r=n(4994);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"SDKProvider",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"uuidv4",{enumerable:!0,get:function(){return a.uuidv4}});var i=r(n(8303)),o=r(n(3570)),s=r(n(4757)),a=n(4479);!function(){if(void 0===n.g.window&&(n.g.window=n.g),!window)throw new Error("window object not found");"Microsoft"in window||(window.Microsoft={}),"CRM"in window.Microsoft||(window.Microsoft.CRM={}),"Omnichannel"in window.Microsoft.CRM||(window.Microsoft.CRM.Omnichannel={}),"SDK"in window.Microsoft.CRM.Omnichannel||(window.Microsoft.CRM.Omnichannel.SDK={SDKProvider:s.default,Util:{uuidv4:a.uuidv4}}),window.document&&i.default.raiseCustomEvent(o.default.OCSDKLOAD)}()},7928:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(983),c=n(2246),u=n(3843),l=function(e){function t(t){var n=e.call(this,t)||this;return n.hostType=c.default.Page,n.protocolAdapter=new u.default("",n.hostType),n}return i(t,e),t.prototype.setup=function(e){return Promise.resolve()},t.prototype.update=function(e){return Promise.resolve()},t.prototype.onRegisterOnNewMessage=function(e){return Promise.resolve()},t.prototype.onRegisterOnThreadUpdate=function(e){return Promise.resolve()},t.prototype.initialize=function(e){return this.protocolAdapter.initialize(e)},t.prototype.dispose=function(){return this.protocolAdapter.dispose()},t.prototype.sendMessage=function(e,t){return this.protocolAdapter.sendMessage(e,t)},t.prototype.sendFileMessage=function(e,t,n){return this.protocolAdapter.sendFileMessage(e,t,n)},t.prototype.getMessages=function(e){return this.protocolAdapter.getMessages(e)},t.prototype.disconnectFromConversation=function(e){return this.protocolAdapter.disconnectFromConversation(e)},t.prototype.onJoinConversation=function(e,t){return this.protocolAdapter.joinConversation(e,t)},t.prototype.sendFileData=function(e,t,n){return this.protocolAdapter.sendFileData(e,t,n)},t.prototype.downloadFileData=function(e,t){return this.protocolAdapter.downloadFileData(e,t)},t.prototype.getFileStatus=function(e,t){return this.protocolAdapter.getFileStatus(e,t)},t.prototype.indicateTypingStatus=function(e,t,n){return this.protocolAdapter.indicateTypingStatus(e,t,n)},t.prototype.sendMessageToBot=function(e,t,n){return this.protocolAdapter.sendMessageToBot(e,t,n)},t.prototype.getMembers=function(e){return this.protocolAdapter.getMembers(e)},t.prototype.registerOnNewMessage=function(e,t){return o(this,void 0,void 0,function(){return s(this,function(n){return this.protocolAdapter.registerOnNewMessage(e,t),[2,Promise.resolve()]})})},t.prototype.registerOnThreadUpdate=function(e,t){return o(this,void 0,void 0,function(){return s(this,function(n){return this.protocolAdapter.registerOnThreadUpdate(e,t),[2,Promise.resolve()]})})},t.prototype.setDebug=function(e){void 0===e&&(e=!1),this.protocolAdapter.setDebug(e)},t}(a.default);t.default=l},7969:function(e,t,n){"use strict";var r=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.setChatId=t.setDebugDetailed=t.setDebug=t.setRequestId=t.setRuntimeId=t.useTelemetry=t._exceptionDetailPIIKeys=t._basePIIKeys=void 0,t.redactPII=a;var i=n(3428);t._basePIIKeys=["senderDisplayName","message","content","fileName"].map(function(e){return e.toLowerCase()}),t._exceptionDetailPIIKeys=r(r([],t._basePIIKeys,!0),["authorization"],!1);var o=[];function s(e){for(var t=0,n=o;t<n.length;t++){var r=n[t];if(e.toLowerCase().includes(r.toLowerCase()))return r}}function a(e,n,r,o){if(void 0===n&&(n=!1),void 0===r&&(r=!0),void 0===o&&(o=t._basePIIKeys),null==e)return e;if("boolean"==typeof e)return{result:e};if("string"==typeof e&&((0,i.isJsonObject)(e)?e=JSON.parse(e):(g=s(e))&&e.length>1&&(e="".concat(g,":").concat(e.slice(0,1),"**").concat(e.length-1," hidden**"))),e&&"object"==typeof e)try{var c=void 0;c=r?JSON.parse(JSON.stringify(e)):e;for(var u=0,l=Object.entries(c);u<l.length;u++){var d=l[u],h=d[0],p=d[1],f=h.toLowerCase();if(n||o.includes(f))"string"==typeof p?(0,i.isJsonObject)(p)?c[h]=a(JSON.parse(p),!0,!1,o):p.length>1&&(c[h]=p.slice(0,1)+"**".concat(p.length-1," hidden**")):"object"==typeof p&&a(p,!0,!1,o);else if("object"==typeof p)a(p,n,!1,o);else if("string"==typeof p){var g;(0,i.isJsonObject)(p)?c[h]=a(JSON.parse(p),n,!1,o):(g=s(p))&&p.length>1&&(c[h]="".concat(h,":").concat(g,":")+p.slice(0,1)+"**".concat(p.length-1," hidden**"))}}return c}catch(t){return{error:t,keys:Object.keys(e)}}return e}t.useTelemetry=function(e,t,n,r,i,o,s){void 0===s&&(s=null),t.useTelemetry(e),n.useTelemetry(e),r.useTelemetry(e),i.useTelemetry(e),o.useTelemetry(e),null==s||s.useTelemetry(e)},t.setRuntimeId=function(e,t,n,r,i,o,s){void 0===s&&(s=null),t.setRuntimeId(e),n.setRuntimeId(e),r.setRuntimeId(e),i.setRuntimeId(e),o.setRuntimeId(e),null==s||s.setRuntimeId(e)},t.setRequestId=function(e,t,n,r,i,o,s){void 0===s&&(s=null),null==t||t.setRequestId(e),null==n||n.setRequestId(e),null==r||r.setRequestId(e),null==i||i.setRequestId(e),null==o||o.setRequestId(e),null==s||s.setRequestId(e)},t.setDebug=function(e,t,n,r,i,o,s){void 0===s&&(s=null),null==t||t.setDebug(e),null==n||n.setDebug(e),null==r||r.setDebug(e),null==i||i.setDebug(e),null==o||o.setDebug(e),null==s||s.setDebug(e)},t.setDebugDetailed=function(e,t,n,r,i,o,s,a){null==r||r.setDebug(e),null==s||s.setDebug(e),null==i||i.setDebug(t),null==o||o.setDebug(t),null==a||a.setDebug(n)},t.setChatId=function(e,t,n,r,i,o,s){void 0===s&&(s=null),null==t||t.setChatId(e),null==n||n.setChatId(e),null==r||r.setChatId(e),null==i||i.setChatId(e),null==o||o.setChatId(e),null==s||s.setChatId(e)},t.default={useTelemetry:t.useTelemetry,setRuntimeId:t.setRuntimeId,setRequestId:t.setRequestId,setDebug:t.setDebug,setDebugDetailed:t.setDebugDetailed,setChatId:t.setChatId,redactPII:a}},8039:(e,t,n)=>{var r;self,r=()=>(()=>{var e={781:(e,t,n)=>{"use strict";var r=n(611),i=n(5777),o=n(1219),s=n(5923);function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var c=a(r),u=a(i),l=a(o),d=a(s),h="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{};function p(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function f(e,t){return e(t={exports:{}},t.exports),t.exports}var g=f(function(e,t){e.exports=function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=1)}([function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.Timespan=t.toJson=t.fetchWithTimeout=void 0,t.fetchWithTimeout=function(e,t){var n,r=new Promise(function(t,r){fetch(e).then(function(e){void 0!==n&&clearTimeout(n),t(e)}).catch(function(e){void 0!==n&&clearTimeout(n),r(e)})});if(0!==t){var i=new Promise(function(r,i){n=setTimeout(i,t,new Error("Fetch for '".concat(e.url,"' timed out")))});return Promise.race([r,i])}return r},t.toJson=function(e){try{return JSON.stringify(e)}catch(t){return"Unable to serialize object of type ".concat(typeof e)}};var r=function(){function e(){this.start=Date.now()}return Object.defineProperty(e.prototype,"duration",{get:function(){return Date.now()-this.start},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"startTime",{get:function(){return this.start},enumerable:!1,configurable:!0}),e.prototype.reset=function(){this.start=Date.now()},e}();t.Timespan=r},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__assign||function(){return i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?n(e.value):i(e.value).then(s,a)}c((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;a&&(a=0,n[0]&&(c=0)),c;)try{if(i=1,o&&(s=2&n[0]?o.return:n[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(s=(s=c.trys).length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){c.label=n[1];break}if(6===n[0]&&c.label<s[1]){c.label=s[1],s=n;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(n);break}s[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,s,a,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(t,"__esModule",{value:!0}),t.createRegistrarClient=t.RegistrarClient=void 0;var a=n(0),c=["skype","aad","cae"],u=function(e){function t(t){var n=e.call(this,t)||this;return n.name="CancelationError",n}return r(t,e),t}(Error),l=function(){function e(t,n,r){this.logger=t,this.maxBackoffInMs=n,this.initialDelay=r,this.backoffCount=0,this.id=++e.idCounter}return e.prototype.delay=function(e){var t=this;if(void 0!==this.timerHandle)throw new Error("Retry sequence logical failure");if(-1===this.backoffCount)return new Promise(function(e,t){t(new u("Cancelled"))});var n=this.calculateNextBackoffMs();return this.backoffCount++,this.logger.info("[RegistrarClient] Backing off ".concat(e," for ").concat(n," milliseconds with ID ").concat(this.id)),new Promise(function(r,i){t.cancelFunc=i,t.timerHandle=setTimeout(function(){t.logger.info("[RegistrarClient] Back off for ".concat(e," with ID ").concat(t.id," complete")),t.timerHandle=void 0,r()},n)})},e.prototype.cancel=function(){void 0!==this.timerHandle&&(this.logger.debug("Resetting back off"),clearTimeout(this.timerHandle),void 0!==this.cancelFunc&&this.cancelFunc(new u("Cancelled"))),this.backoffCount=-1},e.prototype.calculateNextBackoffMs=function(){var e=1+.4*(Math.random()-.5),t=this.initialDelay*Math.pow(2,this.backoffCount)*e;return t=Math.round(t),Math.min(this.maxBackoffInMs,t)},e.idCounter=0,e}(),d=function(){function e(e,t,n){var r;this.logger=e,this.tokenProvider=t,this.options=n,this.DEFAULT_MAX_RETRIES_FOR_GET_TOKEN=15,this.DEFAULT_MAX_BACKOFF_TIME_IN_MS=3e5,this.backoffs={},this.maxBackOffTime=this.options.maxRetryDelayMs>0?this.options.maxRetryDelayMs:this.DEFAULT_MAX_BACKOFF_TIME_IN_MS,this.maxRetriesForGetToken=void 0===n.maxRetriesForGetToken||null===n.maxRetriesForGetToken?this.DEFAULT_MAX_RETRIES_FOR_GET_TOKEN:n.maxRetriesForGetToken,this.proxyUrlRewrite=null!==(r=n.proxyUrlRewrite)&&void 0!==r?r:function(e){return e}}return e.prototype.setTelemetryLogger=function(e){this.eventLogger=e},e.prototype.register=function(e,t){return o(this,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:return[4,this.performRegistration(e,t,"pr_set_registration")];case 1:return n.sent(),this.cachedRegistrationParams=[e,t],[2]}})})},e.prototype.unregister=function(){return o(this,void 0,void 0,function(){var e;return s(this,function(t){switch(t.label){case 0:return this.logger.info("[RegistrarClient] sending unregister request"),e=new Request(this.proxyUrlRewrite("".concat(this.options.registrarUrl,"/").concat(this.options.registrationId)),{method:"DELETE",mode:"cors",headers:new Headers(i(i({},this.options.extraRegistrationHeaders),{accept:"application/json, text/javascript"}))}),[4,this.callRegistrar(e,"pr_delete_registration")];case 1:return t.sent(),[2]}})})},e.prototype.cancelPendingRequests=function(){var e=this;Object.keys(this.backoffs).forEach(function(t){e.backoffs[t].cancel()}),this.backoffs={}},e.prototype.resendRegistration=function(){return o(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:if(!this.cachedRegistrationParams)throw new Error("Re-registration failed because there is no registration parameters cached");return[4,this.performRegistration(this.cachedRegistrationParams[0],this.cachedRegistrationParams[1],"pr_resend_registration")];case 1:return e.sent(),[2]}})})},e.prototype.performRegistration=function(e,t,n){return o(this,void 0,void 0,function(){var r,o;return s(this,function(s){switch(s.label){case 0:return this.logger.info("[RegistrarClient] Sending register request"),r={clientDescription:e,registrationId:this.options.registrationId,nodeId:"",transports:t},o=new Request(this.proxyUrlRewrite(this.options.registrarUrl),{method:"POST",mode:"cors",headers:new Headers(i(i({},this.options.extraRegistrationHeaders),{"content-type":"application/json",accept:"application/json, text/javascript"})),body:(0,a.toJson)(r)}),[4,this.callRegistrar(o,n)];case 1:return s.sent(),[2]}})})},e.prototype.startBackoff=function(){var e=new l(this.logger,this.maxBackOffTime,this.options.initialRetryDelayMs);return this.backoffs[e.id]=e,e},e.prototype.stopBackoff=function(e){e.cancel(),delete this.backoffs[e.id]},e.prototype.getToken=function(e){return o(this,void 0,void 0,function(){var t,n,r,i,o,a,u;return s(this,function(s){switch(s.label){case 0:t=this.startBackoff(),n=0,s.label=1;case 1:return s.trys.push([1,3,,8]),this.logger.info("[RegistrarClient] Asking for a new token"),[4,this.tokenProvider({needFresh:!0,supportedTokenTypes:c,wwwAuthenticateHeader:e,purpose:"registrar"})];case 2:return r=s.sent(),this.stopBackoff(t),[2,r];case 3:i=s.sent(),s.label=4;case 4:return s.trys.push([4,6,,7]),n++,o=JSON.stringify(i),n>this.maxRetriesForGetToken?(a="[RegistrarClient] getToken retry limit hit. Will not retry now. Error: ".concat(o),this.logger.error(a),this.stopBackoff(t),[2,Promise.reject(a)]):(this.logger.warn("[RegistrarClient] Retrying for a new token. Retry Count: ".concat(n," Error: ").concat(o)),[4,t.delay("Fetching a new token")]);case 5:return s.sent(),[3,8];case 6:throw u=s.sent(),this.stopBackoff(t),u;case 7:return[3,8];case 8:return[3,1];case 9:return[2]}})})},e.prototype.callRegistrar=function(e,t){var n,r,i;return o(this,void 0,void 0,function(){var o,u,l,d,h,p,f,g,m,v,y,C,S,T,E,b;return s(this,function(s){switch(s.label){case 0:return o=this.startBackoff(),[4,this.tokenProvider({needFresh:!1,supportedTokenTypes:c,wwwAuthenticateHeader:void 0,purpose:"registrar"})];case 1:u=s.sent(),this.setTokenHeader(e,u),l=new a.Timespan,d=0,s.label=2;case 2:h=void 0,s.label=3;case 3:return s.trys.push([3,10,15,16]),p=e.clone(),[4,(0,a.fetchWithTimeout)(p,this.options.requestTimeoutMs)];case 4:return 401!==(h=s.sent()).status?[3,8]:++d>this.maxRetriesForGetToken?(f="[RegistrarClient] getSkypeToken retry limit hit. Will not retry now. Request '".concat(e.url,"' failed with ").concat(h.status," ").concat(h.statusText),this.logger.error(f),this.stopBackoff(o),[2,Promise.reject(f)]):(this.logger.warn("[RegistrarClient] Retry Count ".concat(d,". Request '").concat(e.url,"' failed with ").concat(h.status," ").concat(h.statusText)),g=null!==(r=null===(n=h.headers)||void 0===n?void 0:n.get("www-authenticate"))&&void 0!==r?r:void 0,m=this.setTokenHeader,v=[e],[4,this.getToken(g)]);case 5:return m.apply(this,v.concat([s.sent()])),d>1?[4,o.delay("Registrar call retry after 401")]:[3,7];case 6:s.sent(),s.label=7;case 7:return[3,22];case 8:if(h.status>=500&&h.status<600)throw new Error("Fetch for '".concat(e.url,"' failed with ").concat(h.status," ").concat(h.statusText));s.label=9;case 9:return[3,16];case 10:y=s.sent(),this.logger.error("[RegistrarClient] Request failed with ".concat(y)),s.label=11;case 11:return s.trys.push([11,13,,14]),[4,o.delay("Registrar call retry")];case 12:return s.sent(),[3,22];case 13:throw C=s.sent(),this.logger.error("[RegistrarClient] Request cancelled"),this.stopBackoff(o),C;case 14:return[3,16];case 15:return this.sendTelemetryEvent(t,e,h,l),[7];case 16:return this.stopBackoff(o),h.ok?[2,h]:[3,17];case 17:S=void 0,s.label=18;case 18:return s.trys.push([18,20,,21]),E=(T=JSON).stringify,[4,h.json()];case 19:return S=E.apply(T,[s.sent()]),[3,21];case 20:return s.sent(),S="no details",[3,21];case 21:throw b="Fetch for '".concat(e.url,"' failed with ").concat(h.status," ").concat(h.statusText," (").concat(S,", MS-CV: ").concat(null===(i=h.headers)||void 0===i?void 0:i.get("MS-CV"),")"),this.logger.error("[RegistrarClient] ".concat(b)),new Error(b);case 22:return[3,2];case 23:return[2]}})})},e.prototype.setTokenHeader=function(e,t){switch(e.headers.delete("X-Skypetoken"),e.headers.delete("Authorization"),e.headers.delete("X-MS-Migration"),t.tokenType.toLowerCase()){case"skype":e.headers.set("X-Skypetoken",t.token);break;case"aad":case"cae":e.headers.set("Authorization","Bearer ".concat(t.token));break;default:throw new Error("unsupported token type: ".concat(t.tokenType))}!1===this.options.usingLegacyTokenApi&&e.headers.set("X-MS-Migration","True")},e.prototype.sendTelemetryEvent=function(e,t,n,r){if(void 0!==this.eventLogger){var i={name:e,properties:{url:{value:t.url},result_code:{value:void 0!==n?n.status:0},begin_timestamp:{value:r.startTime},elapsed:{value:r.duration}}};this.eventLogger.logEvent(i)}},e}();t.RegistrarClient=d,t.createRegistrarClient=function(e,t,n){return new d(e,t,n)}}])});p(g);var m=f(function(e,t){var n;e.exports=(n=g,function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=20)}([function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0;var r=function(){function e(e,t){this.name=e,this.logger=t}return e.prototype.debug=function(e){this.logger.debug("[".concat(this.name,"] ").concat(e))},e.prototype.info=function(e){this.logger.info("[".concat(this.name,"] ").concat(e))},e.prototype.warn=function(e){this.logger.warn("[".concat(this.name,"] ").concat(e))},e.prototype.error=function(e){this.logger.error("[".concat(this.name,"] ").concat(e))},e}();t.Logger=r},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.USER_AUTHENTICATE_EVENT_NAME=t.SUPPORTED_TOKEN_TYPES=t.FAILED_MESSAGE_ACK=t.UNHANDLED_MESSAGE_ACK=t.HANDLED_MESSAGE_ACK=t.CLIENT_VERSION=t.constants=void 0,t.constants={TROUTER_INIT:"trouterinit",TROUTER_READY_EVENT:"trouterReadyEvent",TROUTER_READY_TIMEOUT:"trouterReadyTimeout",TROUTER_TOKEN_REQUEST:"trouterTokenRequest",TROUTER_TOKEN_GET_SUCCEEDED:"trouterTokenGetSucceeded",TROUTER_TOKEN_GET_FAILED:"trouterTokenGetFailed",TROUTER_RECONNECTING:"trouterReconnecting",RENEWAL:"renewal",NEW_CONNECTION:"newConnection",ENDPOINT_REGISTRATION_FAILED:"endpointRegistrationFailed"},t.CLIENT_VERSION="2024.14.01.55",t.HANDLED_MESSAGE_ACK=200,t.UNHANDLED_MESSAGE_ACK=404,t.FAILED_MESSAGE_ACK=500,t.SUPPORTED_TOKEN_TYPES=["skype","aad","cae"],t.USER_AUTHENTICATE_EVENT_NAME="user.authenticate"},function(e,t,n){var r,i;Object.defineProperty(t,"__esModule",{value:!0}),t.TrouterState=t.UserActivityState=void 0,function(e){e[e.Unknown=0]="Unknown",e[e.Active=1]="Active",e[e.Inactive=2]="Inactive"}(r||(t.UserActivityState=r={})),function(e){e[e.Unknown=0]="Unknown",e[e.Connected=2]="Connected",e[e.Disconnected=3]="Disconnected",e[e.Switching=9]="Switching"}(i||(t.TrouterState=i={}))},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?n(e.value):i(e.value).then(s,a)}c((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;a&&(a=0,n[0]&&(c=0)),c;)try{if(i=1,o&&(s=2&n[0]?o.return:n[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(s=(s=c.trys).length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){c.label=n[1];break}if(6===n[0]&&c.label<s[1]){c.label=s[1],s=n;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(n);break}s[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,s,a,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(t,"__esModule",{value:!0}),t.Timespan=t.CorrelationVector=t.fetchWithTimeout=t.calculateExpireTsInSec=t.calculateTtlInSec=t.toJson=void 0,t.toJson=function(e){try{return JSON.stringify(e)}catch(t){return"Unable to serialize object of type ".concat(typeof e)}},t.calculateTtlInSec=function(e){var t=Math.round((new Date).getTime()/1e3);return void 0!==e&&e>t?e-t:0},t.calculateExpireTsInSec=function(e){return Math.round((new Date).getTime()/1e3)+e},t.fetchWithTimeout=function(e,t){return r(this,void 0,void 0,function(){var n,r,o;return i(this,function(i){return r=new Promise(function(t,r){fetch(e).then(function(e){clearTimeout(n),t(e)}).catch(function(e){clearTimeout(n),r(e)})}),0!==t?(o=new Promise(function(r,i){var o=new URL(e.url),s=new Error("".concat(e.method," ").concat(o.origin).concat(o.pathname," timed out"));n=setTimeout(i,t,s)}),[2,Promise.race([r,o])]):[2,r]})})};var o=function(){function e(e){this.base=void 0!==e?e:this.createCorrelationVectorBase(),this.extension=0}return e.extend=function(t){return new e(t)},e.prototype.increase=function(){this.extension++},e.prototype.value=function(){return"".concat(this.base,".").concat(this.extension)},e.prototype.createCorrelationVectorBase=function(){for(var e="",t=0;t<21;t++)e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0987654321/+".charAt(Math.floor(64*Math.random()));return e+"AQgw".charAt(Math.floor(4*Math.random()))},e}();t.CorrelationVector=o;var s=function(){function e(){this.start=Date.now()}return Object.defineProperty(e.prototype,"duration",{get:function(){return Date.now()-this.start},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"startTime",{get:function(){return this.start},enumerable:!1,configurable:!0}),e.prototype.reset=function(){this.start=Date.now()},e}();t.Timespan=s},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.TrouterManagerState=t.UserActivityEventReason=t.ServerState=void 0;var r,i,o=n(3),s=function(){function e(e,t,n,r,i,o,s){this.connectionId=e,this.connectedClientId=t,this.domId=n,this.unsecureUrl=r,this.url=i,this.c2cUrlBase=o,this.expirationTsSec=s}return e.prototype.getRemainingTtlInSec=function(){return(0,o.calculateTtlInSec)(this.expirationTsSec)},e}();t.ServerState=s,function(e){e[e.Unknown=0]="Unknown",e[e.Modified=1]="Modified",e[e.Snapshot=2]="Snapshot",e[e.Connected=3]="Connected"}(r||(t.UserActivityEventReason=r={})),function(e){e[e.Unknown=0]="Unknown",e[e.Connected=2]="Connected",e[e.Disconnected=3]="Disconnected",e[e.Switching=9]="Switching",e[e.TerminalError=10]="TerminalError"}(i||(t.TrouterManagerState=i={}))},function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.redirectUrlIfPresent=t.ensureNumber=t.reconnectParamsWithoutUrls=t.adaptUrl=t.isV4ConnectEvent=t.usedProtocolAfterFallback=t.usedProtocol=void 0,t.usedProtocol=function(e,t){return"skype"===e&&"1"!==function(e){return"string"==typeof e?e:"number"==typeof e?e.toString():void 0}(null==t?void 0:t.scae)?"v4a":"v4c"},t.usedProtocolAfterFallback=function(e,t){return"v4c-websocket-failure"===(null==t?void 0:t.kind)?"v4a":e},t.isV4ConnectEvent=function(e){return Object.prototype.hasOwnProperty.call(e,"connectparams")},t.adaptUrl=function(e,t){return"v4a"===t?e.replace(/\/v4\/c\b/,"/v4/a").replace("wss://","https://").replace("ws://","http://"):e.replace(/\/v4\/a\b/,"/v4/c").replace("https://","wss://").replace("http://","ws://")},t.reconnectParamsWithoutUrls=function(e){if(void 0!==e)return r(r({},e),{reconnectUrl:void 0,serviceUrl:void 0})},t.ensureNumber=function(e){return"string"==typeof e?parseInt(e,10):e},t.redirectUrlIfPresent=function(e){if("redirect"===(null==e?void 0:e.kind)&&void 0!==e.host){var t=e.host;return t.endsWith("/")&&(t=t.substring(0,t.length-1)),t.endsWith("/v4/c")||t.endsWith("/v4/a")||(t+="/v4/c"),t}}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.TrouterFsm=t.State=void 0;var r,i,o=n(4),s=n(0),a=n(5);!function(e){e[e.Initial=0]="Initial",e[e.RetrievingToken=1]="RetrievingToken",e[e.Allocating=2]="Allocating",e[e.Handshaking=3]="Handshaking",e[e.Connecting=4]="Connecting",e[e.AnonymousConnecting=5]="AnonymousConnecting",e[e.WebsocketAuthenticating=6]="WebsocketAuthenticating",e[e.Connected=7]="Connected",e[e.Unregistering=8]="Unregistering",e[e.TerminalError=9]="TerminalError"}(r||(t.State=r={})),function(e){e[e.Initial=0]="Initial",e[e.Registering=1]="Registering",e[e.RegisteringButResendPending=2]="RegisteringButResendPending",e[e.Retrying=3]="Retrying",e[e.Registered=4]="Registered",e[e.RegistrationDisabled=5]="RegistrationDisabled"}(i||(i={}));var c=function(){function e(e,t,n,o){this.worker=t,this.incallModeEnabled=n,this.protocolSelector=o,this.state=r.Initial,this.autoReconnect=!0,this.logger=new s.Logger("ConnectionFsm",e),this.registrationState=i.Initial}return e.prototype.getState=function(){return this.state},e.prototype.isActive=function(){return this.state===r.Allocating||this.state===r.Connected||this.state===r.Handshaking||this.state===r.Connecting||this.state===r.RetrievingToken||this.state===r.AnonymousConnecting||this.state===r.WebsocketAuthenticating},e.prototype.isConnecting=function(){return this.state===r.Allocating||this.state===r.Handshaking||this.state===r.Connecting||this.state===r.AnonymousConnecting},e.prototype.start=function(){return this.state===r.Initial?(this.setState(r.RetrievingToken),this.worker.getToken(!0,!1,void 0),!0):(this.showIgnored("start"),!1)},e.prototype.stop=function(e,t){e&&(this.registrationState=i.Initial),this.worker.isIncallMode()&&this.worker.exitIncallMode(),this.worker.resetTokenBackoff(),this.worker.cancelPendingRegistrationRequests(),this.worker.stopConnectionTimer(),this.worker.stopPingTimer(),this.worker.clearSentEventTimers(),this.worker.stopRegistrationTimer(),this.worker.stopSocketIo(),this.state===r.Connected&&this.worker.sendDisconnectTelemetryEvent("connection stopped"),this.registrationState!==i.Registered&&this.registrationState!==i.Registering&&this.registrationState!==i.RegisteringButResendPending||this.state===r.Unregistering?t?(this.setState(r.TerminalError),this.worker.dispatchTerminalError()):(this.setState(r.Initial),this.worker.dispatchDisconnected()):(this.registrationState=i.Initial,this.setState(r.Unregistering),this.worker.sendUnregisterRequest())},e.prototype.onTokenReceived=function(e,t,n){this.state===r.RetrievingToken?"v4c"===(0,a.usedProtocolAfterFallback)(this.protocolSelector(e.tokenType,n),t)?(this.setState(r.AnonymousConnecting),this.worker.startConnectionTimer(),this.worker.connectV4c(e,t)):(this.setState(r.Allocating),this.worker.startConnectionTimer(),this.worker.sendAllocateRequest(e)):this.showIgnored("onTokenReceived")},e.prototype.checkConnection=function(e){e&&this.onPingInterval()},e.prototype.onAllocationSucceed=function(e){return this.state===r.Allocating&&this.registrationState===i.Registered&&this.worker.dispatchUnregistered(),this.state===r.Allocating?(this.setState(r.Handshaking),this.registrationState=i.Initial,this.worker.startSocketIo(e),!0):(this.showIgnored("onAllocationSucceed"),!1)},e.prototype.onAllocationFailed=function(e,t){this.state===r.Allocating?this.cleanUpAndInitiateReconnect({backoff:!0,allowCachedToken:!e,claimsChallenge:t}):this.showIgnored("onAllocationFailed")},e.prototype.onV4cException=function(){this.state!==r.AnonymousConnecting&&this.state!==r.WebsocketAuthenticating||(this.logger.error("v4c exception, falling back to longpoll"),this.cleanUpAndInitiateReconnect({backoff:!0,allowCachedToken:!0,fallbackReason:{kind:"v4c-websocket-failure"}}))},e.prototype.onConnectingTimeout=function(){this.state===r.Allocating||this.state===r.Connecting||this.state===r.Handshaking||this.state===r.AnonymousConnecting||this.state===r.WebsocketAuthenticating?this.cleanUpAndInitiateReconnect({backoff:!1,allowCachedToken:!0}):this.showIgnored("onConnectingTimeout")},e.prototype.onConnecting=function(){this.state===r.Handshaking?this.setState(r.Connecting):this.showIgnored("onConnecting")},e.prototype.onSocketConnect=function(e){this.state===r.AnonymousConnecting?(this.setState(r.WebsocketAuthenticating),this.worker.sendV4cAuthenticationEvent(e)):this.showIgnored("onSocketConnect")},e.prototype.onConnectingFailed=function(){this.state===r.Connecting?this.onConnectingTimeout():this.state===r.Handshaking?(this.logger.error("Unexpected error in Socket.io - no valid transports"),this.onConnectingTimeout()):this.state===r.AnonymousConnecting||this.state===r.WebsocketAuthenticating?(this.logger.info("/v4/c falling back to longpoll"),this.cleanUpAndInitiateReconnect({backoff:!0,allowCachedToken:!0,fallbackReason:{kind:"v4c-websocket-failure"}})):this.showIgnored("onConnectingFailed")},e.prototype.onSocketDisconnect=function(e){this.state===r.Handshaking||this.state===r.Connected||this.state===r.WebsocketAuthenticating?(this.state===r.Connected&&this.worker.sendDisconnectTelemetryEvent(null==e?void 0:e.toTelemetryString()),this.state===r.WebsocketAuthenticating&&this.worker.countDisconnectBeforeConnectionEstablishment(),"skypetoken-deprecated"===(null==e?void 0:e.reason)?(this.logger.error("Skypetoken deprecated response, not retrying any further"),this.onTerminalError()):this.cleanUpAndInitiateReconnect({backoff:this.state!==r.Connected&&"dup"!==(null==e?void 0:e.reason),allowCachedToken:"unauthorized"!==(null==e?void 0:e.reason),claimsChallenge:null==e?void 0:e.claims})):this.showIgnored("onSocketDisconnect")},e.prototype.onTrouterConnected=function(){this.state===r.Connecting||this.state===r.WebsocketAuthenticating?(this.setState(r.Connected),this.worker.resetTokenBackoff(),this.worker.stopConnectionTimer(),this.worker.sendUserActivityState(o.UserActivityEventReason.Connected,!0),this.worker.startPingTimer(),this.worker.dispatchConnected(),this.worker.shouldSkipRegistration()?(this.registrationState=i.RegistrationDisabled,this.worker.dispatchRegistered()):(this.registrationState=i.Registering,this.worker.sendRegisterRequest())):this.showIgnored("onTrouterConnected")},e.prototype.onReconnectRequired=function(e,t,n){this.state===r.AnonymousConnecting||this.state===r.WebsocketAuthenticating?void 0===n||"host"!==n.target||void 0===n.url||""===n.url?(this.logger.error("unexpected reconnect arguments: ".concat(null==n?void 0:n.target," ").concat(null==n?void 0:n.url,", reconnecting without cache")),this.cleanUpAndInitiateReconnect({backoff:!0,allowCachedToken:!0,fallbackReason:{kind:"redirect-no-host"}})):this.cleanUpAndInitiateReconnect({backoff:!0,allowCachedToken:!0,fallbackReason:{kind:"redirect",host:n.url}}):this.worker.dispatchReconnectIsRequired(e,t)},e.prototype.disableAutoReconnect=function(){this.autoReconnect=!1},e.prototype.onDownstreamRequest=function(e){this.state===r.Connected?(this.switchToIncallModeIfEnabled(),this.worker.dispatchDownstreamRequest(e)):this.showIgnored("onDownstreamRequest")},e.prototype.onTrouterMessageLost=function(e){this.state===r.Connected?this.worker.dispatchTrouterMessageLost(e):this.showIgnored("onTrouterMessageLost")},e.prototype.onPingInterval=function(){this.state===r.Connected?this.worker.sendPingRequest():this.showIgnored("onPingInterval")},e.prototype.onPingResponseTimeout=function(){this.onMissedResponse("onPingResponseTimeout")},e.prototype.onPingResponse=function(){this.state===r.Connected||this.showIgnored("onPingResponse")},e.prototype.onRegistrationFailed=function(){this.state===r.Connected&&this.registrationState===i.Registering?(this.worker.dispatchUnregistered(),this.registrationState=i.Retrying,this.worker.startRegistrationRetryTimer()):this.state===r.Connected&&this.registrationState===i.RegisteringButResendPending?(this.registrationState=i.Registering,this.worker.sendRegisterRequest()):this.showIgnored("onRegistrationFailed")},e.prototype.onRetryRegistration=function(){this.state===r.Connected&&this.registrationState===i.Retrying?(this.registrationState=i.Registering,this.worker.sendRegisterRequest()):this.showIgnored("onRetryRegistration")},e.prototype.onRegistrationSucceeded=function(){this.state===r.Connected&&this.registrationState===i.Registering?(this.registrationState=i.Registered,this.worker.dispatchRegistered(),this.worker.startRegistrationTimer()):this.state===r.Connected&&this.registrationState===i.RegisteringButResendPending?(this.registrationState=i.Registering,this.worker.sendRegisterRequest()):this.showIgnored("onRegistrationSucceeded")},e.prototype.onRegistrationNearExpiry=function(){this.state===r.Connected&&this.registrationState===i.Registered?(this.registrationState=i.Registering,this.worker.sendRegisterRequest()):this.showIgnored("onRegistrationNearExpiry")},e.prototype.onUnregistrationDone=function(){this.state===r.Unregistering?(this.setState(r.Initial),this.worker.dispatchUnregistered(),this.worker.dispatchDisconnected()):this.showIgnored("onUnregistrationDone")},e.prototype.onResendRegistration=function(){this.worker.dispatchUnregistered(),this.state===r.Connected&&this.registrationState===i.Registered?(this.registrationState=i.Registering,this.worker.stopRegistrationTimer(),this.worker.sendRegisterRequest()):this.state===r.Connected&&this.registrationState===i.Registering&&(this.registrationState=i.RegisteringButResendPending)},e.prototype.onIncallModeTimer=function(){this.worker.exitIncallMode(),this.state===r.Connected?(this.worker.stopPingTimer(),this.worker.startPingTimer()):this.showIgnored("onIncallModeTimer")},e.prototype.onSetNewUserActivityState=function(){this.worker.sendUserActivityState(o.UserActivityEventReason.Modified,this.state===r.Connected)},e.prototype.onActivityStateResponseTimeout=function(){this.onMissedResponse("onActivityStateResponseTimeout")},e.prototype.forceReconnect=function(e){this.state===r.Connected&&this.worker.sendDisconnectTelemetryEvent(e),this.worker.resetTokenBackoff(),this.cleanUpAndInitiateReconnect({backoff:!1,allowCachedToken:!0})},e.prototype.onTerminalError=function(){this.logger.error("Cannot proceed, reached terminal state. Switching from state '".concat(r[this.state],"' to ").concat(r[r.TerminalError])),this.stop(!0,!0),this.setState(r.TerminalError)},e.prototype.onMissedResponse=function(e){this.state===r.Connected?(this.worker.sendDisconnectTelemetryEvent(e),this.cleanUpAndInitiateReconnect({backoff:!1,allowCachedToken:!0})):this.showIgnored(e)},e.prototype.showIgnored=function(e){this.logger.debug("Ignoring event '".concat(e,"' in state '").concat(r[this.state],"'"))},e.prototype.setState=function(e){this.logger.info("Switching from state '".concat(r[this.state],"' to state '").concat(r[e],"'")),this.state!==e?this.state=e:this.logger.error("Attempt to switch to the current state '".concat(r[e],"'"))},e.prototype.switchToIncallModeIfEnabled=function(){this.incallModeEnabled&&(this.worker.isIncallMode()||(this.worker.enterIncallMode(),this.worker.stopPingTimer(),this.worker.startPingTimer()),this.worker.restartIncallModeTimer())},e.prototype.cleanUpAndInitiateReconnect=function(e){if(!this.autoReconnect)return this.logger.info("Automatic reconnect is disabled, stopping this connection"),void this.stop(!0);this.worker.cancelPendingRegistrationRequests(),this.worker.stopConnectionTimer(),this.worker.stopPingTimer(),this.worker.clearSentEventTimers(),this.worker.stopRegistrationTimer(),this.worker.stopSocketIo(),this.setState(r.RetrievingToken),this.worker.dispatchReconnecting(),this.worker.getToken(e.allowCachedToken,e.backoff,e.claimsChallenge,e.fallbackReason)},e}();t.TrouterFsm=c},function(e,t,n){function r(e,t){var n=t?void 0:{"X-MS-Migration":"True"};switch(e.tokenType.toLowerCase()){case"skype":return s({"X-Skypetoken":e.token},n);case"aad":case"cae":return s({Authorization:"Bearer ".concat(e.token)},n);default:throw new Error("unsupported token type: ".concat(e.tokenType))}}function i(e){return"object"==typeof e&&null!==e&&void 0!==e.stack?(0,d.toJson)(e.stack):'"(no error.stack)"'}function o(e){return"object"==typeof e&&null!==e&&"string"==typeof e.message?e.message:"(no error.message)"}var s=this&&this.__assign||function(){return s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},s.apply(this,arguments)},a=this&&this.__awaiter||function(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?n(e.value):i(e.value).then(s,a)}c((r=r.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;a&&(a=0,n[0]&&(c=0)),c;)try{if(i=1,o&&(s=2&n[0]?o.return:n[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(s=(s=c.trys).length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){c.label=n[1];break}if(6===n[0]&&c.label<s[1]){c.label=s[1],s=n;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(n);break}s[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,s,a,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(t,"__esModule",{value:!0}),t.TrouterConnection=t.ReconnectReason=void 0;var u,l=n(21),d=n(3),h=n(15),p=n(1),f=n(16),g=n(17),m=n(2),v=n(4),y=n(0),C=n(5),S=n(6),T=n(12),E=function(){this.cv=p.CLIENT_VERSION,this.ua="",this.hr="",this.v=""},b=function(){function e(){this["force new connection"]=!0,this.reconnect=!1,this.query="",this.ackTimeoutMs=5e3}return e.prototype.rewriteUrlForProxy=function(e){return e},e}(),I="MS-CV",w=function(){function e(e,t){this.logger=t,this.cvCounter=0;var n=JSON.parse(e);this.startTS=this.safeJsonNumber(n,"startTS",0),this.url=this.safeJsonString(n,"url",""),this.shortUrl=this.safeJsonString(n,"shortUrl",""),this.body=this.safeJsonString(n,"body",""),this.headers=this.safeJsonRecord(n,"headers",{}),this.id=this.safeJsonNumber(n,"id",-1),this.method=this.safeJsonString(n,"method",""),this.replied=!1,this.timedout=!1,this.receivedCv=this.headers[I],this.updateCvHeader()}return Object.defineProperty(e.prototype,"correlationVector",{get:function(){return this.receivedCv?"".concat(this.receivedCv,".").concat(this.cvCounter):""},enumerable:!1,configurable:!0}),e.prototype.on=function(e,t){"data"===e?this.dataCallback=t:"end"===e&&("function"==typeof this.dataCallback&&this.dataCallback(this.body),t())},e.prototype.incrementCorrelationVector=function(){++this.cvCounter,this.updateCvHeader()},e.prototype.updateCvHeader=function(){var e=this.correlationVector;e&&(this.headers[I]=e)},e.prototype.safeJsonNumber=function(e,t,n){var r;if(null!=e&&Object.prototype.hasOwnProperty.call(e,t)){var i=e;if("number"==typeof i[t])return i[t];if("string"==typeof i[t])return parseFloat(i[t]);null===(r=this.logger)||void 0===r||r.warn("unexpected type of '".concat(t,"': ").concat(typeof i[t]))}return n},e.prototype.safeJsonString=function(e,t,n){var r;if(null!=e&&Object.prototype.hasOwnProperty.call(e,t)){var i=e;if("string"==typeof i[t])return i[t];null===(r=this.logger)||void 0===r||r.warn("unexpected type of '".concat(t,"': ").concat(typeof i[t]))}return n},e.prototype.safeJsonRecord=function(e,t,n){var r;if(null!=e&&Object.prototype.hasOwnProperty.call(e,t)){var i=e;if("object"==typeof i[t])return i[t];null===(r=this.logger)||void 0===r||r.warn("unexpected type of '".concat(t,"': ").concat(typeof i[t]))}return n},e}(),R=function(){function e(e,t,n){this.request=e,this.responseData=t,this.sendResponse=n}return e.prototype.writeHead=function(e,t){this.responseData.status=e,this.responseData.headers=t},e.prototype.write=function(e){this.responseData.body+=e},e.prototype.end=function(e){return e&&(this.responseData.body+=e),this.sendResponse(this.request,this.responseData)},e}(),A=function(e){this.name=e,this.args={},this.timeoutTimerId=0};!function(e){e[e.Configuration=0]="Configuration",e[e.ServerInitiated=1]="ServerInitiated"}(u||(t.ReconnectReason=u={}));var O=function(){function e(e,t,n,r,i,o,s,a){var c,u=this;this.options=t,this.manager=n,this.tokenProvider=r,this.usingLegacyTokenApi=i,this.protocolSelector=s,this.audienceSubscriptionState=a,this.WEBSOCKET_TRANSPORT_NAME="websocket",this.XHR_POLLING_TRANSPORT_NAME="xhr-polling",this.AUDIENCE_SUBSCRIPTION_RESULT_ERROR="Error",this.AUDIENCE_SUBSCRIPTION_RESULT_UNSUBSCRIBED="Unsubscribed",this.AUDIENCE_SUBSCRIPTION_RESULT_TIMEOUT="Timeout",this.AUDIENCE_SUBSCRIPTION_RESULT_BAD_REQUEST="BadRequest",this.AUDIENCE_SUBSCRIPTION_STATE_QUERY_PARAM_REGEX=/&audienceSubscriptionState=[^&]*|^audienceSubscriptionState=[^&]*&?/,this.connectionId="",this.inIncallMode=!1,this.connectionAttempt=0,this.connectedClientId="",this.isNavigatorOnline=!0,this.onNavigatorOnlineStatusUpdateBound=this.onNavigatorOnlineStatusUpdate.bind(this),this.c2cUrlBase="",this.connectingErrorsInRow=0,this.unauthorizedErrorCount=0,this.pendingSentEventTimers={},this.lastDisconnectReason="",this.UNKNOWN_TRANSPORT="unknown_transport",this.connectingErrorsThreshold=3,this.pendingAudienceSubscription=void 0,this.logger=new y.Logger("Connection",e),this.timeoutOptions=this.options.timeoutOptions,this.tokenBackoff=new g.ExponentialBackoff(this.logger,this.timeoutOptions.maxBackoffMs),this.clientID=Date.now(),"undefined"!=typeof window&&window.location&&(this.domId=window.location.hostname);var d=new E;d.cv=p.CLIENT_VERSION,d.ua="",(null===(c=this.options)||void 0===c?void 0:c.clientInfo)&&(d.ua=this.safeString(this.options.clientInfo.ua),d.v=this.safeString(this.options.clientInfo.v)),this.clientInfo=d,this.connectionTracker=new h.ConnectionTracker(e,this.clientID,this.clientInfo,function(){return u.getServerState()},this.options.endpointId,this.options.clientCorrelationID,this.options.environment),this.applyConnectionTrackerOptions(t);var f=this.options.incallModeTimeoutMs>0;if(this.fsm=new S.TrouterFsm(e,this,f,this.protocolSelector),t.registration){var m={registrarUrl:t.registration.registrarUrl,proxyUrlRewrite:t.rewriteUrlForProxy,registrationId:t.registration.registrationId,requestTimeoutMs:t.timeoutOptions.fetchTimeoutMs,initialRetryDelayMs:1e3,maxRetryDelayMs:t.timeoutOptions.maxBackoffMs,usingLegacyTokenApi:this.usingLegacyTokenApi,maxRetriesForGetToken:t.retryLimitOnTokenFetch,extraRegistrationHeaders:t.extraConnectionHeaders};this.registrarClient=(0,l.createRegistrarClient)(e,this.tokenProvider,m)}this.userActivityState=o}return e.prototype.start=function(e){this.logger.info("Starting"),this.reconnectParams=e,"undefined"!=typeof window&&window.navigator&&window.addEventListener?(this.isNavigatorOnline=window.navigator.onLine,window.addEventListener("online",this.onNavigatorOnlineStatusUpdateBound),window.addEventListener("offline",this.onNavigatorOnlineStatusUpdateBound),this.logger.debug("Registered for browser online notifications - current state: ".concat(this.isNavigatorOnline))):this.isNavigatorOnline=!0,this.fsm.start()},e.prototype.stop=function(e){this.logger.info("Stopping"),"undefined"!=typeof window&&window.navigator&&(window.removeEventListener("online",this.onNavigatorOnlineStatusUpdateBound),window.removeEventListener("offline",this.onNavigatorOnlineStatusUpdateBound)),this.fsm.stop(e),this.connectionTracker.close()},e.prototype.configure=function(e){var t=this.options.trouterUrl!==e.trouterUrl;this.options=e,this.applyConnectionTrackerOptions(e),t&&(this.logger.info("Configuration changed. Reconnection required."),this.fsm.onReconnectRequired(!1,u.Configuration))},e.prototype.checkConnection=function(e){this.logger.info("checkConnection called with ".concat(e)),this.fsm.checkConnection(e),e&&this.connectionTracker.sendTelemetry(h.ClientEventName.CheckConnection,{disconnectDetected:e},[])},e.prototype.disableRegistrationsAndAutoReconnect=function(){this.stopRegistrationTimer(),this.cancelPendingRegistrationRequests(),this.fsm.disableAutoReconnect()},e.prototype.getServerState=function(){return new v.ServerState(this.connectionId,this.connectedClientId,this.domId?this.domId:"",this.allocateResult?this.allocateResult.url:"",this.allocateResult?this.allocateResult.surl:"",this.c2cUrlBase,this.connectionExpireTimestampInSecs)},e.prototype.getState=function(){return this.fsm.getState()},e.prototype.getToken=function(e,t,n,r,i){var o=this;void 0===i&&(i=0),this.logger.info("Getting token ".concat(t?"with backoff":"without backoff"));var s=function(){o.connectionTracker.trackStart("token");var t={needFresh:!e,wwwAuthenticateHeader:n,supportedTokenTypes:p.SUPPORTED_TOKEN_TYPES,purpose:"trouter"};o.logger.info("Requesting token: needFresh=".concat(t.needFresh," ")+"types=[".concat(p.SUPPORTED_TOKEN_TYPES,"], ")+"wwwAuthenticateHeader is ".concat(t.wwwAuthenticateHeader?"non empty":"empty")),o.tokenProvider(t).then(function(e){o.logger.debug("".concat(e.tokenType," token is received")),o.connectionTracker.trackEnd("token"),o.fsm.onTokenReceived(e,r,o.reconnectParams)}).catch(function(t){var s=(0,d.toJson)(t.stack);if(o.logger.error("Getting token failed, will retry after timeout. Error: ".concat(s)),o.connectionTracker.trackError("token",s),!o.canRetryTokenFetchRequest(i+o.unauthorizedErrorCount))return o.connectionTracker.trackError("token","getToken retry limit hit, reached terminal error state"),o.resetTokenBackoff(),void o.fsm.onTerminalError();o.getToken(e,!0,n,r,i+1)})};t?this.tokenBackoff.backoff("getting token",s):(this.resetTokenBackoff(),s())},e.prototype.startConnectionTimer=function(){var e=this;this.stopConnectionTimer(),this.logger.debug("Starting connection timeout for ".concat(this.timeoutOptions.connectionTimeoutMs," ms")),this.connectionTimeoutId=setTimeout(function(){e.logger.info("Connection timeout is fired"),e.fsm.onConnectingTimeout()},this.timeoutOptions.connectionTimeoutMs)},e.prototype.stopConnectionTimer=function(){this.connectionTimeoutId&&(this.logger.debug("Stopping connection timeout"),clearTimeout(this.connectionTimeoutId),this.connectionTimeoutId=void 0)},e.prototype.startPingTimer=function(){var e=this;"websocket"===this.transportTypeName?(this.logger.debug("Starting ping timeout for ".concat(this.timeoutOptions.pingTimeoutMs," ms")),this.pingTimerId=setInterval(function(){e.logger.info("Ping interval fired"),e.fsm.onPingInterval()},this.timeoutOptions.pingTimeoutMs)):this.logger.debug("Not starting ping for transport ".concat(this.transportTypeName))},e.prototype.stopPingTimer=function(){this.pingTimerId&&(this.logger.debug("Stopping ping timeout"),this.clearPingResponseTimer(),clearInterval(this.pingTimerId),this.pingTimerId=void 0)},e.prototype.shouldSkipRegistration=function(){return void 0===this.options.registration},e.prototype.hasCustomRegistrationTtl=function(){var e,t;return void 0!==(null===(e=this.options.registration)||void 0===e?void 0:e.registrarTtlSec)&&0!==(null===(t=this.options.registration)||void 0===t?void 0:t.registrarTtlSec)},e.prototype.startRegistrationTimer=function(){var e=this;this.stopRegistrationTimer();var t=this.getRegistrationTtl(),n=t[0],r=t[1];if(n<=30||!r)return this.logger.debug("Starting registration expiration timer (TTL ".concat(n," sec)")),void(this.registrationTimerId=setTimeout(function(){e.registrationTimerId=void 0,e.logger.warn("Registration expired but the connection is still alive. Should never happen"),e.dispatchUnregistered()},1e3*n));var i=n-30;this.logger.debug("Starting registration extension timer for ".concat(i," sec")),this.registrationTimerId=setTimeout(function(){e.logger.info("Registration extension timer fired"),e.registrationTimerId=setTimeout(function(){e.registrationTimerId=void 0,e.logger.debug("Registration extension did not happen in time"),e.dispatchUnregistered()},3e4),e.fsm.onRegistrationNearExpiry()},1e3*i)},e.prototype.startRegistrationRetryTimer=function(){var e=this;this.stopRegistrationTimer(),this.registrationTimerId=setTimeout(function(){e.registrationTimerId=void 0,e.fsm.onRetryRegistration()},123e3)},e.prototype.stopRegistrationTimer=function(){this.registrationTimerId&&(this.logger.debug("Stopping registration timeout"),clearTimeout(this.registrationTimerId),this.registrationTimerId=void 0)},e.prototype.resendRegistration=function(){if(!this.registrarClient)throw new Error("Trouter Client not configured to handle registrations");return this.fsm.onResendRegistration(),Promise.resolve()},e.prototype.buildSocketIoUrlParams=function(e,t){if(!this.allocateResult)throw new Error("Allocate result is undefined in buildSocketIoUrlParams()");for(var n={},r=this.allocateResult.connectparams,i=0,o=Object.keys(r);i<o.length;i++){var s=o[i];if(void 0!==r[s]){var a=r[s];"string"==typeof a||"number"==typeof a?n[s]=a:this.logger.error("signatureData[".concat(s,"] has unsupported type ").concat(typeof a))}}return n.v="v4",n.tc=encodeURI((0,d.toJson)(this.clientInfo)),n.timeout=this.timeoutOptions.pingTimeoutMs/1e3,n.auth="true",this.options.endpointId&&(n.epid=this.options.endpointId),e&&(n.userActivity=encodeURI((0,d.toJson)(e))),t&&(n.audienceSubscriptionState=encodeURIComponent((0,d.toJson)(t))),this.appendConnectedClientIds(this.buildQuery(n),!0)},e.prototype.startSocketIo=function(e){var t,n;if(this.logger.debug("Starting socket io"),this.connectionTracker.trackStart("connectSocket"),!this.allocateResult)throw new Error("Allocate result is undefined in startSocketIo()");var i=this.options.ioOptions?s({},this.options.ioOptions):new b,o=this.userActivityState.state!==m.UserActivityState.Unknown?this.userActivityState.increaseCvAndGetEventObject():void 0,a=null===(t=this.audienceSubscriptionState)||void 0===t?void 0:t.increaseCvAndGetEventObject();if(i["force new connection"]=!0,i.reconnect=!1,i.rewriteUrlForProxy=this.options.rewriteUrlForProxy,i.requestHeaders=s(s({},this.options.extraConnectionHeaders),r(e,this.usingLegacyTokenApi)),i.query=this.buildSocketIoUrlParams(o,a),this.logger.info("connecting to ".concat(this.allocateResult.socketio,"?").concat(i.query)),this.stopSocketIo(),this.socket=(null!==(n=this.options.io)&&void 0!==n?n:T).connect(this.allocateResult.socketio,i),void 0===this.socket)throw new Error("Can't create Socket.io object");this.attachSocketIoHandlers(this.socket,e,o,a)},e.prototype.stopSocketIo=function(){if(this.socket){this.logger.debug("clearing socket.io");try{for(var e=0,t=["connecting","connect","connect_failed","close_during_connecting","disconnect","reconnect","reconnect_failed","reconnecting","error","message","trouter.connected","trouter.reconnect","trouter.message_loss"];e<t.length;e++){var n=t[e];this.socket.removeAllListeners(n)}this.socket.disconnect(),this.logger.debug("cleared socket"),this.socket=void 0}catch(e){this.logger.error("exception in disconnecting previous socket. Error: ".concat(i(e)))}}},e.prototype.dispatchConnected=function(){this.logger.info("dispatching connected"),this.manager.onConnected(this)},e.prototype.dispatchRegistered=function(){this.logger.info("dispatching registered"),this.manager.onRegistered(this)},e.prototype.dispatchUnregistered=function(){this.logger.info("dispatching unregistered"),this.manager.onUnregistered(this)},e.prototype.dispatchDownstreamRequest=function(e){var t=this;this.logger.debug("dispatching downstream request");try{var n=new R(e,new h.ResponseData(e.id),function(e,n){return t.logger.debug("sending response to downstream"),t.sendResponse(e,n)});this.manager.onDownstreamRequest(this,e,n)}catch(e){this.logger.error("exception in socket.on message. Error : ".concat(i(e)))}},e.prototype.dispatchReconnecting=function(){this.logger.info("dispatching reconnecting"),this.manager.onReconnecting(this)},e.prototype.dispatchReconnectIsRequired=function(e,t){this.logger.info("dispatching reconnect is required by server"),this.manager.onReconnectIsRequired(this,e,t)},e.prototype.dispatchDisconnected=function(){this.logger.info("dispatching disconnected"),this.manager.onDisconnected(this)},e.prototype.dispatchTerminalError=function(){this.logger.info("dispatching terminal error"),this.manager.onTerminalError(this)},e.prototype.dispatchTrouterMessageLost=function(e){this.logger.info("dispatching trouter message lost"),this.manager.onTrouterMessageLost(e)},e.prototype.countDisconnectBeforeConnectionEstablishment=function(){this.logger.warn("counting disconnect before connection was fully established as a connection failure"),++this.connectingErrorsInRow>=this.connectingErrorsThreshold&&this.resetReconnectParamsOnErrorThreshold()},e.prototype.sendProcessedDroppedIndicators=function(e){var t=this;try{this.logger.debug("emitting processed flow tags to the server");var n=new A("trouter.processed_message_loss");n.args={droppedIndicators:e},this.sendDownstreamEvent(n,function(){t.logger.info("emitted processed flow tags to the server")})}catch(e){var r=i(e);this.logger.error("unable to send processed message loss event. Error: ".concat(r)),this.connectionTracker.trackError("trouter.processed_message_loss",r,!1)}},e.prototype.sendAllocateRequest=function(e){var t=this;this.connectionAttempt++,this.connectionTracker.trackNewConnection();var n,i=this.options.trouterUrl,o=this.reconnectParams,a="string"==typeof(null==o?void 0:o.se)?parseInt(o.se,10):"number"==typeof(null==o?void 0:o.se)?o.se:void 0;a&&a<=Date.now()+36e5&&(this.logger.warn("Dropping expired cached connection parameters: ".concat(new Date(a))),this.reconnectParams=o=void 0),o&&o.serviceUrl!==i&&(this.logger.warn("Dropping cached connection parameters for a different environment (".concat(o.serviceUrl,", now ").concat(i,")")),this.reconnectParams=o=void 0),(null==o?void 0:o.reconnectUrl)&&(i=o.reconnectUrl),n=o?s(s({},o),{serviceUrl:void 0,reconnectUrl:void 0}):null,i=(0,C.adaptUrl)(i,"v4a"),i=this.appendCorrelationIds(i,!1),i=this.appendEndpointId(i,!1),n&&(i+="&".concat(this.buildQuery(n)),n.v||(i+="&v=".concat("v4"))),i=this.options.rewriteUrlForProxy(i);var c=new Request(i,{method:"POST",mode:"cors",headers:new Headers(s(s({"Content-Type":"text/plain"},this.options.extraConnectionHeaders),r(e,this.usingLegacyTokenApi)))});this.logger.info("sendAllocateRequest: POST ".concat(i)),this.connectionTracker.trackStart("allocation");var u,l=Date.now(),h=-1,p=!1;(0,d.fetchWithTimeout)(c,this.timeoutOptions.fetchTimeoutMs).then(function(e){var n;if(h=e.status,!e.ok)throw u=null!==(n=e.headers.get("www-authenticate"))&&void 0!==n?n:void 0,p="1"===e.headers.get("x-trouter-skypetoken-deprecated"),t.logger.warn("Allocation request got response status ".concat(e.status,", www-authenticate header was ").concat(u?"not empty":"empty")),new Error(e.statusText);var r=e.headers.get("content-type");if(!r||"application/json"!==r&&!r.startsWith("application/json;"))throw new Error("Content-type '".concat(r,"' is unexpected"));return t.connectionTracker.trackEnd("allocation"),e.json()}).then(function(n){t.unauthorizedErrorCount=0,t.onAllocationResponse(n,e)}).catch(function(e){t.connectingErrorsInRow++;var n="".concat(e).concat(h>=0?", status code ".concat(h):"");if(t.logger.error("".concat(t.connectingErrorsInRow," failed connecting attempt(s) in a row. ").concat(n)),t.connectionTracker.trackError("allocation",n),p){var r="Skypetoken deprecated response, not retrying any further";return t.logger.error(r),t.connectionTracker.trackError("allocation",r),void t.fsm.onTerminalError()}if(401===h&&t.unauthorizedErrorCount++,!t.canRetryTokenFetchRequest(t.unauthorizedErrorCount))return r="getToken retry limit hit, reached terminal error state",t.connectionTracker.trackError("allocation",r),void t.fsm.onTerminalError();if(-1!==h||t.isNavigatorOnline){if(t.reconnectParams&&t.connectingErrorsInRow>=t.connectingErrorsThreshold)if(h>=400&&h<=599)t.resetReconnectParamsOnErrorThreshold();else if(t.reconnectParams.reconnectUrl&&t.connectingErrorsInRow%3==0){t.logger.warn("".concat(t.connectingErrorsInRow," connection attempts, testing nominal service URL"));var i=Math.min(t.timeoutOptions.connectionTimeoutMs-(Date.now()-l)-500,t.timeoutOptions.fetchTimeoutMs);return void t.testNominalUrlConnectivity(i).then(function(e){t.connectionTracker.trackProgress("nomcheck",e?"ok":"failed"),e?(t.logger.warn("Nominal service URL is reachable, erasing cached reconnect URL"),t.reconnectParams&&delete t.reconnectParams.reconnectUrl):t.logger.warn("Nominal service URL is not reachable either, keeping cached reconnect URL"),t.fsm.onAllocationFailed(!1,void 0)},function(){t.fsm.onAllocationFailed(!1,void 0)})}}else t.logger.info("Expected failure, the browser says it is not online at the moment");t.fsm.onAllocationFailed(401===h,u)})},e.prototype.testNominalUrlConnectivity=function(e){var t,n=this;if(e<1e3)return this.logger.warn("There is no time left to reasonably perform the nominal service URL connectivity check (".concat(e," ms), falling back to assuming that the connectivity is fine")),Promise.resolve(!0);try{var r=new URL(this.options.trouterUrl);r.pathname="/",r.search="?"+this.buildQuery({check:Date.now(),cor_id:encodeURIComponent(this.options.clientCorrelationID),epid:encodeURIComponent(this.options.endpointId?this.options.endpointId:""),tc:encodeURIComponent((0,d.toJson)(this.clientInfo))}),t=new Request(this.options.rewriteUrlForProxy(r.toString()),{method:"GET",headers:{Accept:"text/plain"}})}catch(e){return this.logger.warn("Nominal service URL connectivity test request could not be created (".concat(e,"), falling back to assuming that the connectivity is fine")),Promise.resolve(!0)}return(0,d.fetchWithTimeout)(t,e).then(function(e){if(200!==e.status)throw new Error("Not 200 OK: ".concat(e.status," ").concat(e.statusText));return e.text()}).then(function(e){if("Trouter"!==e)throw new Error('Not "Trouter": '.concat(e.substring(0,16)).concat(e.length>16?"...":""));return!0}).catch(function(e){return n.logger.error("Nominal service URL connectivity test failed: ".concat(e)),!1})},e.prototype.sendPingRequest=function(){var e=this;if(this.socket&&void 0===this.pingResponseTimerId)try{this.logger.debug("emitting ping event");var t=!1;this.socket.emit("ping",function(){!0!==t&&e.onPingResponse()}),this.pingResponseTimerId=setTimeout(function(){e.logger.error("Ping response timeout is fired"),t=!0,e.clearPingResponseTimer(),e.fsm.onPingResponseTimeout()},this.timeoutOptions.pongTimeoutMs)}catch(e){var n=i(e);this.logger.error("unable to send ping. Error: ".concat(n)),this.connectionTracker.trackError("ping",n,!1)}},e.prototype.connectV4c=function(e,t){var n,r,i,o,a,c,u=this.options.ioOptions?s({},this.options.ioOptions):new b;u["force new connection"]=!0,u.reconnect=!1,(null===(n=this.reconnectParams)||void 0===n?void 0:n.serviceUrl)&&(0,C.adaptUrl)(this.reconnectParams.serviceUrl,"v4c")!==(0,C.adaptUrl)(this.options.trouterUrl,"v4c")&&(this.logger.warn("Dropping cached connection parameters for a different environment (".concat(this.reconnectParams.serviceUrl,", now ").concat(this.options.trouterUrl,")")),this.reconnectParams=void 0);var l=null!==(o=null!==(r=(0,C.redirectUrlIfPresent)(t))&&void 0!==r?r:"redirect-no-host"!==(null==t?void 0:t.kind)?null===(i=this.reconnectParams)||void 0===i?void 0:i.reconnectUrl:void 0)&&void 0!==o?o:this.options.trouterUrl,d=(0,C.adaptUrl)(l,"v4c");u["skipped handshake data"]={timeout:70,websocketUrl:d},u.query=this.buildV4cUrlParams(),u.rewriteUrlForProxy=this.options.rewriteUrlForProxy;try{if(this.stopSocketIo(),this.transportTypeName="websocket",this.socket=(null!==(a=this.options.io)&&void 0!==a?a:T).connect(this.options.trouterUrl,u),void 0===this.socket)throw new Error("failed to create Socket.io object");var h=null===(c=this.audienceSubscriptionState)||void 0===c?void 0:c.increaseCvAndGetEventObject();this.attachSocketIoHandlers(this.socket,e,void 0,h)}catch(e){this.logger.error("".concat(e)),this.connectionTracker.trackError("v4c","".concat(e)),this.fsm.onV4cException()}},e.prototype.sendV4cAuthenticationEvent=function(e){var t,n={headers:s(s({},this.options.extraConnectionHeaders),r(e,this.usingLegacyTokenApi)),connectparams:(0,C.reconnectParamsWithoutUrls)(this.reconnectParams)};null===(t=this.socket)||void 0===t||t.emit(p.USER_AUTHENTICATE_EVENT_NAME,n)},e.prototype.setUserActivityState=function(e){var t=e.state!==this.userActivityState.state;this.userActivityState=e,t?(this.logger.info("Changing user activity state to '".concat(e.toEventJSON(),"'")),this.fsm.onSetNewUserActivityState()):(this.logger.debug("Not changing the same user activity state '".concat(e.toEventJSON(),"'")),this.manager.onUserActivityStateAccepted(e.correlationVector.value()))},e.prototype.sendUserActivityState=function(e,t){this.userActivityState.state!==m.UserActivityState.Unknown&&("websocket"===this.transportTypeName&&t?e===v.UserActivityEventReason.Connected?this.sendUserActivityStateMultiple(2):this.sendUserActivityStateMultiple(1):"xhr-polling"===this.transportTypeName&&e===v.UserActivityEventReason.Modified&&this.fsm.forceReconnect("user activity/force reconnect"))},e.prototype.setAudienceSubscriptionsAsync=function(e,t){var n=this.audienceSubscriptionState;if(this.audienceSubscriptionState=e,this.transportTypeName===this.WEBSOCKET_TRANSPORT_NAME)return this.setAudienceSubscriptionsInternalAsync(e.increaseCvAndGetEventObject(),t);if(this.transportTypeName===this.XHR_POLLING_TRANSPORT_NAME){var r=this.setAudienceSubscriptionsLongpollInternalAsync(e.increaseCvAndGetEventObject(),t,n);return this.fsm.forceReconnect("set audience subscription force reconnect"),r}throw new Error("set audience subscription executed on an unknown transport")},e.prototype.setAudienceSubscriptionsUnsafeAsync=function(e){if(e)return this.transportTypeName===this.WEBSOCKET_TRANSPORT_NAME?this.setAudienceSubscriptionsInternalAsync(e,15e3):void 0},e.prototype.setAudienceSubscriptionsInternalAsync=function(e,t){return a(this,void 0,void 0,function(){var n,r,i=this;return c(this,function(o){switch(o.label){case 0:return this.logger.info("[WebSocket] Audience subscription set requested."),(n=new A("audience.subscribe")).args=e,[4,new Promise(function(r){var o=!1,s=setTimeout(function(){return o=!0,r(i.buildAudienceSubscriptionsTimeoutResponse(e))},t);i.sendDownstreamEvent(n,function(e,t){o||(clearTimeout(s),i.logger.debug("[Websocket] Audience subscription response: ".concat(t)),i.pendingAudienceSubscription&&i.onAudienceSubscriptionResult(t),r(t))})})];case 1:return r=o.sent(),this.manager.onAudiencesSetResolved(r,e.cv),[2,r]}})})},e.prototype.setAudienceSubscriptionsLongpollInternalAsync=function(e,t,n){var r;return a(this,void 0,void 0,function(){var i,o,s,a,u,l,d=this;return c(this,function(c){switch(c.label){case 0:return this.logger.info("[XHR Polling] Audience subscription set requested."),this.pendingAudienceSubscription&&(this.logger.error("Racing audience subscriptions occured. This situation resolves into undefined scenario and/or nasal demons."),clearTimeout(this.pendingAudienceSubscription.timeoutId)),0===e.audiences.length?[2,this.handleAudienceUnsubscribeLongpoll(e.cv,n)]:[4,new Promise(function(n){var r=setTimeout(function(){return d.pendingAudienceSubscription=void 0,n(d.buildAudienceSubscriptionsTimeoutResponse(e))},t);d.pendingAudienceSubscription={audienceSetResolve:n,timeoutId:r}})];case 1:return i=c.sent(),this.manager.getState()===m.TrouterState.Unknown||this.transportTypeName===this.WEBSOCKET_TRANSPORT_NAME?[2,i]:(null==(o=i.responses[0])?void 0:o.result.audienceSubscriptionState)===this.AUDIENCE_SUBSCRIPTION_RESULT_BAD_REQUEST?(this.clearAudienceSubscriptionStateQueryParam(),this.manager.onAudiencesSetResolved(i,e.cv),[2,i]):(s=i.responses.find(function(t){return t.audienceId===e.audiences[0].id}),(null==s?void 0:s.result.audienceSubscriptionState)===this.AUDIENCE_SUBSCRIPTION_RESULT_ERROR?(this.clearAudienceSubscriptionStateQueryParam(),this.manager.onAudiencesSetResolved(i,e.cv),[2,i]):(a=(null===(r=null==n?void 0:n.audienceSubscriptionModel.audienceSubscriptions[0])||void 0===r?void 0:r.id)!==(null==o?void 0:o.audienceId),n&&a&&(u=this.mapToSyntheticAudienceSubscriptionResponses(n.audienceSubscriptionModel.audienceSubscriptions,this.AUDIENCE_SUBSCRIPTION_RESULT_UNSUBSCRIBED,200),(l=i.responses).push.apply(l,u)),this.manager.onAudiencesSetResolved(i,e.cv),[2,i]))}})})},e.prototype.clearAudienceSubscriptionStateQueryParam=function(){var e,t,n;(null===(n=null===(t=null===(e=this.socket)||void 0===e?void 0:e.socket)||void 0===t?void 0:t.options)||void 0===n?void 0:n.query)&&(this.socket.socket.options.query=this.socket.socket.options.query.replace(this.AUDIENCE_SUBSCRIPTION_STATE_QUERY_PARAM_REGEX,""))},e.prototype.handleAudienceUnsubscribeLongpoll=function(e,t){var n;this.audienceSubscriptionState=void 0;var r={responses:[]};if(t){var i=this.mapToSyntheticAudienceSubscriptionResponses(t.audienceSubscriptionModel.audienceSubscriptions,this.AUDIENCE_SUBSCRIPTION_RESULT_UNSUBSCRIBED,200);(n=r.responses).push.apply(n,i)}return this.manager.onAudiencesSetResolved(r,e),r},e.prototype.buildAudienceSubscriptionsTimeoutResponse=function(e){return this.logger.error("Audience subscription attempt has timed out."),{responses:this.mapToSyntheticAudienceSubscriptionResponses(e.audiences,this.AUDIENCE_SUBSCRIPTION_RESULT_TIMEOUT)}},e.prototype.mapToSyntheticAudienceSubscriptionResponses=function(e,t,n){return e.map(function(e){return{audienceId:e.id,result:{audienceSubscriptionState:t,responseStatus:n}}})},e.prototype.expediteBackoff=function(){this.tokenBackoff.expediteIfPending()},e.prototype.sendRegisterRequest=function(){var e=this;if(!this.options.registration||!this.registrarClient)throw new Error("Internal error - options.registration is undefined");if(!this.allocateResult)throw new Error("Allocate result is undefined in sendRegisterRequest()");this.logger.info("sending register request");var t=new d.Timespan;this.connectionTracker.trackStart("registration");var n=this.getRegistrationTtl()[0];this.registrarClient.register({appId:this.options.registration.pnhAppId,aesKey:"",languageId:"en-US",platform:this.options.registration.platform,templateKey:this.options.registration.pnhTemplateKey,platformUIVersion:this.options.registration.platformUIVersion,productContext:this.options.registration.productContext},{TROUTER:[{context:this.options.registration.context,path:this.allocateResult.surl,ttl:n}]}).then(function(){e.logger.info("Register request successful"),e.connectionTracker.trackEnd("registration"),e.fsm.onRegistrationSucceeded(),e.connectionTracker.sendTelemetry(h.ClientEventName.Registration,{duration:t.duration},[])}).catch(function(n){e.logger.error("Register request failed. Error: ".concat(n)),e.connectionTracker.trackError("registration",o(n)),e.fsm.onRegistrationFailed(),e.connectionTracker.sendTelemetry(h.ClientEventName.Registration,{duration:t.duration},[])})},e.prototype.sendUnregisterRequest=function(){var e=this;this.logger.info("sending unregister request");var t=new d.Timespan;if(!this.options.registration||!this.registrarClient)throw new Error("Internal error - options.registration is undefined");this.connectionTracker.trackStart("unregistration"),this.registrarClient.unregister().then(function(){e.logger.info("Unregister request successful"),e.connectionTracker.trackEnd("unregistration"),e.fsm.onUnregistrationDone(),e.connectionTracker.sendTelemetry(h.ClientEventName.Unregistration,{duration:t.duration},[])}).catch(function(n){e.logger.error("Unregister request failed. Error: ".concat(n)),e.connectionTracker.trackError("unregistration",o(n)),e.fsm.onUnregistrationDone(),e.connectionTracker.sendTelemetry(h.ClientEventName.Unregistration,{duration:t.duration},[])})},e.prototype.resetTokenBackoff=function(){this.tokenBackoff.reset()},e.prototype.cancelPendingRegistrationRequests=function(){this.registrarClient&&this.registrarClient.cancelPendingRequests()},e.prototype.clearSentEventTimers=function(){var e=Object.keys(this.pendingSentEventTimers);if(e.length>0){this.logger.debug("Clearing all pending downstream events related timers");for(var t=0,n=e;t<n.length;t++){var r=n[t];this.clearSentEventTimer(Number(r))}}},e.prototype.restartIncallModeTimer=function(){var e=this;this.clearIncallModeTimerId(),this.logger.debug("Restarting incall mode timer"),this.incallModeTimerId=setTimeout(function(){e.logger.info("Call mode timer fired"),e.fsm.onIncallModeTimer()},this.options.incallModeTimeoutMs)},e.prototype.enterIncallMode=function(){this.logger.info("Entering incall mode"),this.timeoutOptions=this.options.incallTimeoutOptions,this.tokenBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs),this.inIncallMode=!0},e.prototype.exitIncallMode=function(){this.logger.info("Exiting incall mode"),this.clearIncallModeTimerId(),this.timeoutOptions=this.options.timeoutOptions,this.tokenBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs),this.inIncallMode=!1},e.prototype.isIncallMode=function(){return this.inIncallMode},e.prototype.sendDisconnectTelemetryEvent=function(e){var t={reason:e,serverClosed:!this.fsm.isActive()};this.connectionTracker.trackDisconnected(t),this.connectionTracker.clearConnectedInfo()},e.prototype.forceReconnectDueToNoRegistration=function(){this.fsm.forceReconnect("force reconnect due to no registration")},e.prototype.resetReconnectParamsOnErrorThreshold=function(){this.logger.warn("".concat(this.connectingErrorsInRow," connection attempts, server-side failure: erasing cached connection parameters")),this.reconnectParams=void 0},e.prototype.onSocketConnecting=function(e){this.logger.info("onSocketConnecting(".concat(e,")")),this.transportTypeName=e,this.connectionTracker.trackProgress("connecting",this.transportTypeName),this.fsm.onConnecting()},e.prototype.onSocketConnect=function(e){this.logger.info("onSocketConnect"),this.fsm.onSocketConnect(e)},e.prototype.onSocketConnectFailed=function(e){this.logger.error("onSocketConnectFailed"),this.connectionTracker.trackError("connect_failed",e,!0,this.transportTypeName?this.transportTypeName:this.UNKNOWN_TRANSPORT),this.fsm.onConnectingFailed()},e.prototype.onSocketDisconnect=function(e){var t=this.connectionTracker.getSessionLength()||0,n=f.DisconnectReason.fromRawReason(e);this.logger.error("onSocketDisconnect, reason: ".concat(n.reason)),"dup"===n.reason&&"dup"===this.lastDisconnectReason&&t<this.options.duplicateDisconnectThresholdMs&&(this.logger.warn("Socket was closed by server as Duplicate for the second time in a row "+"after ".concat(t," ms which is below the threshold of ")+"".concat(this.options.duplicateDisconnectThresholdMs," ms. Resetting cached ")+"connection parameters and making a new allocation."),this.reconnectParams=void 0),this.lastDisconnectReason=n.reason,this.fsm.onSocketDisconnect(n),this.connectionExpireTimestampInSecs=void 0},e.prototype.onSocketReconnect=function(){this.logger.error("onSocketReconnect"),this.fsm.onTrouterConnected()},e.prototype.onSocketReconnectFailed=function(e){this.logger.error("onSocketReconnectFailed with '".concat(e,"'")),this.fsm.onSocketDisconnect(f.DisconnectReason.fromSocketIoEventData("reconnecterror",e))},e.prototype.onSocketReconnecting=function(){this.logger.error("onSocketReconnecting")},e.prototype.onSocketError=function(e){this.logger.error("onSocketError with '".concat((0,d.toJson)(e),"'")),this.fsm.isConnecting()&&++this.connectingErrorsInRow>=this.connectingErrorsThreshold&&this.resetReconnectParamsOnErrorThreshold(),this.connectionTracker.trackError("connectSocket",function(e){return null!=e&&"function"==typeof e.toString?e.toString():"[".concat(typeof e,"]")}(e)),this.fsm.onSocketDisconnect(f.DisconnectReason.fromSocketIoEventData("socketerror",e))},e.prototype.onSocketMessage=function(e){var t,n,r=this;this.logger.debug("onSocketMessage");try{var s=null===(t=(n=new w(e,this.logger)).headers)||void 0===t?void 0:t["X-Microsoft-Skype-Chain-ID"],a=s?" Chain-Id ".concat(s):"";this.logger.info("Received request N ".concat(n.id).concat(a," CV ").concat(n.correlationVector," to '").concat(n.url,"'")),n.startTS=Date.now(),n.url&&this.urlPath&&n.url.startsWith(this.urlPath)&&(n.shortUrl=n.url.substring(this.urlPath.length))}catch(e){var c=i(e);return this.logger.error("unable to parse request. Error: ".concat(c)),this.connectionTracker.trackRequest(void 0,c),void this.connectionTracker.sendResponseError("unable to parse request, error: ".concat(e))}n.timeoutTimerId=setTimeout(function(){if(!n.replied){r.logger.error("Request ".concat(n.id," timed out"));var e=new h.ResponseData(n.id);e.status=504,e.headers={"Trouter-Responder":"ClientLib"},r.sendResponse(n,e),n.timedout=!0}},this.timeoutOptions.requestTimeoutMs);try{this.connectionTracker.trackRequest(n),this.fsm.onDownstreamRequest(n)}catch(e){this.logger.error("exception in socket.on message. Error: ".concat(i(e))),this.connectionTracker.sendResponseError(o(e),n,void 0)}},e.prototype.onTrouterConnected=function(e,t,n){var r,i,o,a,c=this;if((0,C.isV4ConnectEvent)(e)){var u=e;this.allocateResult=s(s({},u),{ttl:e.ttl.toString()}),this.populateAndCacheReconnectParams(u,u.reconnectUrl),this.populateConnectionStateFields(u)}else if(!this.allocateResult)return void this.logger.error("Invalid internal state - received onTrouterConnected while allocateResult is not set");this.connectingErrorsInRow=0,this.logger.info("onTrouterConnected: ".concat(this.allocateResult.url)),"xhr-polling"===this.transportTypeName&&t&&this.manager.onUserActivityStateAccepted(t.cv),(null===(o=null===(i=null===(r=this.socket)||void 0===r?void 0:r.socket)||void 0===i?void 0:i.options)||void 0===o?void 0:o.query)&&(this.socket.socket.options.query+="&connected=true"),this.urlPath=this.allocateResult.url.replace(/https?:\/\/([A-z0-9\:\$\-\_\.\+\!\*\"\(\)\,]*)\//,"/");var l=this.connectedUrl!==this.allocateResult.url;this.connectedUrl=this.allocateResult.url,this.connectionExpireTimestampInSecs=(0,d.calculateExpireTsInSec)((0,C.ensureNumber)(e.ttl)),this.connectionTracker.trackEnd("connectSocket"),this.connectionTracker.trackConnected(l,this.transportTypeName?this.transportTypeName:this.UNKNOWN_TRANSPORT),null===(a=this.setAudienceSubscriptionsUnsafeAsync(n))||void 0===a||a.catch(function(e){return c.logger.error("Re-subscribe to audiences has failed with ".concat(e))}),this.fsm.onTrouterConnected()},e.prototype.onTrouterReconnect=function(e){var t=e.target;this.logger.info("onTrouterReconnect target: ".concat(t)),"self"===t?this.fsm.onReconnectRequired(!0,u.ServerInitiated):this.fsm.onReconnectRequired(!1,u.ServerInitiated,e)},e.prototype.onTrouterMessageLoss=function(e){this.logger.debug("onTrouterMessageLoss"),this.fsm.onTrouterMessageLost(e.droppedIndicators)},e.prototype.onAudienceSubscriptionResult=function(e){this.logger.info("onAudienceSubscriptionResult"),this.pendingAudienceSubscription&&(clearTimeout(this.pendingAudienceSubscription.timeoutId),this.pendingAudienceSubscription.audienceSetResolve(e),this.pendingAudienceSubscription=void 0)},e.prototype.buildV4cUrlParams=function(){var e={};return e.tc=encodeURI((0,d.toJson)(this.clientInfo)),e.timeout=Math.floor(this.timeoutOptions.pingTimeoutMs/1e3),this.options.endpointId&&(e.epid=this.options.endpointId),this.appendConnectedClientIds(this.buildQuery(e),!0)},e.prototype.attachSocketIoHandlers=function(e,t,n,r){var i=this;e.on("connecting",function(e){i.onSocketConnecting(e)}),e.on("connect",function(){i.onSocketConnect(t)}),e.on("connect_failed",function(e){i.onSocketConnectFailed(e)}),e.on("close_during_connecting",function(e){i.onSocketConnectFailed(e)}),e.on("disconnect",function(e){i.onSocketDisconnect(e)}),e.on("reconnect",function(){i.onSocketReconnect()}),e.on("reconnect_failed",function(e){i.onSocketReconnectFailed(e)}),e.on("reconnecting",function(){i.onSocketReconnecting()}),e.on("error",function(e){i.onSocketError(e)}),e.on("message",function(e){i.onSocketMessage(e)}),e.on("trouter.connected",function(e){i.onTrouterConnected(e,n,r)}),e.on("trouter.reconnect",function(e){i.onTrouterReconnect(e)}),e.on("trouter.message_loss",function(e){i.onTrouterMessageLoss(e)}),e.on("audience.subscriptionresult",function(e,t){i.onAudienceSubscriptionResult(t)})},e.prototype.onNavigatorOnlineStatusUpdate=function(){var e=window.navigator.onLine;this.logger.debug("Browser online status update - new state: ".concat(e,", previously: ").concat(this.isNavigatorOnline)),e&&!this.isNavigatorOnline?(this.isNavigatorOnline=!0,this.tokenBackoff.expediteIfPending(),this.connectionTracker.trackProgress("browserNet","online")):!e&&this.isNavigatorOnline&&(this.isNavigatorOnline=!1,this.connectionTracker.trackProgress("browserNet","offline"))},e.prototype.onAllocationResponse=function(e,t){this.logger.info("Received allocation response ".concat(JSON.stringify(e))),this.allocateResult=e,this.populateAndCacheReconnectParams(this.allocateResult,"".concat(this.allocateResult.socketio,"v4/a")),this.populateConnectionStateFields(this.allocateResult),this.fsm.onAllocationSucceed(t)},e.prototype.populateAndCacheReconnectParams=function(e,t){this.reconnectParams=s({serviceUrl:this.options.trouterUrl,reconnectUrl:t},e.connectparams),this.manager.onConnectionParametersUpdated(this.reconnectParams)},e.prototype.populateConnectionStateFields=function(e){var t,n,r="string"==typeof e.ttl?parseInt(e.ttl,10):e.ttl;if(this.connectionExpireTimestampInSecs=(0,d.calculateExpireTsInSec)(r),this.connectionId=null!==(t=e.id)&&void 0!==t?t:"",this.connectedClientId=e.ccid,this.logger.debug("connected client id set {connectedClientId:".concat(this.connectedClientId,"}")),this.c2cUrlBase=null!==(n=e.curlb)&&void 0!==n?n:"",""===this.c2cUrlBase){var i=e.surl.indexOf("://");i>=0&&(i=e.surl.indexOf("/",i+3))>=5&&":3443"===e.surl.substr(i-5,5)&&(this.c2cUrlBase=e.surl.substr(0,i-5))}},e.prototype.onPingResponse=function(){this.logger.debug("onPingResponse"),this.connectionTracker.increasePingResponseCount(),this.clearPingResponseTimer(),this.fsm.onPingResponse()},e.prototype.clearPingResponseTimer=function(){void 0!==this.pingResponseTimerId&&(clearTimeout(this.pingResponseTimerId),this.pingResponseTimerId=void 0)},e.prototype.buildQuery=function(e){for(var t=[],n=0,r=Object.keys(e);n<r.length;n++){var i=r[n];void 0!==e[i]&&t.push("".concat(i,"=").concat(e[i]))}return t.join("&")},e.prototype.appendConnectedClientIds=function(e,t){var n="";e.includes("ccid=")||(n="ccid=".concat(this.connectedClientId,"&")),this.domId&&(n+="dom=".concat(this.domId,"&")),n.length>0&&(n=n.slice(0,-1));var r=t||e.includes("?")?"&":"?";return this.appendCorrelationIds(e+r+n,t)},e.prototype.appendEndpointId=function(e,t){var n=t||e.includes("?")?"&":"?";return!e.includes("epid")&&this.options.endpointId?"".concat(e).concat(n,"epid=").concat(this.options.endpointId):e},e.prototype.appendCorrelationIds=function(e,t){var n=t||e.includes("?")?"&":"?";return e.includes("cor_id")?e:"".concat(e).concat(n,"cor_id=").concat(this.options.clientCorrelationID)+"&con_num=".concat(this.clientID,"_").concat(this.connectionAttempt)},e.prototype.safeString=function(e){return"string"==typeof e?e:""},e.prototype.sendResponse=function(e,t){var n,r,o;if(e.timedout)return this.logger.error("Request ".concat(e.id," already timed out")),1;if(e.replied)return this.logger.error("Response for request ".concat(e.id," already sent")),2;clearTimeout(e.timeoutTimerId),e.timeoutTimerId=void 0,e.replied=!0,t.headers=null!==(n=t.headers)&&void 0!==n?n:{};var s=e.correlationVector;this.logger.info("Sending response N ".concat(e.id," CV ").concat(s," with status ").concat(t.status)),s&&(t.headers[I]=s),(null===(r=e.headers)||void 0===r?void 0:r["trouter-request"])&&(t.headers["trouter-request"]=e.headers["trouter-request"]);var a=Date.now()-e.startTS;if(t.headers["trouter-client"]=(0,d.toJson)({cd:a}),(null===(o=e.headers)||void 0===o?void 0:o["trouter-is-broadcast"])&&(t.headers["trouter-is-broadcast"]=e.headers["trouter-is-broadcast"]),this.logger.debug("response: ".concat((0,d.toJson)(t))),!this.socket)return this.connectionTracker.sendResponseError("no socket",e,t),4;try{return this.socket.send((0,d.toJson)(t)),t.sentTS=Date.now(),e.incrementCorrelationVector(),this.connectionTracker.trackResponse(e,a,t),"websocket"===this.transportTypeName&&this.sendPingRequest(),0}catch(n){var c="unable to send data on response.end. Error: ".concat(i(n));return this.logger.error(c),this.connectionTracker.sendResponseError(c,e,t),4}},e.prototype.sendUserActivityStateMultiple=function(e){var t=this,n=new A("user.activity"),r=this.userActivityState.increaseCvAndGetEventObject();n.args=r,this.logger.debug("Sending user activity '".concat(this.userActivityState.toEventJSON(),"', remaining ").concat(e-1));var i=!1;this.sendDownstreamEvent(n,function(){if(!0!==i&&(t.logger.info("User activity state: ".concat(r.state,", cv: ").concat(r.cv," accepted")),t.manager.onUserActivityStateAccepted(r.cv),t.clearSentEventTimer(n.timeoutTimerId),e>1)){var o=setTimeout(function(){t.clearSentEventTimer(o),t.sendUserActivityStateMultiple(e-1)},t.options.userActivitySecondResendDelayMs);t.registerSentEventTimer(o,"user.activity/resend")}}),n.timeoutTimerId=setTimeout(function(){t.logger.error("Activity state response timeout is fired"),i=!0,t.fsm.onActivityStateResponseTimeout(),t.clearSentEventTimer(n.timeoutTimerId)},this.timeoutOptions.userActivityResponseTimeoutMs),this.registerSentEventTimer(n.timeoutTimerId,"user.activity/response")},e.prototype.sendDownstreamEvent=function(e,t){this.logger.debug("Sending downstream event ".concat(e.name)),this.socket&&this.socket.emit(e.name,e.args,t)},e.prototype.registerSentEventTimer=function(e,t){this.logger.debug("registering timer ".concat(e," -> ").concat(t)),this.pendingSentEventTimers[e]=t},e.prototype.clearSentEventTimer=function(e){var t=this.pendingSentEventTimers[e];this.logger.debug("clearing timer ".concat(e," -> ").concat(t)),delete this.pendingSentEventTimers[e],clearTimeout(e)},e.prototype.getRegistrationTtl=function(){var e,t,n=(0,d.calculateTtlInSec)(this.connectionExpireTimestampInSecs);if(this.logger.debug("Current connectionID will expire in ".concat(n," seconds")),(null===(e=this.options.registration)||void 0===e?void 0:e.registrarTtlSec)&&n>0){var r=this.options.registration.registrarTtlSec<n;return[Math.min(this.options.registration.registrarTtlSec,n),r]}return(null===(t=this.options.registration)||void 0===t?void 0:t.registrarTtlSec)?[this.options.registration.registrarTtlSec,!1]:n>0?[n,!1]:[3600,!1]},e.prototype.clearIncallModeTimerId=function(){void 0!==this.incallModeTimerId&&(this.logger.debug("Clearing in-call mode timer"),clearTimeout(this.incallModeTimerId),this.incallModeTimerId=void 0)},e.prototype.applyConnectionTrackerOptions=function(e){try{e.eventLogger&&"function"==typeof e.eventLogger.logEvent?(this.connectionTracker.mergeSettings(e.telemetrySettings),this.connectionTracker.enable(e.eventLogger)):this.logger.warn("Trouter client event logging disabled due to invalid configuration.")}catch(e){this.logger.warn("Trouter client event logging disabled. Error: ".concat(i(e))),this.connectionTracker.disable()}},e.prototype.canRetryTokenFetchRequest=function(e){var t=this.options.retryLimitOnTokenFetch;return null==t||e<t||(this.logger.warn("Reached limit on maximum number of token fetch request. Current count: ".concat(e,", retry limit: ").concat(t)),!1)},e}();t.TrouterConnection=O},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.MessageHandlerRegistry=void 0;var r=n(1),i=n(0),o=function(){function e(e){this.messageHandlers=[],this.logger=new i.Logger("MessageHandlers",e)}return e.prototype.register=function(e){if(this.messageHandlers.some(function(t){return t===e}))throw new Error("Registering the same handler twice is not allowed");this.messageHandlers.push(e)},e.prototype.clear=function(){this.logger.debug("Clearing message handlers"),this.messageHandlers=[]},e.prototype.active=function(){return this.messageHandlers.length>0},e.prototype.handleMessage=function(e){for(var t={resultCode:r.UNHANDLED_MESSAGE_ACK,isHandled:!1},n=0,i=this.messageHandlers;n<i.length;n++){var o=i[n],s=this.safeExecuteHandle(o,e);if(void 0!==s&&(void 0===s.isHandled||s.isHandled))return void 0===s.resultCode&&(s.resultCode=r.HANDLED_MESSAGE_ACK),s}return t},e.prototype.safeExecuteHandle=function(e,t){try{return e.handleMessage(t)}catch(e){return void this.logger.warn("Trouter message handler threw an exception: ".concat(e))}},e}();t.MessageHandlerRegistry=o},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?n(e.value):i(e.value).then(s,a)}c((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;a&&(a=0,n[0]&&(c=0)),c;)try{if(i=1,o&&(s=2&n[0]?o.return:n[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(s=(s=c.trys).length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){c.label=n[1];break}if(6===n[0]&&c.label<s[1]){c.label=s[1],s=n;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(n);break}s[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,s,a,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(t,"__esModule",{value:!0}),t.addCacheAsBackupTo=void 0,t.addCacheAsBackupTo=function(e){var t,n=this;return function(o){return r(n,void 0,void 0,function(){return i(this,function(n){return o&&(t=void 0),[2,new Promise(function(n,r){e(o).then(function(e){t=e,n(e)}).catch(function(e){void 0!==t&&t.length>0&&n(t),r(e)})})]})})}}},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?n(e.value):i(e.value).then(s,a)}c((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;a&&(a=0,n[0]&&(c=0)),c;)try{if(i=1,o&&(s=2&n[0]?o.return:n[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(s=(s=c.trys).length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){c.label=n[1];break}if(6===n[0]&&c.label<s[1]){c.label=s[1],s=n;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(n);break}s[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,s,a,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(t,"__esModule",{value:!0}),t.TrouterManager=t.AudienceSubscriptionState=t.UserActivityObject=void 0;var o=n(3),s=n(2),a=n(4),c=n(0),u=n(5),l=n(18),d=n(7),h=n(6),p=n(19),f=function(){function e(e,t){this.state=e,this.correlationVector=void 0!==t?t:o.CorrelationVector.extend()}return e.prototype.getStateString=function(){switch(this.state){case s.UserActivityState.Active:return"active";case s.UserActivityState.Inactive:return"inactive";case s.UserActivityState.Unknown:return"unknown";default:return"undefined"}},e.prototype.increaseCvAndGetEventObject=function(){return this.correlationVector.increase(),this.toEventObject()},e.prototype.toEventObject=function(){return{state:this.getStateString(),cv:this.correlationVector.value()}},e.prototype.toEventJSON=function(){return(0,o.toJson)(this.toEventObject())},e}();t.UserActivityObject=f;var g=function(){function e(e,t){void 0===t&&(t=o.CorrelationVector.extend()),this.audienceSubscriptionModel=e,this.correlationVector=t}return e.prototype.increaseCvAndGetEventObject=function(){return this.correlationVector.increase(),this.toEventObject()},e.prototype.toEventObject=function(){return{audiences:this.audienceSubscriptionModel.audienceSubscriptions,cv:this.correlationVector.value()}},e.prototype.toEventJSON=function(){return(0,o.toJson)(this.toEventObject())},e}();t.AudienceSubscriptionState=g;var m=function(){function e(e,t,n,r,i,a){var l=this;this.logFunc=e,this.options=t,this.tokenProvider=n,this.usingLegacyTokenApi=r,this.listener=i,this.tokenTypeProtocolSelector=function(e,t){return l.options.forceV4aProtocol?"v4a":(0,u.usedProtocol)(e,t)},this.logger=new c.Logger("Manager",e),this.logger.info("Created TrouterManager with options ".concat((0,o.toJson)(this.options))),this.fsm=new p.TrouterManagerFsm(e,this),this.baseEndpointUrl="",this.processedMessageLoss={},this.userActivityObject=new f(s.UserActivityState.Unknown),this.protocolSelector=null!=a?a:this.tokenTypeProtocolSelector.bind(this)}return e.prototype.start=function(){this.fsm.start()},e.prototype.stop=function(e){this.fsm.stop(e)},e.prototype.configure=function(e){this.options=e,void 0!==this.firstConnection&&this.firstConnection.configure(e),void 0!==this.secondConnection&&this.secondConnection.configure(e),this.logger.info("Reconfigured TrouterManager with options ".concat((0,o.toJson)(this.options)))},e.prototype.checkConnection=function(e){void 0!==this.firstConnection&&this.firstConnection.checkConnection(e),void 0!==this.secondConnection&&this.secondConnection.checkConnection(e)},e.prototype.resendRegistration=function(){return r(this,void 0,void 0,function(){return i(this,function(e){return void 0!==this.secondConnection?(this.logger.info("Resending registration on the second/new connection"),[2,this.secondConnection.resendRegistration()]):void 0!==this.firstConnection?(this.logger.info("Resending registration on the first/current connection"),[2,this.firstConnection.resendRegistration()]):(this.logger.info("No connection to resend registration on, will be done upon (re)connect"),[2])})})},e.prototype.getServerState=function(){if(void 0!==this.firstConnection)return this.firstConnection.getServerState()},e.prototype.getState=function(){return this.fsm.getState()},e.prototype.isInTerminalState=function(){return this.fsm.getInternalState()===a.TrouterManagerState.TerminalError},e.prototype.reportStateInfo=function(){var e=this.firstConnection?h.State[this.firstConnection.getState()]:"Unknown",t=a.TrouterManagerState[this.fsm.getInternalState()];if(this.secondConnection){var n=h.State[this.secondConnection.getState()];return"Manager ".concat(t,"; 1st ").concat(e,"; 2nd ").concat(n)}return"Manager ".concat(t,"; Connection ").concat(e)},e.prototype.startFirstConnection=function(){var e=new d.TrouterConnection(this.logFunc,this.options,this.configuredTrouterManager(),this.tokenProvider,this.usingLegacyTokenApi,this.userActivityObject,this.protocolSelector,this.audienceSubscriptionState);this.firstConnection=e,this.getConnectionCache().then(function(t){e.start(t)}).catch(function(){})},e.prototype.startSecondConnection=function(e){var t=new d.TrouterConnection(this.logFunc,this.options,this.configuredTrouterManager(),this.tokenProvider,this.usingLegacyTokenApi,this.userActivityObject,this.protocolSelector,this.audienceSubscriptionState);this.secondConnection=t,void 0!==this.firstConnection&&this.firstConnection.disableRegistrationsAndAutoReconnect(),e?this.getConnectionCache().then(function(e){t.start(e)}).catch(function(){}):t.start()},e.prototype.stopFirstConnection=function(e){void 0!==this.firstConnection&&(this.storedFirstConnection=this.firstConnection,this.firstConnection.stop(e),this.firstConnection=void 0)},e.prototype.stopSecondConnection=function(e){void 0!==this.secondConnection&&(this.secondConnection.stop(e),this.secondConnection=void 0)},e.prototype.stopSecondConnectionDelayed=function(){if(void 0!==this.secondConnection){var e=this.secondConnection;this.secondConnection=void 0,this.logger.info("Closing an inactive connection in ".concat(Math.round(this.options.lingeringConnectionDelayMs/1e3),"s")),setTimeout(function(){e.stop(!0)},this.options.lingeringConnectionDelayMs)}},e.prototype.forceStopLingeringConnection=function(){this.storedFirstConnection&&(this.storedFirstConnection.stop(!1),this.storedFirstConnection=void 0)},e.prototype.switchConnections=function(){var e=this.firstConnection;this.firstConnection=this.secondConnection,this.secondConnection=e},e.prototype.doesSecondConnectionExist=function(){return void 0!==this.secondConnection},e.prototype.dispatchConnected=function(){if(void 0!==this.firstConnection){var e=this.firstConnection.getServerState(),t=e.url.endsWith("/")?e.url.slice(0,-1):e.url,n={baseEndpointUrl:t,newEndpointUrl:t!==this.baseEndpointUrl,c2cUrlBase:e.c2cUrlBase,clientId:e.connectedClientId,connectionId:e.connectionId,connectionTtlSec:e.getRemainingTtlInSec()};this.baseEndpointUrl=t,this.listener.onTrouterConnected(e.url,n)}},e.prototype.dispatchDisconnected=function(){this.listener.onTrouterDisconnected&&this.listener.onTrouterDisconnected()},e.prototype.dispatchTerminalError=function(){this.listener.onTrouterDisconnected&&this.listener.onTrouterDisconnected()},e.prototype.dispatchRegistrationState=function(e){this.options.registrationStateCallback&&this.options.registrationStateCallback(e)},e.prototype.expediteBackoffOnConnections=function(){var e;void 0!==this.lastExpediteBackoffCallAt&&Date.now()-this.lastExpediteBackoffCallAt<(null!==(e=this.options.expediteBackoffOnStartMinimumDelayMs)&&void 0!==e?e:1e4)?this.logger.info("Expedite backoff due to start() too frequent, skipping"):(this.lastExpediteBackoffCallAt=Date.now(),void 0!==this.firstConnection&&this.firstConnection.expediteBackoff(),void 0!==this.secondConnection&&this.secondConnection.expediteBackoff())},e.prototype.onDownstreamRequest=function(e,t,n){var r={id:t.id,method:t.method,path:"/".concat(t.shortUrl),body:t.body,headers:t.headers},i={id:t.id,status:0,headers:{},body:"",send:function(){return i.status<=100||i.status>=999?3:(n.writeHead(i.status,i.headers),n.end(i.body))}};this.listener.onTrouterRequest(r,i)},e.prototype.onConnected=function(e){this.fsm.onConnected(e===this.firstConnection)},e.prototype.onRegistered=function(e){this.fsm.onRegistered(e===this.firstConnection)},e.prototype.onUnregistered=function(e){this.fsm.onUnregistered(e===this.firstConnection||e===this.storedFirstConnection)},e.prototype.onReconnecting=function(e){this.fsm.onReconnecting(e===this.firstConnection)},e.prototype.onReconnectIsRequired=function(e,t,n){this.fsm.onReconnectionRequired(e===this.firstConnection,t,n)},e.prototype.onDisconnected=function(e){this.fsm.onDisconnected(e===this.firstConnection||e==this.storedFirstConnection),this.storedFirstConnection=void 0},e.prototype.onTerminalError=function(){this.fsm.onTerminalError(),this.storedFirstConnection=void 0},e.prototype.onUserActivityStateAccepted=function(e){this.listener.onTrouterUserActivityStateAccepted&&this.listener.onTrouterUserActivityStateAccepted(e)},e.prototype.onAudiencesSetResolved=function(e,t){var n,r;null===(r=(n=this.listener).onAudiencesSetResolved)||void 0===r||r.call(n,e,t)},e.prototype.onConnectionParametersUpdated=function(e){this.setConnectionCache(e)},e.prototype.setUserActivityState=function(e,t){return this.userActivityObject=new f(e,o.CorrelationVector.extend(t)),void 0!==this.secondConnection?(this.logger.info("Setting user activity ".concat(this.userActivityObject.toEventJSON()," on the second/new connection")),void this.secondConnection.setUserActivityState(this.userActivityObject)):void 0!==this.firstConnection?(this.logger.info("Setting user activity ".concat(this.userActivityObject.toEventJSON()," on the first/current connection")),void this.firstConnection.setUserActivityState(this.userActivityObject)):void 0},e.prototype.setAudienceSubscriptionsAsync=function(e,t,n){if(this.audienceSubscriptionState=new g(e,o.CorrelationVector.extend(n)),this.secondConnection)return this.logger.info("Setting audience subscriptions ".concat(this.audienceSubscriptionState.toEventJSON()," on second/new connection")),this.secondConnection.setAudienceSubscriptionsAsync(this.audienceSubscriptionState,t);if(this.firstConnection)return this.logger.info("Setting audience subscriptions ".concat(this.audienceSubscriptionState.toEventJSON()," on first/current connection")),this.firstConnection.setAudienceSubscriptionsAsync(this.audienceSubscriptionState,t);throw new Error("No connection found")},e.prototype.onTrouterMessageLost=function(e){var t=this;if(this.listener.onTrouterMessageLoss)if(null==e?void 0:e.length){var n=e.filter(function(e){return void 0!==t.processedMessageLoss["".concat(e.tag,"-").concat(e.etag)]});if(n.length&&(this.logger.info("onTrouterMessageLoss - immediately acknowledging ".concat(n.length," seen dropped indicators")),this.sendProcessedDroppedIndicators(n),!(e=e.filter(function(e){return void 0===t.processedMessageLoss["".concat(e.tag,"-").concat(e.etag)]})).length))return void this.logger.info("onTrouterMessageLoss - all declared dropped indicators have been seen before");if(!this.listener.onTrouterMessageLoss(e.map(function(e){return e.tag})))return void this.logger.warn("onTrouterMessageLoss - some flow tag(s) have not been processed by listeners");e.forEach(function(e){t.processedMessageLoss["".concat(e.tag,"-").concat(e.etag)]=""}),this.sendProcessedDroppedIndicators(e)}else this.logger.warn("onTrouterMessageLoss - no flow tags have been provided")},e.prototype.getConnectionCache=function(){var e=this;return this.options.connectionCache?(this.logger.debug("Querying host's connection cache"),this.options.connectionCache.onGetTrouterConnectionCache().then(function(e){var t=e?JSON.parse(e):void 0;return"object"==typeof t?t:void 0}).catch(function(t){return e.logger.warn("Invalid connection cache content provided: ".concat(t)),e.connectionCache})):Promise.resolve(this.connectionCache)},e.prototype.setConnectionCache=function(e){if(this.connectionCache=e,this.options.connectionCache)try{this.options.connectionCache.onSetTrouterConnectionCache(JSON.stringify(e))}catch(e){this.logger.warn("Error setting external connection cache: ".concat(e))}},e.prototype.sendProcessedDroppedIndicators=function(e){return void 0!==this.firstConnection?void this.firstConnection.sendProcessedDroppedIndicators(e):void 0!==this.secondConnection?void this.secondConnection.sendProcessedDroppedIndicators(e):void 0},e.prototype.configuredTrouterManager=function(){return new l.RegistrationEnforcer(this,this.options.connectionDependsOnRegistration,this.options.delayEventsUntilRegistered)},e}();t.TrouterManager=m},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.TrouterUrlPromise=void 0;var r=n(0),i=function(){function e(e){this.logger=new r.Logger("UrlPromise",e)}return e.prototype.getPromise=function(){var e=this;return void 0!==this.url?(this.logger.debug("returning previously resolved url: ".concat(this.url)),Promise.resolve(this.url)):(void 0===this.pendingPromise?(this.logger.debug("creating and returning promise"),this.pendingPromise=new Promise(function(t,n){e.pendingPromiseResolveRef=t,e.pendingPromiseRejectRef=n})):this.logger.debug("returning existing promise"),this.pendingPromise)},e.prototype.resolveUrl=function(e){this.url=e,this.logger.debug("got url: ".concat(this.url));var t=this.pendingPromiseResolveRef;this.pendingPromise=void 0,this.pendingPromiseResolveRef=void 0,this.pendingPromiseRejectRef=void 0,void 0!==t&&(this.logger.debug("resolving promise"),t(e))},e.prototype.rejectUrl=function(e){this.logger.debug("aborting");var t=this.pendingPromiseRejectRef;this.url=void 0,this.pendingPromise=void 0,this.pendingPromiseResolveRef=void 0,this.pendingPromiseRejectRef=void 0,void 0!==t&&(this.logger.debug("rejecting promise"),t(e))},e.prototype.resetUrl=function(){this.logger.debug("resetting url"),this.url=void 0},e}();t.TrouterUrlPromise=i},function(e,t,n){(function(e,n){!function(e,t){var n=e;n.version="0.9.6",n.protocol=1,n.transports=[],n.j=[],n.sockets={},n.connect=function(e,r){var i,o,s=n.util.parseUri(e);t&&t.location&&(s.protocol=s.protocol||t.location.protocol.slice(0,-1),s.host=s.host||(t.document?t.document.domain:t.location.hostname),s.port=s.port||t.location.port),i=n.util.uniqueUri(s);var a={host:s.host,secure:"https"==s.protocol,port:s.port||("https"==s.protocol?443:80),query:s.query||""};return n.util.merge(a,r),!a["force new connection"]&&n.sockets[i]||(o=new n.Socket(a)),!a["force new connection"]&&o&&(n.sockets[i]=o),o=o||n.sockets[i],a["skipped handshake data"]?o.of(""):o.of(s.path.length>1?s.path:"")}}(n.exports,void 0===e?window:e);var r=n.exports;!function(e,t){var n=e.util={},r=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,i=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];n.parseUri=function(e){for(var t=r.exec(e||""),n={},o=14;o--;)n[i[o]]=t[o]||"";return n},n.uniqueUri=function(e){var n=e.protocol,r=e.host,i=e.port;return"document"in t?(r=r||document.domain,i=i||("https"==n&&"https:"!==document.location.protocol?443:document.location.port)):(r=r||"localhost",i||"https"!=n||(i=443)),(n||"http")+"://"+r+":"+(i||80)},n.query=function(e,t){var r=n.chunkQuery(e||""),i=[];for(var o in n.merge(r,n.chunkQuery(t||"")),r)r.hasOwnProperty(o)&&i.push(o+"="+r[o]);return i.length?"?"+i.join("&"):""},n.chunkQuery=function(e){for(var t,n={},r=e.split("&"),i=0,o=r.length;i<o;++i)(t=r[i].split("="))[0]&&(n[t[0]]=t[1]);return n};var o=!1;n.load=function(e){if("document"in t&&"complete"===document.readyState||o)return e();n.on(t,"load",e,!1)},n.on=function(e,t,n,r){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener&&e.addEventListener(t,n,r)},n.request=function(e){if(e&&"undefined"!=typeof XDomainRequest)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!e||n.ua.hasCORS))return new XMLHttpRequest;if(!e)try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}return null},"undefined"!=typeof window&&n.load(function(){o=!0}),n.defer=function(e){if(!n.ua.webkit||"undefined"!=typeof importScripts)return e();n.load(function(){setTimeout(e,100)})},n.merge=function(e,t,r,i){var o,s=i||[],a=void 0===r?2:r;for(o in t)t.hasOwnProperty(o)&&n.indexOf(s,o)<0&&("object"==typeof e[o]&&a?n.merge(e[o],t[o],a-1,s):(e[o]=t[o],s.push(t[o])));return e},n.mixin=function(e,t){n.merge(e.prototype,t.prototype)},n.inherit=function(e,t){function n(){}n.prototype=t.prototype,e.prototype=new n},n.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},n.intersect=function(e,t){for(var r=[],i=e.length>t.length?e:t,o=e.length>t.length?t:e,s=0,a=o.length;s<a;s++)~n.indexOf(i,o[s])&&r.push(o[s]);return r},n.indexOf=function(e,t,n){var r=e.length;for(n=n<0?n+r<0?0:n+r:n||0;n<r&&e[n]!==t;n++);return r<=n?-1:n},n.toArray=function(e){for(var t=[],n=0,r=e.length;n<r;n++)t.push(e[n]);return t},n.ua={},n.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var e=new XMLHttpRequest}catch(e){return!1}return null!=e.withCredentials}(),n.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent)}(void 0!==r?r:n.exports,void 0===e?window:e),function(e,t){function n(){}e.EventEmitter=n,n.prototype.on=function(e,n){return this.$events||(this.$events={}),this.$events[e]?t.util.isArray(this.$events[e])?this.$events[e].push(n):this.$events[e]=[this.$events[e],n]:this.$events[e]=n,this},n.prototype.addListener=n.prototype.on,n.prototype.once=function(e,t){function n(){r.removeListener(e,n),t.apply(this,arguments)}var r=this;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,n){if(this.$events&&this.$events[e]){var r=this.$events[e];if(t.util.isArray(r)){for(var i=-1,o=0,s=r.length;o<s;o++)if(r[o]===n||r[o].listener&&r[o].listener===n){i=o;break}if(i<0)return this;r.splice(i,1),r.length||delete this.$events[e]}else(r===n||r.listener&&r.listener===n)&&delete this.$events[e]}return this},n.prototype.removeAllListeners=function(e){return this.$events&&this.$events[e]&&(this.$events[e]=null),this},n.prototype.listeners=function(e){return this.$events||(this.$events={}),this.$events[e]||(this.$events[e]=[]),t.util.isArray(this.$events[e])||(this.$events[e]=[this.$events[e]]),this.$events[e]},n.prototype.emit=function(e){if(!this.$events)return!1;var n=this.$events[e];if(!n)return!1;var r=Array.prototype.slice.call(arguments,1);if("function"==typeof n)n.apply(this,r);else{if(!t.util.isArray(n))return!1;for(var i=n.slice(),o=0,s=i.length;o<s;o++)i[o].apply(this,r)}return!0}}(void 0!==r?r:n.exports,void 0!==r?r:n.parent.exports),function(e,t){if(t&&t.parse)return e.JSON={parse:t.parse,stringify:t.stringify};throw new Error("JSON not available")}(void 0!==r?r:n.exports,"undefined"!=typeof JSON?JSON:void 0),function(e,t){var n=e.parser={},r=n.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],i=n.reasons=["transport not supported","client not handshaken","unauthorized"],o=n.advice=["reconnect"],s=t.JSON,a=t.util.indexOf;n.encodePacket=function(e){var t=a(r,e.type),n=e.id||"",c=e.endpoint||"",u=e.ack,l=null;switch(e.type){case"error":var d=e.reason?a(i,e.reason):"",h=e.advice?a(o,e.advice):"";""===d&&""===h||(l=d+(""!==h?"+"+h:""));break;case"message":""!==e.data&&(l=e.data);break;case"event":var p={name:e.name};e.args&&e.args.length&&(p.args=e.args),l=s.stringify(p);break;case"json":l=s.stringify(e.data);break;case"connect":e.qs&&(l=e.qs);break;case"ack":l=e.ackId+(e.args&&e.args.length?"+"+s.stringify(e.args):"")}var f=[t,n+("data"==u?"+":""),c];return null!=l&&f.push(l),f.join(":")},n.encodePayload=function(e){var t="";if(1==e.length)return e[0];for(var n=0,r=e.length;n<r;n++)t+=""+e[n].length+""+e[n];return t};var c=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;n.decodePacket=function(e){if(!(a=e.match(c)))return{};var t=a[2]||"",n=(e=a[5]||"",{type:r[a[1]],endpoint:a[4]||""});switch(t&&(n.id=t,a[3]?n.ack="data":n.ack=!0),n.type){case"error":var a=e.split("+");n.reason=i[a[0]]||"",n.advice=o[a[1]]||"";break;case"message":n.data=e||"";break;case"event":try{var u=s.parse(e);n.name=u.name,n.args=u.args}catch(e){}n.args=n.args||[];break;case"json":try{n.data=s.parse(e)}catch(e){}break;case"connect":n.qs=e||"";break;case"ack":if((a=e.match(/^([0-9]+)(\+)?(.*)/))&&(n.ackId=a[1],n.args=[],a[3]))try{n.args=a[3]?s.parse(a[3]):[]}catch(e){}break;case"disconnect":n.reason=e}return n},n.decodePayload=function(e){if(""==e.charAt(0)){for(var t=[],r=1,i="";r<e.length;r++)""==e.charAt(r)?(t.push(n.decodePacket(e.substr(r+1).substr(0,i))),r+=Number(i)+1,i=""):i+=e.charAt(r);return t}return[n.decodePacket(e)]}}(void 0!==r?r:n.exports,void 0!==r?r:n.parent.exports),function(e,t){function n(e,t){this.socket=e,this.sessid=t,this.connectErrorCallback=void 0,this.isOpened=!1}e.Transport=n,t.util.mixin(n,t.EventEmitter),n.prototype.onData=function(e){if(this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout(),""!==e){var n=t.parser.decodePayload(e);if(n&&n.length)for(var r=0,i=n.length;r<i;r++)this.onPacket(n[r])}return this},n.prototype.onPacket=function(e){return this.socket.setHeartbeatTimeout(),"heartbeat"==e.type?this.onHeartbeat():("connect"==e.type&&""==e.endpoint&&this.onConnect(),"error"==e.type&&"reconnect"==e.advice&&(this.isOpened=!1),this.socket.onPacket(e),this)},n.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var e=this;this.closeTimeout=setTimeout(function(){e.onDisconnect()},this.socket.closeTimeout)}},n.prototype.onDisconnect=function(){return this.close&&this.isOpened&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},n.prototype.onConnect=function(){return this.socket.onConnect(),this.connectErrorCallback=void 0,this},n.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},n.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},n.prototype.packet=function(e){this.send(t.parser.encodePacket(e))},n.prototype.onHeartbeat=function(e){this.packet({type:"heartbeat"})},n.prototype.onOpen=function(){this.isOpened=!0,this.clearCloseTimeout(),this.socket.onOpen()},n.prototype.onClose=function(){this.isOpened=!1,this.socket.onClose(),this.onDisconnect()},n.prototype.prepareUrl=function(e){var n=this.socket.options;if(n["skipped handshake data"])return n.rewriteUrlForProxy(n["skipped handshake data"].websocketUrl+(e||""));var r=this.scheme()+"://"+n.host+":"+n.port+"/"+n.resource+"/"+t.protocol+"/"+this.name+"/"+this.sessid+(e||"");return n.rewriteUrlForProxy(r)},n.prototype.ready=function(e,t){t.call(this)},n.prototype.clearEventHandlers=function(){return this}}(void 0!==r?r:n.exports,void 0!==r?r:n.parent.exports),function(e,t,n){function r(e){if(this.options={port:80,secure:!1,document:"document"in n&&document,resource:"socket.io",transports:t.transports.slice(),"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":1/0,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!0,"auto connect":!0,"flash policy port":10843},t.util.merge(this.options,e),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1,this.disconnected=!1,this.options["sync disconnect on unload"]&&(!this.isXDomain()||t.util.ua.hasCORS)){var r=this;t.util.on(n,"unload",function(){r.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function i(){}e.Socket=r,t.util.mixin(r,t.EventEmitter),r.prototype.of=function(e){return this.namespaces[e]||(this.namespaces[e]=new t.SocketNamespace(this,e),""!==e&&this.namespaces[e].packet({type:"connect"})),this.namespaces[e]},r.prototype.publish=function(){var e;for(var t in this.emit.apply(this,arguments),this.namespaces)this.namespaces.hasOwnProperty(t)&&(e=this.of(t)).$emit.apply(e,arguments)},r.prototype.handshake=function(e){function n(t){t instanceof Error?r.onError(t.message):e.apply(null,t.split(":"))}var r=this,o=this.options;if(!r.disconnected){var s=o.rewriteUrlForProxy(["http"+(o.secure?"s":"")+":/",o.host+":"+o.port,o.resource,t.protocol,t.util.query(this.options.query,"t="+ +new Date)].join("/"));if(this.isXDomain()&&!t.util.ua.hasCORS){var a=document.getElementsByTagName("script")[0],c=document.createElement("script");c.src=s+"&jsonp="+t.j.length,a.parentNode.insertBefore(c,a),t.j.push(function(e){n(e),c.parentNode.removeChild(c)})}else{var u=t.util.request();u.open("GET",s,!0);var l=this.options.requestHeaders;void 0!==l&&Object.keys(l).forEach(function(e){u.setRequestHeader(e,l[e])}),u.onreadystatechange=function(){4==u.readyState&&(u.onreadystatechange=i,200==u.status?n(u.responseText):!r.reconnecting&&r.onError(u.responseText))},u.send(null)}}},r.prototype.getTransport=function(e){for(var n,r=e||this.transports,i=0;n=r[i];i++)if(t.Transport[n]&&t.Transport[n].check(this)&&(!this.isXDomain()||t.Transport[n].xdomainCheck()))return new t.Transport[n](this,this.sessionid);return null},r.prototype.connect=function(e){if(this.connecting||this.disconnected)return this;var n=this,r=function(r,i,o,s){function a(){if(!n.connected&&!n.disconnected)if(n.connecting=!1,clearTimeout(n.connectTimeoutTimer),n.options["try multiple transports"]){for(;n.remainingTransports.length>0&&n.remainingTransports.splice(0,1)[0]!=n.transport.name;);n.remainingTransports.length?c(n.remainingTransports):n.publish("connect_failed")}else n.publish("connect_failed")}function c(e){if(n.transport&&(n.transport.clearTimeouts(),n.transport.clearEventHandlers()),n.transport=n.getTransport(e),!n.transport||n.disconnected)return n.publish("connect_failed");n.transport.ready(n,function(){n.connecting=!0,n.publish("connecting",n.transport.name),n.transport.open(a),n.options["connect timeout"]&&(n.connectTimeoutTimer=setTimeout(function(){a()},n.options["connect timeout"]))})}n.sessionid=r,n.closeTimeout=1e3*o+2e3,n.heartbeatTimeout=1e3*i+2e3,n.transports=s?t.util.intersect(s.split(","),n.options.transports):n.options.transports,n.setHeartbeatTimeout(),n.remainingTransports=n.transports.slice(0),c(n.transports),n.once("connect",function(){clearTimeout(n.connectTimeoutTimer),e&&"function"==typeof e&&e()})};if(this.options["skipped handshake data"]){var i=this.options["skipped handshake data"];r("v4c-"+(new Date).getTime(),i.timeout,i.timeout,"websocket")}else this.handshake(r);return this},r.prototype.setHeartbeatTimeout=function(){clearTimeout(this.heartbeatTimeoutTimer);var e=this;this.heartbeatTimeoutTimer=setTimeout(function(){e.transport.onClose()},this.heartbeatTimeout)},r.prototype.packet=function(e){return this.connected&&!this.doBuffer?this.transport.packet(e):this.buffer.push(e),this},r.prototype.setBuffer=function(e){this.doBuffer=e,!e&&this.connected&&this.buffer.length&&(this.transport.payload(this.buffer),this.buffer=[])},r.prototype.disconnect=function(){return(this.connected||this.connecting)&&(this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted")),this.disconnected=!0,this},r.prototype.disconnectSync=function(){var e=t.util.request(),n=this.resource+"/"+t.protocol+"/"+this.sessionid;e.open("GET",n,!0),this.onDisconnect("booted")},r.prototype.isXDomain=function(){var e=n.location.port||("https:"==n.location.protocol?443:80);return this.options.host!==n.location.hostname||this.options.port!=e},r.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},r.prototype.onOpen=function(){this.open=!0},r.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},r.prototype.onPacket=function(e){this.of(e.endpoint).onPacket(e)},r.prototype.onError=function(e){e&&e.advice&&"reconnect"===e.advice&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",e&&e.reason?e.reason:e)},r.prototype.onDisconnect=function(e){var t=this.connected,n=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1,(t||n)&&(this.transport.close(),this.transport.clearTimeouts(),t?(this.publish("disconnect",e),"booted"!=e&&this.options.reconnect&&!this.reconnecting&&this.reconnect()):this.publish("close_during_connecting",e))},r.prototype.reconnect=function(){function e(){if(n.connected){for(var e in n.namespaces)n.namespaces.hasOwnProperty(e)&&""!==e&&n.namespaces[e].packet({type:"connect"});n.publish("reconnect",n.transport.name,n.reconnectionAttempts)}clearTimeout(n.reconnectionTimer),n.removeListener("connect_failed",t),n.removeListener("connect",t),n.reconnecting=!1,delete n.reconnectionAttempts,delete n.reconnectionDelay,delete n.reconnectionTimer,delete n.redoTransports,n.options["try multiple transports"]=i}function t(){if(n.reconnecting)return n.connected?e():n.connecting&&n.reconnecting?n.reconnectionTimer=setTimeout(t,1e3):void(n.reconnectionAttempts++>=r?n.redoTransports?(n.publish("reconnect_failed"),e()):(n.on("connect_failed",t),n.options["try multiple transports"]=!0,n.transport=n.getTransport(),n.redoTransports=!0,n.connect()):(n.reconnectionDelay<o&&(n.reconnectionDelay*=2),n.connect(),n.publish("reconnecting",n.reconnectionDelay,n.reconnectionAttempts),n.reconnectionTimer=setTimeout(t,n.reconnectionDelay)))}this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var n=this,r=this.options["max reconnection attempts"],i=this.options["try multiple transports"],o=this.options["reconnection limit"];this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(t,this.reconnectionDelay),this.on("connect",t)}}(void 0!==r?r:n.exports,void 0!==r?r:n.parent.exports,void 0===e?window:e),function(e,t){function n(e,t){this.socket=e,this.name=t||"",this.flags={},this.json=new r(this,"json"),this.ackPackets=0,this.acks={}}function r(e,t){this.namespace=e,this.name=t}e.SocketNamespace=n,t.util.mixin(n,t.EventEmitter),n.prototype.$emit=t.EventEmitter.prototype.emit,n.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},n.prototype.packet=function(e){return e.endpoint=this.name,this.socket.packet(e),this.flags={},this},n.prototype.send=function(e,t){var n={type:this.flags.json?"json":"message",data:e};return"function"==typeof t&&(n.id=++this.ackPackets,n.ack=!0,this.acks[n.id]=t),this.packet(n)},n.prototype.emit=function(e){var t=Array.prototype.slice.call(arguments,1),n=t[t.length-1],r={type:"event",name:e};return"function"==typeof n&&(r.id=++this.ackPackets,r.ack="data",this.acks[r.id]=n,t=t.slice(0,t.length-1)),r.args=t,this.packet(r)},n.prototype.disconnect=function(){return""===this.name?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},n.prototype.onPacket=function(e){function n(){r.packet({type:"ack",args:t.util.toArray(arguments),ackId:e.id})}var r=this;switch(e.type){case"connect":this.$emit("connect");break;case"disconnect":""===this.name?this.socket.onDisconnect(e.reason||"booted"):this.$emit("disconnect",e.reason||"");break;case"message":case"json":var i=["message",e.data];"data"==e.ack?i.push(n):e.ack&&this.packet({type:"ack",ackId:e.id}),this.$emit.apply(this,i);break;case"event":i=[e.name].concat(e.args),"data"==e.ack&&i.push(n),this.$emit.apply(this,i);break;case"ack":this.acks[e.ackId]&&(this.acks[e.ackId].apply(this,e.args),delete this.acks[e.ackId]);break;case"error":e.advice?this.socket.onError(e):"unauthorized"==e.reason?this.$emit("connect_failed",e.reason):this.$emit("error",e.reason)}},r.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},r.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}(void 0!==r?r:n.exports,void 0!==r?r:n.parent.exports),function(e,t,n){function r(e){t.Transport.apply(this,arguments)}function i(){}e.websocket=r,t.util.inherit(r,t.Transport),r.prototype.name="websocket",r.prototype.open=function(e){var r,i=t.util.query(this.socket.options.query),o=this;return this.connectErrorCallback=e,r||(r=n.MozWebSocket||n.WebSocket),this.websocket=new r(this.prepareUrl(i)),this.websocket.onopen=function(){o.onOpen(),o.socket.setBuffer(!1)},this.websocket.onmessage=function(e){o.onData(e.data)},this.websocket.onclose=function(){o.onClose(),o.socket.setBuffer(!0)},this.websocket.onerror=function(e){o.onError(e)},this},r.prototype.send=function(e){return this.websocket.send(e),this},r.prototype.payload=function(e){for(var t=0,n=e.length;t<n;t++)this.packet(e[t]);return this},r.prototype.close=function(){return this.websocket.close(),this},r.prototype.onError=function(e){void 0!==this.connectErrorCallback&&(this.connectErrorCallback(),this.connectErrorCallback=void 0),this.socket.onError(e)},r.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},r.check=function(){return"WebSocket"in n&&!("__addTask"in WebSocket)||"MozWebSocket"in n},r.xdomainCheck=function(){return!0},r.prototype.clearEventHandlers=function(){return this.websocket&&(this.websocket.onopen=this.websocket.onmessage=this.websocket.onclose=this.websocket.onerror=i),this},t.transports.push("websocket")}(void 0!==r?r.Transport:n.exports,void 0!==r?r:n.parent.exports,void 0===e?window:e),function(e,t,n){function r(e){e&&t.Transport.apply(this,arguments)}function i(){}e.XHR=r,t.util.inherit(r,t.Transport),r.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},r.prototype.payload=function(e){for(var n=[],r=0,i=e.length;r<i;r++)n.push(t.parser.encodePacket(e[r]));this.send(t.parser.encodePayload(n))},r.prototype.send=function(e){return this.post(e),this},r.prototype.post=function(e){var t=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),n.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=function(){this.onload=i,t.socket.setBuffer(!1)}:this.sendXHR.onreadystatechange=function(){4==this.readyState&&(this.onreadystatechange=i,200==this.status?(clearTimeout(this.ackTimeoutTimer),t.socket.setBuffer(!1)):t.onClose())},this.sendXHR.send(e),t.sendXHR.ackTimeoutTimer=setTimeout(function(){t.onClose()},t.socket.options.ackTimeoutMs)},r.prototype.close=function(){return this.onClose(),this},r.prototype.request=function(e){var n=t.util.request(this.socket.isXDomain()),r=t.util.query(this.socket.options.query,"t="+ +new Date);n.open(e||"GET",this.prepareUrl(r),!0);var i=this.socket.options.requestHeaders;if(void 0!==i&&Object.keys(i).forEach(function(e){n.setRequestHeader(e,i[e])}),"POST"==e)try{n.setRequestHeader?n.setRequestHeader("Content-type","text/plain;charset=UTF-8"):n.contentType="text/plain"}catch(e){}return n},r.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},r.check=function(e,r){try{var i=t.util.request(r),o=n.XDomainRequest&&i instanceof XDomainRequest,s=(e&&e.options&&e.options.secure?"https:":"http:")!=n.location.protocol;if(i&&(!o||!s))return!0}catch(e){}return!1},r.xdomainCheck=function(){return r.check(null,!0)},r.prototype.clearEventHandlers=function(){return this.sendXHR&&(this.sendXHR.onreadystatechange=this.sendXHR.onload=i),this}}(void 0!==r?r.Transport:n.exports,void 0!==r?r:n.parent.exports,void 0===e?window:e),function(e,t,n){function r(){t.Transport.XHR.apply(this,arguments)}function i(){}e["xhr-polling"]=r,t.util.inherit(r,t.Transport.XHR),t.util.merge(r,t.Transport.XHR),r.prototype.name="xhr-polling",r.prototype.open=function(e){return this.connectErrorCallback=e,t.Transport.XHR.prototype.open.call(this),!1},r.prototype.get=function(){if(this.isOpened){var e=this;this.xhr=this.request(),n.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=function(){e.connectErrorCallback=void 0,this.onload=i,this.onerror=i,e.onData(this.responseText),e.get()},this.xhr.onerror=function(){e.onClose(),void 0!==e.connectErrorCallback&&(e.connectErrorCallback(),e.connectErrorCallback=void 0)}):this.xhr.onreadystatechange=function(){4==this.readyState&&(this.onreadystatechange=i,200==this.status?(e.connectErrorCallback=void 0,e.onData(this.responseText),e.get()):(e.onClose(),void 0!==e.connectErrorCallback&&(e.connectErrorCallback(),e.connectErrorCallback=void 0)))},this.xhr.send(null)}},r.prototype.onClose=function(){if(t.Transport.XHR.prototype.onClose.call(this),this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=i;try{this.xhr.abort()}catch(e){}this.xhr=null}},r.prototype.ready=function(e,n){var r=this;t.util.defer(function(){n.call(r)})},r.prototype.clearEventHandlers=function(){return t.Transport.XHR.prototype.clearEventHandlers.call(this),this.xhr&&(this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=i),this},t.transports.push("xhr-polling")}(void 0!==r?r.Transport:n.exports,void 0!==r?r:n.parent.exports,void 0===e?window:e),t.io=r}).call(t,n(13),n(14)(e))},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectionTracker=t.Properties=t.TrackerStep=t.ClientEventName=t.ResponseData=void 0;var r,i=n(3),o=n(1),s=n(0);t.ResponseData=function(e){this.id=e,this.status=200,this.headers={},this.body=""},function(e){e.Connected="trouter_js_client_connected",e.Disconnected="trouter_js_client_disconnected",e.Error="trouter_js_client_error",e.Progress="trouter_js_client_progress",e.Response="trouter_js_client_response",e.Request="trouter_js_client_request",e.CheckConnection="trouter_js_client_check_connection",e.Registration="trouter_js_client_registration",e.Unregistration="trouter_js_client_unregistration"}(r||(t.ClientEventName=r={}));var a=function(e,t,n,r,i){this.stepName=e,this.operation=t,this.delta=n,this.ts=r,this.error=i};t.TrackerStep=a,t.Properties=function(){};var c=function(){this.numberOfPingReplies=0,this.connectedTimestamp=0,this.isNewUrl=!1,this.transportType="",this.connectionNumber=0},u=function(){this.enabled=!1,this.numberOfStepsToMaintain=40,this.logHealthCheckError=!1,this.sendProgressTimeoutSecs=55,this.logSendPingError=!1,this.maxBackoffInMs=12e4,this.trouter_js_client_connected=!1,this.trouter_js_client_disconnected=!1,this.trouter_js_client_error=!1,this.trouter_js_client_progress=!1,this.trouter_js_client_response=!1,this.trouter_js_client_request=!1,this.trouter_js_client_registration=!1,this.trouter_js_client_unregistration=!1,this.trouter_js_client_check_connection=!0},l=function(){function e(e,t,n,r,o,a,l){this.clientId=t,this.clientInfo=n,this.getServerState=r,this.endpointId=o,this.clientCorrelationID=a,this.environment=l,this.logger=new s.Logger("ConnectionTracker",e),this.clientCorrelationID=void 0!==a?a:"",this.steps=[],this.connectionAttempt=0,this.totalStepCount=0,this.beginTimestamp=new i.Timespan,this.eventLogSettings=new u,this.connectedInfo=new c}return e.prototype.enable=function(e){this.eventLogSettings.enabled=!0,this.eventLogger=e},e.prototype.disable=function(){this.eventLogSettings.enabled=!1},e.prototype.sendProgress=function(e){this.steps.length>0&&this.sendTelemetry(r.Progress,e,this.steps)},e.prototype.cancelProgressTimer=function(){void 0!==this.progressTimeout&&(clearTimeout(this.progressTimeout),this.progressTimeout=void 0)},e.prototype.resetProgressSendTimer=function(){var e=this;this.cancelProgressTimer(),void 0!==this.eventLogSettings.sendProgressTimeoutSecs&&this.eventLogSettings.sendProgressTimeoutSecs>0&&(this.progressTimeout=setTimeout(function(){e.sendProgress({reason:"timeout",timeoutSecs:e.eventLogSettings.sendProgressTimeoutSecs})},1e3*this.eventLogSettings.sendProgressTimeoutSecs))},e.prototype.setConnectedInfo=function(e,t){this.connectedInfo.numberOfPingReplies=0,this.connectedInfo.connectedTimestamp=Date.now(),this.connectedInfo.isNewUrl=e,this.connectedInfo.transportType=t,++this.connectedInfo.connectionNumber},e.prototype.clearConnectedInfo=function(){this.connectedInfo.numberOfPingReplies=0,this.connectedInfo.connectedTimestamp=0,this.connectedInfo.isNewUrl=!0,this.connectedInfo.transportType=""},e.prototype.copyProperties=function(e,t){for(var n=0,r=Object.keys(t);n<r.length;n++){var i=r[n];void 0!==t[i]&&(e[i.replace(/-/g,"_")]={value:t[i]})}},e.prototype.increasePingResponseCount=function(){++this.connectedInfo.numberOfPingReplies},e.prototype.sendTelemetry=function(e,t,n){try{if(!0===this.eventLogSettings.enabled&&!0===this.eventLogSettings[e]&&void 0!==this.eventLogger){var r=this.getServerState(),s={name:e,properties:{connectionAttempt:{value:this.connectionAttempt},epid:{value:this.endpointId},clientCorrelationID:{value:this.clientCorrelationID},steps:{value:(0,i.toJson)(n)},clientID:{value:this.clientId},eventVersion:{value:3},environment:{value:this.environment},cv:{value:o.CLIENT_VERSION},ua:{value:this.clientInfo.ua},connectionId:{value:r.connectionId},connectedClientId:{value:r.connectedClientId},domId:{value:r.domId},url:{value:r.unsecureUrl},surl:{value:r.url},ttlInSecs:{value:r.getRemainingTtlInSec()},numberOfPingReplies:{value:this.connectedInfo.numberOfPingReplies},connectedTimestamp:{value:this.connectedInfo.connectedTimestamp},isNewUrl:{value:this.connectedInfo.isNewUrl},transportType:{value:this.connectedInfo.transportType},connectionNumber:{value:this.connectedInfo.connectionNumber}}};this.copyProperties(s.properties,t),this.eventLogger.logEvent(s)}}catch(t){this.logger.warn("error in sending event ".concat(e,": ").concat((0,i.toJson)(t)))}},e.prototype.createStep=function(e,t,n){return new a(e,t,this.beginTimestamp.duration,Date.now(),n)},e.prototype.addStep=function(e,t,n){if(!1!==this.eventLogSettings.enabled&&(0===this.steps.length&&this.beginTimestamp.reset(),this.steps.push(this.createStep(e,t,n)),++this.totalStepCount,void 0!==this.eventLogSettings.numberOfStepsToMaintain&&this.steps.length>this.eventLogSettings.numberOfStepsToMaintain)){var i=this.steps.slice(0);this.steps.length=0,this.sendTelemetry(r.Progress,{reason:"flush"},i)}},e.prototype.trackStart=function(e){this.addStep(e,"start")},e.prototype.trackEnd=function(e){this.addStep(e,"end")},e.prototype.trackError=function(e,t,n,i){void 0===n&&(n=!0),"health"===e&&!0!==this.eventLogSettings.logHealthCheckError||"ping"===e&&!1===this.eventLogSettings.logSendPingError||(void 0===i&&(i="error"),!0===n&&this.addStep(e,i,t),this.sendTelemetry(r.Error,{},[this.createStep(e,i,t)]))},e.prototype.trackProgress=function(e,t){this.addStep(e,t)},e.prototype.trackConnected=function(e,t){this.setConnectedInfo(e,t);var n=this.steps.slice(0),i=this.totalStepCount,o=this.beginTimestamp.duration;this.steps.length=0,this.totalStepCount=0,this.sendTelemetry(r.Connected,{stepCount:n.length,totalStepCount:i,connectionEstablishmentMs_Total:o},n),this.cancelProgressTimer()},e.prototype.getSessionLength=function(){return Date.now()-this.connectedInfo.connectedTimestamp},e.prototype.trackDisconnected=function(e){e.sessionLengthMS=this.getSessionLength(),this.sendTelemetry(r.Disconnected,e,[]),this.resetProgressSendTimer()},e.prototype.trackNewConnection=function(){++this.connectionAttempt},e.prototype.trackRequest=function(e,t){var n={};void 0!==t&&(n.hasError=!0,n.error=t);try{if(e){n.requestID=e.id,n.httpMethod=e.method,n.url=e.url,n.bodyLength=e.body.length,n.shortUrl=e.shortUrl,n.requestTimeStamp=e.startTS,n.correlationVector=e.correlationVector;for(var o=e.headers,s=0,a=Object.keys(o);s<a.length;s++){var c=a[s];n[c]=o[c]}}}catch(e){n.hasError=!0,n.error="".concat(n.error," error creating request context ").concat((0,i.toJson)(e))}this.sendTelemetry(r.Request,n,[])},e.prototype.trackResponse=function(e,t,n,o){var s={};void 0!==o&&(s.hasError=!0,s.error=o);try{if(s.responseTimestamp=void 0!==n?n.sentTS:Date.now(),e){s.requestID=e.id,s.httpMethod=e.method,s.shortUrl=e.shortUrl,s.correlationVector=e.correlationVector;for(var a=e.headers,c=0,u=Object.keys(a);c<u.length;c++){var l=u[c];s[l]=a[l]}}n&&(s.latencyMS=t,s.responseCode=n.status,s.responseLength=n.body.length)}catch(e){s.hasError=!0,s.error="".concat(s.error," error creating response context ").concat((0,i.toJson)(e))}this.sendTelemetry(r.Response,s,[])},e.prototype.sendResponseError=function(e,t,n){this.trackResponse(t,void 0,n,e)},e.prototype.close=function(){this.sendProgress({reason:"closed"}),this.steps.length=0,this.cancelProgressTimer()},e.prototype.mergeSettings=function(e){if(e){this.eventLogSettings.numberOfStepsToMaintain=Math.min(40,Math.max(10,void 0!==e.numberOfStepsToMaintain?e.numberOfStepsToMaintain:0));var t=Math.min(3600,Math.max(55,void 0!==e.sendProgressTimeoutSecs?e.sendProgressTimeoutSecs:0));this.eventLogSettings.logHealthCheckError=e.logHealthCheckError,this.eventLogSettings.logSendPingError=e.logSendPingError;for(var n=0,i=Object.keys(r).map(function(e){return r[e]});n<i.length;n++){var o=i[n];void 0!==e[o]&&(this.eventLogSettings[o]=e[o])}this.eventLogSettings.sendProgressTimeoutSecs!==t&&(this.eventLogSettings.sendProgressTimeoutSecs=t,this.resetProgressSendTimer())}},e}();t.ConnectionTracker=l},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.DisconnectReason=void 0;var r=function(){function e(e,t,n){this.reason=e,this.claims=t,this.details=n}return e.fromRawReason=function(t,n){if(""===t||"dup"===t)return new e(t);try{var r=JSON.parse(t);return"object"!=typeof r||void 0===r.reason?(null==n||n.error("invalid disconnect reason format"),new e("unknown",void 0,t)):new e(r.reason,r.claims,r.details)}catch(n){return new e("disconnect",void 0,t)}},e.fromSocketIoEventData=function(t,n){return"string"==typeof n?new e(t,void 0,n):void 0},e.prototype.toTelemetryString=function(){return"socketerror"===this.reason||"reconnecterror"===this.reason||"disconnect"===this.reason?this.details:this.reason},e}();t.DisconnectReason=r},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.ExponentialBackoff=void 0;var r=function(){function e(e,t,n){void 0===n&&(n={tolerance:2,minimumWaitMs:1e4}),this.logger=e,this.maxBackoffInMs=t,this.gapDetectionSettings=n,this.backoffId=0,this.backoffCount=0}return e.calculateNextBackoffMs=function(e,t){var n=1+.4*(Math.random()-.5),r=1e3*Math.pow(2,e)*n;return r=Math.round(r),Math.min(t,r)},e.prototype.setMaxBackoffMs=function(e){this.maxBackoffInMs=e},e.prototype.backoff=function(t,n){var r=this;if(void 0!==this.timerHandle&&(this.logger.debug("Clearing current back off"),clearTimeout(this.timerHandle),this.timerHandle=void 0),void 0!==this.previousCompleteTime){var i=Date.now()-this.previousCompleteTime;i>this.maxBackoffInMs*this.gapDetectionSettings.tolerance&&i>this.gapDetectionSettings.minimumWaitMs&&(this.logger.info("Back off for ".concat(t," with ID ").concat(this.backoffId," will be reset due to a lot of time having passed since the previous backoff (").concat(i," ms)")),this.backoffCount=0,this.previousCompleteTime=void 0)}var o=e.calculateNextBackoffMs(this.backoffCount,this.maxBackoffInMs);this.backoffId++,this.backoffCount++,this.logger.info("Backing off ".concat(t," for ").concat(o," milliseconds with ID ").concat(this.backoffId)),this.callback=function(e,i){(function(e,t,n){if(void 0===e||void 0===t)return!1;var r=Date.now()-e;return r>t*n.tolerance&&r>n.minimumWaitMs})(e,i,r.gapDetectionSettings)&&(r.logger.info("Back off for ".concat(t," with ID ").concat(r.backoffId," will be reset due to the wait (").concat(Date.now()-(null!=e?e:0)," ms) being longer than expected (").concat(i," ms)")),r.backoffCount=0),r.logger.info("Back off for ".concat(t," with ID ").concat(r.backoffId," complete, invoking handler")),r.timerHandle=void 0,r.callback=void 0,r.previousCompleteTime=Date.now(),n()};var s=Date.now();this.timerHandle=setTimeout(function(){var e;return null===(e=r.callback)||void 0===e?void 0:e.call(r,s,o)},o)},e.prototype.reset=function(){void 0!==this.timerHandle&&(this.logger.debug("Resetting back off with ID ".concat(this.backoffId)),clearTimeout(this.timerHandle),this.timerHandle=void 0,this.callback=void 0),this.backoffCount=0},e.prototype.expediteIfPending=function(){if(this.backoffCount=0,void 0!==this.timerHandle){this.logger.debug("Expediting back off with ID ".concat(this.backoffId)),clearTimeout(this.timerHandle),this.timerHandle=void 0;var e=this.callback;this.callback=void 0,e&&e()}},e}();t.ExponentialBackoff=r},function(e,t,n){var r=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.LoggingManagerConsumer=t.RegistrationEnforcer=void 0;var i=n(6),o=function(){function e(e,t,n){this.wrapped=e,this.shouldConnectionDependOnRegistration=t,this.shouldHoldBackEvents=n,this.isRegistered=!1,this.heldBackEvents=[]}return e.prototype.onDownstreamRequest=function(e,t,n){this.passIfRegisteredOrNotNeeded("onDownstreamRequest",e,t,n)},e.prototype.onConnected=function(e){this.passIfRegisteredOrNotNeeded("onConnected",e)},e.prototype.onRegistered=function(e){this.isRegistered=!0,this.wrapped.onRegistered(e),this.fireHeldBackEvents()},e.prototype.onUnregistered=function(e){this.isRegistered=!1,this.wrapped.onUnregistered(e),e.getState()===i.State.Connected&&this.shouldConnectionDependOnRegistration()&&e.forceReconnectDueToNoRegistration()},e.prototype.onReconnecting=function(e){this.wrapped.onReconnecting(e)},e.prototype.onReconnectIsRequired=function(e,t,n){this.wrapped.onReconnectIsRequired(e,t,n)},e.prototype.onDisconnected=function(e){this.isRegistered=!1,this.dropHeldBackEvents(),this.wrapped.onDisconnected(e)},e.prototype.onTerminalError=function(e){this.wrapped.onTerminalError(e)},e.prototype.onConnectionParametersUpdated=function(e){this.wrapped.onConnectionParametersUpdated(e)},e.prototype.onTrouterMessageLost=function(e){this.passIfRegisteredOrNotNeeded("onTrouterMessageLost",e)},e.prototype.onUserActivityStateAccepted=function(e){this.passIfRegisteredOrNotNeeded("onUserActivityStateAccepted",e)},e.prototype.onAudiencesSetResolved=function(e,t){this.passIfRegisteredOrNotNeeded("onAudiencesSetResolved",e,t)},e.prototype.getState=function(){return this.wrapped.getState()},e.prototype.holdBackEvent=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.heldBackEvents.push({kind:e,args:t})},e.prototype.passIfRegisteredOrNotNeeded=function(e){for(var t,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];var o=this.shouldConnectionDependOnRegistration(),s=this.shouldHoldBackEvents();o&&s||this.fireHeldBackEvents(o?function(e){return"onConnected"!==e.kind}:void 0),this.isRegistered||!o||!1===s&&"onConnected"!==e?(t=this.wrapped)[e].apply(t,n):this.holdBackEvent.apply(this,r([e],n,!1))},e.prototype.fireHeldBackEvents=function(e){for(var t,n=0,r=this.heldBackEvents;n<r.length;n++){var i=r[n];(void 0===e||e(i))&&(t=this.wrapped)[i.kind].apply(t,i.args)}this.heldBackEvents=void 0===e?[]:this.heldBackEvents.filter(function(t){return!e(t)})},e.prototype.dropHeldBackEvents=function(){this.heldBackEvents=[]},e}();t.RegistrationEnforcer=o;var s=function(){function e(e,t,n,r){this.wrapped=e,this.prefix=t,this.logger=n,this.onEventAction=r}return e.prototype.onEvent=function(e,t){var n;void 0!==this.onEventAction?this.onEventAction(e,t):(null!==(n=this.logger)&&void 0!==n?n:console).log("".concat(this.prefix," TracingEnforcer: ").concat(e,"(").concat(t,")"))},e.prototype.onDownstreamRequest=function(e,t,n){this.onEvent("onDownstreamRequest",JSON.stringify({request:t,response:n})),this.wrapped.onDownstreamRequest(e,t,n)},e.prototype.onConnected=function(e){this.onEvent("onConnected",e.getState().toString()),this.wrapped.onConnected(e)},e.prototype.onRegistered=function(e){this.onEvent("onRegistered",e.getState().toString()),this.wrapped.onRegistered(e)},e.prototype.onUnregistered=function(e){this.onEvent("onUnregistered",e.getState().toString()),this.wrapped.onUnregistered(e)},e.prototype.onReconnecting=function(e){this.onEvent("onReconnecting",e.getState().toString()),this.wrapped.onReconnecting(e)},e.prototype.onReconnectIsRequired=function(e,t,n){this.onEvent("onReconnectIsRequired",JSON.stringify({connection:e.getState().toString(),useConnectParamsFromCache:t,reason:n})),this.wrapped.onReconnectIsRequired(e,t,n)},e.prototype.onDisconnected=function(e){this.onEvent("onDisconnected",e.getState().toString()),this.wrapped.onDisconnected(e)},e.prototype.onTerminalError=function(e){this.onEvent("onTerminalError",JSON.stringify({connection:e})),this.wrapped.onTerminalError(e)},e.prototype.onConnectionParametersUpdated=function(e){this.onEvent("onConnectionParametersUpdated",JSON.stringify({connectParams:e})),this.wrapped.onConnectionParametersUpdated(e)},e.prototype.onTrouterMessageLost=function(e){this.onEvent("onTrouterMessageLost",JSON.stringify({flowTags:e})),this.wrapped.onTrouterMessageLost(e)},e.prototype.onUserActivityStateAccepted=function(e){this.onEvent("onUserActivityStateAccepted",JSON.stringify({cv:e})),this.wrapped.onUserActivityStateAccepted(e)},e.prototype.onAudiencesSetResolved=function(e,t){this.onEvent("onAudiencesSetResolved",JSON.stringify({audienceSubscriptionsResponse:e,cv:t})),this.wrapped.onAudiencesSetResolved(e,t)},e.prototype.getState=function(){return this.wrapped.getState()},e}();t.LoggingManagerConsumer=s},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.TrouterManagerFsm=void 0;var r=n(2),i=n(4),o=n(0),s=n(7),a=function(){function e(e,t){this.worker=t,this.state=i.TrouterManagerState.Unknown,this.logger=new o.Logger("ManagerFsm",e)}return e.prototype.start=function(){this.state===i.TrouterManagerState.Unknown?(this.setState(i.TrouterManagerState.Disconnected),this.worker.forceStopLingeringConnection(),this.worker.startFirstConnection()):(this.logger.info("start called in state '".concat(i.TrouterManagerState[this.state],"', expediting pending backoffs, if any")),this.worker.expediteBackoffOnConnections())},e.prototype.stop=function(e){this.state!==i.TrouterManagerState.Unknown?(this.setState(i.TrouterManagerState.Unknown),this.worker.stopFirstConnection(!0===e),this.worker.stopSecondConnection(!0===e)):this.showIgnored("stop")},e.prototype.getState=function(){switch(this.state){case i.TrouterManagerState.Unknown:case i.TrouterManagerState.Connected:case i.TrouterManagerState.Disconnected:case i.TrouterManagerState.Switching:return this.state;case i.TrouterManagerState.TerminalError:return r.TrouterState.Disconnected}},e.prototype.getInternalState=function(){return this.state},e.prototype.onConnected=function(e){this.state===i.TrouterManagerState.Disconnected&&e?this.worker.doesSecondConnectionExist()?this.setState(i.TrouterManagerState.Switching):(this.setState(i.TrouterManagerState.Connected),this.worker.dispatchConnected()):this.showIgnored("onConnected(".concat(e,")"))},e.prototype.onRegistered=function(e){this.state!==i.TrouterManagerState.Disconnected||e?this.state!==i.TrouterManagerState.Switching||e?this.state===i.TrouterManagerState.Disconnected&&e&&(this.setState(i.TrouterManagerState.Connected),this.worker.dispatchConnected()):(this.setState(i.TrouterManagerState.Connected),this.worker.switchConnections(),this.worker.stopSecondConnectionDelayed(),this.worker.dispatchConnected()):(this.setState(i.TrouterManagerState.Connected),this.worker.switchConnections(),this.worker.stopSecondConnection(!0),this.worker.dispatchConnected()),this.worker.dispatchRegistrationState(!0)},e.prototype.onUnregistered=function(e){e&&this.worker.dispatchRegistrationState(!1)},e.prototype.onReconnecting=function(e){this.state!==i.TrouterManagerState.Connected&&this.state!==i.TrouterManagerState.Switching||!e?this.showIgnored("onReconnecting(".concat(e,")")):(this.setState(i.TrouterManagerState.Disconnected),this.worker.dispatchDisconnected())},e.prototype.onReconnectionRequired=function(e,t,n){this.state===i.TrouterManagerState.Connected&&e?(this.setState(i.TrouterManagerState.Switching),this.worker.startSecondConnection(t)):this.state===i.TrouterManagerState.Disconnected&&e?this.worker.startSecondConnection(t):this.state===i.TrouterManagerState.Switching&&e&&n===s.ReconnectReason.Configuration?(this.logger.debug("onReconnectionRequired: switch requested while already in Switching state"),this.worker.stopSecondConnection(!0),this.worker.startSecondConnection(t)):this.showIgnored("onReconnectionRequired(".concat(e,")"))},e.prototype.onDisconnected=function(e){this.state==i.TrouterManagerState.Unknown&&e?this.worker.dispatchDisconnected():this.state==i.TrouterManagerState.Switching&&e?(this.worker.switchConnections(),this.worker.stopSecondConnection(!1),this.setState(i.TrouterManagerState.Disconnected),this.worker.dispatchDisconnected()):this.showIgnored("onDisconnected(".concat(e,")"))},e.prototype.onTerminalError=function(){this.setState(i.TrouterManagerState.TerminalError),this.worker.dispatchTerminalError()},e.prototype.showIgnored=function(e){this.logger.info("Ignoring event '".concat(e,"' in state '").concat(i.TrouterManagerState[this.state],"'"))},e.prototype.setState=function(e){this.logger.info("Switching from state '".concat(i.TrouterManagerState[this.state],"' to state '").concat(i.TrouterManagerState[e],"'")),this.state!==e?this.state=e:this.logger.error("Attempt to switch to the current state '".concat(i.TrouterManagerState[e],"'"))},e}();t.TrouterManagerFsm=a},function(e,t,n){function r(e,t){if(!t)return e;var n=o(o({},e),{enabled:t.TelemetryEnabled});return void 0!==t.ClientTelemetryEventEnabled&&(n=o(o({},n),t.ClientTelemetryEventEnabled)),n}function i(e,t,n){var i,s,a,c,u,l,d,h,p,f,g=function(n){return e.proxyUrlRewrite?(t.info("Using rewritten URL for proxy"),e.proxyUrlRewrite(n)):n};return{clientInfo:{ua:e.trouterSettings.productName,v:e.trouterSettings.version},ioOptions:{ackTimeoutMs:5e3,rewriteUrlForProxy:g},clientCorrelationID:e.trouterSettings.sessionId,environment:e.trouterSettings.environment,telemetrySettings:r(e.telemetryConfig.settings,n),eventLogger:e.telemetryConfig.eventLogger,endpointId:e.trouterSettings.registrationId,trouterUrl:(null==n?void 0:n.TrouterConnectionUrl)||e.trouterSettings.trouterServiceUrl,registration:e.trouterSettings.registrarServiceUrl?{registrarUrl:e.trouterSettings.registrarServiceUrl,registrationId:null!==(i=e.trouterSettings.registrationId)&&void 0!==i?i:"",pnhAppId:null!==(s=e.trouterSettings.pnhAppId)&&void 0!==s?s:"",platform:null!==(a=e.trouterSettings.platform)&&void 0!==a?a:"",pnhTemplateKey:null!==(c=e.trouterSettings.pnhTemplate)&&void 0!==c?c:"",platformUIVersion:null!==(u=e.trouterSettings.platformUIVersion)&&void 0!==u?u:"",productContext:e.trouterSettings.pnhProductContext||void 0,context:null!==(l=e.trouterSettings.pnhContext)&&void 0!==l?l:"",registrarTtlSec:(null!==(d=e.trouterSettings.maxRegistrationTimeInMs)&&void 0!==d?d:0)/1e3}:void 0,connectionDependsOnRegistration:void 0===e.trouterSettings.registrarServiceUrl?function(){return!1}:null!==(h=e.trouterSettings.connectionDependsOnRegistration)&&void 0!==h?h:function(){return!1},delayEventsUntilRegistered:null!==(p=e.trouterSettings.delayEventsUntilRegistered)&&void 0!==p?p:function(){return!1},timeoutOptions:o({connectionTimeoutMs:e.trouterSettings.trouterConnectTimeoutInMs||3e4,fetchTimeoutMs:1e4,pingTimeoutMs:4e4,pongTimeoutMs:5e3,maxBackoffMs:"TeamsCDL"===e.trouterSettings.productName?3e5:3e4,requestTimeoutMs:5e3,userActivityResponseTimeoutMs:1e4},e.trouterSettings.timeoutOptions),incallTimeoutOptions:o({connectionTimeoutMs:1e4,fetchTimeoutMs:5e3,pingTimeoutMs:5e3,pongTimeoutMs:2e3,maxBackoffMs:"TeamsCDL"===e.trouterSettings.productName?3e5:1e4,requestTimeoutMs:5e3,userActivityResponseTimeoutMs:1e4},e.trouterSettings.incallTimeoutOptions),incallModeTimeoutMs:null!==(f=e.trouterSettings.incallModeTimeoutMs)&&void 0!==f?f:0,lingeringConnectionDelayMs:6e4,userActivitySecondResendDelayMs:e.trouterSettings.userActivitySecondResendDelayMs||1e4,duplicateDisconnectThresholdMs:1e4,connectionCache:e.connectionCache,registrationStateCallback:e.registrationStateCallbackForAcsDoNotUse,rewriteUrlForProxy:g,retryLimitOnTokenFetch:e.trouterSettings.retryLimitOnTokenFetch,extraConnectionHeaders:e.trouterSettings.extraConnectionHeaders,expediteBackoffOnStartMinimumDelayMs:1e4,toJSON:function(){return o(o({},this),{connectionCache:this.connectionCache?{}:this.connectionCache})}}}var o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},o.apply(this,arguments)},s=this&&this.__awaiter||function(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?n(e.value):i(e.value).then(s,a)}c((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;a&&(a=0,n[0]&&(c=0)),c;)try{if(i=1,o&&(s=2&n[0]?o.return:n[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(s=(s=c.trys).length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){c.label=n[1];break}if(6===n[0]&&c.label<s[1]){c.label=s[1],s=n;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(n);break}s[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,s,a,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(t,"__esModule",{value:!0}),t.replaceTrouterUrlBase=t.getTrouterServiceVersion=t.createTrouterService=t.TrouterService=t.UserActivityState=t.TrouterState=void 0;var c=n(1),u=n(2);Object.defineProperty(t,"TrouterState",{enumerable:!0,get:function(){return u.TrouterState}}),Object.defineProperty(t,"UserActivityState",{enumerable:!0,get:function(){return u.UserActivityState}});var l=n(0),d=n(8),h=n(9),p=n(10),f=n(11),g=function(){function e(e){this.logProvider=e,this.stateChangedListeners=[],this.logger=new l.Logger("Trouter",e),this.trouterUrlPromise=new f.TrouterUrlPromise(e),this.messageHandlers=new d.MessageHandlerRegistry(e),this.listeners={},this.connectionInfo=null,this.logger.info("Created TrouterService version ".concat(c.CLIENT_VERSION))}return e.prototype.start=function(e){var t;if(this.logger.info("Start"),!e.skypeTokenProvider&&!e.authTokenProvider)throw new Error("no token provider has been configured, either skypeTokenProvider or authTokenProvider must be populated");e.skypeTokenProvider&&!e.trouterSettings.disableInternalSkypeTokenCache&&(e.skypeTokenProvider=(0,h.addCacheAsBackupTo)(e.skypeTokenProvider)),this.trouterCfg=e;var n=i(e,this.logger,this.ecsCfg);!1===e.internalEnableV4cProtocol&&(n.forceV4aProtocol=!0);var r=function(e,t){var n,r=this;return function(i){return s(r,void 0,void 0,function(){var r,o,s;return a(this,function(a){switch(a.label){case 0:r=new Date,o=setInterval(function(){var t=Math.round((Date.now()-r.getTime())/6e4);e.warn("Note: Trouter auth token request promise from ".concat(r.toISOString()," has not been resolved for ").concat(t," minutes. The client is blocked from operating properly"))},3e5),a.label=1;case 1:return a.trys.push([1,,3,4]),[4,t(i)];case 2:return s=a.sent(),i.needFresh&&s.token===n&&e.error("API violation: Trouter auth token provider got a request with needRefresh=true, but returned the same token as last time anyway. Please fix the host app"),n=s.token,[2,s];case 3:return clearInterval(o),[7];case 4:return[2]}})})}}(this.logger,null!==(t=e.authTokenProvider)&&void 0!==t?t:function(e){var t=this;return function(n){return s(t,void 0,void 0,function(){var t;return a(this,function(r){switch(r.label){case 0:return t={},[4,e(n.needFresh)];case 1:return[2,(t.token=r.sent(),t.tokenType="skype",t)]}})})}}(e.skypeTokenProvider));void 0===this.trouterServer&&(this.trouterServer=new p.TrouterManager(this.logProvider,n,r,void 0===e.authTokenProvider,this)),void 0!==this.pendingActivityState&&(this.trouterServer.setUserActivityState(this.pendingActivityState[0],this.pendingActivityState[1]),this.pendingActivityState=void 0),this.trouterServer.start()},e.prototype.stop=function(e){this.logger.info("close connection"),this.trouterUrlPromise.rejectUrl(new Error("TrouterService is stopped")),void 0!==this.trouterServer&&this.trouterServer.stop(e)},e.prototype.setEcsConfig=function(e){return s(this,void 0,void 0,function(){var t=this;return a(this,function(n){return[2,new Promise(function(n){if(t.ecsCfg=e.TrouterJScriptClient,t.logger.info("Setting ECS configuration to ".concat(JSON.stringify(t.ecsCfg))),void 0!==t.trouterServer&&void 0!==t.trouterCfg){var r=i(t.trouterCfg,t.logger,t.ecsCfg);t.trouterServer.configure(r)}n()})]})})},e.prototype.checkConnection=function(e){void 0!==this.trouterServer&&this.trouterServer.checkConnection(null!=e&&e)},e.prototype.resendRegistration=function(){return s(this,void 0,void 0,function(){return a(this,function(e){if(!this.trouterServer)throw new Error("resendRegistration called too early");return[2,this.trouterServer.resendRegistration()]})})},e.prototype.registerListener=function(e,t){return""===t||!t.startsWith("/")||t.includes("?")||t.includes("#")?(this.logger.error("Listener path '".concat(t,"' is not valid")),!1):this.listeners[t]?(this.logger.error("Another listener is already registered for path '".concat(t,"'")),!1):(this.listeners[t]=e,this.logger.debug("Listener for path '".concat(t,"' registered")),this.connectionInfo&&e.onTrouterConnected(this.connectionInfo.baseEndpointUrl+t,this.connectionInfo),!0)},e.prototype.unregisterListener=function(e){for(var t=[],n=0,r=Object.keys(this.listeners);n<r.length;n++){var i=r[n];this.listeners[i]===e&&t.push(i)}if(0===t.length)return!1;for(var o=0,s=t;o<s.length;o++)i=s[o],delete this.listeners[i];return this.logger.debug("Listener for path(s) '".concat(t.join("', '"),"' unregistered")),!0},e.prototype.onTrouterConnected=function(e,t){this.logger.debug("Trouter is now connected");for(var n=0,r=Object.keys(this.listeners);n<r.length;n++){var i=r[n];try{this.listeners[i].onTrouterConnected(t.baseEndpointUrl+i,t)}catch(e){this.logger.error("Listener '".concat(i,"' threw an exception from onTrouterConnected(): ").concat(e))}}this.connectionInfo=t,this.trouterUrlPromise.resolveUrl(e),this.notifyStateChanged(u.TrouterState.Connected,{url:e,getRemainingTtlInSec:function(){return t.connectionTtlSec}})},e.prototype.onTrouterDisconnected=function(){this.logger.debug("Trouter is now disconnected"),this.connectionInfo=null;for(var e=0,t=Object.keys(this.listeners);e<t.length;e++){var n=t[e],r=this.listeners[n];if(r.onTrouterDisconnected)try{r.onTrouterDisconnected()}catch(e){this.logger.error("Listener '".concat(n,"' threw an exception from onTrouterDisconnected(): ").concat(e))}}this.notifyStateChanged(u.TrouterState.Disconnected)},e.prototype.onTrouterRequest=function(e,t){for(var n="",r=0,i=Object.keys(this.listeners);r<i.length;r++){var o=i[r];e.path.startsWith(o)&&o.length>n.length&&(n=o)}if(""===n)this.tryMessageHandlers(e,t)||(t.status=404,t.headers={"Trouter-Responder":"ClientLib"},t.send());else try{this.listeners[n].onTrouterRequest(e,t)}catch(e){this.logger.error("Listener '".concat(n,"' threw an exception from onTrouterRequest(): ").concat(e)),t.status=500,t.headers={"Trouter-Responder":"ClientLib"},t.send()}},e.prototype.onTrouterMessageLoss=function(e){this.logger.info("onTrouterMessageLoss called with tags [".concat(e,"]"));for(var t=!0,n=0,r=Object.keys(this.listeners);n<r.length;n++){var i=r[n],o=this.listeners[i];if(o.onTrouterMessageLoss)try{void 0===(t=o.onTrouterMessageLoss(e)&&t)&&(this.logger.error("Listener '".concat(i,"' did not return a boolean value from onTrouterMessageLoss()")),t=!1)}catch(e){this.logger.error("Listener '".concat(i,"' threw an exception from onTrouterMessageLoss(): ").concat(e)),t=!1}}return t},e.prototype.onTrouterUserActivityStateAccepted=function(e){this.logger.debug("onTrouterUserActivityStateAccepted cv: ".concat(e));for(var t=0,n=Object.keys(this.listeners);t<n.length;t++){var r=n[t],i=this.listeners[r];if(i.onTrouterUserActivityStateAccepted)try{i.onTrouterUserActivityStateAccepted(e)}catch(e){this.logger.error("Listener '".concat(r,"' threw an exception from onTrouterUserActivityStateAccepted(): ").concat(e))}}},e.prototype.onAudiencesSetResolved=function(e,t){this.logger.debug("onAudiencesSetResolved cv: ".concat(t));for(var n=0,r=Object.keys(this.listeners);n<r.length;n++){var i=r[n],o=this.listeners[i];if(o.onAudiencesSetResolved)try{o.onAudiencesSetResolved(e,t)}catch(e){this.logger.error("Listener '".concat(i,"' threw an exception from onAudienceSubscribed(): ").concat(e))}}},e.prototype.setUserActivityState=function(e,t){if(e!==u.UserActivityState.Active&&e!==u.UserActivityState.Inactive)throw new Error("setUserActivityState called with unsupported value ".concat(e));this.logger.info("setUserActivityState called with value ".concat(u.UserActivityState[e])),this.trouterServer&&this.state()!==u.TrouterState.Unknown?this.trouterServer.setUserActivityState(e,t):(this.pendingActivityState=[e,t],this.logger.warn("setUserActivityState called before start() or after stop()"))},e.prototype.setAudienceSubscriptions=function(e,t){if(e.audienceSubscriptions.length>1)throw new Error("Only singular audience subscription is supported");if(this.trouterServer&&this.state()!==u.TrouterState.Unknown)return this.trouterServer.setAudienceSubscriptionsAsync(e,15e3,t);throw new Error("audience subscribe called before start() or after stop()")},e.prototype.state=function(){return void 0!==this.trouterServer?this.trouterServer.getState():u.TrouterState.Unknown},e.prototype.isInTerminalState=function(){return void 0!==this.trouterServer&&this.trouterServer.isInTerminalState()},e.prototype.reportStateInfo=function(){return void 0===this.trouterServer?"":this.trouterServer.reportStateInfo()},e.prototype.getServerState=function(){if(void 0!==this.trouterServer)return this.trouterServer.getServerState()},e.prototype.getTrouterUrlAsync=function(){return void 0!==this.trouterServer?this.trouterUrlPromise.getPromise():Promise.reject(new Error("TrouterService has not been started"))},e.prototype.onStateChanged=function(e){if(this.logger.info("onStateChanged called"),void 0===e)this.stateChangedListeners=this.stateChangedListeners.filter(function(e){return void 0===e.wrappedCallback});else{this.offStateChanged(e);var t=function(t,n){e(t,n?n.url:"")};t.wrappedCallback=e,this.stateChangedListeners.push(t)}},e.prototype.offStateChanged=function(e){this.logger.info("offStateChanged called");var t=this.stateChangedListeners.length;return this.stateChangedListeners=this.stateChangedListeners.filter(function(t){return t.wrappedCallback!==e}),t>this.stateChangedListeners.length},e.prototype.addCallback=function(e){this.logger.info("addListener called"),-1===this.stateChangedListeners.indexOf(e,0)&&void 0!==e&&this.stateChangedListeners.push(e)},e.prototype.removeCallback=function(e){this.logger.info("removeListener called");var t=this.stateChangedListeners.indexOf(e,0);return t>-1&&(this.stateChangedListeners.splice(t,1),!0)},e.prototype.registerMessageHandler=function(e){this.logger.info("registerMessageHandler is called"),this.messageHandlers.register(e)},e.prototype.clearMessageHandlers=function(){this.logger.info("clearMessageHandlers is called"),this.messageHandlers.clear()},e.prototype.notifyStateChanged=function(e,t){var n=this;this.logger.info("notifyStateChanged called, will forward to ".concat(this.stateChangedListeners.length," listeners")),this.stateChangedListeners.forEach(function(r){try{r(e,t)}catch(e){n.logger.error("Error in callback ".concat(e))}})},e.prototype.tryMessageHandlers=function(e,t){if(!this.messageHandlers.active())return!1;var n,r=null;try{r=(n=JSON.parse(e.body))&&(n.evt||n.eventId)||null}catch(e){}var i={eventId:r,url:(this.connectionInfo?this.connectionInfo.baseEndpointUrl:"")+e.path,body:n,rawBody:e.body,headers:e.headers},o=this.messageHandlers.handleMessage(i);return!!o.isHandled&&(t.status=o.resultCode,o.responseHeaders&&(t.headers=o.responseHeaders),o.responseBody&&(t.body=o.responseBody),t.send(),!0)},e}();t.TrouterService=g,t.createTrouterService=function(e){return new g(e)},t.getTrouterServiceVersion=function(){return c.CLIENT_VERSION},t.replaceTrouterUrlBase=function(e,t){var n=e.indexOf("://");if(n>=0){var r=e.indexOf("/",n+3);if(r>=0)return t+e.substr(r)}return""}},function(e,t){e.exports=n}]))});p(m);var v=f(function(e,t){var n,r;Object.defineProperty(t,"__esModule",{value:!0}),t.PACKAGE_VERSION=t.CONFIG_API_VERSION=t.EudbCountries=t.CloudPrefix=t.CloudType=t.MAX_NUMBER_OF_TOKEN_FETCH_RETRIES=void 0,t.MAX_NUMBER_OF_TOKEN_FETCH_RETRIES=3,function(e){e.Public="Public",e.GccHigh="GCC High",e.Dod="DoD"}(n||(t.CloudType=n={})),function(e){e.OrgId="orgid",e.Acs="acs",e.Spool="spool",e.GccHigh="gcch",e.GccHighAcs="gcch-acs",e.Dod="dod",e.DodAcs="dod-acs"}(r||(t.CloudPrefix=r={})),t.EudbCountries=["europe","france","germany","norway","switzerland","sweden"],t.CONFIG_API_VERSION="2024-09-01",t.PACKAGE_VERSION="1.0.0-beta.30"});p(v),v.PACKAGE_VERSION,v.CONFIG_API_VERSION,v.EudbCountries,v.CloudPrefix,v.CloudType,v.MAX_NUMBER_OF_TOKEN_FETCH_RETRIES;var y=v,C=f(function(e,t){var n=h&&h.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.isEudbLocation=t.parseTokenCredential=t.base64decode=t.toTelemetrySender=t.toLogProvider=t.toMessageHandler=void 0,t.generateUuid=function(){return(0,c.default.v4)()};const r=new Map([["chatMessageReceived",200],["typingIndicatorReceived",245],["readReceiptReceived",246],["chatMessageEdited",247],["chatMessageDeleted",248],["streamingChatMessageStarted",250],["streamingChatMessageChunkReceived",251],["chatThreadCreated",257],["chatThreadPropertiesUpdated",258],["chatThreadDeleted",259],["participantsAdded",260],["participantsRemoved",261]]);function i(e,t,n){let r=f(e.streaming);return{threadId:e.groupId,sender:p(e.senderId),senderDisplayName:e.senderDisplayName,recipient:p(e.recipientMri),id:e.messageId,createdOn:new Date(e.originalArrivalTime),version:e.version,type:e.messageType,message:e.messageBody,metadata:f(e.acsChatMessageMetadata)||{},attachments:m(f(e.attachments)||[],t,n),streamingMetadata:{streamingMessageType:null==r?void 0:r.contentType,streamEndReason:null==r?void 0:r.streamEndReason,streamingSequenceNumber:Number(null==r?void 0:r.sequenceNumber)}}}function o(e,t,n){return Object.assign(Object.assign({},i(e,t,n)),{editedOn:new Date(e.edittime),policyViolation:d(f(e.policyViolation))})}t.toMessageHandler=(e,t,n,i)=>{const o=r.get(e);return{handleMessage(r){let a=null;if((null==r?void 0:r.rawBody)&&(a=JSON.parse(r.rawBody)),null===a||a.eventId!==o)return;const c=s(e,a,n,i);return null!==c?(t(c),{isHandled:!0,resultCode:200}):void 0}}};const s=(e,t,n,r)=>{if("chatMessageReceived"===e)return i(t,n,r);if("streamingChatMessageStarted"==e)return i(t,n,r);if("streamingChatMessageChunkReceived"==e)return o(t,n,r);if("chatMessageEdited"===e)return o(t,n,r);if("chatMessageDeleted"===e){const e=t;return{threadId:e.groupId,sender:p(e.senderId),senderDisplayName:e.senderDisplayName,recipient:p(e.recipientMri),id:e.messageId,createdOn:new Date(e.originalArrivalTime),version:e.version,deletedOn:new Date(e.deletetime),type:e.messageType}}if("typingIndicatorReceived"===e){const e=t;return{threadId:e.groupId,sender:p(e.senderId),senderDisplayName:e.senderDisplayName,recipient:p(e.recipientMri),version:e.version,receivedOn:new Date(e.originalArrivalTime)}}if("readReceiptReceived"===e){const e=t,n=JSON.parse(e.messageBody).consumptionhorizon.split(";");return{threadId:e.groupId,sender:p(e.senderId),senderDisplayName:"",recipient:p(e.recipientMri),chatMessageId:e.messageId,readOn:new Date(+n[1])}}if("chatThreadCreated"===e){const e=t,n=JSON.parse(unescape(e.createdBy)),r=JSON.parse(unescape(e.members)),i=a(n),o=r.map(e=>a(e));return{threadId:e.threadId,createdOn:new Date(e.createTime),createdBy:i,version:e.version,participants:o,properties:l(JSON.parse(unescape(e.properties)))}}if("chatThreadPropertiesUpdated"===e){const e=t,n=JSON.parse(unescape(e.editedBy)),r=a(n);return{threadId:e.threadId,updatedOn:new Date(e.editTime),updatedBy:r,version:e.version,properties:l(JSON.parse(unescape(e.properties)))}}if("chatThreadDeleted"===e){const e=t,n=a(JSON.parse(unescape(e.deletedBy)));return{threadId:e.threadId,deletedOn:new Date(e.deleteTime),deletedBy:n,version:e.version}}if("participantsAdded"===e){const e=t,n=JSON.parse(unescape(e.addedBy)),r=JSON.parse(unescape(e.participantsAdded)),i=a(n),o=r.map(e=>a(e));return{threadId:e.threadId,addedOn:new Date(e.time),addedBy:i,version:e.version,participantsAdded:o}}if("participantsRemoved"===e){const e=t,n=JSON.parse(unescape(e.removedBy)),r=JSON.parse(unescape(e.participantsRemoved)),i=a(n),o=r.map(e=>a(e));return{threadId:e.threadId,removedOn:new Date(e.time),removedBy:i,version:e.version,participantsRemoved:o}}return null},a=e=>{var t;const n={id:p(e.participantId),displayName:e.displayName,metadata:f(null!==(t=e.memberMetaData)&&void 0!==t?t:"")||{}};return e.shareHistoryTime&&(n.shareHistoryTime=new Date(e.shareHistoryTime)),n},l=e=>{var t;return{topic:e.topic,metadata:f(null!==(t=e.acsChatThreadMetadata)&&void 0!==t?t:"")||{}}},d=e=>{if(e&&void 0!==(null==e?void 0:e.result))return{result:e.result}};t.toLogProvider=e=>({log:(...t)=>e.info(t),warn:(...t)=>e.warning(t),error:(...t)=>e.error(t),debug:(...t)=>e.verbose(t),info:(...t)=>e.verbose(t)}),t.toTelemetrySender=e=>({logEvent:t=>e.info(t)});const p=e=>e.startsWith("8:orgid:")?{kind:"microsoftTeamsUser",rawId:e,microsoftTeamsUserId:e.substring(8),isAnonymous:!1,cloud:"public"}:e.startsWith("8:dod:")?{kind:"microsoftTeamsUser",rawId:e,microsoftTeamsUserId:e.substring(6),isAnonymous:!1,cloud:"dod"}:e.startsWith("8:gcch:")?{kind:"microsoftTeamsUser",rawId:e,microsoftTeamsUserId:e.substring(7),isAnonymous:!1,cloud:"gcch"}:e.startsWith("8:teamsvisitor:")?{kind:"microsoftTeamsUser",rawId:e,microsoftTeamsUserId:e.substring(15),isAnonymous:!0}:e.startsWith("4:")?{kind:"phoneNumber",rawId:e,phoneNumber:e.substring(2)}:e.startsWith("8:acs:")||e.startsWith("8:gcch-acs:")||e.startsWith("8:dod-acs:")||e.startsWith("8:spool:")?{kind:"communicationUser",communicationUserId:e}:{kind:"unknown",id:e},f=e=>{if(null!=e&&""!==e&&"null"!==e&&"{}"!==e&&"[]"!==e)return JSON.parse(e)},g=(e,t,n)=>{let r;try{r=new URL(e),"http:"!==r.protocol&&"https:"!==r.protocol||(r=new URL(r.pathname,t))}catch(n){try{r=new URL(e,t)}catch(t){return e}}return r.searchParams.set("api-version",n),r.toString()},m=(e,t,n)=>null!=t&&""!==t&&(e=>{let t;try{t=new URL(e)}catch(e){return!1}return"http:"===t.protocol||"https:"===t.protocol})(t)?(e.filter(e=>e.attachmentType.toLowerCase()==="image".toLowerCase()).map(e=>{e.previewUrl&&(e.previewUrl=g(e.previewUrl,t,n)),e.url&&(e.url=g(e.url,t,n))}),e):e;t.base64decode=e=>u.default.isNodeLike?Buffer.from(e,"base64").toString():atob(e),t.parseTokenCredential=e=>n(void 0,void 0,void 0,function*(){const n=yield e.getToken(),r=null==n?void 0:n.token,i=(e=>{let[,n]=null==e?void 0:e.split(".");if(void 0===n)throw new Error("Invalid token");return n=n.replace(/-/g,"+").replace(/_/g,"/"),JSON.parse(decodeURIComponent(escape((0,t.base64decode)(n))))})(r),o=i.skypeid;return{jwtToken:r,acsResourceId:i.resourceId,identityMri:o,cloudType:function(e){switch(e.substring(0,e.indexOf(":"))){case y.CloudPrefix.OrgId:case y.CloudPrefix.Acs:case y.CloudPrefix.Spool:return y.CloudType.Public;case y.CloudPrefix.GccHigh:case y.CloudPrefix.GccHighAcs:return y.CloudType.GccHigh;case y.CloudPrefix.Dod:case y.CloudPrefix.DodAcs:return y.CloudType.Dod;default:return y.CloudType.Public}}(o),resourceLocation:i.resourceLocation||""}}),t.isEudbLocation=e=>!!e&&!!y.EudbCountries.find(t=>t===e)});p(C),C.isEudbLocation,C.parseTokenCredential,C.base64decode,C.toTelemetrySender,C.toLogProvider,C.toMessageHandler,C.generateUuid;var S=f(function(e,t){var n=h&&h.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),r=h&&h.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=h&&h.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&n(t,e,i);return r(t,e),t},o=h&&h.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.RealTimeNotificationConfiguration=t.TrouterConfigClient=void 0;const s=i(l.default);class a extends s.ServiceClient{constructor(e,t){t||(t={});const n=`azsdk-js-communication-signaling/${y.PACKAGE_VERSION}`,r=t.userAgentOptions&&t.userAgentOptions.userAgentPrefix?`${t.userAgentOptions.userAgentPrefix} ${n}`:`${n}`;super(Object.assign(Object.assign({},t),{userAgentOptions:{userAgentPrefix:r},additionalPolicies:t.additionalPolicies})),this.apiVersion=y.CONFIG_API_VERSION,this.endpoint=e,this.httpClient=(0,d.default.createDefaultHttpClient)()}fetchServiceUrls(e){return o(this,void 0,void 0,function*(){try{const t=(yield e.getToken()).token,n=(0,d.default.createPipelineRequest)({url:`${this.endpoint}/chat/config/realTimeNotifications?api-version=${this.apiVersion}`,method:"GET",headers:(0,d.default.createHttpHeaders)({Authorization:`Bearer ${t}`})}),r=yield this.pipeline.sendRequest(this.httpClient,n);if(200!==r.status||!r.bodyAsText)throw new Error(`Failed to fetch service URLs. Status: ${r.status}, Body: ${r.bodyAsText||"No response body"}`);const i=JSON.parse(r.bodyAsText);if(!i.trouterServiceUrl||!i.registrarServiceUrl||!i.cloudType)throw new Error("One or more required fields are missing in the response data");return new c(i.trouterServiceUrl,i.registrarServiceUrl,i.cloudType)}catch(e){throw new Error(`Error fetching real-time notification configuration from Chat Gateway: ${e.message}`)}})}}t.TrouterConfigClient=a;class c{constructor(e,t,n){this.trouterServiceUrl=e,this.registrarServiceUrl=t,this.cloudType=n}}t.RealTimeNotificationConfiguration=c});p(S),S.RealTimeNotificationConfiguration,S.TrouterConfigClient;var T=C,E=S,b=f(function(e,t){var n=h&&h.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.defaultTelemetrySettings=t.createSettings=void 0;const r={version:"1.0.0",registrationId:"",sessionId:"",pnhAppId:"AcsWeb",pnhTemplate:"AcsWeb_Chat_2.0",platform:"SPOOL",platformUIVersion:"0.0.0",environment:"",productName:"acs-chat-web",trouterServiceUrl:"",registrarServiceUrl:"",registrarRefreshTimeoutInMs:35e4,timeoutOptions:{connectionTimeoutMs:2e4,fetchTimeoutMs:1e4,pingTimeoutMs:4e4,pongTimeoutMs:5e3,maxBackoffMs:5e4,requestTimeoutMs:5e3},maxRegistrationTimeInMs:72e5};t.createSettings=(e,t)=>n(void 0,void 0,void 0,function*(){var n;const i=null==t?void 0:t.resourceEndpoint;if(void 0===i)throw new Error("'endpoint' cannot be null");const o=Object.assign({},r);o.registrationId=(0,T.generateUuid)(),o.sessionId=(0,T.generateUuid)();const s=new E.TrouterConfigClient(i,t),a=yield s.fetchServiceUrls(e);return o.trouterServiceUrl=`${a.trouterServiceUrl}/v4/a`,o.registrarServiceUrl=`${a.registrarServiceUrl}/v3/registrations`,"int"===a.cloudType&&(o.pnhAppId="cns-e2e-test",o.pnhTemplate="cns-e2e-test:2.0"),o.maxRegistrationTimeInMs=null!==(n=null==t?void 0:t.registrationTimeInMs)&&void 0!==n?n:r.maxRegistrationTimeInMs,o}),t.defaultTelemetrySettings={enabled:!1}});p(b),b.defaultTelemetrySettings,b.createSettings;var I=b,w=f(function(e,t){var n=h&&h.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.CommunicationSignalingClient=void 0,t.CommunicationSignalingClient=class{constructor(e,t,n){this.credential=e,this.logger=t,this.options=n,this.stateChangedListener=null,this.tokenFetchRetries=0,this.trouter=(0,m.createTrouterService)((0,T.toLogProvider)(t))}start(){return n(this,void 0,void 0,function*(){var e,t;if(this.resourceEndpoint=null===(e=this.options)||void 0===e?void 0:e.resourceEndpoint,void 0===this.resourceEndpoint)throw new Error("'endpoint' cannot be null");this.gatewayApiVersion=(null===(t=this.options)||void 0===t?void 0:t.gatewayApiVersion)||"2024-03-07",void 0===this.config&&(this.config={trouterSettings:yield(0,I.createSettings)(this.credential,this.options),skypeTokenProvider:e=>n(this,void 0,void 0,function*(){if(e){if(this.tokenFetchRetries+=1,this.tokenFetchRetries>y.MAX_NUMBER_OF_TOKEN_FETCH_RETRIES)throw yield this.stop(!0),new Error(`Access token is expired and failed to fetch a valid one after ${y.MAX_NUMBER_OF_TOKEN_FETCH_RETRIES} retries`)}else this.tokenFetchRetries=0;return Promise.resolve((yield this.credential.getToken()).token)}),telemetryConfig:{eventLogger:(0,T.toTelemetrySender)(this.logger),settings:I.defaultTelemetrySettings}}),this.trouter.start(this.config),this.trouter.setUserActivityState(m.UserActivityState.Active)})}stop(e){return n(this,void 0,void 0,function*(){this.trouter.offStateChanged(this.stateChangedListener),this.trouter.clearMessageHandlers(),this.trouter.stop(null!=e?e:this.tokenFetchRetries>y.MAX_NUMBER_OF_TOKEN_FETCH_RETRIES)})}on(e,t){if("connectionChanged"===e)return this.trouter.offStateChanged(this.stateChangedListener),this.stateChangedListener=(e,n)=>t(e),void this.trouter.onStateChanged(this.stateChangedListener);this.trouter.registerMessageHandler((0,T.toMessageHandler)(e,t,this.resourceEndpoint,this.gatewayApiVersion))}}});p(w),w.CommunicationSignalingClient;var R=w,A=p(f(function(e,t){var n=h&&h.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),r=h&&h.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),r(R,t)}));e.exports=A},947:(e,t,n)=>{"use strict";n.d(t,{y:()=>c});const r={span:Symbol.for("@azure/core-tracing span"),namespace:Symbol.for("@azure/core-tracing namespace")};function i(e={}){let t=new o(e.parentContext);return e.span&&(t=t.setValue(r.span,e.span)),e.namespace&&(t=t.setValue(r.namespace,e.namespace)),t}class o{constructor(e){this._contextMap=e instanceof o?new Map(e._contextMap):new Map}setValue(e,t){const n=new o(this);return n._contextMap.set(e,t),n}getValue(e){return this._contextMap.get(e)}deleteValue(e){const t=new o(this);return t._contextMap.delete(e),t}}let s;function a(){return s||(s={createRequestHeaders:()=>({}),parseTraceparentHeader:()=>{},startSpan:(e,t)=>({span:{end:()=>{},isRecording:()=>!1,recordException:()=>{},setAttribute:()=>{},setStatus:()=>{}},tracingContext:i({parentContext:t.tracingContext})}),withContext:(e,t,...n)=>t(...n)}),s}function c(e){const{namespace:t,packageName:n,packageVersion:i}=e;function o(e,o,s){var c;const u=a().startSpan(e,Object.assign(Object.assign({},s),{packageName:n,packageVersion:i,tracingContext:null===(c=null==o?void 0:o.tracingOptions)||void 0===c?void 0:c.tracingContext}));let l=u.tracingContext;const d=u.span;return l.getValue(r.namespace)||(l=l.setValue(r.namespace,t)),d.setAttribute("az.namespace",l.getValue(r.namespace)),{span:d,updatedOptions:Object.assign({},o,{tracingOptions:Object.assign(Object.assign({},null==o?void 0:o.tracingOptions),{tracingContext:l})})}}function s(e,t,...n){return a().withContext(e,t,...n)}return{startSpan:o,withSpan:async function(e,t,n,r){const{span:i,updatedOptions:a}=o(e,t,r);try{const e=await s(a.tracingOptions.tracingContext,()=>Promise.resolve(n(a,i)));return i.setStatus({status:"success"}),e}catch(e){throw i.setStatus({status:"error",error:e}),e}finally{i.end()}},withContext:s,parseTraceparentHeader:function(e){return a().parseTraceparentHeader(e)},createRequestHeaders:function(e){return a().createRequestHeaders(e)}}}},3526:(e,t,n)=>{"use strict";n.d(t,{KV:()=>T});const r="undefined"!=typeof process&&process.env&&process.env.DEBUG||void 0;let i,o=[],s=[];const a=[];r&&u(r);const c=Object.assign(e=>d(e),{enable:u,enabled:l,disable:function(){const e=i||"";return u(""),e},log:function(...e){if(e.length>0){const t=String(e[0]);t.includes(":error")?console.error(...e):t.includes(":warning")?console.warn(...e):t.includes(":info")?console.info(...e):(t.includes(":verbose"),console.debug(...e))}}});function u(e){i=e,o=[],s=[];const t=/\*/g,n=e.split(",").map(e=>e.trim().replace(t,".*?"));for(const e of n)e.startsWith("-")?s.push(new RegExp(`^${e.substr(1)}$`)):o.push(new RegExp(`^${e}$`));for(const e of a)e.enabled=l(e.namespace)}function l(e){if(e.endsWith("*"))return!0;for(const t of s)if(t.test(e))return!1;for(const t of o)if(t.test(e))return!0;return!1}function d(e){const t=Object.assign(function(...n){t.enabled&&(n.length>0&&(n[0]=`${e} ${n[0]}`),t.log(...n))},{enabled:l(e),destroy:h,log:c.log,namespace:e,extend:p});return a.push(t),t}function h(){const e=a.indexOf(this);return e>=0&&(a.splice(e,1),!0)}function p(e){const t=d(`${this.namespace}:${e}`);return t.log=this.log,t}const f=c,g=new Set,m="undefined"!=typeof process&&process.env&&process.env.AZURE_LOG_LEVEL||void 0;let v;const y=f("azure");y.log=(...e)=>{f.log(...e)};const C=["verbose","info","warning","error"];m&&(w(m)?function(e){if(e&&!w(e))throw new Error(`Unknown log level '${e}'. Acceptable values: ${C.join(",")}`);v=e;const t=[];for(const e of g)I(e)&&t.push(e.namespace);f.enable(t.join(","))}(m):console.error(`AZURE_LOG_LEVEL set to unknown log level '${m}'; logging is not enabled. Acceptable values: ${C.join(", ")}.`));const S={verbose:400,info:300,warning:200,error:100};function T(e){const t=y.extend(e);return E(y,t),{error:b(t,"error"),warning:b(t,"warning"),info:b(t,"info"),verbose:b(t,"verbose")}}function E(e,t){t.log=(...t)=>{e.log(...t)}}function b(e,t){const n=Object.assign(e.extend(t),{level:t});if(E(e,n),I(n)){const e=f.disable();f.enable(e+","+n.namespace)}return g.add(n),n}function I(e){return Boolean(v&&S[e.level]<=S[v])}function w(e){return C.includes(e)}},7007:e=>{"use strict";var t,n="object"==typeof Reflect?Reflect:null,r=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,e.exports.once=function(e,t){return new Promise(function(n,r){function i(n){e.removeListener(t,o),r(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}g(e,t,o,{once:!0}),"error"!==t&&function(e,t){"function"==typeof e.on&&g(e,"error",t,{once:!0})}(e,i)})},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var s=10;function a(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function u(e,t,n,r){var i,o,s,u;if(a(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),s=o[t]),void 0===s)s=o[t]=n,++e._eventsCount;else if("function"==typeof s?s=o[t]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),(i=c(e))>0&&s.length>i&&!s.warned){s.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=s.length,u=l,console&&console.warn&&console.warn(u)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=l.bind(r);return i.listener=n,r.wrapFn=i,i}function h(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):f(i,i.length)}function p(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function f(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function g(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,function i(o){r.once&&e.removeEventListener(t,i),n(o)})}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");s=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return c(this)},o.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,o=this._events;if(void 0!==o)i=i&&void 0===o.error;else if(!i)return!1;if(i){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var c=o[e];if(void 0===c)return!1;if("function"==typeof c)r(c,this,t);else{var u=c.length,l=f(c,u);for(n=0;n<u;++n)r(l[n],this,t)}return!0},o.prototype.addListener=function(e,t){return u(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return u(this,e,t,!0)},o.prototype.once=function(e,t){return a(t),this.on(e,d(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,d(this,e,t)),this},o.prototype.removeListener=function(e,t){var n,r,i,o,s;if(a(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){s=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},o.prototype.listeners=function(e){return h(this,e,!0)},o.prototype.rawListeners=function(e){return h(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},o.prototype.listenerCount=p,o.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},5581:e=>{var t="undefined"!=typeof window?window:self;e.exports=t.crypto||t.msCrypto},7162:(e,t,n)=>{e.exports=function(e){if(!e)return Math.random;var t=Math.pow(2,32),n=new Uint32Array(1);return function(){return e.getRandomValues(n)[0]/t}}(n(5581))},611:(e,t,n)=>{"use strict";var r;n.r(t),n.d(t,{NIL:()=>_,parse:()=>m,stringify:()=>l,v1:()=>g,v3:()=>w,v4:()=>R,v5:()=>k,validate:()=>a,version:()=>P});var i=new Uint8Array(16);function o(){if(!r&&!(r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(i)}const s=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,a=function(e){return"string"==typeof e&&s.test(e)};for(var c=[],u=0;u<256;++u)c.push((u+256).toString(16).substr(1));const l=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(c[e[t+0]]+c[e[t+1]]+c[e[t+2]]+c[e[t+3]]+"-"+c[e[t+4]]+c[e[t+5]]+"-"+c[e[t+6]]+c[e[t+7]]+"-"+c[e[t+8]]+c[e[t+9]]+"-"+c[e[t+10]]+c[e[t+11]]+c[e[t+12]]+c[e[t+13]]+c[e[t+14]]+c[e[t+15]]).toLowerCase();if(!a(n))throw TypeError("Stringified UUID is invalid");return n};var d,h,p=0,f=0;const g=function(e,t,n){var r=t&&n||0,i=t||new Array(16),s=(e=e||{}).node||d,a=void 0!==e.clockseq?e.clockseq:h;if(null==s||null==a){var c=e.random||(e.rng||o)();null==s&&(s=d=[1|c[0],c[1],c[2],c[3],c[4],c[5]]),null==a&&(a=h=16383&(c[6]<<8|c[7]))}var u=void 0!==e.msecs?e.msecs:Date.now(),g=void 0!==e.nsecs?e.nsecs:f+1,m=u-p+(g-f)/1e4;if(m<0&&void 0===e.clockseq&&(a=a+1&16383),(m<0||u>p)&&void 0===e.nsecs&&(g=0),g>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");p=u,f=g,h=a;var v=(1e4*(268435455&(u+=122192928e5))+g)%4294967296;i[r++]=v>>>24&255,i[r++]=v>>>16&255,i[r++]=v>>>8&255,i[r++]=255&v;var y=u/4294967296*1e4&268435455;i[r++]=y>>>8&255,i[r++]=255&y,i[r++]=y>>>24&15|16,i[r++]=y>>>16&255,i[r++]=a>>>8|128,i[r++]=255&a;for(var C=0;C<6;++C)i[r+C]=s[C];return t||l(i)},m=function(e){if(!a(e))throw TypeError("Invalid UUID");var t,n=new Uint8Array(16);return n[0]=(t=parseInt(e.slice(0,8),16))>>>24,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=255&t,n[4]=(t=parseInt(e.slice(9,13),16))>>>8,n[5]=255&t,n[6]=(t=parseInt(e.slice(14,18),16))>>>8,n[7]=255&t,n[8]=(t=parseInt(e.slice(19,23),16))>>>8,n[9]=255&t,n[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,n[11]=t/4294967296&255,n[12]=t>>>24&255,n[13]=t>>>16&255,n[14]=t>>>8&255,n[15]=255&t,n};function v(e,t,n){function r(e,r,i,o){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t}(e)),"string"==typeof r&&(r=m(r)),16!==r.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var s=new Uint8Array(16+e.length);if(s.set(r),s.set(e,r.length),(s=n(s))[6]=15&s[6]|t,s[8]=63&s[8]|128,i){o=o||0;for(var a=0;a<16;++a)i[o+a]=s[a];return i}return l(s)}try{r.name=e}catch(e){}return r.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",r.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",r}function y(e){return 14+(e+64>>>9<<4)+1}function C(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function S(e,t,n,r,i,o){return C((s=C(C(t,e),C(r,o)))<<(a=i)|s>>>32-a,n);var s,a}function T(e,t,n,r,i,o,s){return S(t&n|~t&r,e,t,i,o,s)}function E(e,t,n,r,i,o,s){return S(t&r|n&~r,e,t,i,o,s)}function b(e,t,n,r,i,o,s){return S(t^n^r,e,t,i,o,s)}function I(e,t,n,r,i,o,s){return S(n^(t|~r),e,t,i,o,s)}const w=v("v3",48,function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var n=0;n<t.length;++n)e[n]=t.charCodeAt(n)}return function(e){for(var t=[],n=32*e.length,r="0123456789abcdef",i=0;i<n;i+=8){var o=e[i>>5]>>>i%32&255,s=parseInt(r.charAt(o>>>4&15)+r.charAt(15&o),16);t.push(s)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[y(t)-1]=t;for(var n=1732584193,r=-271733879,i=-1732584194,o=271733878,s=0;s<e.length;s+=16){var a=n,c=r,u=i,l=o;n=T(n,r,i,o,e[s],7,-680876936),o=T(o,n,r,i,e[s+1],12,-389564586),i=T(i,o,n,r,e[s+2],17,606105819),r=T(r,i,o,n,e[s+3],22,-1044525330),n=T(n,r,i,o,e[s+4],7,-176418897),o=T(o,n,r,i,e[s+5],12,1200080426),i=T(i,o,n,r,e[s+6],17,-1473231341),r=T(r,i,o,n,e[s+7],22,-45705983),n=T(n,r,i,o,e[s+8],7,1770035416),o=T(o,n,r,i,e[s+9],12,-1958414417),i=T(i,o,n,r,e[s+10],17,-42063),r=T(r,i,o,n,e[s+11],22,-1990404162),n=T(n,r,i,o,e[s+12],7,1804603682),o=T(o,n,r,i,e[s+13],12,-40341101),i=T(i,o,n,r,e[s+14],17,-1502002290),n=E(n,r=T(r,i,o,n,e[s+15],22,1236535329),i,o,e[s+1],5,-165796510),o=E(o,n,r,i,e[s+6],9,-1069501632),i=E(i,o,n,r,e[s+11],14,643717713),r=E(r,i,o,n,e[s],20,-373897302),n=E(n,r,i,o,e[s+5],5,-701558691),o=E(o,n,r,i,e[s+10],9,38016083),i=E(i,o,n,r,e[s+15],14,-660478335),r=E(r,i,o,n,e[s+4],20,-405537848),n=E(n,r,i,o,e[s+9],5,568446438),o=E(o,n,r,i,e[s+14],9,-1019803690),i=E(i,o,n,r,e[s+3],14,-187363961),r=E(r,i,o,n,e[s+8],20,1163531501),n=E(n,r,i,o,e[s+13],5,-1444681467),o=E(o,n,r,i,e[s+2],9,-51403784),i=E(i,o,n,r,e[s+7],14,1735328473),n=b(n,r=E(r,i,o,n,e[s+12],20,-1926607734),i,o,e[s+5],4,-378558),o=b(o,n,r,i,e[s+8],11,-2022574463),i=b(i,o,n,r,e[s+11],16,1839030562),r=b(r,i,o,n,e[s+14],23,-35309556),n=b(n,r,i,o,e[s+1],4,-1530992060),o=b(o,n,r,i,e[s+4],11,1272893353),i=b(i,o,n,r,e[s+7],16,-155497632),r=b(r,i,o,n,e[s+10],23,-1094730640),n=b(n,r,i,o,e[s+13],4,681279174),o=b(o,n,r,i,e[s],11,-358537222),i=b(i,o,n,r,e[s+3],16,-722521979),r=b(r,i,o,n,e[s+6],23,76029189),n=b(n,r,i,o,e[s+9],4,-640364487),o=b(o,n,r,i,e[s+12],11,-421815835),i=b(i,o,n,r,e[s+15],16,530742520),n=I(n,r=b(r,i,o,n,e[s+2],23,-995338651),i,o,e[s],6,-198630844),o=I(o,n,r,i,e[s+7],10,1126891415),i=I(i,o,n,r,e[s+14],15,-1416354905),r=I(r,i,o,n,e[s+5],21,-57434055),n=I(n,r,i,o,e[s+12],6,1700485571),o=I(o,n,r,i,e[s+3],10,-1894986606),i=I(i,o,n,r,e[s+10],15,-1051523),r=I(r,i,o,n,e[s+1],21,-2054922799),n=I(n,r,i,o,e[s+8],6,1873313359),o=I(o,n,r,i,e[s+15],10,-30611744),i=I(i,o,n,r,e[s+6],15,-1560198380),r=I(r,i,o,n,e[s+13],21,1309151649),n=I(n,r,i,o,e[s+4],6,-145523070),o=I(o,n,r,i,e[s+11],10,-1120210379),i=I(i,o,n,r,e[s+2],15,718787259),r=I(r,i,o,n,e[s+9],21,-343485551),n=C(n,a),r=C(r,c),i=C(i,u),o=C(o,l)}return[n,r,i,o]}(function(e){if(0===e.length)return[];for(var t=8*e.length,n=new Uint32Array(y(t)),r=0;r<t;r+=8)n[r>>5]|=(255&e[r/8])<<r%32;return n}(e),8*e.length))}),R=function(e,t,n){var r=(e=e||{}).random||(e.rng||o)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var i=0;i<16;++i)t[n+i]=r[i];return t}return l(r)};function A(e,t,n,r){switch(e){case 0:return t&n^~t&r;case 1:case 3:return t^n^r;case 2:return t&n^t&r^n&r}}function O(e,t){return e<<t|e>>>32-t}const k=v("v5",80,function(e){var t=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var r=unescape(encodeURIComponent(e));e=[];for(var i=0;i<r.length;++i)e.push(r.charCodeAt(i))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var o=e.length/4+2,s=Math.ceil(o/16),a=new Array(s),c=0;c<s;++c){for(var u=new Uint32Array(16),l=0;l<16;++l)u[l]=e[64*c+4*l]<<24|e[64*c+4*l+1]<<16|e[64*c+4*l+2]<<8|e[64*c+4*l+3];a[c]=u}a[s-1][14]=8*(e.length-1)/Math.pow(2,32),a[s-1][14]=Math.floor(a[s-1][14]),a[s-1][15]=8*(e.length-1)&4294967295;for(var d=0;d<s;++d){for(var h=new Uint32Array(80),p=0;p<16;++p)h[p]=a[d][p];for(var f=16;f<80;++f)h[f]=O(h[f-3]^h[f-8]^h[f-14]^h[f-16],1);for(var g=n[0],m=n[1],v=n[2],y=n[3],C=n[4],S=0;S<80;++S){var T=Math.floor(S/20),E=O(g,5)+A(T,m,v,y)+C+t[T]+h[S]>>>0;C=y,y=v,v=O(m,30)>>>0,m=g,g=E}n[0]=n[0]+g>>>0,n[1]=n[1]+m>>>0,n[2]=n[2]+v>>>0,n[3]=n[3]+y>>>0,n[4]=n[4]+C>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,255&n[0],n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,255&n[1],n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,255&n[2],n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,255&n[3],n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,255&n[4]]}),_="00000000-0000-0000-0000-000000000000",P=function(e){if(!a(e))throw TypeError("Invalid UUID");return parseInt(e.substr(14,1),16)}},7698:(e,t,n)=>{"use strict";n(3792),n(6099),n(3362),n(7764),n(3811),n(4147),n(9150),n(4648),n(7333),n(3064),n(2679),n(9920),n(6967),n(1393),n(4905),n(8159),n(9320),n(6994),n(2953);var r=n(9167);e.exports=r.AsyncIterator},6330:(e,t,n)=>{"use strict";var r=n(1327);e.exports=r},6691:(e,t,n)=>{"use strict";var r=n(884);n(6401),n(1202),n(3275),n(465),e.exports=r},3216:(e,t,n)=>{"use strict";n(9908);var r=n(9167);e.exports=r.Object.is},9281:(e,t,n)=>{"use strict";n(8706),n(6099),n(2675),n(6412),n(9463),n(193),n(2168),n(2259),n(6964),n(3142),n(3237),n(1833),n(7947),n(1073),n(5700),n(8125),n(326),n(4731),n(479),n(5472);var r=n(9167);e.exports=r.Symbol},5245:(e,t,n)=>{"use strict";n(2711)},8435:(e,t,n)=>{"use strict";e.exports=n(3049)},2493:(e,t,n)=>{"use strict";e.exports=n(3068)},2440:(e,t,n)=>{"use strict";n(7414)},2711:(e,t,n)=>{"use strict";var r=n(7698);n(4847),n(5182),e.exports=r},3049:(e,t,n)=>{"use strict";var r=n(6330);e.exports=r},3068:(e,t,n)=>{"use strict";n(2917),n(2793),n(6099),n(7764),n(2953);var r=n(9167);e.exports=r.Observable},7414:(e,t,n)=>{"use strict";var r=n(6691);n(3070),n(3032),n(9604),n(2793),n(7153),n(3803),n(3976),n(8999),n(7208),n(3440),e.exports=r},9306:(e,t,n)=>{"use strict";var r=n(4901),i=n(6823),o=TypeError;e.exports=function(e){if(r(e))return e;throw new o(i(e)+" is not a function")}},5548:(e,t,n)=>{"use strict";var r=n(3517),i=n(6823),o=TypeError;e.exports=function(e){if(r(e))return e;throw new o(i(e)+" is not a constructor")}},3506:(e,t,n)=>{"use strict";var r=n(3925),i=String,o=TypeError;e.exports=function(e){if(r(e))return e;throw new o("Can't set "+i(e)+" as a prototype")}},6469:(e,t,n)=>{"use strict";var r=n(8227),i=n(2360),o=n(4913).f,s=r("unscopables"),a=Array.prototype;void 0===a[s]&&o(a,s,{configurable:!0,value:i(null)}),e.exports=function(e){a[s][e]=!0}},679:(e,t,n)=>{"use strict";var r=n(1625),i=TypeError;e.exports=function(e,t){if(r(t,e))return e;throw new i("Incorrect invocation")}},8551:(e,t,n)=>{"use strict";var r=n(34),i=String,o=TypeError;e.exports=function(e){if(r(e))return e;throw new o(i(e)+" is not an object")}},9617:(e,t,n)=>{"use strict";var r=n(5397),i=n(5610),o=n(6198),s=function(e){return function(t,n,s){var a=r(t),c=o(a);if(0===c)return!e&&-1;var u,l=i(s,c);if(e&&n!=n){for(;c>l;)if((u=a[l++])!=u)return!0}else for(;c>l;l++)if((e||l in a)&&a[l]===n)return e||l||0;return!e&&-1}};e.exports={includes:s(!0),indexOf:s(!1)}},9213:(e,t,n)=>{"use strict";var r=n(6080),i=n(9504),o=n(7055),s=n(8981),a=n(6198),c=n(1469),u=i([].push),l=function(e){var t=1===e,n=2===e,i=3===e,l=4===e,d=6===e,h=7===e,p=5===e||d;return function(f,g,m,v){for(var y,C,S=s(f),T=o(S),E=a(T),b=r(g,m),I=0,w=v||c,R=t?w(f,E):n||h?w(f,0):void 0;E>I;I++)if((p||I in T)&&(C=b(y=T[I],I,S),e))if(t)R[I]=C;else if(C)switch(e){case 3:return!0;case 5:return y;case 6:return I;case 2:u(R,y)}else switch(e){case 4:return!1;case 7:u(R,y)}return d?-1:i||l?l:R}};e.exports={forEach:l(0),map:l(1),filter:l(2),some:l(3),every:l(4),find:l(5),findIndex:l(6),filterReject:l(7)}},597:(e,t,n)=>{"use strict";var r=n(9039),i=n(8227),o=n(7388),s=i("species");e.exports=function(e){return o>=51||!r(function(){var t=[];return(t.constructor={})[s]=function(){return{foo:1}},1!==t[e](Boolean).foo})}},7680:(e,t,n)=>{"use strict";var r=n(9504);e.exports=r([].slice)},7433:(e,t,n)=>{"use strict";var r=n(4376),i=n(3517),o=n(34),s=n(8227)("species"),a=Array;e.exports=function(e){var t;return r(e)&&(t=e.constructor,(i(t)&&(t===a||r(t.prototype))||o(t)&&null===(t=t[s]))&&(t=void 0)),void 0===t?a:t}},1469:(e,t,n)=>{"use strict";var r=n(7433);e.exports=function(e,t){return new(r(e))(0===t?0:t)}},4074:(e,t,n)=>{"use strict";var r=n(9565),i=n(8551),o=n(2360),s=n(5966),a=n(6279),c=n(1181),u=n(7751),l=n(3982),d=n(2529),h=u("Promise"),p="AsyncFromSyncIterator",f=c.set,g=c.getterFor(p),m=function(e,t,n){var r=e.done;h.resolve(e.value).then(function(e){t(d(e,r))},n)},v=function(e){e.type=p,f(this,e)};v.prototype=a(o(l),{next:function(){var e=g(this);return new h(function(t,n){var o=i(r(e.next,e.iterator));m(o,t,n)})},return:function(){var e=g(this).iterator;return new h(function(t,n){var o=s(e,"return");if(void 0===o)return t(d(void 0,!0));var a=i(r(o,e));m(a,t,n)})}}),e.exports=v},772:(e,t,n)=>{"use strict";var r=n(9565),i=n(7751),o=n(5966);e.exports=function(e,t,n,s){try{var a=o(e,"return");if(a)return i("Promise").resolve(r(a,e)).then(function(){t(n)},function(e){s(e)})}catch(e){return s(e)}t(n)}},2059:(e,t,n)=>{"use strict";var r=n(9565),i=n(1103),o=n(8551),s=n(2360),a=n(6699),c=n(6279),u=n(8227),l=n(1181),d=n(7751),h=n(5966),p=n(3982),f=n(2529),g=n(9539),m=d("Promise"),v=u("toStringTag"),y="AsyncIteratorHelper",C="WrapForValidAsyncIterator",S=l.set,T=function(e){var t=!e,n=l.getterFor(e?C:y),a=function(e){var r=i(function(){return n(e)}),o=r.error,s=r.value;return o||t&&s.done?{exit:!0,value:o?m.reject(s):m.resolve(f(void 0,!0))}:{exit:!1,value:s}};return c(s(p),{next:function(){var e=a(this),t=e.value;if(e.exit)return t;var n=i(function(){return o(t.nextHandler(m))}),r=n.error,s=n.value;return r&&(t.done=!0),r?m.reject(s):m.resolve(s)},return:function(){var t=a(this),n=t.value;if(t.exit)return n;n.done=!0;var s,c,u=n.iterator,l=i(function(){if(n.inner)try{g(n.inner.iterator,"normal")}catch(e){return g(u,"throw",e)}return h(u,"return")});return s=c=l.value,l.error?m.reject(c):void 0===s?m.resolve(f(void 0,!0)):(c=(l=i(function(){return r(s,u)})).value,l.error?m.reject(c):e?m.resolve(c):m.resolve(c).then(function(e){return o(e),f(void 0,!0)}))}})},E=T(!0),b=T(!1);a(b,v,"Async Iterator Helper"),e.exports=function(e,t){var n=function(n,r){r?(r.iterator=n.iterator,r.next=n.next):r=n,r.type=t?C:y,r.nextHandler=e,r.counter=0,r.done=!1,S(this,r)};return n.prototype=t?E:b,n}},7481:(e,t,n)=>{"use strict";var r=n(9565),i=n(1750),o=function(e,t){return[t,e]};e.exports=function(){return r(i,this,o)}},6639:(e,t,n)=>{"use strict";var r=n(9565),i=n(9306),o=n(8551),s=n(34),a=n(6837),c=n(7751),u=n(1767),l=n(772),d=function(e){var t=0===e,n=1===e,d=2===e,h=3===e;return function(e,p,f){o(e);var g=void 0!==p;!g&&t||i(p);var m=u(e),v=c("Promise"),y=m.iterator,C=m.next,S=0;return new v(function(e,i){var c=function(e){l(y,i,e,i)},u=function(){try{if(g)try{a(S)}catch(e){c(e)}v.resolve(o(r(C,y))).then(function(r){try{if(o(r).done)t?(f.length=S,e(f)):e(!h&&(d||void 0));else{var a=r.value;try{if(g){var m=p(a,S),C=function(r){if(n)u();else if(d)r?u():l(y,e,!1,i);else if(t)try{f[S++]=r,u()}catch(e){c(e)}else r?l(y,e,h||a,i):u()};s(m)?v.resolve(m).then(C,c):C(m)}else f[S++]=a,u()}catch(e){c(e)}}}catch(e){i(e)}},i)}catch(e){i(e)}};u()})}};e.exports={toArray:d(0),forEach:d(1),every:d(2),some:d(3),find:d(4)}},1750:(e,t,n)=>{"use strict";var r=n(9565),i=n(9306),o=n(8551),s=n(34),a=n(1767),c=n(2059),u=n(2529),l=n(772),d=c(function(e){var t=this,n=t.iterator,i=t.mapper;return new e(function(a,c){var d=function(e){t.done=!0,c(e)},h=function(e){l(n,d,e,d)};e.resolve(o(r(t.next,n))).then(function(n){try{if(o(n).done)t.done=!0,a(u(void 0,!0));else{var r=n.value;try{var c=i(r,t.counter++),l=function(e){a(u(e,!1))};s(c)?e.resolve(c).then(l,h):l(c)}catch(e){h(e)}}}catch(e){d(e)}},d)})});e.exports=function(e){return o(this),i(e),new d(a(this),{mapper:e})}},3982:(e,t,n)=>{"use strict";var r,i,o=n(4475),s=n(7629),a=n(4901),c=n(2360),u=n(2787),l=n(6840),d=n(8227),h=n(6395),p="USE_FUNCTION_CONSTRUCTOR",f=d("asyncIterator"),g=o.AsyncIterator,m=s.AsyncIteratorPrototype;if(m)r=m;else if(a(g))r=g.prototype;else if(s[p]||o[p])try{i=u(u(u(Function("return async function*(){}()")()))),u(i)===Object.prototype&&(r=i)}catch(e){}r?h&&(r=c(r)):r={},a(r[f])||l(r,f,function(){return this}),e.exports=r},4690:(e,t,n)=>{"use strict";var r=n(9565),i=n(2059);e.exports=i(function(){return r(this.next,this.iterator)},!0)},4428:(e,t,n)=>{"use strict";var r=n(8227)("iterator"),i=!1;try{var o=0,s={next:function(){return{done:!!o++}},return:function(){i=!0}};s[r]=function(){return this},Array.from(s,function(){throw 2})}catch(e){}e.exports=function(e,t){try{if(!t&&!i)return!1}catch(e){return!1}var n=!1;try{var o={};o[r]=function(){return{next:function(){return{done:n=!0}}}},e(o)}catch(e){}return n}},4576:(e,t,n)=>{"use strict";var r=n(9504),i=r({}.toString),o=r("".slice);e.exports=function(e){return o(i(e),8,-1)}},6955:(e,t,n)=>{"use strict";var r=n(2140),i=n(4901),o=n(4576),s=n(8227)("toStringTag"),a=Object,c="Arguments"===o(function(){return arguments}());e.exports=r?o:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=a(e),s))?n:c?o(t):"Object"===(r=o(t))&&i(t.callee)?"Arguments":r}},7740:(e,t,n)=>{"use strict";var r=n(9297),i=n(5031),o=n(7347),s=n(4913);e.exports=function(e,t,n){for(var a=i(t),c=s.f,u=o.f,l=0;l<a.length;l++){var d=a[l];r(e,d)||n&&r(n,d)||c(e,d,u(t,d))}}},2211:(e,t,n)=>{"use strict";var r=n(9039);e.exports=!r(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})},2529:e=>{"use strict";e.exports=function(e,t){return{value:e,done:t}}},6699:(e,t,n)=>{"use strict";var r=n(3724),i=n(4913),o=n(6980);e.exports=r?function(e,t,n){return i.f(e,t,o(1,n))}:function(e,t,n){return e[t]=n,e}},6980:e=>{"use strict";e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},4659:(e,t,n)=>{"use strict";var r=n(3724),i=n(4913),o=n(6980);e.exports=function(e,t,n){r?i.f(e,t,o(0,n)):e[t]=n}},2106:(e,t,n)=>{"use strict";var r=n(283),i=n(4913);e.exports=function(e,t,n){return n.get&&r(n.get,t,{getter:!0}),n.set&&r(n.set,t,{setter:!0}),i.f(e,t,n)}},6840:(e,t,n)=>{"use strict";var r=n(4901),i=n(4913),o=n(283),s=n(9433);e.exports=function(e,t,n,a){a||(a={});var c=a.enumerable,u=void 0!==a.name?a.name:t;if(r(n)&&o(n,u,a),a.global)c?e[t]=n:s(t,n);else{try{a.unsafe?e[t]&&(c=!0):delete e[t]}catch(e){}c?e[t]=n:i.f(e,t,{value:n,enumerable:!1,configurable:!a.nonConfigurable,writable:!a.nonWritable})}return e}},6279:(e,t,n)=>{"use strict";var r=n(6840);e.exports=function(e,t,n){for(var i in t)r(e,i,t[i],n);return e}},9433:(e,t,n)=>{"use strict";var r=n(4475),i=Object.defineProperty;e.exports=function(e,t){try{i(r,e,{value:t,configurable:!0,writable:!0})}catch(n){r[e]=t}return t}},3724:(e,t,n)=>{"use strict";var r=n(9039);e.exports=!r(function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]})},4055:(e,t,n)=>{"use strict";var r=n(4475),i=n(34),o=r.document,s=i(o)&&i(o.createElement);e.exports=function(e){return s?o.createElement(e):{}}},6837:e=>{"use strict";var t=TypeError;e.exports=function(e){if(e>9007199254740991)throw t("Maximum allowed index exceeded");return e}},7400:e=>{"use strict";e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},9296:(e,t,n)=>{"use strict";var r=n(4055)("span").classList,i=r&&r.constructor&&r.constructor.prototype;e.exports=i===Object.prototype?void 0:i},7290:(e,t,n)=>{"use strict";var r=n(516),i=n(9088);e.exports=!r&&!i&&"object"==typeof window&&"object"==typeof document},516:e=>{"use strict";e.exports="object"==typeof Deno&&Deno&&"object"==typeof Deno.version},28:(e,t,n)=>{"use strict";var r=n(9392);e.exports=/ipad|iphone|ipod/i.test(r)&&"undefined"!=typeof Pebble},8119:(e,t,n)=>{"use strict";var r=n(9392);e.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(r)},9088:(e,t,n)=>{"use strict";var r=n(4475),i=n(4576);e.exports="process"===i(r.process)},6765:(e,t,n)=>{"use strict";var r=n(9392);e.exports=/web0s(?!.*chrome)/i.test(r)},9392:e=>{"use strict";e.exports="undefined"!=typeof navigator&&String(navigator.userAgent)||""},7388:(e,t,n)=>{"use strict";var r,i,o=n(4475),s=n(9392),a=o.process,c=o.Deno,u=a&&a.versions||c&&c.version,l=u&&u.v8;l&&(i=(r=l.split("."))[0]>0&&r[0]<4?1:+(r[0]+r[1])),!i&&s&&(!(r=s.match(/Edge\/(\d+)/))||r[1]>=74)&&(r=s.match(/Chrome\/(\d+)/))&&(i=+r[1]),e.exports=i},8727:e=>{"use strict";e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},6518:(e,t,n)=>{"use strict";var r=n(4475),i=n(7347).f,o=n(6699),s=n(6840),a=n(9433),c=n(7740),u=n(2796);e.exports=function(e,t){var n,l,d,h,p,f=e.target,g=e.global,m=e.stat;if(n=g?r:m?r[f]||a(f,{}):r[f]&&r[f].prototype)for(l in t){if(h=t[l],d=e.dontCallGetSet?(p=i(n,l))&&p.value:n[l],!u(g?l:f+(m?".":"#")+l,e.forced)&&void 0!==d){if(typeof h==typeof d)continue;c(h,d)}(e.sham||d&&d.sham)&&o(h,"sham",!0),s(n,l,h,e)}}},9039:e=>{"use strict";e.exports=function(e){try{return!!e()}catch(e){return!0}}},8745:(e,t,n)=>{"use strict";var r=n(616),i=Function.prototype,o=i.apply,s=i.call;e.exports="object"==typeof Reflect&&Reflect.apply||(r?s.bind(o):function(){return s.apply(o,arguments)})},6080:(e,t,n)=>{"use strict";var r=n(7476),i=n(9306),o=n(616),s=r(r.bind);e.exports=function(e,t){return i(e),void 0===t?e:o?s(e,t):function(){return e.apply(t,arguments)}}},616:(e,t,n)=>{"use strict";var r=n(9039);e.exports=!r(function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})},9565:(e,t,n)=>{"use strict";var r=n(616),i=Function.prototype.call;e.exports=r?i.bind(i):function(){return i.apply(i,arguments)}},350:(e,t,n)=>{"use strict";var r=n(3724),i=n(9297),o=Function.prototype,s=r&&Object.getOwnPropertyDescriptor,a=i(o,"name"),c=a&&"something"===function(){}.name,u=a&&(!r||r&&s(o,"name").configurable);e.exports={EXISTS:a,PROPER:c,CONFIGURABLE:u}},6706:(e,t,n)=>{"use strict";var r=n(9504),i=n(9306);e.exports=function(e,t,n){try{return r(i(Object.getOwnPropertyDescriptor(e,t)[n]))}catch(e){}}},7476:(e,t,n)=>{"use strict";var r=n(4576),i=n(9504);e.exports=function(e){if("Function"===r(e))return i(e)}},9504:(e,t,n)=>{"use strict";var r=n(616),i=Function.prototype,o=i.call,s=r&&i.bind.bind(o,o);e.exports=r?s:function(e){return function(){return o.apply(e,arguments)}}},133:(e,t,n)=>{"use strict";var r=n(9565),i=n(4901),o=n(8551),s=n(1767),a=n(851),c=n(5966),u=n(8227),l=n(4074),d=u("asyncIterator");e.exports=function(e){var t,n=o(e),u=!0,h=c(n,d);return i(h)||(h=a(n),u=!1),void 0!==h?t=r(h,n):(t=n,u=!0),o(t),s(u?t:new l(s(t)))}},7751:(e,t,n)=>{"use strict";var r=n(4475),i=n(4901);e.exports=function(e,t){return arguments.length<2?(n=r[e],i(n)?n:void 0):r[e]&&r[e][t];var n}},1767:e=>{"use strict";e.exports=function(e){return{iterator:e,next:e.next,done:!1}}},851:(e,t,n)=>{"use strict";var r=n(6955),i=n(5966),o=n(4117),s=n(6269),a=n(8227)("iterator");e.exports=function(e){if(!o(e))return i(e,a)||i(e,"@@iterator")||s[r(e)]}},81:(e,t,n)=>{"use strict";var r=n(9565),i=n(9306),o=n(8551),s=n(6823),a=n(851),c=TypeError;e.exports=function(e,t){var n=arguments.length<2?a(e):t;if(i(n))return o(r(n,e));throw new c(s(e)+" is not iterable")}},6933:(e,t,n)=>{"use strict";var r=n(9504),i=n(4376),o=n(4901),s=n(4576),a=n(655),c=r([].push);e.exports=function(e){if(o(e))return e;if(i(e)){for(var t=e.length,n=[],r=0;r<t;r++){var u=e[r];"string"==typeof u?c(n,u):"number"!=typeof u&&"Number"!==s(u)&&"String"!==s(u)||c(n,a(u))}var l=n.length,d=!0;return function(e,t){if(d)return d=!1,t;if(i(this))return t;for(var r=0;r<l;r++)if(n[r]===e)return t}}}},5966:(e,t,n)=>{"use strict";var r=n(9306),i=n(4117);e.exports=function(e,t){var n=e[t];return i(n)?void 0:r(n)}},4475:function(e,t,n){"use strict";var r=function(e){return e&&e.Math===Math&&e};e.exports=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof n.g&&n.g)||r("object"==typeof this&&this)||function(){return this}()||Function("return this")()},9297:(e,t,n)=>{"use strict";var r=n(9504),i=n(8981),o=r({}.hasOwnProperty);e.exports=Object.hasOwn||function(e,t){return o(i(e),t)}},421:e=>{"use strict";e.exports={}},3138:e=>{"use strict";e.exports=function(e,t){try{1===arguments.length?console.error(e):console.error(e,t)}catch(e){}}},397:(e,t,n)=>{"use strict";var r=n(7751);e.exports=r("document","documentElement")},5917:(e,t,n)=>{"use strict";var r=n(3724),i=n(9039),o=n(4055);e.exports=!r&&!i(function(){return 7!==Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a})},7055:(e,t,n)=>{"use strict";var r=n(9504),i=n(9039),o=n(4576),s=Object,a=r("".split);e.exports=i(function(){return!s("z").propertyIsEnumerable(0)})?function(e){return"String"===o(e)?a(e,""):s(e)}:s},3706:(e,t,n)=>{"use strict";var r=n(9504),i=n(4901),o=n(7629),s=r(Function.toString);i(o.inspectSource)||(o.inspectSource=function(e){return s(e)}),e.exports=o.inspectSource},1181:(e,t,n)=>{"use strict";var r,i,o,s=n(8622),a=n(4475),c=n(34),u=n(6699),l=n(9297),d=n(7629),h=n(6119),p=n(421),f="Object already initialized",g=a.TypeError,m=a.WeakMap;if(s||d.state){var v=d.state||(d.state=new m);v.get=v.get,v.has=v.has,v.set=v.set,r=function(e,t){if(v.has(e))throw new g(f);return t.facade=e,v.set(e,t),t},i=function(e){return v.get(e)||{}},o=function(e){return v.has(e)}}else{var y=h("state");p[y]=!0,r=function(e,t){if(l(e,y))throw new g(f);return t.facade=e,u(e,y,t),t},i=function(e){return l(e,y)?e[y]:{}},o=function(e){return l(e,y)}}e.exports={set:r,get:i,has:o,enforce:function(e){return o(e)?i(e):r(e,{})},getterFor:function(e){return function(t){var n;if(!c(t)||(n=i(t)).type!==e)throw new g("Incompatible receiver, "+e+" required");return n}}}},4209:(e,t,n)=>{"use strict";var r=n(8227),i=n(6269),o=r("iterator"),s=Array.prototype;e.exports=function(e){return void 0!==e&&(i.Array===e||s[o]===e)}},4376:(e,t,n)=>{"use strict";var r=n(4576);e.exports=Array.isArray||function(e){return"Array"===r(e)}},4901:e=>{"use strict";var t="object"==typeof document&&document.all;e.exports=void 0===t&&void 0!==t?function(e){return"function"==typeof e||e===t}:function(e){return"function"==typeof e}},3517:(e,t,n)=>{"use strict";var r=n(9504),i=n(9039),o=n(4901),s=n(6955),a=n(7751),c=n(3706),u=function(){},l=a("Reflect","construct"),d=/^\s*(?:class|function)\b/,h=r(d.exec),p=!d.test(u),f=function(e){if(!o(e))return!1;try{return l(u,[],e),!0}catch(e){return!1}},g=function(e){if(!o(e))return!1;switch(s(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return p||!!h(d,c(e))}catch(e){return!0}};g.sham=!0,e.exports=!l||i(function(){var e;return f(f.call)||!f(Object)||!f(function(){e=!0})||e})?g:f},2796:(e,t,n)=>{"use strict";var r=n(9039),i=n(4901),o=/#|\.prototype\./,s=function(e,t){var n=c[a(e)];return n===l||n!==u&&(i(t)?r(t):!!t)},a=s.normalize=function(e){return String(e).replace(o,".").toLowerCase()},c=s.data={},u=s.NATIVE="N",l=s.POLYFILL="P";e.exports=s},4117:e=>{"use strict";e.exports=function(e){return null==e}},34:(e,t,n)=>{"use strict";var r=n(4901);e.exports=function(e){return"object"==typeof e?null!==e:r(e)}},3925:(e,t,n)=>{"use strict";var r=n(34);e.exports=function(e){return r(e)||null===e}},6395:e=>{"use strict";e.exports=!1},757:(e,t,n)=>{"use strict";var r=n(7751),i=n(4901),o=n(1625),s=n(7040),a=Object;e.exports=s?function(e){return"symbol"==typeof e}:function(e){var t=r("Symbol");return i(t)&&o(t.prototype,a(e))}},2652:(e,t,n)=>{"use strict";var r=n(6080),i=n(9565),o=n(8551),s=n(6823),a=n(4209),c=n(6198),u=n(1625),l=n(81),d=n(851),h=n(9539),p=TypeError,f=function(e,t){this.stopped=e,this.result=t},g=f.prototype;e.exports=function(e,t,n){var m,v,y,C,S,T,E,b=n&&n.that,I=!(!n||!n.AS_ENTRIES),w=!(!n||!n.IS_RECORD),R=!(!n||!n.IS_ITERATOR),A=!(!n||!n.INTERRUPTED),O=r(t,b),k=function(e){return m&&h(m,"normal",e),new f(!0,e)},_=function(e){return I?(o(e),A?O(e[0],e[1],k):O(e[0],e[1])):A?O(e,k):O(e)};if(w)m=e.iterator;else if(R)m=e;else{if(!(v=d(e)))throw new p(s(e)+" is not iterable");if(a(v)){for(y=0,C=c(e);C>y;y++)if((S=_(e[y]))&&u(g,S))return S;return new f(!1)}m=l(e,v)}for(T=w?e.next:m.next;!(E=i(T,m)).done;){try{S=_(E.value)}catch(e){h(m,"throw",e)}if("object"==typeof S&&S&&u(g,S))return S}return new f(!1)}},9539:(e,t,n)=>{"use strict";var r=n(9565),i=n(8551),o=n(5966);e.exports=function(e,t,n){var s,a;i(e);try{if(!(s=o(e,"return"))){if("throw"===t)throw n;return n}s=r(s,e)}catch(e){a=!0,s=e}if("throw"===t)throw n;if(a)throw s;return i(s),n}},3994:(e,t,n)=>{"use strict";var r=n(7657).IteratorPrototype,i=n(2360),o=n(6980),s=n(687),a=n(6269),c=function(){return this};e.exports=function(e,t,n,u){var l=t+" Iterator";return e.prototype=i(r,{next:o(+!u,n)}),s(e,l,!1,!0),a[l]=c,e}},1088:(e,t,n)=>{"use strict";var r=n(6518),i=n(9565),o=n(6395),s=n(350),a=n(4901),c=n(3994),u=n(2787),l=n(2967),d=n(687),h=n(6699),p=n(6840),f=n(8227),g=n(6269),m=n(7657),v=s.PROPER,y=s.CONFIGURABLE,C=m.IteratorPrototype,S=m.BUGGY_SAFARI_ITERATORS,T=f("iterator"),E="keys",b="values",I="entries",w=function(){return this};e.exports=function(e,t,n,s,f,m,R){c(n,t,s);var A,O,k,_=function(e){if(e===f&&x)return x;if(!S&&e&&e in D)return D[e];switch(e){case E:case b:case I:return function(){return new n(this,e)}}return function(){return new n(this)}},P=t+" Iterator",M=!1,D=e.prototype,N=D[T]||D["@@iterator"]||f&&D[f],x=!S&&N||_(f),U="Array"===t&&D.entries||N;if(U&&(A=u(U.call(new e)))!==Object.prototype&&A.next&&(o||u(A)===C||(l?l(A,C):a(A[T])||p(A,T,w)),d(A,P,!0,!0),o&&(g[P]=w)),v&&f===b&&N&&N.name!==b&&(!o&&y?h(D,"name",b):(M=!0,x=function(){return i(N,this)})),f)if(O={values:_(b),keys:m?x:_(E),entries:_(I)},R)for(k in O)(S||M||!(k in D))&&p(D,k,O[k]);else r({target:t,proto:!0,forced:S||M},O);return o&&!R||D[T]===x||p(D,T,x,{name:f}),g[t]=x,O}},7657:(e,t,n)=>{"use strict";var r,i,o,s=n(9039),a=n(4901),c=n(34),u=n(2360),l=n(2787),d=n(6840),h=n(8227),p=n(6395),f=h("iterator"),g=!1;[].keys&&("next"in(o=[].keys())?(i=l(l(o)))!==Object.prototype&&(r=i):g=!0),!c(r)||s(function(){var e={};return r[f].call(e)!==e})?r={}:p&&(r=u(r)),a(r[f])||d(r,f,function(){return this}),e.exports={IteratorPrototype:r,BUGGY_SAFARI_ITERATORS:g}},6269:e=>{"use strict";e.exports={}},6198:(e,t,n)=>{"use strict";var r=n(8014);e.exports=function(e){return r(e.length)}},283:(e,t,n)=>{"use strict";var r=n(9504),i=n(9039),o=n(4901),s=n(9297),a=n(3724),c=n(350).CONFIGURABLE,u=n(3706),l=n(1181),d=l.enforce,h=l.get,p=String,f=Object.defineProperty,g=r("".slice),m=r("".replace),v=r([].join),y=a&&!i(function(){return 8!==f(function(){},"length",{value:8}).length}),C=String(String).split("String"),S=e.exports=function(e,t,n){"Symbol("===g(p(t),0,7)&&(t="["+m(p(t),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),n&&n.getter&&(t="get "+t),n&&n.setter&&(t="set "+t),(!s(e,"name")||c&&e.name!==t)&&(a?f(e,"name",{value:t,configurable:!0}):e.name=t),y&&n&&s(n,"arity")&&e.length!==n.arity&&f(e,"length",{value:n.arity});try{n&&s(n,"constructor")&&n.constructor?a&&f(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(e){}var r=d(e);return s(r,"source")||(r.source=v(C,"string"==typeof t?t:"")),e};Function.prototype.toString=S(function(){return o(this)&&h(this).source||u(this)},"toString")},741:e=>{"use strict";var t=Math.ceil,n=Math.floor;e.exports=Math.trunc||function(e){var r=+e;return(r>0?n:t)(r)}},1955:(e,t,n)=>{"use strict";var r,i,o,s,a,c=n(4475),u=n(3389),l=n(6080),d=n(9225).set,h=n(8265),p=n(8119),f=n(28),g=n(6765),m=n(9088),v=c.MutationObserver||c.WebKitMutationObserver,y=c.document,C=c.process,S=c.Promise,T=u("queueMicrotask");if(!T){var E=new h,b=function(){var e,t;for(m&&(e=C.domain)&&e.exit();t=E.get();)try{t()}catch(e){throw E.head&&r(),e}e&&e.enter()};p||m||g||!v||!y?!f&&S&&S.resolve?((s=S.resolve(void 0)).constructor=S,a=l(s.then,s),r=function(){a(b)}):m?r=function(){C.nextTick(b)}:(d=l(d,c),r=function(){d(b)}):(i=!0,o=y.createTextNode(""),new v(b).observe(o,{characterData:!0}),r=function(){o.data=i=!i}),T=function(e){E.head||r(),E.add(e)}}e.exports=T},6043:(e,t,n)=>{"use strict";var r=n(9306),i=TypeError,o=function(e){var t,n;this.promise=new e(function(e,r){if(void 0!==t||void 0!==n)throw new i("Bad Promise constructor");t=e,n=r}),this.resolve=r(t),this.reject=r(n)};e.exports.f=function(e){return new o(e)}},4149:e=>{"use strict";var t=RangeError;e.exports=function(e){if(e==e)return e;throw new t("NaN is not allowed")}},2360:(e,t,n)=>{"use strict";var r,i=n(8551),o=n(6801),s=n(8727),a=n(421),c=n(397),u=n(4055),l=n(6119),d="prototype",h="script",p=l("IE_PROTO"),f=function(){},g=function(e){return"<"+h+">"+e+"</"+h+">"},m=function(e){e.write(g("")),e.close();var t=e.parentWindow.Object;return e=null,t},v=function(){try{r=new ActiveXObject("htmlfile")}catch(e){}var e,t,n;v="undefined"!=typeof document?document.domain&&r?m(r):(t=u("iframe"),n="java"+h+":",t.style.display="none",c.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(g("document.F=Object")),e.close(),e.F):m(r);for(var i=s.length;i--;)delete v[d][s[i]];return v()};a[p]=!0,e.exports=Object.create||function(e,t){var n;return null!==e?(f[d]=i(e),n=new f,f[d]=null,n[p]=e):n=v(),void 0===t?n:o.f(n,t)}},6801:(e,t,n)=>{"use strict";var r=n(3724),i=n(8686),o=n(4913),s=n(8551),a=n(5397),c=n(1072);t.f=r&&!i?Object.defineProperties:function(e,t){s(e);for(var n,r=a(t),i=c(t),u=i.length,l=0;u>l;)o.f(e,n=i[l++],r[n]);return e}},4913:(e,t,n)=>{"use strict";var r=n(3724),i=n(5917),o=n(8686),s=n(8551),a=n(6969),c=TypeError,u=Object.defineProperty,l=Object.getOwnPropertyDescriptor,d="enumerable",h="configurable",p="writable";t.f=r?o?function(e,t,n){if(s(e),t=a(t),s(n),"function"==typeof e&&"prototype"===t&&"value"in n&&p in n&&!n[p]){var r=l(e,t);r&&r[p]&&(e[t]=n.value,n={configurable:h in n?n[h]:r[h],enumerable:d in n?n[d]:r[d],writable:!1})}return u(e,t,n)}:u:function(e,t,n){if(s(e),t=a(t),s(n),i)try{return u(e,t,n)}catch(e){}if("get"in n||"set"in n)throw new c("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},7347:(e,t,n)=>{"use strict";var r=n(3724),i=n(9565),o=n(8773),s=n(6980),a=n(5397),c=n(6969),u=n(9297),l=n(5917),d=Object.getOwnPropertyDescriptor;t.f=r?d:function(e,t){if(e=a(e),t=c(t),l)try{return d(e,t)}catch(e){}if(u(e,t))return s(!i(o.f,e,t),e[t])}},298:(e,t,n)=>{"use strict";var r=n(4576),i=n(5397),o=n(8480).f,s=n(7680),a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return a&&"Window"===r(e)?function(e){try{return o(e)}catch(e){return s(a)}}(e):o(i(e))}},8480:(e,t,n)=>{"use strict";var r=n(1828),i=n(8727).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,i)}},3717:(e,t)=>{"use strict";t.f=Object.getOwnPropertySymbols},2787:(e,t,n)=>{"use strict";var r=n(9297),i=n(4901),o=n(8981),s=n(6119),a=n(2211),c=s("IE_PROTO"),u=Object,l=u.prototype;e.exports=a?u.getPrototypeOf:function(e){var t=o(e);if(r(t,c))return t[c];var n=t.constructor;return i(n)&&t instanceof n?n.prototype:t instanceof u?l:null}},1625:(e,t,n)=>{"use strict";var r=n(9504);e.exports=r({}.isPrototypeOf)},1828:(e,t,n)=>{"use strict";var r=n(9504),i=n(9297),o=n(5397),s=n(9617).indexOf,a=n(421),c=r([].push);e.exports=function(e,t){var n,r=o(e),u=0,l=[];for(n in r)!i(a,n)&&i(r,n)&&c(l,n);for(;t.length>u;)i(r,n=t[u++])&&(~s(l,n)||c(l,n));return l}},1072:(e,t,n)=>{"use strict";var r=n(1828),i=n(8727);e.exports=Object.keys||function(e){return r(e,i)}},8773:(e,t)=>{"use strict";var n={}.propertyIsEnumerable,r=Object.getOwnPropertyDescriptor,i=r&&!n.call({1:2},1);t.f=i?function(e){var t=r(this,e);return!!t&&t.enumerable}:n},2967:(e,t,n)=>{"use strict";var r=n(6706),i=n(34),o=n(7750),s=n(3506);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=r(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch(e){}return function(n,r){return o(n),s(r),i(n)?(t?e(n,r):n.__proto__=r,n):n}}():void 0)},3179:(e,t,n)=>{"use strict";var r=n(2140),i=n(6955);e.exports=r?{}.toString:function(){return"[object "+i(this)+"]"}},4270:(e,t,n)=>{"use strict";var r=n(9565),i=n(4901),o=n(34),s=TypeError;e.exports=function(e,t){var n,a;if("string"===t&&i(n=e.toString)&&!o(a=r(n,e)))return a;if(i(n=e.valueOf)&&!o(a=r(n,e)))return a;if("string"!==t&&i(n=e.toString)&&!o(a=r(n,e)))return a;throw new s("Can't convert object to primitive value")}},5031:(e,t,n)=>{"use strict";var r=n(7751),i=n(9504),o=n(8480),s=n(3717),a=n(8551),c=i([].concat);e.exports=r("Reflect","ownKeys")||function(e){var t=o.f(a(e)),n=s.f;return n?c(t,n(e)):t}},9167:(e,t,n)=>{"use strict";var r=n(4475);e.exports=r},1103:e=>{"use strict";e.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}},916:(e,t,n)=>{"use strict";var r=n(4475),i=n(550),o=n(4901),s=n(2796),a=n(3706),c=n(8227),u=n(7290),l=n(516),d=n(6395),h=n(7388),p=i&&i.prototype,f=c("species"),g=!1,m=o(r.PromiseRejectionEvent),v=s("Promise",function(){var e=a(i),t=e!==String(i);if(!t&&66===h)return!0;if(d&&(!p.catch||!p.finally))return!0;if(!h||h<51||!/native code/.test(e)){var n=new i(function(e){e(1)}),r=function(e){e(function(){},function(){})};if((n.constructor={})[f]=r,!(g=n.then(function(){})instanceof r))return!0}return!t&&(u||l)&&!m});e.exports={CONSTRUCTOR:v,REJECTION_EVENT:m,SUBCLASSING:g}},550:(e,t,n)=>{"use strict";var r=n(4475);e.exports=r.Promise},3438:(e,t,n)=>{"use strict";var r=n(8551),i=n(34),o=n(6043);e.exports=function(e,t){if(r(e),i(t)&&t.constructor===e)return t;var n=o.f(e);return(0,n.resolve)(t),n.promise}},537:(e,t,n)=>{"use strict";var r=n(550),i=n(4428),o=n(916).CONSTRUCTOR;e.exports=o||!i(function(e){r.all(e).then(void 0,function(){})})},8265:e=>{"use strict";var t=function(){this.head=null,this.tail=null};t.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return null===(this.head=e.next)&&(this.tail=null),e.item}},e.exports=t},7750:(e,t,n)=>{"use strict";var r=n(4117),i=TypeError;e.exports=function(e){if(r(e))throw new i("Can't call method on "+e);return e}},3389:(e,t,n)=>{"use strict";var r=n(4475),i=n(3724),o=Object.getOwnPropertyDescriptor;e.exports=function(e){if(!i)return r[e];var t=o(r,e);return t&&t.value}},3470:e=>{"use strict";e.exports=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}},7633:(e,t,n)=>{"use strict";var r=n(7751),i=n(2106),o=n(8227),s=n(3724),a=o("species");e.exports=function(e){var t=r(e);s&&t&&!t[a]&&i(t,a,{configurable:!0,get:function(){return this}})}},687:(e,t,n)=>{"use strict";var r=n(4913).f,i=n(9297),o=n(8227)("toStringTag");e.exports=function(e,t,n){e&&!n&&(e=e.prototype),e&&!i(e,o)&&r(e,o,{configurable:!0,value:t})}},6119:(e,t,n)=>{"use strict";var r=n(5745),i=n(3392),o=r("keys");e.exports=function(e){return o[e]||(o[e]=i(e))}},7629:(e,t,n)=>{"use strict";var r=n(6395),i=n(4475),o=n(9433),s="__core-js_shared__",a=e.exports=i[s]||o(s,{});(a.versions||(a.versions=[])).push({version:"3.37.0",mode:r?"pure":"global",copyright:" 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.37.0/LICENSE",source:"https://github.com/zloirock/core-js"})},5745:(e,t,n)=>{"use strict";var r=n(7629);e.exports=function(e,t){return r[e]||(r[e]=t||{})}},2293:(e,t,n)=>{"use strict";var r=n(8551),i=n(5548),o=n(4117),s=n(8227)("species");e.exports=function(e,t){var n,a=r(e).constructor;return void 0===a||o(n=r(a)[s])?t:i(n)}},8183:(e,t,n)=>{"use strict";var r=n(9504),i=n(1291),o=n(655),s=n(7750),a=r("".charAt),c=r("".charCodeAt),u=r("".slice),l=function(e){return function(t,n){var r,l,d=o(s(t)),h=i(n),p=d.length;return h<0||h>=p?e?"":void 0:(r=c(d,h))<55296||r>56319||h+1===p||(l=c(d,h+1))<56320||l>57343?e?a(d,h):r:e?u(d,h,h+2):l-56320+(r-55296<<10)+65536}};e.exports={codeAt:l(!1),charAt:l(!0)}},4495:(e,t,n)=>{"use strict";var r=n(7388),i=n(9039),o=n(4475).String;e.exports=!!Object.getOwnPropertySymbols&&!i(function(){var e=Symbol("symbol detection");return!o(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&r&&r<41})},8242:(e,t,n)=>{"use strict";var r=n(9565),i=n(7751),o=n(8227),s=n(6840);e.exports=function(){var e=i("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,a=o("toPrimitive");t&&!t[a]&&s(t,a,function(e){return r(n,this)},{arity:1})}},2586:(e,t,n)=>{"use strict";var r=n(7751),i=n(9504),o=r("Symbol"),s=o.keyFor,a=i(o.prototype.valueOf);e.exports=o.isRegisteredSymbol||function(e){try{return void 0!==s(a(e))}catch(e){return!1}}},2104:(e,t,n)=>{"use strict";for(var r=n(5745),i=n(7751),o=n(9504),s=n(757),a=n(8227),c=i("Symbol"),u=c.isWellKnownSymbol,l=i("Object","getOwnPropertyNames"),d=o(c.prototype.valueOf),h=r("wks"),p=0,f=l(c),g=f.length;p<g;p++)try{var m=f[p];s(c[m])&&a(m)}catch(e){}e.exports=function(e){if(u&&u(e))return!0;try{for(var t=d(e),n=0,r=l(h),i=r.length;n<i;n++)if(h[r[n]]==t)return!0}catch(e){}return!1}},1296:(e,t,n)=>{"use strict";var r=n(4495);e.exports=r&&!!Symbol.for&&!!Symbol.keyFor},9225:(e,t,n)=>{"use strict";var r,i,o,s,a=n(4475),c=n(8745),u=n(6080),l=n(4901),d=n(9297),h=n(9039),p=n(397),f=n(7680),g=n(4055),m=n(2812),v=n(8119),y=n(9088),C=a.setImmediate,S=a.clearImmediate,T=a.process,E=a.Dispatch,b=a.Function,I=a.MessageChannel,w=a.String,R=0,A={},O="onreadystatechange";h(function(){r=a.location});var k=function(e){if(d(A,e)){var t=A[e];delete A[e],t()}},_=function(e){return function(){k(e)}},P=function(e){k(e.data)},M=function(e){a.postMessage(w(e),r.protocol+"//"+r.host)};C&&S||(C=function(e){m(arguments.length,1);var t=l(e)?e:b(e),n=f(arguments,1);return A[++R]=function(){c(t,void 0,n)},i(R),R},S=function(e){delete A[e]},y?i=function(e){T.nextTick(_(e))}:E&&E.now?i=function(e){E.now(_(e))}:I&&!v?(s=(o=new I).port2,o.port1.onmessage=P,i=u(s.postMessage,s)):a.addEventListener&&l(a.postMessage)&&!a.importScripts&&r&&"file:"!==r.protocol&&!h(M)?(i=M,a.addEventListener("message",P,!1)):i=O in g("script")?function(e){p.appendChild(g("script"))[O]=function(){p.removeChild(this),k(e)}}:function(e){setTimeout(_(e),0)}),e.exports={set:C,clear:S}},5610:(e,t,n)=>{"use strict";var r=n(1291),i=Math.max,o=Math.min;e.exports=function(e,t){var n=r(e);return n<0?i(n+t,0):o(n,t)}},5397:(e,t,n)=>{"use strict";var r=n(7055),i=n(7750);e.exports=function(e){return r(i(e))}},1291:(e,t,n)=>{"use strict";var r=n(741);e.exports=function(e){var t=+e;return t!=t||0===t?0:r(t)}},8014:(e,t,n)=>{"use strict";var r=n(1291),i=Math.min;e.exports=function(e){var t=r(e);return t>0?i(t,9007199254740991):0}},8981:(e,t,n)=>{"use strict";var r=n(7750),i=Object;e.exports=function(e){return i(r(e))}},9590:(e,t,n)=>{"use strict";var r=n(1291),i=RangeError;e.exports=function(e){var t=r(e);if(t<0)throw new i("The argument can't be less than 0");return t}},2777:(e,t,n)=>{"use strict";var r=n(9565),i=n(34),o=n(757),s=n(5966),a=n(4270),c=n(8227),u=TypeError,l=c("toPrimitive");e.exports=function(e,t){if(!i(e)||o(e))return e;var n,c=s(e,l);if(c){if(void 0===t&&(t="default"),n=r(c,e,t),!i(n)||o(n))return n;throw new u("Can't convert object to primitive value")}return void 0===t&&(t="number"),a(e,t)}},6969:(e,t,n)=>{"use strict";var r=n(2777),i=n(757);e.exports=function(e){var t=r(e,"string");return i(t)?t:t+""}},2140:(e,t,n)=>{"use strict";var r={};r[n(8227)("toStringTag")]="z",e.exports="[object z]"===String(r)},655:(e,t,n)=>{"use strict";var r=n(6955),i=String;e.exports=function(e){if("Symbol"===r(e))throw new TypeError("Cannot convert a Symbol value to a string");return i(e)}},6823:e=>{"use strict";var t=String;e.exports=function(e){try{return t(e)}catch(e){return"Object"}}},3392:(e,t,n)=>{"use strict";var r=n(9504),i=0,o=Math.random(),s=r(1..toString);e.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+s(++i+o,36)}},7040:(e,t,n)=>{"use strict";var r=n(4495);e.exports=r&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},8686:(e,t,n)=>{"use strict";var r=n(3724),i=n(9039);e.exports=r&&i(function(){return 42!==Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype})},2812:e=>{"use strict";var t=TypeError;e.exports=function(e,n){if(e<n)throw new t("Not enough arguments");return e}},8622:(e,t,n)=>{"use strict";var r=n(4475),i=n(4901),o=r.WeakMap;e.exports=i(o)&&/native code/.test(String(o))},511:(e,t,n)=>{"use strict";var r=n(9167),i=n(9297),o=n(1951),s=n(4913).f;e.exports=function(e){var t=r.Symbol||(r.Symbol={});i(t,e)||s(t,e,{value:o.f(e)})}},1951:(e,t,n)=>{"use strict";var r=n(8227);t.f=r},8227:(e,t,n)=>{"use strict";var r=n(4475),i=n(5745),o=n(9297),s=n(3392),a=n(4495),c=n(7040),u=r.Symbol,l=i("wks"),d=c?u.for||u:u&&u.withoutSetter||s;e.exports=function(e){return o(l,e)||(l[e]=a&&o(u,e)?u[e]:d("Symbol."+e)),l[e]}},8706:(e,t,n)=>{"use strict";var r=n(6518),i=n(9039),o=n(4376),s=n(34),a=n(8981),c=n(6198),u=n(6837),l=n(4659),d=n(1469),h=n(597),p=n(8227),f=n(7388),g=p("isConcatSpreadable"),m=f>=51||!i(function(){var e=[];return e[g]=!1,e.concat()[0]!==e}),v=function(e){if(!s(e))return!1;var t=e[g];return void 0!==t?!!t:o(e)};r({target:"Array",proto:!0,arity:1,forced:!m||!h("concat")},{concat:function(e){var t,n,r,i,o,s=a(this),h=d(s,0),p=0;for(t=-1,r=arguments.length;t<r;t++)if(v(o=-1===t?s:arguments[t]))for(i=c(o),u(p+i),n=0;n<i;n++,p++)n in o&&l(h,p,o[n]);else u(p+1),l(h,p++,o);return h.length=p,h}})},3792:(e,t,n)=>{"use strict";var r=n(5397),i=n(6469),o=n(6269),s=n(1181),a=n(4913).f,c=n(1088),u=n(2529),l=n(6395),d=n(3724),h="Array Iterator",p=s.set,f=s.getterFor(h);e.exports=c(Array,"Array",function(e,t){p(this,{type:h,target:r(e),index:0,kind:t})},function(){var e=f(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=void 0,u(void 0,!0);switch(e.kind){case"keys":return u(n,!1);case"values":return u(t[n],!1)}return u([n,t[n]],!1)},"values");var g=o.Arguments=o.Array;if(i("keys"),i("values"),i("entries"),!l&&d&&"values"!==g.name)try{a(g,"name",{value:"values"})}catch(e){}},3110:(e,t,n)=>{"use strict";var r=n(6518),i=n(7751),o=n(8745),s=n(9565),a=n(9504),c=n(9039),u=n(4901),l=n(757),d=n(7680),h=n(6933),p=n(4495),f=String,g=i("JSON","stringify"),m=a(/./.exec),v=a("".charAt),y=a("".charCodeAt),C=a("".replace),S=a(1..toString),T=/[\uD800-\uDFFF]/g,E=/^[\uD800-\uDBFF]$/,b=/^[\uDC00-\uDFFF]$/,I=!p||c(function(){var e=i("Symbol")("stringify detection");return"[null]"!==g([e])||"{}"!==g({a:e})||"{}"!==g(Object(e))}),w=c(function(){return'"\\udf06\\ud834"'!==g("\udf06\ud834")||'"\\udead"'!==g("\udead")}),R=function(e,t){var n=d(arguments),r=h(t);if(u(r)||void 0!==e&&!l(e))return n[1]=function(e,t){if(u(r)&&(t=s(r,this,f(e),t)),!l(t))return t},o(g,null,n)},A=function(e,t,n){var r=v(n,t-1),i=v(n,t+1);return m(E,e)&&!m(b,i)||m(b,e)&&!m(E,r)?"\\u"+S(y(e,0),16):e};g&&r({target:"JSON",stat:!0,arity:3,forced:I||w},{stringify:function(e,t,n){var r=d(arguments),i=o(I?R:g,null,r);return w&&"string"==typeof i?C(i,T,A):i}})},4731:(e,t,n)=>{"use strict";var r=n(4475);n(687)(r.JSON,"JSON",!0)},479:(e,t,n)=>{"use strict";n(687)(Math,"Math",!0)},9773:(e,t,n)=>{"use strict";var r=n(6518),i=n(4495),o=n(9039),s=n(3717),a=n(8981);r({target:"Object",stat:!0,forced:!i||o(function(){s.f(1)})},{getOwnPropertySymbols:function(e){var t=s.f;return t?t(a(e)):[]}})},9908:(e,t,n)=>{"use strict";n(6518)({target:"Object",stat:!0},{is:n(3470)})},6099:(e,t,n)=>{"use strict";var r=n(2140),i=n(6840),o=n(3179);r||i(Object.prototype,"toString",o,{unsafe:!0})},6499:(e,t,n)=>{"use strict";var r=n(6518),i=n(9565),o=n(9306),s=n(6043),a=n(1103),c=n(2652);r({target:"Promise",stat:!0,forced:n(537)},{all:function(e){var t=this,n=s.f(t),r=n.resolve,u=n.reject,l=a(function(){var n=o(t.resolve),s=[],a=0,l=1;c(e,function(e){var o=a++,c=!1;l++,i(n,t,e).then(function(e){c||(c=!0,s[o]=e,--l||r(s))},u)}),--l||r(s)});return l.error&&u(l.value),n.promise}})},2003:(e,t,n)=>{"use strict";var r=n(6518),i=n(6395),o=n(916).CONSTRUCTOR,s=n(550),a=n(7751),c=n(4901),u=n(6840),l=s&&s.prototype;if(r({target:"Promise",proto:!0,forced:o,real:!0},{catch:function(e){return this.then(void 0,e)}}),!i&&c(s)){var d=a("Promise").prototype.catch;l.catch!==d&&u(l,"catch",d,{unsafe:!0})}},436:(e,t,n)=>{"use strict";var r,i,o,s=n(6518),a=n(6395),c=n(9088),u=n(4475),l=n(9565),d=n(6840),h=n(2967),p=n(687),f=n(7633),g=n(9306),m=n(4901),v=n(34),y=n(679),C=n(2293),S=n(9225).set,T=n(1955),E=n(3138),b=n(1103),I=n(8265),w=n(1181),R=n(550),A=n(916),O=n(6043),k="Promise",_=A.CONSTRUCTOR,P=A.REJECTION_EVENT,M=A.SUBCLASSING,D=w.getterFor(k),N=w.set,x=R&&R.prototype,U=R,L=x,q=u.TypeError,j=u.document,F=u.process,B=O.f,G=B,H=!!(j&&j.createEvent&&u.dispatchEvent),V="unhandledrejection",z=function(e){var t;return!(!v(e)||!m(t=e.then))&&t},W=function(e,t){var n,r,i,o=t.value,s=1===t.state,a=s?e.ok:e.fail,c=e.resolve,u=e.reject,d=e.domain;try{a?(s||(2===t.rejection&&Q(t),t.rejection=1),!0===a?n=o:(d&&d.enter(),n=a(o),d&&(d.exit(),i=!0)),n===e.promise?u(new q("Promise-chain cycle")):(r=z(n))?l(r,n,c,u):c(n)):u(o)}catch(e){d&&!i&&d.exit(),u(e)}},K=function(e,t){e.notified||(e.notified=!0,T(function(){for(var n,r=e.reactions;n=r.get();)W(n,e);e.notified=!1,t&&!e.rejection&&J(e)}))},$=function(e,t,n){var r,i;H?((r=j.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),u.dispatchEvent(r)):r={promise:t,reason:n},!P&&(i=u["on"+e])?i(r):e===V&&E("Unhandled promise rejection",n)},J=function(e){l(S,u,function(){var t,n=e.facade,r=e.value;if(X(e)&&(t=b(function(){c?F.emit("unhandledRejection",r,n):$(V,n,r)}),e.rejection=c||X(e)?2:1,t.error))throw t.value})},X=function(e){return 1!==e.rejection&&!e.parent},Q=function(e){l(S,u,function(){var t=e.facade;c?F.emit("rejectionHandled",t):$("rejectionhandled",t,e.value)})},Y=function(e,t,n){return function(r){e(t,r,n)}},Z=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,K(e,!0))},ee=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw new q("Promise can't be resolved itself");var r=z(t);r?T(function(){var n={done:!1};try{l(r,t,Y(ee,n,e),Y(Z,n,e))}catch(t){Z(n,t,e)}}):(e.value=t,e.state=1,K(e,!1))}catch(t){Z({done:!1},t,e)}}};if(_&&(L=(U=function(e){y(this,L),g(e),l(r,this);var t=D(this);try{e(Y(ee,t),Y(Z,t))}catch(e){Z(t,e)}}).prototype,(r=function(e){N(this,{type:k,done:!1,notified:!1,parent:!1,reactions:new I,rejection:!1,state:0,value:void 0})}).prototype=d(L,"then",function(e,t){var n=D(this),r=B(C(this,U));return n.parent=!0,r.ok=!m(e)||e,r.fail=m(t)&&t,r.domain=c?F.domain:void 0,0===n.state?n.reactions.add(r):T(function(){W(r,n)}),r.promise}),i=function(){var e=new r,t=D(e);this.promise=e,this.resolve=Y(ee,t),this.reject=Y(Z,t)},O.f=B=function(e){return e===U||void 0===e?new i(e):G(e)},!a&&m(R)&&x!==Object.prototype)){o=x.then,M||d(x,"then",function(e,t){var n=this;return new U(function(e,t){l(o,n,e,t)}).then(e,t)},{unsafe:!0});try{delete x.constructor}catch(e){}h&&h(x,L)}s({global:!0,constructor:!0,wrap:!0,forced:_},{Promise:U}),p(U,k,!1,!0),f(k)},3362:(e,t,n)=>{"use strict";n(436),n(6499),n(2003),n(7743),n(1481),n(280)},7743:(e,t,n)=>{"use strict";var r=n(6518),i=n(9565),o=n(9306),s=n(6043),a=n(1103),c=n(2652);r({target:"Promise",stat:!0,forced:n(537)},{race:function(e){var t=this,n=s.f(t),r=n.reject,u=a(function(){var s=o(t.resolve);c(e,function(e){i(s,t,e).then(n.resolve,r)})});return u.error&&r(u.value),n.promise}})},1481:(e,t,n)=>{"use strict";var r=n(6518),i=n(6043);r({target:"Promise",stat:!0,forced:n(916).CONSTRUCTOR},{reject:function(e){var t=i.f(this);return(0,t.reject)(e),t.promise}})},280:(e,t,n)=>{"use strict";var r=n(6518),i=n(7751),o=n(6395),s=n(550),a=n(916).CONSTRUCTOR,c=n(3438),u=i("Promise"),l=o&&!a;r({target:"Promise",stat:!0,forced:o||a},{resolve:function(e){return c(l&&this===u?s:this,e)}})},5472:(e,t,n)=>{"use strict";var r=n(6518),i=n(4475),o=n(687);r({global:!0},{Reflect:{}}),o(i.Reflect,"Reflect",!0)},7764:(e,t,n)=>{"use strict";var r=n(8183).charAt,i=n(655),o=n(1181),s=n(1088),a=n(2529),c="String Iterator",u=o.set,l=o.getterFor(c);s(String,"String",function(e){u(this,{type:c,string:i(e),index:0})},function(){var e,t=l(this),n=t.string,i=t.index;return i>=n.length?a(void 0,!0):(e=r(n,i),t.index+=e.length,a(e,!1))})},6412:(e,t,n)=>{"use strict";n(511)("asyncIterator")},6761:(e,t,n)=>{"use strict";var r=n(6518),i=n(4475),o=n(9565),s=n(9504),a=n(6395),c=n(3724),u=n(4495),l=n(9039),d=n(9297),h=n(1625),p=n(8551),f=n(5397),g=n(6969),m=n(655),v=n(6980),y=n(2360),C=n(1072),S=n(8480),T=n(298),E=n(3717),b=n(7347),I=n(4913),w=n(6801),R=n(8773),A=n(6840),O=n(2106),k=n(5745),_=n(6119),P=n(421),M=n(3392),D=n(8227),N=n(1951),x=n(511),U=n(8242),L=n(687),q=n(1181),j=n(9213).forEach,F=_("hidden"),B="Symbol",G="prototype",H=q.set,V=q.getterFor(B),z=Object[G],W=i.Symbol,K=W&&W[G],$=i.RangeError,J=i.TypeError,X=i.QObject,Q=b.f,Y=I.f,Z=T.f,ee=R.f,te=s([].push),ne=k("symbols"),re=k("op-symbols"),ie=k("wks"),oe=!X||!X[G]||!X[G].findChild,se=function(e,t,n){var r=Q(z,t);r&&delete z[t],Y(e,t,n),r&&e!==z&&Y(z,t,r)},ae=c&&l(function(){return 7!==y(Y({},"a",{get:function(){return Y(this,"a",{value:7}).a}})).a})?se:Y,ce=function(e,t){var n=ne[e]=y(K);return H(n,{type:B,tag:e,description:t}),c||(n.description=t),n},ue=function(e,t,n){e===z&&ue(re,t,n),p(e);var r=g(t);return p(n),d(ne,r)?(n.enumerable?(d(e,F)&&e[F][r]&&(e[F][r]=!1),n=y(n,{enumerable:v(0,!1)})):(d(e,F)||Y(e,F,v(1,y(null))),e[F][r]=!0),ae(e,r,n)):Y(e,r,n)},le=function(e,t){p(e);var n=f(t),r=C(n).concat(fe(n));return j(r,function(t){c&&!o(de,n,t)||ue(e,t,n[t])}),e},de=function(e){var t=g(e),n=o(ee,this,t);return!(this===z&&d(ne,t)&&!d(re,t))&&(!(n||!d(this,t)||!d(ne,t)||d(this,F)&&this[F][t])||n)},he=function(e,t){var n=f(e),r=g(t);if(n!==z||!d(ne,r)||d(re,r)){var i=Q(n,r);return!i||!d(ne,r)||d(n,F)&&n[F][r]||(i.enumerable=!0),i}},pe=function(e){var t=Z(f(e)),n=[];return j(t,function(e){d(ne,e)||d(P,e)||te(n,e)}),n},fe=function(e){var t=e===z,n=Z(t?re:f(e)),r=[];return j(n,function(e){!d(ne,e)||t&&!d(z,e)||te(r,ne[e])}),r};u||(A(K=(W=function(){if(h(K,this))throw new J("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?m(arguments[0]):void 0,t=M(e),n=function(e){var r=void 0===this?i:this;r===z&&o(n,re,e),d(r,F)&&d(r[F],t)&&(r[F][t]=!1);var s=v(1,e);try{ae(r,t,s)}catch(e){if(!(e instanceof $))throw e;se(r,t,s)}};return c&&oe&&ae(z,t,{configurable:!0,set:n}),ce(t,e)})[G],"toString",function(){return V(this).tag}),A(W,"withoutSetter",function(e){return ce(M(e),e)}),R.f=de,I.f=ue,w.f=le,b.f=he,S.f=T.f=pe,E.f=fe,N.f=function(e){return ce(D(e),e)},c&&(O(K,"description",{configurable:!0,get:function(){return V(this).description}}),a||A(z,"propertyIsEnumerable",de,{unsafe:!0}))),r({global:!0,constructor:!0,wrap:!0,forced:!u,sham:!u},{Symbol:W}),j(C(ie),function(e){x(e)}),r({target:B,stat:!0,forced:!u},{useSetter:function(){oe=!0},useSimple:function(){oe=!1}}),r({target:"Object",stat:!0,forced:!u,sham:!c},{create:function(e,t){return void 0===t?y(e):le(y(e),t)},defineProperty:ue,defineProperties:le,getOwnPropertyDescriptor:he}),r({target:"Object",stat:!0,forced:!u},{getOwnPropertyNames:pe}),U(),L(W,B),P[F]=!0},9463:(e,t,n)=>{"use strict";var r=n(6518),i=n(3724),o=n(4475),s=n(9504),a=n(9297),c=n(4901),u=n(1625),l=n(655),d=n(2106),h=n(7740),p=o.Symbol,f=p&&p.prototype;if(i&&c(p)&&(!("description"in f)||void 0!==p().description)){var g={},m=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:l(arguments[0]),t=u(f,this)?new p(e):void 0===e?p():p(e);return""===e&&(g[t]=!0),t};h(m,p),m.prototype=f,f.constructor=m;var v="Symbol(description detection)"===String(p("description detection")),y=s(f.valueOf),C=s(f.toString),S=/^Symbol\((.*)\)[^)]+$/,T=s("".replace),E=s("".slice);d(f,"description",{configurable:!0,get:function(){var e=y(this);if(a(g,e))return"";var t=C(e),n=v?E(t,7,-1):T(t,S,"$1");return""===n?void 0:n}}),r({global:!0,constructor:!0,forced:!0},{Symbol:m})}},1510:(e,t,n)=>{"use strict";var r=n(6518),i=n(7751),o=n(9297),s=n(655),a=n(5745),c=n(1296),u=a("string-to-symbol-registry"),l=a("symbol-to-string-registry");r({target:"Symbol",stat:!0,forced:!c},{for:function(e){var t=s(e);if(o(u,t))return u[t];var n=i("Symbol")(t);return u[t]=n,l[n]=t,n}})},193:(e,t,n)=>{"use strict";n(511)("hasInstance")},2168:(e,t,n)=>{"use strict";n(511)("isConcatSpreadable")},2259:(e,t,n)=>{"use strict";n(511)("iterator")},2675:(e,t,n)=>{"use strict";n(6761),n(1510),n(7812),n(3110),n(9773)},7812:(e,t,n)=>{"use strict";var r=n(6518),i=n(9297),o=n(757),s=n(6823),a=n(5745),c=n(1296),u=a("symbol-to-string-registry");r({target:"Symbol",stat:!0,forced:!c},{keyFor:function(e){if(!o(e))throw new TypeError(s(e)+" is not a symbol");if(i(u,e))return u[e]}})},3142:(e,t,n)=>{"use strict";n(511)("matchAll")},6964:(e,t,n)=>{"use strict";n(511)("match")},3237:(e,t,n)=>{"use strict";n(511)("replace")},1833:(e,t,n)=>{"use strict";n(511)("search")},7947:(e,t,n)=>{"use strict";n(511)("species")},1073:(e,t,n)=>{"use strict";n(511)("split")},5700:(e,t,n)=>{"use strict";var r=n(511),i=n(8242);r("toPrimitive"),i()},8125:(e,t,n)=>{"use strict";var r=n(7751),i=n(511),o=n(687);i("toStringTag"),o(r("Symbol"),"Symbol")},326:(e,t,n)=>{"use strict";n(511)("unscopables")},4847:(e,t,n)=>{"use strict";n(6518)({target:"AsyncIterator",name:"indexed",proto:!0,real:!0,forced:!0},{asIndexedPairs:n(7481)})},4147:(e,t,n)=>{"use strict";var r=n(9565),i=n(6840),o=n(7751),s=n(5966),a=n(9297),c=n(8227),u=n(3982),l=c("asyncDispose"),d=o("Promise");a(u,l)||i(u,l,function(){var e=this;return new d(function(t,n){var i=s(e,"return");i?d.resolve(r(i,e)).then(function(){t(void 0)},n):t(void 0)})})},3811:(e,t,n)=>{"use strict";var r=n(6518),i=n(679),o=n(2787),s=n(6699),a=n(9297),c=n(8227),u=n(3982),l=n(6395),d=c("toStringTag"),h=TypeError,p=function(){if(i(this,u),o(this)===u)throw new h("Abstract class AsyncIterator not directly constructable")};p.prototype=u,a(u,d)||s(u,d,"AsyncIterator"),!l&&a(u,"constructor")&&u.constructor!==Object||s(u,"constructor",p),r({global:!0,constructor:!0,forced:l},{AsyncIterator:p})},9150:(e,t,n)=>{"use strict";var r=n(6518),i=n(9565),o=n(8551),s=n(1767),a=n(4149),c=n(9590),u=n(2059),l=n(2529),d=n(6395),h=u(function(e){var t=this;return new e(function(n,r){var s=function(e){t.done=!0,r(e)},a=function(){try{e.resolve(o(i(t.next,t.iterator))).then(function(e){try{o(e).done?(t.done=!0,n(l(void 0,!0))):t.remaining?(t.remaining--,a()):n(l(e.value,!1))}catch(e){s(e)}},s)}catch(e){s(e)}};a()})});r({target:"AsyncIterator",proto:!0,real:!0,forced:d},{drop:function(e){o(this);var t=c(a(+e));return new h(s(this),{remaining:t})}})},4648:(e,t,n)=>{"use strict";var r=n(6518),i=n(6639).every;r({target:"AsyncIterator",proto:!0,real:!0},{every:function(e){return i(this,e)}})},7333:(e,t,n)=>{"use strict";var r=n(6518),i=n(9565),o=n(9306),s=n(8551),a=n(34),c=n(1767),u=n(2059),l=n(2529),d=n(772),h=n(6395),p=u(function(e){var t=this,n=t.iterator,r=t.predicate;return new e(function(o,c){var u=function(e){t.done=!0,c(e)},h=function(e){d(n,u,e,u)},p=function(){try{e.resolve(s(i(t.next,n))).then(function(n){try{if(s(n).done)t.done=!0,o(l(void 0,!0));else{var i=n.value;try{var c=r(i,t.counter++),d=function(e){e?o(l(i,!1)):p()};a(c)?e.resolve(c).then(d,h):d(c)}catch(e){h(e)}}}catch(e){u(e)}},u)}catch(e){u(e)}};p()})});r({target:"AsyncIterator",proto:!0,real:!0,forced:h},{filter:function(e){return s(this),o(e),new p(c(this),{predicate:e})}})},3064:(e,t,n)=>{"use strict";var r=n(6518),i=n(6639).find;r({target:"AsyncIterator",proto:!0,real:!0},{find:function(e){return i(this,e)}})},2679:(e,t,n)=>{"use strict";var r=n(6518),i=n(9565),o=n(9306),s=n(8551),a=n(34),c=n(1767),u=n(2059),l=n(2529),d=n(133),h=n(772),p=n(6395),f=u(function(e){var t=this,n=t.iterator,r=t.mapper;return new e(function(o,c){var u=function(e){t.done=!0,c(e)},p=function(e){h(n,u,e,u)},f=function(){try{e.resolve(s(i(t.next,n))).then(function(n){try{if(s(n).done)t.done=!0,o(l(void 0,!0));else{var i=n.value;try{var c=r(i,t.counter++),h=function(e){try{t.inner=d(e),g()}catch(e){p(e)}};a(c)?e.resolve(c).then(h,p):h(c)}catch(e){p(e)}}}catch(e){u(e)}},u)}catch(e){u(e)}},g=function(){var n=t.inner;if(n)try{e.resolve(s(i(n.next,n.iterator))).then(function(e){try{s(e).done?(t.inner=null,f()):o(l(e.value,!1))}catch(e){p(e)}},p)}catch(e){p(e)}else f()};g()})});r({target:"AsyncIterator",proto:!0,real:!0,forced:p},{flatMap:function(e){return s(this),o(e),new f(c(this),{mapper:e,inner:null})}})},9920:(e,t,n)=>{"use strict";var r=n(6518),i=n(6639).forEach;r({target:"AsyncIterator",proto:!0,real:!0},{forEach:function(e){return i(this,e)}})},6967:(e,t,n)=>{"use strict";var r=n(6518),i=n(8981),o=n(1625),s=n(133),a=n(3982),c=n(4690);r({target:"AsyncIterator",stat:!0,forced:n(6395)},{from:function(e){var t=s("string"==typeof e?i(e):e);return o(a,t.iterator)?t.iterator:new c(t)}})},5182:(e,t,n)=>{"use strict";n(6518)({target:"AsyncIterator",proto:!0,real:!0,forced:!0},{indexed:n(7481)})},1393:(e,t,n)=>{"use strict";var r=n(6518),i=n(1750);r({target:"AsyncIterator",proto:!0,real:!0,forced:n(6395)},{map:i})},4905:(e,t,n)=>{"use strict";var r=n(6518),i=n(9565),o=n(9306),s=n(8551),a=n(34),c=n(7751),u=n(1767),l=n(772),d=c("Promise"),h=TypeError;r({target:"AsyncIterator",proto:!0,real:!0},{reduce:function(e){s(this),o(e);var t=u(this),n=t.iterator,r=t.next,c=arguments.length<2,p=c?void 0:arguments[1],f=0;return new d(function(t,o){var u=function(e){l(n,o,e,o)},g=function(){try{d.resolve(s(i(r,n))).then(function(n){try{if(s(n).done)c?o(new h("Reduce of empty iterator with no initial value")):t(p);else{var r=n.value;if(c)c=!1,p=r,g();else try{var i=e(p,r,f),l=function(e){p=e,g()};a(i)?d.resolve(i).then(l,u):l(i)}catch(e){u(e)}}f++}catch(e){o(e)}},o)}catch(e){o(e)}};g()})}})},8159:(e,t,n)=>{"use strict";var r=n(6518),i=n(6639).some;r({target:"AsyncIterator",proto:!0,real:!0},{some:function(e){return i(this,e)}})},9320:(e,t,n)=>{"use strict";var r=n(6518),i=n(9565),o=n(8551),s=n(1767),a=n(4149),c=n(9590),u=n(2059),l=n(2529),d=n(6395),h=u(function(e){var t,n=this,r=n.iterator;if(!n.remaining--){var s=l(void 0,!0);return n.done=!0,void 0!==(t=r.return)?e.resolve(i(t,r,void 0)).then(function(){return s}):s}return e.resolve(i(n.next,r)).then(function(e){return o(e).done?(n.done=!0,l(void 0,!0)):l(e.value,!1)}).then(null,function(e){throw n.done=!0,e})});r({target:"AsyncIterator",proto:!0,real:!0,forced:d},{take:function(e){o(this);var t=c(a(+e));return new h(s(this),{remaining:t})}})},6994:(e,t,n)=>{"use strict";var r=n(6518),i=n(6639).toArray;r({target:"AsyncIterator",proto:!0,real:!0},{toArray:function(){return i(this,void 0,[])}})},6401:(e,t,n)=>{"use strict";var r=n(8227),i=n(4913).f,o=r("metadata"),s=Function.prototype;void 0===s[o]&&i(s,o,{value:null})},5239:(e,t,n)=>{"use strict";var r=n(6518),i=n(9565),o=n(3724),s=n(7633),a=n(9306),c=n(8551),u=n(679),l=n(4901),d=n(4117),h=n(34),p=n(5966),f=n(6840),g=n(6279),m=n(2106),v=n(3138),y=n(8227),C=n(1181),S=y("observable"),T="Observable",E="Subscription",b="SubscriptionObserver",I=C.getterFor,w=C.set,R=I(T),A=I(E),O=I(b),k=function(e){this.observer=c(e),this.cleanup=void 0,this.subscriptionObserver=void 0};k.prototype={type:E,clean:function(){var e=this.cleanup;if(e){this.cleanup=void 0;try{e()}catch(e){v(e)}}},close:function(){if(!o){var e=this.facade,t=this.subscriptionObserver;e.closed=!0,t&&(t.closed=!0)}this.observer=void 0},isClosed:function(){return void 0===this.observer}};var _=function(e,t){var n,r=w(this,new k(e));o||(this.closed=!1);try{(n=p(e,"start"))&&i(n,e,this)}catch(e){v(e)}if(!r.isClosed()){var s=r.subscriptionObserver=new P(r);try{var c=t(s),u=c;d(c)||(r.cleanup=l(c.unsubscribe)?function(){u.unsubscribe()}:a(c))}catch(e){return void s.error(e)}r.isClosed()&&r.clean()}};_.prototype=g({},{unsubscribe:function(){var e=A(this);e.isClosed()||(e.close(),e.clean())}}),o&&m(_.prototype,"closed",{configurable:!0,get:function(){return A(this).isClosed()}});var P=function(e){w(this,{type:b,subscriptionState:e}),o||(this.closed=!1)};P.prototype=g({},{next:function(e){var t=O(this).subscriptionState;if(!t.isClosed()){var n=t.observer;try{var r=p(n,"next");r&&i(r,n,e)}catch(e){v(e)}}},error:function(e){var t=O(this).subscriptionState;if(!t.isClosed()){var n=t.observer;t.close();try{var r=p(n,"error");r?i(r,n,e):v(e)}catch(e){v(e)}t.clean()}},complete:function(){var e=O(this).subscriptionState;if(!e.isClosed()){var t=e.observer;e.close();try{var n=p(t,"complete");n&&i(n,t)}catch(e){v(e)}e.clean()}}}),o&&m(P.prototype,"closed",{configurable:!0,get:function(){return O(this).subscriptionState.isClosed()}});var M=function(e){u(this,D),w(this,{type:T,subscriber:a(e)})},D=M.prototype;g(D,{subscribe:function(e){var t=arguments.length;return new _(l(e)?{next:e,error:t>1?arguments[1]:void 0,complete:t>2?arguments[2]:void 0}:h(e)?e:{},R(this).subscriber)}}),f(D,S,function(){return this}),r({global:!0,constructor:!0,forced:!0},{Observable:M}),s(T)},9035:(e,t,n)=>{"use strict";var r=n(6518),i=n(7751),o=n(9565),s=n(8551),a=n(3517),c=n(81),u=n(5966),l=n(2652),d=n(8227)("observable");r({target:"Observable",stat:!0,forced:!0},{from:function(e){var t=a(this)?this:i("Observable"),n=u(s(e),d);if(n){var r=s(o(n,e));return r.constructor===t?r:new t(function(e){return r.subscribe(e)})}var h=c(e);return new t(function(e){l(h,function(t,n){if(e.next(t),e.closed)return n()},{IS_ITERATOR:!0,INTERRUPTED:!0}),e.complete()})}})},2917:(e,t,n)=>{"use strict";n(5239),n(9035),n(8662)},8662:(e,t,n)=>{"use strict";var r=n(6518),i=n(7751),o=n(3517),s=i("Array");r({target:"Observable",stat:!0,forced:!0},{of:function(){for(var e=o(this)?this:i("Observable"),t=arguments.length,n=s(t),r=0;r<t;)n[r]=arguments[r++];return new e(function(e){for(var r=0;r<t;r++)if(e.next(n[r]),e.closed)return;e.complete()})}})},1202:(e,t,n)=>{"use strict";var r=n(4475),i=n(511),o=n(4913).f,s=n(7347).f,a=r.Symbol;if(i("asyncDispose"),a){var c=s(a,"asyncDispose");c.enumerable&&c.configurable&&c.writable&&o(a,"asyncDispose",{value:c.value,enumerable:!1,configurable:!1,writable:!1})}},9604:(e,t,n)=>{"use strict";n(511)("customMatcher")},3275:(e,t,n)=>{"use strict";var r=n(4475),i=n(511),o=n(4913).f,s=n(7347).f,a=r.Symbol;if(i("dispose"),a){var c=s(a,"dispose");c.enumerable&&c.configurable&&c.writable&&o(a,"dispose",{value:c.value,enumerable:!1,configurable:!1,writable:!1})}},3070:(e,t,n)=>{"use strict";n(6518)({target:"Symbol",stat:!0},{isRegisteredSymbol:n(2586)})},7153:(e,t,n)=>{"use strict";n(6518)({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:n(2586)})},3032:(e,t,n)=>{"use strict";n(6518)({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:n(2104)})},3803:(e,t,n)=>{"use strict";n(6518)({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:n(2104)})},3976:(e,t,n)=>{"use strict";n(511)("matcher")},8999:(e,t,n)=>{"use strict";n(511)("metadataKey")},465:(e,t,n)=>{"use strict";n(511)("metadata")},2793:(e,t,n)=>{"use strict";n(511)("observable")},7208:(e,t,n)=>{"use strict";n(511)("patternMatch")},3440:(e,t,n)=>{"use strict";n(511)("replaceAll")},2953:(e,t,n)=>{"use strict";var r=n(4475),i=n(7400),o=n(9296),s=n(3792),a=n(6699),c=n(687),u=n(8227)("iterator"),l=s.values,d=function(e,t){if(e){if(e[u]!==l)try{a(e,u,l)}catch(t){e[u]=l}if(c(e,t,!0),i[t])for(var n in s)if(e[n]!==s[n])try{a(e,n,s[n])}catch(t){e[n]=s[n]}}};for(var h in i)d(r[h]&&r[h].prototype,h);d(o,"DOMTokenList")},1327:(e,t,n)=>{"use strict";var r=n(3216);e.exports=r},884:(e,t,n)=>{"use strict";var r=n(9281);n(2953),e.exports=r},1219:(e,t,n)=>{"use strict";function r(e){let t="";for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return btoa(t)}function i(e){const t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}n.r(t),n.d(t,{MapperTypeNames:()=>S,ServiceClient:()=>j,XML_ATTRKEY:()=>o,XML_CHARKEY:()=>s,authorizeRequestOnClaimChallenge:()=>F,authorizeRequestOnTenantChallenge:()=>B,createClientPipeline:()=>N,createSerializer:()=>d,deserializationPolicy:()=>_,deserializationPolicyName:()=>k,serializationPolicy:()=>D,serializationPolicyName:()=>M});const o="$",s="_",a=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/,c=/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/i;function u(e,t){var n,r;const i=e.parsedHeaders;if("HEAD"===e.request.method)return Object.assign(Object.assign({},i),{body:e.parsedBody});const o=t&&t.bodyMapper,s=Boolean(null==o?void 0:o.nullable),a=null==o?void 0:o.type.name;if("Stream"===a)return Object.assign(Object.assign({},i),{blobBody:e.blobBody,readableStreamBody:e.readableStreamBody});const c="Composite"===a&&o.type.modelProperties||{},u=Object.keys(c).some(e=>""===c[e].serializedName);if("Sequence"===a||u){const t=null!==(n=e.parsedBody)&&void 0!==n?n:[];for(const n of Object.keys(c))c[n].serializedName&&(t[n]=null===(r=e.parsedBody)||void 0===r?void 0:r[n]);if(i)for(const e of Object.keys(i))t[e]=i[e];return!s||e.parsedBody||i||0!==Object.getOwnPropertyNames(c).length?t:null}return function(e){const t=Object.assign(Object.assign({},e.headers),e.body);return e.hasNullableType&&0===Object.getOwnPropertyNames(t).length?e.shouldWrapBody?{body:null}:null:e.shouldWrapBody?Object.assign(Object.assign({},e.headers),{body:e.body}):t}({body:e.parsedBody,headers:i,hasNullableType:s,shouldWrapBody:(l=e.parsedBody,d=a,"Composite"!==d&&"Dictionary"!==d&&("string"==typeof l||"number"==typeof l||"boolean"==typeof l||null!==(null==d?void 0:d.match(/^(Date|DateTime|DateTimeRfc1123|UnixTime|ByteArray|Base64Url)$/i))||null==l))});var l,d}class l{constructor(e={},t=!1){this.modelMappers=e,this.isXML=t}validateConstraints(e,t,n){const r=(e,r)=>{throw new Error(`"${n}" with value "${t}" should satisfy the constraint "${e}": ${r}.`)};if(e.constraints&&null!=t){const{ExclusiveMaximum:n,ExclusiveMinimum:i,InclusiveMaximum:o,InclusiveMinimum:s,MaxItems:a,MaxLength:c,MinItems:u,MinLength:l,MultipleOf:d,Pattern:h,UniqueItems:p}=e.constraints;if(void 0!==n&&t>=n&&r("ExclusiveMaximum",n),void 0!==i&&t<=i&&r("ExclusiveMinimum",i),void 0!==o&&t>o&&r("InclusiveMaximum",o),void 0!==s&&t<s&&r("InclusiveMinimum",s),void 0!==a&&t.length>a&&r("MaxItems",a),void 0!==c&&t.length>c&&r("MaxLength",c),void 0!==u&&t.length<u&&r("MinItems",u),void 0!==l&&t.length<l&&r("MinLength",l),void 0!==d&&t%d!=0&&r("MultipleOf",d),h){const e="string"==typeof h?new RegExp(h):h;"string"==typeof t&&null!==t.match(e)||r("Pattern",h)}p&&t.some((e,t,n)=>n.indexOf(e)!==t)&&r("UniqueItems",p)}}serialize(e,t,n,i={xml:{}}){var u,l,d;const m={xml:{rootName:null!==(u=i.xml.rootName)&&void 0!==u?u:"",includeRoot:null!==(l=i.xml.includeRoot)&&void 0!==l&&l,xmlCharKey:null!==(d=i.xml.xmlCharKey)&&void 0!==d?d:s}};let C={};const S=e.type.name;n||(n=e.serializedName),null!==S.match(/^Sequence$/i)&&(C=[]),e.isConstant&&(t=e.defaultValue);const{required:T,nullable:E}=e;if(T&&E&&void 0===t)throw new Error(`${n} cannot be undefined.`);if(T&&!E&&null==t)throw new Error(`${n} cannot be null or undefined.`);if(!T&&!1===E&&null===t)throw new Error(`${n} cannot be null.`);return null==t||null!==S.match(/^any$/i)?C=t:null!==S.match(/^(Number|String|Boolean|Object|Stream|Uuid)$/i)?C=function(e,t,n){if(null!=n)if(null!==e.match(/^Number$/i)){if("number"!=typeof n)throw new Error(`${t} with value ${n} must be of type number.`)}else if(null!==e.match(/^String$/i)){if("string"!=typeof n.valueOf())throw new Error(`${t} with value "${n}" must be of type string.`)}else if(null!==e.match(/^Uuid$/i)){if("string"!=typeof n.valueOf()||(r=n,!c.test(r)))throw new Error(`${t} with value "${n}" must be of type string and a valid uuid.`)}else if(null!==e.match(/^Boolean$/i)){if("boolean"!=typeof n)throw new Error(`${t} with value ${n} must be of type boolean.`)}else if(null!==e.match(/^Stream$/i)){const e=typeof n;if(!("string"===e||"function"==typeof n.pipe||"function"==typeof n.tee||n instanceof ArrayBuffer||ArrayBuffer.isView(n)||("function"==typeof Blob||"object"==typeof Blob)&&n instanceof Blob||"function"===e))throw new Error(`${t} must be a string, Blob, ArrayBuffer, ArrayBufferView, ReadableStream, or () => ReadableStream.`)}var r;return n}(S,n,t):null!==S.match(/^Enum$/i)?C=function(e,t,n){if(!t)throw new Error(`Please provide a set of allowedValues to validate ${e} as an Enum Type.`);if(!t.some(e=>"string"==typeof e.valueOf()?e.toLowerCase()===n.toLowerCase():e===n))throw new Error(`${n} is not a valid value for ${e}. The valid values are: ${JSON.stringify(t)}.`);return n}(n,e.type.allowedValues,t):null!==S.match(/^(Date|DateTime|TimeSpan|DateTimeRfc1123|UnixTime)$/i)?C=function(e,t,n){if(null!=t)if(null!==e.match(/^Date$/i)){if(!(t instanceof Date||"string"==typeof t.valueOf()&&!isNaN(Date.parse(t))))throw new Error(`${n} must be an instanceof Date or a string in ISO8601 format.`);t=t instanceof Date?t.toISOString().substring(0,10):new Date(t).toISOString().substring(0,10)}else if(null!==e.match(/^DateTime$/i)){if(!(t instanceof Date||"string"==typeof t.valueOf()&&!isNaN(Date.parse(t))))throw new Error(`${n} must be an instanceof Date or a string in ISO8601 format.`);t=t instanceof Date?t.toISOString():new Date(t).toISOString()}else if(null!==e.match(/^DateTimeRfc1123$/i)){if(!(t instanceof Date||"string"==typeof t.valueOf()&&!isNaN(Date.parse(t))))throw new Error(`${n} must be an instanceof Date or a string in RFC-1123 format.`);t=t instanceof Date?t.toUTCString():new Date(t).toUTCString()}else if(null!==e.match(/^UnixTime$/i)){if(!(t instanceof Date||"string"==typeof t.valueOf()&&!isNaN(Date.parse(t))))throw new Error(`${n} must be an instanceof Date or a string in RFC-1123/ISO8601 format for it to be serialized in UnixTime/Epoch format.`);t=function(e){if(e)return"string"==typeof e.valueOf()&&(e=new Date(e)),Math.floor(e.getTime()/1e3)}(t)}else if(null!==e.match(/^TimeSpan$/i)&&!function(e){return a.test(e)}(t))throw new Error(`${n} must be a string in ISO 8601 format. Instead was "${t}".`);return t}(S,t,n):null!==S.match(/^ByteArray$/i)?C=function(e,t){if(null!=t){if(!(t instanceof Uint8Array))throw new Error(`${e} must be of type Uint8Array.`);t=r(t)}return t}(n,t):null!==S.match(/^Base64Url$/i)?C=function(e,t){if(null!=t){if(!(t instanceof Uint8Array))throw new Error(`${e} must be of type Uint8Array.`);t=function(e){if(e){if(!(e instanceof Uint8Array))throw new Error("Please provide an input of type Uint8Array for converting to Base64Url.");return function(e){let t=e.length;for(;t-1>=0&&"="===e[t-1];)--t;return e.substr(0,t)}(r(e)).replace(/\+/g,"-").replace(/\//g,"_")}}(t)}return t}(n,t):null!==S.match(/^Sequence$/i)?C=function(e,t,n,r,i,s){var a;if(!Array.isArray(n))throw new Error(`${r} must be of type Array.`);let c=t.type.element;if(!c||"object"!=typeof c)throw new Error(`element" metadata for an Array must be defined in the mapper and it must of type "object" in ${r}.`);"Composite"===c.type.name&&c.type.className&&(c=null!==(a=e.modelMappers[c.type.className])&&void 0!==a?a:c);const u=[];for(let t=0;t<n.length;t++){const a=e.serialize(c,n[t],r,s);if(i&&c.xmlNamespace){const e=c.xmlNamespacePrefix?`xmlns:${c.xmlNamespacePrefix}`:"xmlns";"Composite"===c.type.name?(u[t]=Object.assign({},a),u[t][o]={[e]:c.xmlNamespace}):(u[t]={},u[t][s.xml.xmlCharKey]=a,u[t][o]={[e]:c.xmlNamespace})}else u[t]=a}return u}(this,e,t,n,Boolean(this.isXML),m):null!==S.match(/^Dictionary$/i)?C=function(e,t,n,r,i,s){if("object"!=typeof n)throw new Error(`${r} must be of type object.`);const a=t.type.value;if(!a||"object"!=typeof a)throw new Error(`"value" metadata for a Dictionary must be defined in the mapper and it must of type "object" in ${r}.`);const c={};for(const t of Object.keys(n)){const o=e.serialize(a,n[t],r,s);c[t]=g(a,o,i,s)}if(i&&t.xmlNamespace){const e=t.xmlNamespacePrefix?`xmlns:${t.xmlNamespacePrefix}`:"xmlns",n=c;return n[o]={[e]:t.xmlNamespace},n}return c}(this,e,t,n,Boolean(this.isXML),m):null!==S.match(/^Composite$/i)&&(C=function(e,t,n,r,i,s){if(y(e,t)&&(t=v(e,t,n,"clientName")),null!=n){const a={},c=f(e,t,r);for(const u of Object.keys(c)){const l=c[u];if(l.readOnly)continue;let d,p=a;if(e.isXML)d=l.xmlIsWrapped?l.xmlName:l.xmlElementName||l.xmlName;else{const e=h(l.serializedName);d=e.pop();for(const t of e)null==p[t]&&(void 0!==n[u]&&null!==n[u]||void 0!==l.defaultValue)&&(p[t]={}),p=p[t]}if(null!=p){if(i&&t.xmlNamespace){const e=t.xmlNamespacePrefix?`xmlns:${t.xmlNamespacePrefix}`:"xmlns";p[o]=Object.assign(Object.assign({},p[o]),{[e]:t.xmlNamespace})}const a=""!==l.serializedName?r+"."+l.serializedName:r;let c=n[u];const h=y(e,t);h&&h.clientName===u&&null==c&&(c=t.serializedName);const f=e.serialize(l,c,a,s);if(void 0!==f&&null!=d){const e=g(l,f,i,s);i&&l.xmlIsAttribute?(p[o]=p[o]||{},p[o][d]=f):i&&l.xmlIsWrapped?p[d]={[l.xmlElementName]:e}:p[d]=e}}}const u=function(e,t,n){const r=t.type.additionalProperties;if(!r&&t.type.className){const r=p(e,t,n);return null==r?void 0:r.type.additionalProperties}return r}(e,t,r);if(u){const t=Object.keys(c);for(const i in n)t.every(e=>e!==i)&&(a[i]=e.serialize(u,n[i],r+'["'+i+'"]',s))}return a}return n}(this,e,t,n,Boolean(this.isXML),m)),C}deserialize(e,t,n,r={xml:{}}){var a,c,u,l;const d={xml:{rootName:null!==(a=r.xml.rootName)&&void 0!==a?a:"",includeRoot:null!==(c=r.xml.includeRoot)&&void 0!==c&&c,xmlCharKey:null!==(u=r.xml.xmlCharKey)&&void 0!==u?u:s},ignoreUnknownProperties:null!==(l=r.ignoreUnknownProperties)&&void 0!==l&&l};if(null==t)return this.isXML&&"Sequence"===e.type.name&&!e.xmlIsWrapped&&(t=[]),void 0!==e.defaultValue&&(t=e.defaultValue),t;let p;const g=e.type.name;if(n||(n=e.serializedName),null!==g.match(/^Composite$/i))p=function(e,t,n,r,i){var a,c;const u=null!==(a=i.xml.xmlCharKey)&&void 0!==a?a:s;y(e,t)&&(t=v(e,t,n,"serializedName"));const l=f(e,t,r);let d={};const p=[];for(const s of Object.keys(l)){const a=l[s],f=h(l[s].serializedName);p.push(f[0]);const{serializedName:g,xmlName:m,xmlElementName:v}=a;let y=r;""!==g&&void 0!==g&&(y=r+"."+g);const C=a.headerCollectionPrefix;if(C){const t={};for(const r of Object.keys(n))r.startsWith(C)&&(t[r.substring(C.length)]=e.deserialize(a.type.value,n[r],y,i)),p.push(r);d[s]=t}else if(e.isXML)if(a.xmlIsAttribute&&n[o])d[s]=e.deserialize(a,n[o][m],y,i);else if(a.xmlIsMsText)void 0!==n[u]?d[s]=n[u]:"string"==typeof n&&(d[s]=n);else{const t=v||m||g;if(a.xmlIsWrapped){const t=n[m],r=null!==(c=null==t?void 0:t[v])&&void 0!==c?c:[];d[s]=e.deserialize(a,r,y,i),p.push(m)}else{const r=n[t];d[s]=e.deserialize(a,r,y,i),p.push(t)}}else{let r,o=n,c=0;for(const e of f){if(!o)break;c++,o=o[e]}null===o&&c<f.length&&(o=void 0),r=o;const u=t.type.polymorphicDiscriminator;let h;if(u&&s===u.clientName&&null==r&&(r=t.serializedName),Array.isArray(n[s])&&""===l[s].serializedName){r=n[s];const t=e.deserialize(a,r,y,i);for(const[e,n]of Object.entries(d))Object.prototype.hasOwnProperty.call(t,e)||(t[e]=n);d=t}else void 0===r&&void 0===a.defaultValue||(h=e.deserialize(a,r,y,i),d[s]=h)}}const g=t.type.additionalProperties;if(g){const t=e=>{for(const t in l)if(h(l[t].serializedName)[0]===e)return!1;return!0};for(const o in n)t(o)&&(d[o]=e.deserialize(g,n[o],r+'["'+o+'"]',i))}else if(n&&!i.ignoreUnknownProperties)for(const e of Object.keys(n))void 0!==d[e]||p.includes(e)||m(e,i)||(d[e]=n[e]);return d}(this,e,t,n,d);else{if(this.isXML){const e=d.xml.xmlCharKey;void 0!==t[o]&&void 0!==t[e]&&(t=t[e])}null!==g.match(/^Number$/i)?(p=parseFloat(t),isNaN(p)&&(p=t)):null!==g.match(/^Boolean$/i)?p="true"===t||"false"!==t&&t:null!==g.match(/^(String|Enum|Object|Stream|Uuid|TimeSpan|any)$/i)?p=t:null!==g.match(/^(Date|DateTime|DateTimeRfc1123)$/i)?p=new Date(t):null!==g.match(/^UnixTime$/i)?p=function(e){if(e)return new Date(1e3*e)}(t):null!==g.match(/^ByteArray$/i)?p=i(t):null!==g.match(/^Base64Url$/i)?p=function(e){if(e){if(e&&"string"!=typeof e.valueOf())throw new Error("Please provide an input of type string for converting to Uint8Array");return i(e=e.replace(/-/g,"+").replace(/_/g,"/"))}}(t):null!==g.match(/^Sequence$/i)?p=function(e,t,n,r,i){var o;let s=t.type.element;if(!s||"object"!=typeof s)throw new Error(`element" metadata for an Array must be defined in the mapper and it must of type "object" in ${r}`);if(n){Array.isArray(n)||(n=[n]),"Composite"===s.type.name&&s.type.className&&(s=null!==(o=e.modelMappers[s.type.className])&&void 0!==o?o:s);const t=[];for(let o=0;o<n.length;o++)t[o]=e.deserialize(s,n[o],`${r}[${o}]`,i);return t}return n}(this,e,t,n,d):null!==g.match(/^Dictionary$/i)&&(p=function(e,t,n,r,i){const o=t.type.value;if(!o||"object"!=typeof o)throw new Error(`"value" metadata for a Dictionary must be defined in the mapper and it must of type "object" in ${r}`);if(n){const t={};for(const s of Object.keys(n))t[s]=e.deserialize(o,n[s],r,i);return t}return n}(this,e,t,n,d))}return e.isConstant&&(p=e.defaultValue),p}}function d(e={},t=!1){return new l(e,t)}function h(e){const t=[];let n="";if(e){const r=e.split(".");for(const e of r)"\\"===e.charAt(e.length-1)?n+=e.substr(0,e.length-1)+".":(n+=e,t.push(n),n="")}return t}function p(e,t,n){const r=t.type.className;if(!r)throw new Error(`Class name for model "${n}" is not provided in the mapper "${JSON.stringify(t,void 0,2)}".`);return e.modelMappers[r]}function f(e,t,n){let r=t.type.modelProperties;if(!r){const i=p(e,t,n);if(!i)throw new Error(`mapper() cannot be null or undefined for model "${t.type.className}".`);if(r=null==i?void 0:i.type.modelProperties,!r)throw new Error(`modelProperties cannot be null or undefined in the mapper "${JSON.stringify(i)}" of type "${t.type.className}" for object "${n}".`)}return r}function g(e,t,n,r){if(!n||!e.xmlNamespace)return t;const i=e.xmlNamespacePrefix?`xmlns:${e.xmlNamespacePrefix}`:"xmlns",s={[i]:e.xmlNamespace};if(["Composite"].includes(e.type.name)){if(t[o])return t;{const e=Object.assign({},t);return e[o]=s,e}}const a={};return a[r.xml.xmlCharKey]=t,a[o]=s,a}function m(e,t){return[o,t.xml.xmlCharKey].includes(e)}function v(e,t,n,r){var i;const o=y(e,t);if(o){let s=o[r];if(s){"serializedName"===r&&(s=s.replace(/\\/gi,""));const o=n[s],a=null!==(i=t.type.uberParent)&&void 0!==i?i:t.type.className;if("string"==typeof o&&a){const n=function(e,t,n){const r=[n];for(;r.length;){const n=r.shift(),i=t===n?t:n+"."+t;if(Object.prototype.hasOwnProperty.call(e,i))return e[i];for(const[t,i]of Object.entries(e))t.startsWith(n+".")&&i.type.uberParent===n&&i.type.className&&r.push(i.type.className)}}(e.modelMappers.discriminators,o,a);n&&(t=n)}}}return t}function y(e,t){return t.type.polymorphicDiscriminator||C(e,t.type.uberParent)||C(e,t.type.className)}function C(e,t){return t&&e.modelMappers[t]&&e.modelMappers[t].type.polymorphicDiscriminator}const S={Base64Url:"Base64Url",Boolean:"Boolean",ByteArray:"ByteArray",Composite:"Composite",Date:"Date",DateTime:"DateTime",DateTimeRfc1123:"DateTimeRfc1123",Dictionary:"Dictionary",Enum:"Enum",Number:"Number",Object:"Object",Sequence:"Sequence",String:"String",Stream:"Stream",TimeSpan:"TimeSpan",UnixTime:"UnixTime"};var T=n(5923);const E={operationRequestMap:new WeakMap};function b(e,t,n){let r=t.parameterPath;const i=t.mapper;let o;if("string"==typeof r&&(r=[r]),Array.isArray(r)){if(r.length>0)if(i.isConstant)o=i.defaultValue;else{let t=I(e,r);!t.propertyFound&&n&&(t=I(n,r));let s=!1;t.propertyFound||(s=i.required||"options"===r[0]&&2===r.length),o=s?i.defaultValue:t.propertyValue}}else{i.required&&(o={});for(const t in r){const s=i.type.modelProperties[t],a=b(e,{parameterPath:r[t],mapper:s},n);void 0!==a&&(o||(o={}),o[t]=a)}}return o}function I(e,t){const n={propertyFound:!1};let r=0;for(;r<t.length;++r){const n=t[r];if(!e||!(n in e))break;e=e[n]}return r===t.length&&(n.propertyValue=e,n.propertyFound=!0),n}const w=Symbol.for("@azure/core-client original request");function R(e){if(function(e){return w in e}(e))return R(e[w]);let t=E.operationRequestMap.get(e);return t||(t={},E.operationRequestMap.set(e,t)),t}const A=["application/json","text/json"],O=["application/xml","application/atom+xml"],k="deserializationPolicy";function _(e={}){var t,n,r,i,o,a,c;const u=null!==(n=null===(t=e.expectedContentTypes)||void 0===t?void 0:t.json)&&void 0!==n?n:A,l=null!==(i=null===(r=e.expectedContentTypes)||void 0===r?void 0:r.xml)&&void 0!==i?i:O,d=e.parseXML,h=e.serializerOptions,p={xml:{rootName:null!==(o=null==h?void 0:h.xml.rootName)&&void 0!==o?o:"",includeRoot:null!==(a=null==h?void 0:h.xml.includeRoot)&&void 0!==a&&a,xmlCharKey:null!==(c=null==h?void 0:h.xml.xmlCharKey)&&void 0!==c?c:s}};return{name:k,async sendRequest(e,t){const n=await t(e);return async function(e,t,n,r,i){const o=await async function(e,t,n,r,i){var o;if(!(null===(o=n.request.streamResponseStatusCodes)||void 0===o?void 0:o.has(n.status))&&n.bodyAsText){const o=n.bodyAsText,s=n.headers.get("Content-Type")||"",a=s?s.split(";").map(e=>e.toLowerCase()):[];try{if(0===a.length||a.some(t=>-1!==e.indexOf(t)))return n.parsedBody=JSON.parse(o),n;if(a.some(e=>-1!==t.indexOf(e))){if(!i)throw new Error("Parsing XML not supported.");const e=await i(o,r.xml);return n.parsedBody=e,n}}catch(e){const t=`Error "${e}" occurred while parsing the response body - ${n.bodyAsText}.`,r=e.code||T.RestError.PARSE_ERROR;throw new T.RestError(t,{code:r,statusCode:n.status,request:n.request,response:n})}}return n}(e,t,n,r,i);if(!function(e){const t=R(e.request),n=null==t?void 0:t.shouldDeserialize;let r;return r=void 0===n||("boolean"==typeof n?n:n(e)),r}(o))return o;const s=R(o.request),a=null==s?void 0:s.operationSpec;if(!a||!a.responses)return o;const c=function(e){let t;const n=R(e.request),r=null==n?void 0:n.operationSpec;return r&&(t=(null==n?void 0:n.operationResponseGetter)?null==n?void 0:n.operationResponseGetter(r,e):r.responses[e.status]),t}(o),{error:u,shouldReturnResponse:l}=function(e,t,n,r){var i;const o=200<=e.status&&e.status<300,s=function(e){const t=Object.keys(e.responses);return 0===t.length||1===t.length&&"default"===t[0]}(t)?o:!!n;if(s){if(!n)return{error:null,shouldReturnResponse:!1};if(!n.isError)return{error:null,shouldReturnResponse:!1}}const a=null!=n?n:t.responses.default,c=(null===(i=e.request.streamResponseStatusCodes)||void 0===i?void 0:i.has(e.status))?`Unexpected status code: ${e.status}`:e.bodyAsText,u=new T.RestError(c,{statusCode:e.status,request:e.request,response:e});if(!a)throw u;const l=a.bodyMapper,d=a.headersMapper;try{if(e.parsedBody){const n=e.parsedBody;let i;if(l){let e=n;if(t.isXML&&l.type.name===S.Sequence){e=[];const t=l.xmlElementName;"object"==typeof n&&t&&(e=n[t])}i=t.serializer.deserialize(l,e,"error.response.parsedBody",r)}const o=n.error||i||n;u.code=o.code,o.message&&(u.message=o.message),l&&(u.response.parsedBody=i)}e.headers&&d&&(u.response.parsedHeaders=t.serializer.deserialize(d,e.headers.toJSON(),"operationRes.parsedHeaders"))}catch(t){u.message=`Error "${t.message}" occurred in deserializing the responseBody - "${e.bodyAsText}" for the default response.`}return{error:u,shouldReturnResponse:!1}}(o,a,c,r);if(u)throw u;if(l)return o;if(c){if(c.bodyMapper){let t=o.parsedBody;a.isXML&&c.bodyMapper.type.name===S.Sequence&&(t="object"==typeof t?t[c.bodyMapper.xmlElementName]:[]);try{o.parsedBody=a.serializer.deserialize(c.bodyMapper,t,"operationRes.parsedBody",r)}catch(e){throw new T.RestError(`Error ${e} occurred in deserializing the responseBody - ${o.bodyAsText}`,{statusCode:o.status,request:o.request,response:o})}}else"HEAD"===a.httpMethod&&(o.parsedBody=n.status>=200&&n.status<300);c.headersMapper&&(o.parsedHeaders=a.serializer.deserialize(c.headersMapper,o.headers.toJSON(),"operationRes.parsedHeaders",{xml:{},ignoreUnknownProperties:!0}))}return o}(u,l,n,p,d)}}}function P(e){const{parameterPath:t,mapper:n}=e;let r;return r="string"==typeof t?t:Array.isArray(t)?t.join("."):n.serializedName,r}const M="serializationPolicy";function D(e={}){const t=e.stringifyXML;return{name:M,async sendRequest(e,n){const r=R(e),i=null==r?void 0:r.operationSpec,a=null==r?void 0:r.operationArguments;return i&&a&&(function(e,t,n){var r,i;if(n.headerParameters)for(const r of n.headerParameters){let i=b(t,r);if(null!=i||r.mapper.required){i=n.serializer.serialize(r.mapper,i,P(r));const t=r.mapper.headerCollectionPrefix;if(t)for(const n of Object.keys(i))e.headers.set(t+n,i[n]);else e.headers.set(r.mapper.serializedName||P(r),i)}}const o=null===(i=null===(r=t.options)||void 0===r?void 0:r.requestOptions)||void 0===i?void 0:i.customHeaders;if(o)for(const t of Object.keys(o))e.headers.set(t,o[t])}(e,a,i),function(e,t,n,r=function(){throw new Error("XML serialization unsupported!")}){var i,a,c,u,l;const d=null===(i=t.options)||void 0===i?void 0:i.serializerOptions,h={xml:{rootName:null!==(a=null==d?void 0:d.xml.rootName)&&void 0!==a?a:"",includeRoot:null!==(c=null==d?void 0:d.xml.includeRoot)&&void 0!==c&&c,xmlCharKey:null!==(u=null==d?void 0:d.xml.xmlCharKey)&&void 0!==u?u:s}},p=h.xml.xmlCharKey;if(n.requestBody&&n.requestBody.mapper){e.body=b(t,n.requestBody);const i=n.requestBody.mapper,{required:s,serializedName:a,xmlName:c,xmlElementName:u,xmlNamespace:d,xmlNamespacePrefix:f,nullable:g}=i,m=i.type.name;try{if(void 0!==e.body&&null!==e.body||g&&null===e.body||s){const t=P(n.requestBody);e.body=n.serializer.serialize(i,e.body,t,h);const s=m===S.Stream;if(n.isXML){const t=f?`xmlns:${f}`:"xmlns",n=function(e,t,n,r,i){if(e&&!["Composite","Sequence","Dictionary"].includes(n)){const n={};return n[i.xml.xmlCharKey]=r,n[o]={[t]:e},n}return r}(d,t,m,e.body,h);m===S.Sequence?e.body=r(function(e,t,n,r){if(Array.isArray(e)||(e=[e]),!n||!r)return{[t]:e};const i={[t]:e};return i[o]={[n]:r},i}(n,u||c||a,t,d),{rootName:c||a,xmlCharKey:p}):s||(e.body=r(n,{rootName:c||a,xmlCharKey:p}))}else{if(m===S.String&&((null===(l=n.contentType)||void 0===l?void 0:l.match("text/plain"))||"text"===n.mediaType))return;s||(e.body=JSON.stringify(e.body))}}}catch(e){throw new Error(`Error "${e.message}" occurred in serializing the payload - ${JSON.stringify(a,void 0,"  ")}.`)}}else if(n.formDataParameters&&n.formDataParameters.length>0){e.formData={};for(const r of n.formDataParameters){const i=b(t,r);if(null!=i){const t=r.mapper.serializedName||P(r);e.formData[t]=n.serializer.serialize(r.mapper,i,P(r),h)}}}}(e,a,i,t)),n(e)}}}function N(e={}){const t=(0,T.createPipelineFromOptions)(null!=e?e:{});return e.credentialOptions&&t.addPolicy((0,T.bearerTokenAuthenticationPolicy)({credential:e.credentialOptions.credential,scopes:e.credentialOptions.credentialScopes})),t.addPolicy(D(e.serializationOptions),{phase:"Serialize"}),t.addPolicy(_(e.deserializationOptions),{phase:"Deserialize"}),t}let x;const U={CSV:",",SSV:" ",Multi:"Multi",TSV:"\t",Pipes:"|"};function L(e,t){let n=e;for(const[e,r]of t)n=n.split(e).join(r);return n}const q=(0,n(3526).KV)("core-client");class j{constructor(e={}){var t,n;if(this._requestContentType=e.requestContentType,this._endpoint=null!==(t=e.endpoint)&&void 0!==t?t:e.baseUri,e.baseUri&&q.warning("The baseUri option for SDK Clients has been deprecated, please use endpoint instead."),this._allowInsecureConnection=e.allowInsecureConnection,this._httpClient=e.httpClient||(x||(x=(0,T.createDefaultHttpClient)()),x),this.pipeline=e.pipeline||function(e){const t=function(e){if(e.credentialScopes)return e.credentialScopes;if(e.endpoint)return`${e.endpoint}/.default`;if(e.baseUri)return`${e.baseUri}/.default`;if(e.credential&&!e.credentialScopes)throw new Error("When using credentials, the ServiceClientOptions must contain either a endpoint or a credentialScopes. Unable to create a bearerTokenAuthenticationPolicy")}(e),n=e.credential&&t?{credentialScopes:t,credential:e.credential}:void 0;return N(Object.assign(Object.assign({},e),{credentialOptions:n}))}(e),null===(n=e.additionalPolicies)||void 0===n?void 0:n.length)for(const{policy:t,position:n}of e.additionalPolicies){const e="perRetry"===n?"Sign":void 0;this.pipeline.addPolicy(t,{afterPhase:e})}}async sendRequest(e){return this.pipeline.sendRequest(this._httpClient,e)}async sendOperationRequest(e,t){const n=t.baseUrl||this._endpoint;if(!n)throw new Error("If operationSpec.baseUrl is not specified, then the ServiceClient must have a endpoint string property that contains the base URL to use.");const r=function(e,t,n,r){const i=function(e,t,n){var r;const i=new Map;if(null===(r=e.urlParameters)||void 0===r?void 0:r.length)for(const r of e.urlParameters){let o=b(t,r,n);const s=P(r);o=e.serializer.serialize(r.mapper,o,s),r.skipEncoding||(o=encodeURIComponent(o)),i.set(`{${r.mapper.serializedName||s}}`,o)}return i}(t,n,r);let o=!1,s=L(e,i);if(t.path){let e=L(t.path,i);"/{nextLink}"===t.path&&e.startsWith("/")&&(e=e.substring(1)),e.includes("://")?(s=e,o=!0):s=function(e,t){if(!t)return e;const n=new URL(e);let r=n.pathname;r.endsWith("/")||(r=`${r}/`),t.startsWith("/")&&(t=t.substring(1));const i=t.indexOf("?");if(-1!==i){const e=t.substring(0,i),o=t.substring(i+1);r+=e,o&&(n.search=n.search?`${n.search}&${o}`:o)}else r+=t;return n.pathname=r,n.toString()}(s,e)}const{queryParams:a,sequenceParams:c}=function(e,t,n){var r;const i=new Map,o=new Set;if(null===(r=e.queryParameters)||void 0===r?void 0:r.length)for(const r of e.queryParameters){"Sequence"===r.mapper.type.name&&r.mapper.serializedName&&o.add(r.mapper.serializedName);let s=b(t,r,n);if(null!=s||r.mapper.required){s=e.serializer.serialize(r.mapper,s,P(r));const t=r.collectionFormat?U[r.collectionFormat]:"";if(Array.isArray(s)&&(s=s.map(e=>null==e?"":e)),"Multi"===r.collectionFormat&&0===s.length)continue;!Array.isArray(s)||"SSV"!==r.collectionFormat&&"TSV"!==r.collectionFormat||(s=s.join(t)),r.skipEncoding||(s=Array.isArray(s)?s.map(e=>encodeURIComponent(e)):encodeURIComponent(s)),!Array.isArray(s)||"CSV"!==r.collectionFormat&&"Pipes"!==r.collectionFormat||(s=s.join(t)),i.set(r.mapper.serializedName||P(r),s)}}return{queryParams:i,sequenceParams:o}}(t,n,r);return s=function(e,t,n,r=!1){if(0===t.size)return e;const i=new URL(e),o=function(e){const t=new Map;if(!e||"?"!==e[0])return t;const n=(e=e.slice(1)).split("&");for(const e of n){const[n,r]=e.split("=",2),i=t.get(n);i?Array.isArray(i)?i.push(r):t.set(n,[i,r]):t.set(n,r)}return t}(i.search);for(const[e,i]of t){const t=o.get(e);if(Array.isArray(t))if(Array.isArray(i)){t.push(...i);const n=new Set(t);o.set(e,Array.from(n))}else t.push(i);else t?(Array.isArray(i)?i.unshift(t):n.has(e)&&o.set(e,[t,i]),r||o.set(e,i)):o.set(e,i)}const s=[];for(const[e,t]of o)if("string"==typeof t)s.push(`${e}=${t}`);else if(Array.isArray(t))for(const n of t)s.push(`${e}=${n}`);else s.push(`${e}=${t}`);return i.search=s.length?`?${s.join("&")}`:"",i.toString()}(s,a,c,o),s}(n,t,e,this),i=(0,T.createPipelineRequest)({url:r});i.method=t.httpMethod;const o=R(i);o.operationSpec=t,o.operationArguments=e;const s=t.contentType||this._requestContentType;s&&t.requestBody&&i.headers.set("Content-Type",s);const a=e.options;if(a){const e=a.requestOptions;e&&(e.timeout&&(i.timeout=e.timeout),e.onUploadProgress&&(i.onUploadProgress=e.onUploadProgress),e.onDownloadProgress&&(i.onDownloadProgress=e.onDownloadProgress),void 0!==e.shouldDeserialize&&(o.shouldDeserialize=e.shouldDeserialize),e.allowInsecureConnection&&(i.allowInsecureConnection=!0)),a.abortSignal&&(i.abortSignal=a.abortSignal),a.tracingOptions&&(i.tracingOptions=a.tracingOptions)}this._allowInsecureConnection&&(i.allowInsecureConnection=!0),void 0===i.streamResponseStatusCodes&&(i.streamResponseStatusCodes=function(e){const t=new Set;for(const n in e.responses){const r=e.responses[n];r.bodyMapper&&r.bodyMapper.type.name===S.Stream&&t.add(Number(n))}return t}(t));try{const e=await this.sendRequest(i),n=u(e,t.responses[e.status]);return(null==a?void 0:a.onResponse)&&a.onResponse(e,n),n}catch(e){if("object"==typeof e&&(null==e?void 0:e.response)){const n=e.response,r=u(n,t.responses[e.statusCode]||t.responses.default);e.details=r,(null==a?void 0:a.onResponse)&&a.onResponse(n,r,e)}throw e}}}async function F(e){const{scopes:t,response:n}=e,r=e.logger||q,i=n.headers.get("WWW-Authenticate");if(!i)return r.info("The WWW-Authenticate header was missing. Failed to perform the Continuous Access Evaluation authentication flow."),!1;const o=function(e){return`, ${e.trim()}`.split(", Bearer ").filter(e=>e).map(e=>`${e.trim()}, `.split('", ').filter(e=>e).map(e=>(([e,t])=>({[e]:t}))(e.trim().split('="'))).reduce((e,t)=>Object.assign(Object.assign({},e),t),{}))}(i)||[],s=o.find(e=>e.claims);if(!s)return r.info('The WWW-Authenticate header was missing the necessary "claims" to perform the Continuous Access Evaluation authentication flow.'),!1;const a=await e.getAccessToken(s.scope?[s.scope]:t,{claims:(c=s.claims,atob(c))});var c;return!!a&&(e.request.headers.set("Authorization",`Bearer ${a.token}`),!0)}const B=async e=>{const t={abortSignal:(n=e.request).abortSignal,requestOptions:{timeout:n.timeout},tracingOptions:n.tracingOptions};var n;const r=function(e){const t=e.headers.get("WWW-Authenticate");if(401===e.status&&t)return t}(e.response);if(r){const n=function(e){return`${e.slice(7).trim()} `.split(" ").filter(e=>e).map(e=>(([e,t])=>({[e]:t}))(e.trim().split("="))).reduce((e,t)=>Object.assign(Object.assign({},e),t),{})}(r),i=function(e,t){if(!t.resource_id)return e.scopes;const n=new URL(t.resource_id);n.pathname="/.default";let r=n.toString();return"https://disk.azure.com/.default"===r&&(r="https://disk.azure.com//.default"),[r]}(e,n),o=function(e){const t=new URL(e.authorization_uri).pathname.split("/")[1];if(t&&/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/.test(t))return t}(n);if(!o)return!1;const s=await e.getAccessToken(i,Object.assign(Object.assign({},t),{tenantId:o}));return!!s&&(e.request.headers.set("authorization",`Bearer ${s.token}`),!0)}return!1}},5923:(e,t,n)=>{"use strict";n.r(t),n.d(t,{RestError:()=>ye,auxiliaryAuthenticationHeaderPolicy:()=>$e,auxiliaryAuthenticationHeaderPolicyName:()=>ze,bearerTokenAuthenticationPolicy:()=>Be,bearerTokenAuthenticationPolicyName:()=>Ue,createDefaultHttpClient:()=>we,createEmptyPipeline:()=>o,createFile:()=>_,createFileFromStream:()=>k,createHttpHeaders:()=>ie,createPipelineFromOptions:()=>Ee,createPipelineRequest:()=>Ae,decompressResponsePolicy:()=>j,decompressResponsePolicyName:()=>q,defaultRetryPolicy:()=>te,exponentialRetryPolicy:()=>ke,exponentialRetryPolicyName:()=>Oe,formDataPolicy:()=>se,formDataPolicyName:()=>oe,getDefaultProxySettings:()=>ue,isRestError:()=>Ce,logPolicy:()=>f,logPolicyName:()=>p,multipartPolicy:()=>L,multipartPolicyName:()=>N,ndJsonPolicy:()=>Ve,ndJsonPolicyName:()=>He,proxyPolicy:()=>le,proxyPolicyName:()=>ae,redirectPolicy:()=>v,redirectPolicyName:()=>g,retryPolicy:()=>Z,setClientRequestIdPolicy:()=>he,setClientRequestIdPolicyName:()=>de,systemErrorRetryPolicy:()=>Pe,systemErrorRetryPolicyName:()=>_e,throttlingRetryPolicy:()=>De,throttlingRetryPolicyName:()=>Me,tlsPolicy:()=>fe,tlsPolicyName:()=>pe,tracingPolicy:()=>Te,tracingPolicyName:()=>Se,userAgentPolicy:()=>I,userAgentPolicyName:()=>b});const r=new Set(["Deserialize","Serialize","Retry","Sign"]);class i{constructor(e){var t;this._policies=[],this._policies=null!==(t=null==e?void 0:e.slice(0))&&void 0!==t?t:[],this._orderedPolicies=void 0}addPolicy(e,t={}){if(t.phase&&t.afterPhase)throw new Error("Policies inside a phase cannot specify afterPhase.");if(t.phase&&!r.has(t.phase))throw new Error(`Invalid phase name: ${t.phase}`);if(t.afterPhase&&!r.has(t.afterPhase))throw new Error(`Invalid afterPhase name: ${t.afterPhase}`);this._policies.push({policy:e,options:t}),this._orderedPolicies=void 0}removePolicy(e){const t=[];return this._policies=this._policies.filter(n=>!(e.name&&n.policy.name===e.name||e.phase&&n.options.phase===e.phase)||(t.push(n.policy),!1)),this._orderedPolicies=void 0,t}sendRequest(e,t){return this.getOrderedPolicies().reduceRight((e,t)=>n=>t.sendRequest(n,e),t=>e.sendRequest(t))(t)}getOrderedPolicies(){return this._orderedPolicies||(this._orderedPolicies=this.orderPolicies()),this._orderedPolicies}clone(){return new i(this._policies)}static create(){return new i}orderPolicies(){const e=[],t=new Map;function n(e){return{name:e,policies:new Set,hasRun:!1,hasAfterPolicies:!1}}const r=n("Serialize"),i=n("None"),o=n("Deserialize"),s=n("Retry"),a=n("Sign"),c=[r,i,o,s,a];function u(e){return"Retry"===e?s:"Serialize"===e?r:"Deserialize"===e?o:"Sign"===e?a:i}for(const e of this._policies){const n=e.policy,r=e.options,i=n.name;if(t.has(i))throw new Error("Duplicate policy names not allowed in pipeline");const o={policy:n,dependsOn:new Set,dependants:new Set};r.afterPhase&&(o.afterPhase=u(r.afterPhase),o.afterPhase.hasAfterPolicies=!0),t.set(i,o),u(r.phase).policies.add(o)}for(const e of this._policies){const{policy:n,options:r}=e,i=n.name,o=t.get(i);if(!o)throw new Error(`Missing node for policy ${i}`);if(r.afterPolicies)for(const e of r.afterPolicies){const n=t.get(e);n&&(o.dependsOn.add(n),n.dependants.add(o))}if(r.beforePolicies)for(const e of r.beforePolicies){const n=t.get(e);n&&(n.dependsOn.add(o),o.dependants.add(n))}}function l(n){n.hasRun=!0;for(const r of n.policies)if((!r.afterPhase||r.afterPhase.hasRun&&!r.afterPhase.policies.size)&&0===r.dependsOn.size){e.push(r.policy);for(const e of r.dependants)e.dependsOn.delete(r);t.delete(r.policy.name),n.policies.delete(r)}}function d(){for(const e of c){if(l(e),e.policies.size>0&&e!==i)return void(i.hasRun||l(i));e.hasAfterPolicies&&l(i)}}let h=0;for(;t.size>0;){h++;const t=e.length;if(d(),e.length<=t&&h>1)throw new Error("Cannot satisfy policy dependencies due to requirements cycle.")}return e}}function o(){return i.create()}var s=n(3526);const a=(0,s.KV)("core-rest-pipeline");var c=n(5777);const u="REDACTED",l=["x-ms-client-request-id","x-ms-return-client-request-id","x-ms-useragent","x-ms-correlation-request-id","x-ms-request-id","client-request-id","ms-cv","return-client-request-id","traceparent","Access-Control-Allow-Credentials","Access-Control-Allow-Headers","Access-Control-Allow-Methods","Access-Control-Allow-Origin","Access-Control-Expose-Headers","Access-Control-Max-Age","Access-Control-Request-Headers","Access-Control-Request-Method","Origin","Accept","Accept-Encoding","Cache-Control","Connection","Content-Length","Content-Type","Date","ETag","Expires","If-Match","If-Modified-Since","If-None-Match","If-Unmodified-Since","Last-Modified","Pragma","Request-Id","Retry-After","Server","Transfer-Encoding","User-Agent","WWW-Authenticate"],d=["api-version"];class h{constructor({additionalAllowedHeaderNames:e=[],additionalAllowedQueryParameters:t=[]}={}){e=l.concat(e),t=d.concat(t),this.allowedHeaderNames=new Set(e.map(e=>e.toLowerCase())),this.allowedQueryParameters=new Set(t.map(e=>e.toLowerCase()))}sanitize(e){const t=new Set;return JSON.stringify(e,(e,n)=>{if(n instanceof Error)return Object.assign(Object.assign({},n),{name:n.name,message:n.message});if("headers"===e)return this.sanitizeHeaders(n);if("url"===e)return this.sanitizeUrl(n);if("query"===e)return this.sanitizeQuery(n);if("body"!==e&&"response"!==e&&"operationSpec"!==e){if(Array.isArray(n)||(0,c.isObject)(n)){if(t.has(n))return"[Circular]";t.add(n)}return n}},2)}sanitizeUrl(e){if("string"!=typeof e||null===e||""===e)return e;const t=new URL(e);if(!t.search)return e;for(const[e]of t.searchParams)this.allowedQueryParameters.has(e.toLowerCase())||t.searchParams.set(e,u);return t.toString()}sanitizeHeaders(e){const t={};for(const n of Object.keys(e))this.allowedHeaderNames.has(n.toLowerCase())?t[n]=e[n]:t[n]=u;return t}sanitizeQuery(e){if("object"!=typeof e||null===e)return e;const t={};for(const n of Object.keys(e))this.allowedQueryParameters.has(n.toLowerCase())?t[n]=e[n]:t[n]=u;return t}}const p="logPolicy";function f(e={}){var t;const n=null!==(t=e.logger)&&void 0!==t?t:a.info,r=new h({additionalAllowedHeaderNames:e.additionalAllowedHeaderNames,additionalAllowedQueryParameters:e.additionalAllowedQueryParameters});return{name:p,async sendRequest(e,t){if(!n.enabled)return t(e);n(`Request: ${r.sanitize(e)}`);const i=await t(e);return n(`Response status code: ${i.status}`),n(`Headers: ${r.sanitize(i.headers)}`),i}}}const g="redirectPolicy",m=["GET","HEAD"];function v(e={}){const{maxRetries:t=20}=e;return{name:g,async sendRequest(e,n){const r=await n(e);return y(n,r,t)}}}async function y(e,t,n,r=0){const{request:i,status:o,headers:s}=t,a=s.get("location");if(a&&(300===o||301===o&&m.includes(i.method)||302===o&&m.includes(i.method)||303===o&&"POST"===i.method||307===o)&&r<n){const t=new URL(a,i.url);i.url=t.toString(),303===o&&(i.method="GET",i.headers.delete("Content-Length"),delete i.body),i.headers.delete("Authorization");const s=await e(i);return y(e,s,n,r+1)}return t}const C="1.18.2",S=3;async function T(e){const t=new Map;t.set("core-rest-pipeline",C),await async function(e){const t=globalThis.navigator;let n="unknown";if(null==t?void 0:t.userAgentData){const r=await t.userAgentData.getHighEntropyValues(["architecture","platformVersion"]);n=`${r.architecture}-${r.platform}-${r.platformVersion}`;const i=function(e){const t=["Google Chrome","Microsoft Edge","Opera","Brave","Chromium"];for(const n of t){const t=e.find(e=>e.brand===n);if(t)return t}}(t.userAgentData.brands);i&&e.set(i.brand,i.version)}else if(null==t?void 0:t.platform){n=t.platform;const r=function(e){const t=[{name:"Firefox",regex:/Firefox\/([\d.]+)/},{name:"Safari",regex:/Version\/([\d.]+).*Safari/}];for(const n of t){const t=e.match(n.regex);if(t)return{brand:n.name,version:t[1]}}}(t.userAgent);r&&e.set(r.brand,r.version)}else"string"==typeof globalThis.EdgeRuntime&&e.set("EdgeRuntime",globalThis.EdgeRuntime);e.set("OS",n)}(t);const n=function(e){const t=[];for(const[n,r]of e){const e=r?`${n}/${r}`:n;t.push(e)}return t.join(" ")}(t);return e?`${e} ${n}`:n}const E="x-ms-useragent",b="userAgentPolicy";function I(e={}){const t=T(e.userAgentPrefix);return{name:b,sendRequest:async(e,n)=>(e.headers.has(E)||e.headers.set(E,await t),n(e))}}function w(e){return Boolean(e&&"function"==typeof e.pipe)}function R(e){return Boolean(e&&"function"==typeof e.getReader&&"function"==typeof e.tee)}const A={arrayBuffer:()=>{throw new Error("Not implemented")},bytes:()=>{throw new Error("Not implemented")},slice:()=>{throw new Error("Not implemented")},text:()=>{throw new Error("Not implemented")}},O=Symbol("rawContent");function k(e,t,n={}){var r,i,o,s;return Object.assign(Object.assign({},A),{type:null!==(r=n.type)&&void 0!==r?r:"",lastModified:null!==(i=n.lastModified)&&void 0!==i?i:(new Date).getTime(),webkitRelativePath:null!==(o=n.webkitRelativePath)&&void 0!==o?o:"",size:null!==(s=n.size)&&void 0!==s?s:-1,name:t,stream:()=>{const t=e();if(w(t))throw new Error("Not supported: a Node stream was provided as input to createFileFromStream.");return t},[O]:e})}function _(e,t,n={}){var r,i,o;return c.isNodeLike?Object.assign(Object.assign({},A),{type:null!==(r=n.type)&&void 0!==r?r:"",lastModified:null!==(i=n.lastModified)&&void 0!==i?i:(new Date).getTime(),webkitRelativePath:null!==(o=n.webkitRelativePath)&&void 0!==o?o:"",size:e.byteLength,name:t,arrayBuffer:async()=>e.buffer,stream:()=>new Blob([e]).stream(),[O]:()=>e}):new File([e],t,n)}async function P(e){if(e instanceof Blob||e instanceof Uint8Array)return e;if(R(e))return new Response(e).blob();const t=function(e){return"function"==typeof e[O]?e[O]():e.stream()}(e);if(w(t))throw new Error("Encountered unexpected type. In the browser, `concat` supports Web ReadableStream, Blob, Uint8Array, and files created using `createFile` only.");return P(t)}function M(e){let t="";for(const[n,r]of e)t+=`${n}: ${r}\r\n`;return t}function D(e){return e instanceof Uint8Array?e.byteLength:"function"==typeof e.stream?-1===e.size?void 0:e.size:void 0}const N="multipartPolicy",x=70,U=new Set("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'()+,-./:=?");function L(){return{name:N,async sendRequest(e,t){var n;if(!e.multipartBody)return t(e);if(e.body)throw new Error("multipartBody and regular body cannot be set at the same time");let r=e.multipartBody.boundary;const i=null!==(n=e.headers.get("Content-Type"))&&void 0!==n?n:"multipart/mixed",o=i.match(/^(multipart\/[^ ;]+)(?:; *boundary=(.+))?$/);if(!o)throw new Error(`Got multipart request body, but content-type header was not multipart: ${i}`);const[,s,a]=o;if(a&&r&&a!==r)throw new Error(`Multipart boundary was specified as ${a} in the header, but got ${r} in the request body`);return null!=r||(r=a),r?function(e){if(e.length>x)throw new Error(`Multipart boundary "${e}" exceeds maximum length of 70 characters`);if(Array.from(e).some(e=>!U.has(e)))throw new Error(`Multipart boundary "${e}" contains invalid characters`)}(r):r=`----AzSDKFormBoundary${(0,c.randomUUID)()}`,e.headers.set("Content-Type",`${s}; boundary=${r}`),await async function(e,t,n){const r=[(0,c.stringToUint8Array)(`--${n}`,"utf-8"),...t.flatMap(e=>[(0,c.stringToUint8Array)("\r\n","utf-8"),(0,c.stringToUint8Array)(M(e.headers),"utf-8"),(0,c.stringToUint8Array)("\r\n","utf-8"),e.body,(0,c.stringToUint8Array)(`\r\n--${n}`,"utf-8")]),(0,c.stringToUint8Array)("--\r\n\r\n","utf-8")],i=function(e){let t=0;for(const n of e){const e=D(n);if(void 0===e)return;t+=e}return t}(r);i&&e.headers.set("Content-Length",i),e.body=await async function(e){const t=[];for(const n of e)t.push(await P("function"==typeof n?n():n));return new Blob(t)}(r)}(e,e.multipartBody.parts,r),e.multipartBody=void 0,t(e)}}}const q="decompressResponsePolicy";function j(){throw new Error("decompressResponsePolicy is not supported in browser environment")}class F extends Error{constructor(e){super(e),this.name="AbortError"}}const B="The operation was aborted.";function G(e,t,n){return new Promise((r,i)=>{let o,s;const a=()=>i(new F((null==n?void 0:n.abortErrorMsg)?null==n?void 0:n.abortErrorMsg:B)),c=()=>{(null==n?void 0:n.abortSignal)&&s&&n.abortSignal.removeEventListener("abort",s)};if(s=()=>(o&&clearTimeout(o),c(),a()),(null==n?void 0:n.abortSignal)&&n.abortSignal.aborted)return a();o=setTimeout(()=>{c(),r(t)},e),(null==n?void 0:n.abortSignal)&&n.abortSignal.addEventListener("abort",s)})}function H(e,t){const n=e.headers.get(t);if(!n)return;const r=Number(n);return Number.isNaN(r)?void 0:r}const V="Retry-After",z=["retry-after-ms","x-ms-retry-after-ms",V];function W(e){if(e&&[429,503].includes(e.status))try{for(const t of z){const n=H(e,t);if(0===n||n)return n*(t===V?1e3:1)}const t=e.headers.get(V);if(!t)return;const n=Date.parse(t)-Date.now();return Number.isFinite(n)?Math.max(0,n):void 0}catch(e){return}}function K(){return{name:"throttlingRetryStrategy",retry({response:e}){const t=W(e);return Number.isFinite(t)?{retryAfterInMs:t}:{skipStrategy:!0}}}}const $=1e3,J=64e3;function X(e={}){var t,n;const r=null!==(t=e.retryDelayInMs)&&void 0!==t?t:$,i=null!==(n=e.maxRetryDelayInMs)&&void 0!==n?n:J;return{name:"exponentialRetryStrategy",retry({retryCount:t,response:n,responseError:o}){const s=!!(h=o)&&("ETIMEDOUT"===h.code||"ESOCKETTIMEDOUT"===h.code||"ECONNREFUSED"===h.code||"ECONNRESET"===h.code||"ENOENT"===h.code||"ENOTFOUND"===h.code),a=s&&e.ignoreSystemErrors,u=function(e){return Boolean(e&&void 0!==e.status&&(e.status>=500||408===e.status)&&501!==e.status&&505!==e.status)}(n),l=u&&e.ignoreHttpStatusCodes,d=n&&(function(e){return Number.isFinite(W(e))}(n)||!u);var h;return d||l||a?{skipStrategy:!0}:!o||s||u?(0,c.calculateRetryDelay)(t,{retryDelayInMs:r,maxRetryDelayInMs:i}):{errorToThrow:o}}}}const Q=(0,s.KV)("core-rest-pipeline retryPolicy"),Y="retryPolicy";function Z(e,t={maxRetries:S}){const n=t.logger||Q;return{name:Y,async sendRequest(r,i){var o,s;let a,c,u=-1;e:for(;;){u+=1,a=void 0,c=void 0;try{n.info(`Retry ${u}: Attempting to send request`,r.requestId),a=await i(r),n.info(`Retry ${u}: Received a response from request`,r.requestId)}catch(e){if(n.error(`Retry ${u}: Received an error from request`,r.requestId),c=e,!e||"RestError"!==c.name)throw e;a=c.response}if(null===(o=r.abortSignal)||void 0===o?void 0:o.aborted)throw n.error(`Retry ${u}: Request aborted.`),new F;if(u>=(null!==(s=t.maxRetries)&&void 0!==s?s:S)){if(n.info(`Retry ${u}: Maximum retries reached. Returning the last received response, or throwing the last received error.`),c)throw c;if(a)return a;throw new Error("Maximum retries reached with no response or error to throw")}n.info(`Retry ${u}: Processing ${e.length} retry strategies.`);t:for(const t of e){const e=t.logger||Q;e.info(`Retry ${u}: Processing retry strategy ${t.name}.`);const n=t.retry({retryCount:u,response:a,responseError:c});if(n.skipStrategy){e.info(`Retry ${u}: Skipped.`);continue t}const{errorToThrow:i,retryAfterInMs:o,redirectTo:s}=n;if(i)throw e.error(`Retry ${u}: Retry strategy ${t.name} throws error:`,i),i;if(o||0===o){e.info(`Retry ${u}: Retry strategy ${t.name} retries after ${o}`),await G(o,void 0,{abortSignal:r.abortSignal});continue e}if(s){e.info(`Retry ${u}: Retry strategy ${t.name} redirects to ${s}`),r.url=s;continue e}}if(c)throw n.info("None of the retry strategies could work with the received error. Throwing it."),c;if(a)return n.info("None of the retry strategies could work with the received response. Returning it."),a}}}}const ee="defaultRetryPolicy";function te(e={}){var t;return{name:ee,sendRequest:Z([K(),X(e)],{maxRetries:null!==(t=e.maxRetries)&&void 0!==t?t:S}).sendRequest}}function ne(e){return e.toLowerCase()}class re{constructor(e){if(this._headersMap=new Map,e)for(const t of Object.keys(e))this.set(t,e[t])}set(e,t){this._headersMap.set(ne(e),{name:e,value:String(t).trim()})}get(e){var t;return null===(t=this._headersMap.get(ne(e)))||void 0===t?void 0:t.value}has(e){return this._headersMap.has(ne(e))}delete(e){this._headersMap.delete(ne(e))}toJSON(e={}){const t={};if(e.preserveCase)for(const e of this._headersMap.values())t[e.name]=e.value;else for(const[e,n]of this._headersMap)t[e]=n.value;return t}toString(){return JSON.stringify(this.toJSON({preserveCase:!0}))}[Symbol.iterator](){return function*(e){for(const t of e.values())yield[t.name,t.value]}(this._headersMap)}}function ie(e){return new re(e)}const oe="formDataPolicy";function se(){return{name:oe,async sendRequest(e,t){if(c.isNodeLike&&"undefined"!=typeof FormData&&e.body instanceof FormData&&(e.formData=function(e){var t;const n={};for(const[r,i]of e.entries())null!==(t=n[r])&&void 0!==t||(n[r]=[]),n[r].push(i);return n}(e.body),e.body=void 0),e.formData){const t=e.headers.get("Content-Type");t&&-1!==t.indexOf("application/x-www-form-urlencoded")?e.body=function(e){const t=new URLSearchParams;for(const[n,r]of Object.entries(e))if(Array.isArray(r))for(const e of r)t.append(n,e.toString());else t.append(n,r.toString());return t.toString()}(e.formData):await async function(e,t){const n=t.headers.get("Content-Type");if(n&&!n.startsWith("multipart/form-data"))return;t.headers.set("Content-Type",null!=n?n:"multipart/form-data");const r=[];for(const[t,n]of Object.entries(e))for(const e of Array.isArray(n)?n:[n])if("string"==typeof e)r.push({headers:ie({"Content-Disposition":`form-data; name="${t}"`}),body:(0,c.stringToUint8Array)(e,"utf-8")});else{if(null==e||"object"!=typeof e)throw new Error(`Unexpected value for key ${t}: ${e}. Value should be serialized to string first.`);{const n=e.name||"blob",i=ie();i.set("Content-Disposition",`form-data; name="${t}"; filename="${n}"`),i.set("Content-Type",e.type||"application/octet-stream"),r.push({headers:i,body:e})}}t.multipartBody={parts:r}}(e.formData,e),e.formData=void 0}return t(e)}}}const ae="proxyPolicy",ce="proxyPolicy is not supported in browser environment";function ue(){throw new Error(ce)}function le(){throw new Error(ce)}const de="setClientRequestIdPolicy";function he(e="x-ms-client-request-id"){return{name:de,sendRequest:async(t,n)=>(t.headers.has(e)||t.headers.set(e,t.requestId),n(t))}}const pe="tlsPolicy";function fe(e){return{name:pe,sendRequest:async(t,n)=>(t.tlsSettings||(t.tlsSettings=e),n(t))}}var ge=n(947);const me={},ve=new h;class ye extends Error{constructor(e,t={}){super(e),this.name="RestError",this.code=t.code,this.statusCode=t.statusCode,Object.defineProperty(this,"request",{value:t.request,enumerable:!1}),Object.defineProperty(this,"response",{value:t.response,enumerable:!1}),Object.setPrototypeOf(this,ye.prototype)}[me](){return`RestError: ${this.message} \n ${ve.sanitize(Object.assign(Object.assign({},this),{request:this.request,response:this.response}))}`}}function Ce(e){return e instanceof ye||(0,c.isError)(e)&&"RestError"===e.name}ye.REQUEST_SEND_ERROR="REQUEST_SEND_ERROR",ye.PARSE_ERROR="PARSE_ERROR";const Se="tracingPolicy";function Te(e={}){const t=T(e.userAgentPrefix),n=new h({additionalAllowedQueryParameters:e.additionalAllowedQueryParameters}),r=function(){try{return(0,ge.y)({namespace:"",packageName:"@azure/core-rest-pipeline",packageVersion:C})}catch(e){return void a.warning(`Error when creating the TracingClient: ${(0,c.getErrorMessage)(e)}`)}}();return{name:Se,async sendRequest(e,i){var o;if(!r)return i(e);const s=await t,u={"http.url":n.sanitizeUrl(e.url),"http.method":e.method,"http.user_agent":s,requestId:e.requestId};s&&(u["http.user_agent"]=s);const{span:l,tracingContext:d}=null!==(o=function(e,t,n){try{const{span:r,updatedOptions:i}=e.startSpan(`HTTP ${t.method}`,{tracingOptions:t.tracingOptions},{spanKind:"client",spanAttributes:n});if(!r.isRecording())return void r.end();const o=e.createRequestHeaders(i.tracingOptions.tracingContext);for(const[e,n]of Object.entries(o))t.headers.set(e,n);return{span:r,tracingContext:i.tracingOptions.tracingContext}}catch(e){return void a.warning(`Skipping creating a tracing span due to an error: ${(0,c.getErrorMessage)(e)}`)}}(r,e,u))&&void 0!==o?o:{};if(!l||!d)return i(e);try{const t=await r.withContext(d,i,e);return function(e,t){try{e.setAttribute("http.status_code",t.status);const n=t.headers.get("x-ms-request-id");n&&e.setAttribute("serviceRequestId",n),t.status>=400&&e.setStatus({status:"error"}),e.end()}catch(e){a.warning(`Skipping tracing span processing due to an error: ${(0,c.getErrorMessage)(e)}`)}}(l,t),t}catch(e){throw function(e,t){try{e.setStatus({status:"error",error:(0,c.isError)(t)?t:void 0}),Ce(t)&&t.statusCode&&e.setAttribute("http.status_code",t.statusCode),e.end()}catch(e){a.warning(`Skipping tracing span processing due to an error: ${(0,c.getErrorMessage)(e)}`)}}(l,e),e}}}}function Ee(e){var t;const n=o();return c.isNodeLike&&(e.tlsOptions&&n.addPolicy(fe(e.tlsOptions)),n.addPolicy(le(e.proxyOptions)),n.addPolicy(j())),n.addPolicy(se(),{beforePolicies:[N]}),n.addPolicy(I(e.userAgentOptions)),n.addPolicy(he(null===(t=e.telemetryOptions)||void 0===t?void 0:t.clientRequestIdHeaderName)),n.addPolicy(L(),{afterPhase:"Deserialize"}),n.addPolicy(te(e.retryOptions),{phase:"Retry"}),n.addPolicy(Te(Object.assign(Object.assign({},e.userAgentOptions),e.loggingOptions)),{afterPhase:"Retry"}),c.isNodeLike&&n.addPolicy(v(e.redirectOptions),{afterPhase:"Retry"}),n.addPolicy(f(e.loggingOptions),{afterPhase:"Sign"}),n}class be{async sendRequest(e){if("https:"!==new URL(e.url).protocol&&!e.allowInsecureConnection)throw new Error(`Cannot connect to ${e.url} while allowInsecureConnection is false.`);if(e.proxySettings)throw new Error("HTTP proxy is not supported in browser environment");try{return await async function(e){const{abortController:t,abortControllerCleanup:n}=function(e){const t=new AbortController;let n,r;if(e.abortSignal){if(e.abortSignal.aborted)throw new F("The operation was aborted.");r=e=>{"abort"===e.type&&t.abort()},e.abortSignal.addEventListener("abort",r),n=()=>{var t;r&&(null===(t=e.abortSignal)||void 0===t||t.removeEventListener("abort",r))}}return e.timeout>0&&setTimeout(()=>{t.abort()},e.timeout),{abortController:t,abortControllerCleanup:n}}(e);try{const i=function(e){const t=new Headers;for(const[n,r]of e)t.append(n,r);return t}(e.headers),{streaming:o,body:s}=function(e){const t="function"==typeof e.body?e.body():e.body;if(w(t))throw new Error("Node streams are not supported in browser environment.");return R(t)?{streaming:!0,body:Ie(t,{onProgress:e.onUploadProgress})}:{streaming:!1,body:t}}(e),a=Object.assign(Object.assign({body:s,method:e.method,headers:i,signal:t.signal},"credentials"in Request.prototype?{credentials:e.withCredentials?"include":"same-origin"}:{}),"cache"in Request.prototype?{cache:"no-store"}:{});o&&(a.duplex="half");const c=await fetch(e.url,a);return r=e.body,("function"==typeof Blob||"object"==typeof Blob)&&r instanceof Blob&&e.onUploadProgress&&e.onUploadProgress({loadedBytes:e.body.size}),async function(e,t,n){var r,i;const o=function(e){const t=ie();for(const[n,r]of e.headers)t.set(n,r);return t}(e),s={request:t,headers:o,status:e.status},a=R(e.body)?Ie(e.body,{onProgress:t.onDownloadProgress,onEnd:n}):e.body;if((null===(r=t.streamResponseStatusCodes)||void 0===r?void 0:r.has(Number.POSITIVE_INFINITY))||(null===(i=t.streamResponseStatusCodes)||void 0===i?void 0:i.has(s.status)))if(t.enableBrowserStreams)s.browserStreamBody=null!=a?a:void 0;else{const e=new Response(a);s.blobBody=e.blob(),null==n||n()}else{const e=new Response(a);s.bodyAsText=await e.text(),null==n||n()}return s}(c,e,n)}catch(e){throw null==n||n(),e}var r}(e)}catch(t){throw function(e,t){var n;return e&&"AbortError"===(null==e?void 0:e.name)?e:new ye(`Error sending request: ${e.message}`,{code:null!==(n=null==e?void 0:e.code)&&void 0!==n?n:ye.REQUEST_SEND_ERROR,request:t})}(t,e)}}}function Ie(e,t={}){let n=0;const{onProgress:r,onEnd:i}=t;if(function(e){return void 0!==e.pipeThrough&&void 0!==self.TransformStream}(e))return e.pipeThrough(new TransformStream({transform(e,t){null!==e?(t.enqueue(e),n+=e.length,r&&r({loadedBytes:n})):t.terminate()},flush(){null==i||i()}}));{const t=e.getReader();return new ReadableStream({async pull(e){var o;const{done:s,value:a}=await t.read();if(s||!a)return null==i||i(),e.close(),void t.releaseLock();n+=null!==(o=null==a?void 0:a.length)&&void 0!==o?o:0,e.enqueue(a),r&&r({loadedBytes:n})},cancel:e=>(null==i||i(),t.cancel(e))})}}function we(){return new be}class Re{constructor(e){var t,n,r,i,o,s,a;this.url=e.url,this.body=e.body,this.headers=null!==(t=e.headers)&&void 0!==t?t:ie(),this.method=null!==(n=e.method)&&void 0!==n?n:"GET",this.timeout=null!==(r=e.timeout)&&void 0!==r?r:0,this.multipartBody=e.multipartBody,this.formData=e.formData,this.disableKeepAlive=null!==(i=e.disableKeepAlive)&&void 0!==i&&i,this.proxySettings=e.proxySettings,this.streamResponseStatusCodes=e.streamResponseStatusCodes,this.withCredentials=null!==(o=e.withCredentials)&&void 0!==o&&o,this.abortSignal=e.abortSignal,this.tracingOptions=e.tracingOptions,this.onUploadProgress=e.onUploadProgress,this.onDownloadProgress=e.onDownloadProgress,this.requestId=e.requestId||(0,c.randomUUID)(),this.allowInsecureConnection=null!==(s=e.allowInsecureConnection)&&void 0!==s&&s,this.enableBrowserStreams=null!==(a=e.enableBrowserStreams)&&void 0!==a&&a}}function Ae(e){return new Re(e)}const Oe="exponentialRetryPolicy";function ke(e={}){var t;return Z([X(Object.assign(Object.assign({},e),{ignoreSystemErrors:!0}))],{maxRetries:null!==(t=e.maxRetries)&&void 0!==t?t:S})}const _e="systemErrorRetryPolicy";function Pe(e={}){var t;return{name:_e,sendRequest:Z([X(Object.assign(Object.assign({},e),{ignoreHttpStatusCodes:!0}))],{maxRetries:null!==(t=e.maxRetries)&&void 0!==t?t:S}).sendRequest}}const Me="throttlingRetryPolicy";function De(e={}){var t;return{name:Me,sendRequest:Z([K()],{maxRetries:null!==(t=e.maxRetries)&&void 0!==t?t:S}).sendRequest}}const Ne={forcedRefreshWindowInMs:1e3,retryIntervalInMs:3e3,refreshWindowInMs:12e4};function xe(e,t){let n,r=null,i=null;const o=Object.assign(Object.assign({},Ne),t),s={get isRefreshing(){return null!==r},get shouldRefresh(){var e;return!s.isRefreshing&&(!!((null==i?void 0:i.refreshAfterTimestamp)&&i.refreshAfterTimestamp<Date.now())||(null!==(e=null==i?void 0:i.expiresOnTimestamp)&&void 0!==e?e:0)-o.refreshWindowInMs<Date.now())},get mustRefresh(){return null===i||i.expiresOnTimestamp-o.forcedRefreshWindowInMs<Date.now()}};function a(t,a){var c;return s.isRefreshing||(r=async function(e,t,n){async function r(){if(!(Date.now()<n)){const t=await e();if(null===t)throw new Error("Failed to refresh access token.");return t}try{return await e()}catch(e){return null}}let i=await r();for(;null===i;)await G(t),i=await r();return i}(()=>e.getToken(t,a),o.retryIntervalInMs,null!==(c=null==i?void 0:i.expiresOnTimestamp)&&void 0!==c?c:Date.now()).then(e=>(r=null,i=e,n=a.tenantId,i)).catch(e=>{throw r=null,i=null,n=void 0,e})),r}return async(e,t)=>{const r=Boolean(t.claims),o=n!==t.tenantId;return r&&(i=null),o||r||s.mustRefresh?a(e,t):(s.shouldRefresh&&a(e,t),i)}}const Ue="bearerTokenAuthenticationPolicy";async function Le(e,t){try{return[await t(e),void 0]}catch(e){if(Ce(e)&&e.response)return[e.response,e];throw e}}async function qe(e){const{scopes:t,getAccessToken:n,request:r}=e,i={abortSignal:r.abortSignal,tracingOptions:r.tracingOptions,enableCae:!0},o=await n(t,i);o&&e.request.headers.set("Authorization",`Bearer ${o.token}`)}function je(e){return 401===e.status&&e.headers.has("WWW-Authenticate")}async function Fe(e,t){var n;const{scopes:r}=e,i=await e.getAccessToken(r,{enableCae:!0,claims:t});return!!i&&(e.request.headers.set("Authorization",`${null!==(n=i.tokenType)&&void 0!==n?n:"Bearer"} ${i.token}`),!0)}function Be(e){var t,n,r;const{credential:i,scopes:o,challengeCallbacks:s}=e,c=e.logger||a,u={authorizeRequest:null!==(n=null===(t=null==s?void 0:s.authorizeRequest)||void 0===t?void 0:t.bind(s))&&void 0!==n?n:qe,authorizeRequestOnChallenge:null===(r=null==s?void 0:s.authorizeRequestOnChallenge)||void 0===r?void 0:r.bind(s)},l=i?xe(i):()=>Promise.resolve(null);return{name:Ue,async sendRequest(e,t){if(!e.url.toLowerCase().startsWith("https://"))throw new Error("Bearer token authentication is not permitted for non-TLS protected (non-https) URLs.");let n,r,i;if(await u.authorizeRequest({scopes:Array.isArray(o)?o:[o],request:e,getAccessToken:l,logger:c}),[n,r]=await Le(e,t),je(n)){let s=Ge(n.headers.get("WWW-Authenticate"));if(s){let a;try{a=atob(s)}catch(e){return c.warning(`The WWW-Authenticate header contains "claims" that cannot be parsed. Unable to perform the Continuous Access Evaluation authentication flow. Unparsable claims: ${s}`),n}i=await Fe({scopes:Array.isArray(o)?o:[o],response:n,request:e,getAccessToken:l,logger:c},a),i&&([n,r]=await Le(e,t))}else if(u.authorizeRequestOnChallenge&&(i=await u.authorizeRequestOnChallenge({scopes:Array.isArray(o)?o:[o],request:e,response:n,getAccessToken:l,logger:c}),i&&([n,r]=await Le(e,t)),je(n)&&(s=Ge(n.headers.get("WWW-Authenticate")),s))){let a;try{a=atob(s)}catch(e){return c.warning(`The WWW-Authenticate header contains "claims" that cannot be parsed. Unable to perform the Continuous Access Evaluation authentication flow. Unparsable claims: ${s}`),n}i=await Fe({scopes:Array.isArray(o)?o:[o],response:n,request:e,getAccessToken:l,logger:c},a),i&&([n,r]=await Le(e,t))}}if(r)throw r;return n}}}function Ge(e){var t;if(!e)return;const n=function(e){const t=/(\w+)\s+((?:\w+=(?:"[^"]*"|[^,]*),?\s*)+)/g,n=/(\w+)="([^"]*)"/g,r=[];let i;for(;null!==(i=t.exec(e));){const e=i[1],t=i[2],o={};let s;for(;null!==(s=n.exec(t));)o[s[1]]=s[2];r.push({scheme:e,params:o})}return r}(e);return null===(t=n.find(e=>"Bearer"===e.scheme&&e.params.claims&&"insufficient_claims"===e.params.error))||void 0===t?void 0:t.params.claims}const He="ndJsonPolicy";function Ve(){return{name:He,async sendRequest(e,t){if("string"==typeof e.body&&e.body.startsWith("[")){const t=JSON.parse(e.body);Array.isArray(t)&&(e.body=t.map(e=>JSON.stringify(e)+"\n").join(""))}return t(e)}}}const ze="auxiliaryAuthenticationHeaderPolicy",We="x-ms-authorization-auxiliary";async function Ke(e){var t,n;const{scopes:r,getAccessToken:i,request:o}=e,s={abortSignal:o.abortSignal,tracingOptions:o.tracingOptions};return null!==(n=null===(t=await i(r,s))||void 0===t?void 0:t.token)&&void 0!==n?n:""}function $e(e){const{credentials:t,scopes:n}=e,r=e.logger||a,i=new WeakMap;return{name:ze,async sendRequest(e,o){if(!e.url.toLowerCase().startsWith("https://"))throw new Error("Bearer token authentication for auxiliary header is not permitted for non-TLS protected (non-https) URLs.");if(!t||0===t.length)return r.info(`${ze} header will not be set due to empty credentials.`),o(e);const s=[];for(const o of t){let t=i.get(o);t||(t=xe(o),i.set(o,t)),s.push(Ke({scopes:Array.isArray(n)?n:[n],request:e,getAccessToken:t,logger:r}))}const a=(await Promise.all(s)).filter(e=>Boolean(e));return 0===a.length?(r.warning(`None of the auxiliary tokens are valid. ${We} header will not be set.`),o(e)):(e.headers.set(We,a.map(e=>`Bearer ${e}`).join(", ")),o(e))}}}},5777:(e,t,n)=>{"use strict";n.r(t),n.d(t,{calculateRetryDelay:()=>c,cancelablePromiseRace:()=>u,computeSha256Hash:()=>T,computeSha256Hmac:()=>S,createAbortablePromise:()=>i,delay:()=>a,getErrorMessage:()=>h,getRandomIntegerInclusive:()=>o,isBrowser:()=>M,isBun:()=>x,isDefined:()=>E,isDeno:()=>N,isError:()=>d,isNode:()=>L,isNodeLike:()=>U,isNodeRuntime:()=>q,isObject:()=>l,isObjectWithProperties:()=>b,isReactNative:()=>j,isWebWorker:()=>D,objectHasProperty:()=>I,randomUUID:()=>A,stringToUint8Array:()=>f,uint8ArrayToString:()=>p});class r extends Error{constructor(e){super(e),this.name="AbortError"}}function i(e,t){const{cleanupBeforeAbort:n,abortSignal:i,abortErrorMsg:o}=null!=t?t:{};return new Promise((t,s)=>{function a(){s(new r(null!=o?o:"The operation was aborted."))}function c(){null==i||i.removeEventListener("abort",u)}function u(){null==n||n(),c(),a()}if(null==i?void 0:i.aborted)return a();try{e(e=>{c(),t(e)},e=>{c(),s(e)})}catch(e){s(e)}null==i||i.addEventListener("abort",u)})}function o(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}const s="The delay was aborted.";function a(e,t){let n;const{abortSignal:r,abortErrorMsg:o}=null!=t?t:{};return i(t=>{n=setTimeout(t,e)},{cleanupBeforeAbort:()=>clearTimeout(n),abortSignal:r,abortErrorMsg:null!=o?o:s})}function c(e,t){const n=t.retryDelayInMs*Math.pow(2,e),r=Math.min(t.maxRetryDelayInMs,n);return{retryAfterInMs:r/2+o(0,r/2)}}async function u(e,t){var n,r;const i=new AbortController;function o(){i.abort()}null===(n=null==t?void 0:t.abortSignal)||void 0===n||n.addEventListener("abort",o);try{return await Promise.race(e.map(e=>e({abortSignal:i.signal})))}finally{i.abort(),null===(r=null==t?void 0:t.abortSignal)||void 0===r||r.removeEventListener("abort",o)}}function l(e){return!("object"!=typeof e||null===e||Array.isArray(e)||e instanceof RegExp||e instanceof Date)}function d(e){if(l(e)){const t="string"==typeof e.name,n="string"==typeof e.message;return t&&n}return!1}function h(e){if(d(e))return e.message;{let t;try{t="object"==typeof e&&e?JSON.stringify(e):String(e)}catch(e){t="[unable to stringify input]"}return`Unknown error ${t}`}}function p(e,t){switch(t){case"utf-8":return function(e){return(new TextDecoder).decode(e)}(e);case"base64":return g(e);case"base64url":return function(e){return g(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}(e);case"hex":return function(e){return[...e].map(e=>e.toString(16).padStart(2,"0")).join("")}(e)}}function f(e,t){switch(t){case"utf-8":return function(e){return(new TextEncoder).encode(e)}(e);case"base64":return m(e);case"base64url":return function(e){return m(e.replace(/-/g,"+").replace(/_/g,"/"))}(e);case"hex":return function(e){const t=new Uint8Array(e.length/2);for(let n=0;n<e.length/2;++n){const r=e[2*n],i=e[2*n+1];if(!v.has(r)||!v.has(i))return t.slice(0,n);t[n]=parseInt(`${r}${i}`,16)}return t}(e)}}function g(e){return btoa([...e].map(e=>String.fromCharCode(e)).join(""))}function m(e){return new Uint8Array([...atob(e)].map(e=>e.charCodeAt(0)))}const v=new Set("0123456789abcdefABCDEF");let y;function C(){if(y)return y;if(!self.crypto||!self.crypto.subtle)throw new Error("Your browser environment does not support cryptography functions.");return y=self.crypto.subtle,y}async function S(e,t,n){const r=C(),i=f(e,"base64"),o=f(t,"utf-8"),s=await r.importKey("raw",i,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),a=await r.sign({name:"HMAC",hash:{name:"SHA-256"}},s,o);return p(new Uint8Array(a),n)}async function T(e,t){const n=f(e,"utf-8"),r=await C().digest({name:"SHA-256"},n);return p(new Uint8Array(r),t)}function E(e){return null!=e}function b(e,t){if(!E(e)||"object"!=typeof e)return!1;for(const n of t)if(!I(e,n))return!1;return!0}function I(e,t){return E(e)&&"object"==typeof e&&t in e}var w;const R="function"==typeof(null===(w=null===globalThis||void 0===globalThis?void 0:globalThis.crypto)||void 0===w?void 0:w.randomUUID)?globalThis.crypto.randomUUID.bind(globalThis.crypto):function(){let e="";for(let t=0;t<32;t++){const n=Math.floor(16*Math.random());e+=12===t?"4":16===t?3&n|8:n.toString(16),7!==t&&11!==t&&15!==t&&19!==t||(e+="-")}return e};function A(){return R()}var O,k,_,P;const M="undefined"!=typeof window&&void 0!==window.document,D="object"==typeof self&&"function"==typeof(null===self||void 0===self?void 0:self.importScripts)&&("DedicatedWorkerGlobalScope"===(null===(O=self.constructor)||void 0===O?void 0:O.name)||"ServiceWorkerGlobalScope"===(null===(k=self.constructor)||void 0===k?void 0:k.name)||"SharedWorkerGlobalScope"===(null===(_=self.constructor)||void 0===_?void 0:_.name)),N="undefined"!=typeof Deno&&void 0!==Deno.version&&void 0!==Deno.version.deno,x="undefined"!=typeof Bun&&void 0!==Bun.version,U=void 0!==globalThis.process&&Boolean(globalThis.process.version)&&Boolean(null===(P=globalThis.process.versions)||void 0===P?void 0:P.node),L=U,q=U&&!x&&!N,j="undefined"!=typeof navigator&&"ReactNative"===(null===navigator||void 0===navigator?void 0:navigator.product)}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={exports:{}};return e[n].call(o.exports,o,o.exports,r),o.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};return(()=>{"use strict";r.r(i),r.d(i,{ActivityType:()=>cr,BOT_ADAPTIVE_CARD_METADATA_KEY:()=>Cr,BOT_ADAPTIVE_CARD_METADATA_VALUE:()=>Sr,ChannelDataTypes:()=>yr,DIRECT_LINE_ACTIVITY_ENTITIES_MESSAGE_STREAMING_VALUE:()=>lr,LogEvent:()=>Se,LogLevel:()=>ge,Logger:()=>Ce,OneDriveFileManager:()=>hi,ReadyState:()=>e,Role:()=>ur,StateKey:()=>fe,createACSAdapter:()=>pi});var e,t={};r.r(t),r.d(t,{AddChatParticipantsRequest:()=>ht,AddChatParticipantsResult:()=>pt,ChatAttachment:()=>rt,ChatError:()=>et,ChatMessage:()=>st,ChatMessageContent:()=>at,ChatMessageReadReceipt:()=>Ke,ChatMessageReadReceiptsCollection:()=>We,ChatMessagesCollection:()=>ot,ChatParticipant:()=>ct,ChatParticipantsCollection:()=>dt,ChatRetentionPolicy:()=>gt,ChatThreadItem:()=>St,ChatThreadProperties:()=>vt,ChatThreadsItemCollection:()=>Ct,CommunicationErrorResponse:()=>Ze,CommunicationIdentifierModel:()=>$e,CommunicationUserIdentifierModel:()=>Je,CreateChatThreadRequest:()=>ft,CreateChatThreadResult:()=>mt,ErrorDetail:()=>Rt,ErrorModel:()=>wt,ErrorResponse:()=>It,MessagingPolicy:()=>yt,MicrosoftTeamsAppIdentifierModel:()=>Ye,MicrosoftTeamsUserIdentifierModel:()=>Qe,NoneRetentionPolicy:()=>Ot,PhoneNumberIdentifierModel:()=>Xe,PolicyViolation:()=>ut,SendChatMessageRequest:()=>nt,SendChatMessageResult:()=>it,SendReadReceiptRequest:()=>tt,SendTypingNotificationRequest:()=>Et,ThreadCreationDateRetentionPolicy:()=>At,UpdateChatMessageRequest:()=>lt,UpdateChatThreadRequest:()=>Tt,UploadChatImageResult:()=>bt,discriminators:()=>kt}),function(e){e[e.CONNECTING=0]="CONNECTING",e[e.OPEN=1]="OPEN",e[e.CLOSED=2]="CLOSED"}(e||(e={})),"function"==typeof Symbol&&Symbol.observable;var o=function(){return Math.random().toString(36).substring(7).split("").join(".")};function s(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce(function(e,t){return function(){return e(t.apply(void 0,arguments))}})}function a(e,t){return(...n)=>r=>i=>{const o=r(i);if(Object.getPrototypeOf(o)!==Object.prototype)throw new Error("One of the enhancer is returning the adapter as a class object. This is not supported.");let a=()=>{throw new Error("Calling function while constructing your middleware is not allowed. Other middleware would not be applied to this function.")};const c=t(function(e){return{close:(...t)=>e.close(...t),egress:(...t)=>e.egress(...t),getReadyState:(...t)=>e.getReadyState(...t),getState:t=>e.getState(t),ingress:(...t)=>e.ingress(...t),setReadyState:(...t)=>e.setReadyState(...t),setState:(t,n)=>e.setState(t,n),subscribe:(...t)=>e.subscribe(...t)}}(o),(...e)=>a(...e)),u=n.map(e=>e(c));if(u.some(e=>"function"!=typeof e))throw new Error("All middlewares must return a function after caling with middleware API.");return a=s(...u)(e(o)),Object.assign(Object.assign({},o),t(o,a))}}function c(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function u(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((r=r.apply(e,t||[])).next())})}function l(e){return this instanceof l?(this.v=e,this):new l(e)}function d(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),o=[];return r=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),s("next"),s("throw"),s("return",function(e){return function(t){return Promise.resolve(t).then(e,u)}}),r[Symbol.asyncIterator]=function(){return this},r;function s(e,t){i[e]&&(r[e]=function(t){return new Promise(function(n,r){o.push([e,t,n,r])>1||a(e,t)})},t&&(r[e]=t(r[e])))}function a(e,t){try{(n=i[e](t)).value instanceof l?Promise.resolve(n.value.v).then(c,u):d(o[0][2],n)}catch(e){d(o[0][3],e)}var n}function c(e){a("next",e)}function u(e){a("throw",e)}function d(e,t){e(t),o.shift(),o.length&&a(o[0][0],o[0][1])}}function h(e){var t,n;return t={},r("next"),r("throw",function(e){throw e}),r("return"),t[Symbol.iterator]=function(){return this},t;function r(r,i){t[r]=e[r]?function(t){return(n=!n)?{value:l(e[r](t)),done:!1}:i?i(t):t}:i}}function p(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise(function(r,i){!function(e,t,n,r){Promise.resolve(r).then(function(t){e({value:t,done:n})},t)}(r,i,(t=e[n](t)).done,t.value)})}}}function f(){const e={};return e.promise=new Promise((t,n)=>{e.resolve=t,e.reject=n}),e}o(),o(),Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError,r(2440),r(5245);var g=r(8435),m=r.n(g);const v=Symbol();function y(e,t,...n){if(!e)throw new TypeError(C(t,n))}function C(e,t){let n=0;return e.replace(/%[os]/gu,()=>S(t[n++]))}function S(e){return"object"!=typeof e||null===e?String(e):Object.prototype.toString.call(e)}const T="undefined"!=typeof window?window:"undefined"!=typeof self?self:void 0!==n.g?n.g:"undefined"!=typeof globalThis?globalThis:void 0;class E{constructor(e,t){this.code=e,this.message=t}warn(...e){var t;try{const n=(null!==(t=(new Error).stack)&&void 0!==t?t:"").replace(/^(?:.+?\n){2}/gu,"\n");console.warn(this.message,...e,n)}catch(e){}}}const b=new E("W01","Unable to initialize event under dispatching."),I=new E("W02","Assigning any falsy value to 'cancelBubble' property has no effect."),w=new E("W03","Assigning any truthy value to 'returnValue' property has no effect."),R=new E("W04","Unable to preventDefault on non-cancelable events."),A=new E("W05","Unable to preventDefault inside passive event listener invocation."),O=new E("W06","An event listener wasn't added because it has been added already: %o, %o"),k=new E("W07","The %o option value was abandoned because the event listener wasn't added as duplicated."),_=new E("W08","The 'callback' argument must be a function or an object that has 'handleEvent' method: %o"),P=new E("W09","Event attribute handler must be a function: %o");class M{static get NONE(){return D}static get CAPTURING_PHASE(){return N}static get AT_TARGET(){return x}static get BUBBLING_PHASE(){return U}constructor(e,t){Object.defineProperty(this,"isTrusted",{value:!1,enumerable:!0});const n=null!=t?t:{};L.set(this,{type:String(e),bubbles:Boolean(n.bubbles),cancelable:Boolean(n.cancelable),composed:Boolean(n.composed),target:null,currentTarget:null,stopPropagationFlag:!1,stopImmediatePropagationFlag:!1,canceledFlag:!1,inPassiveListenerFlag:!1,dispatchFlag:!1,timeStamp:Date.now()})}get type(){return q(this).type}get target(){return q(this).target}get srcElement(){return q(this).target}get currentTarget(){return q(this).currentTarget}composedPath(){const e=q(this).currentTarget;return e?[e]:[]}get NONE(){return D}get CAPTURING_PHASE(){return N}get AT_TARGET(){return x}get BUBBLING_PHASE(){return U}get eventPhase(){return q(this).dispatchFlag?2:0}stopPropagation(){q(this).stopPropagationFlag=!0}get cancelBubble(){return q(this).stopPropagationFlag}set cancelBubble(e){e?q(this).stopPropagationFlag=!0:I.warn()}stopImmediatePropagation(){const e=q(this);e.stopPropagationFlag=e.stopImmediatePropagationFlag=!0}get bubbles(){return q(this).bubbles}get cancelable(){return q(this).cancelable}get returnValue(){return!q(this).canceledFlag}set returnValue(e){e?w.warn():j(q(this))}preventDefault(){j(q(this))}get defaultPrevented(){return q(this).canceledFlag}get composed(){return q(this).composed}get isTrusted(){return!1}get timeStamp(){return q(this).timeStamp}initEvent(e,t=!1,n=!1){const r=q(this);r.dispatchFlag?b.warn():L.set(this,{...r,type:String(e),bubbles:Boolean(t),cancelable:Boolean(n),target:null,currentTarget:null,stopPropagationFlag:!1,stopImmediatePropagationFlag:!1,canceledFlag:!1})}}const D=0,N=1,x=2,U=3,L=new WeakMap;function q(e,t="this"){const n=L.get(e);return y(null!=n,"'%s' must be an object that Event constructor created, but got another one: %o",t,e),n}function j(e){e.inPassiveListenerFlag?A.warn():e.cancelable?e.canceledFlag=!0:R.warn()}Object.defineProperty(M,"NONE",{enumerable:!0}),Object.defineProperty(M,"CAPTURING_PHASE",{enumerable:!0}),Object.defineProperty(M,"AT_TARGET",{enumerable:!0}),Object.defineProperty(M,"BUBBLING_PHASE",{enumerable:!0});const F=Object.getOwnPropertyNames(M.prototype);for(let e=0;e<F.length;++e)"constructor"!==F[e]&&Object.defineProperty(M.prototype,F[e],{enumerable:!0});let B;void 0!==T&&void 0!==T.Event&&Object.setPrototypeOf(M.prototype,T.Event.prototype);const G={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};function H(e){const t=Object.keys(G);for(let n=0;n<t.length;++n){const r=t[n],i=G[r];Object.defineProperty(e,r,{get:()=>i,configurable:!0,enumerable:!0})}}class V extends M{static wrap(e){return new($(e))(e)}constructor(e){super(e.type,{bubbles:e.bubbles,cancelable:e.cancelable,composed:e.composed}),e.cancelBubble&&super.stopPropagation(),e.defaultPrevented&&super.preventDefault(),z.set(this,{original:e});const t=Object.keys(e);for(let n=0;n<t.length;++n){const r=t[n];r in this||Object.defineProperty(this,r,J(e,r))}}stopPropagation(){super.stopPropagation();const{original:e}=W(this);"stopPropagation"in e&&e.stopPropagation()}get cancelBubble(){return super.cancelBubble}set cancelBubble(e){super.cancelBubble=e;const{original:t}=W(this);"cancelBubble"in t&&(t.cancelBubble=e)}stopImmediatePropagation(){super.stopImmediatePropagation();const{original:e}=W(this);"stopImmediatePropagation"in e&&e.stopImmediatePropagation()}get returnValue(){return super.returnValue}set returnValue(e){super.returnValue=e;const{original:t}=W(this);"returnValue"in t&&(t.returnValue=e)}preventDefault(){super.preventDefault();const{original:e}=W(this);"preventDefault"in e&&e.preventDefault()}get timeStamp(){const{original:e}=W(this);return"timeStamp"in e?e.timeStamp:super.timeStamp}}const z=new WeakMap;function W(e){const t=z.get(e);return y(null!=t,"'this' is expected an Event object, but got",e),t}const K=new WeakMap;function $(e){const t=Object.getPrototypeOf(e);if(null==t)return V;let n=K.get(t);return null==n&&(n=function(e,t){class n extends e{}const r=Object.keys(t);for(let e=0;e<r.length;++e)Object.defineProperty(n.prototype,r[e],J(t,r[e]));return n}($(t),t),K.set(t,n)),n}function J(e,t){const n=Object.getOwnPropertyDescriptor(e,t);return{get(){const e=W(this).original,n=e[t];return"function"==typeof n?n.bind(e):n},set(e){W(this).original[t]=e},configurable:n.configurable,enumerable:n.enumerable}}function X(e){return!(1&~e.flags)}function Q(e){return!(2&~e.flags)}function Y(e){return!(4&~e.flags)}function Z(e){return!(8&~e.flags)}function ee({callback:e},t,n){try{"function"==typeof e?e.call(t,n):"function"==typeof e.handleEvent&&e.handleEvent(n)}catch(e){!function(e){try{const t=e instanceof Error?e:new Error(S(e));if("function"==typeof dispatchEvent&&"function"==typeof ErrorEvent)dispatchEvent(new ErrorEvent("error",{error:t,message:t.message}));else if("undefined"!=typeof process&&"function"==typeof process.emit)return void process.emit("uncaughtException",t);console.error(t)}catch(e){}}(e)}}function te({listeners:e},t,n){for(let r=0;r<e.length;++r)if(e[r].callback===t&&X(e[r])===n)return r;return-1}function ne(e,t,n,r,i,o){let s;o&&(s=re.bind(null,e,t,n),o.addEventListener("abort",s));const a=function(e,t,n,r,i,o){return{callback:e,flags:(t?1:0)|(n?2:0)|(r?4:0),signal:i,signalListener:o}}(t,n,r,i,o,s);return e.cow?(e.cow=!1,e.listeners=[...e.listeners,a]):e.listeners.push(a),a}function re(e,t,n){const r=te(e,t,n);return-1!==r&&ie(e,r)}function ie(e,t,n=!1){const r=e.listeners[t];return function(e){e.flags|=8}(r),r.signal&&r.signal.removeEventListener("abort",r.signalListener),e.cow&&!n?(e.cow=!1,e.listeners=e.listeners.filter((e,n)=>n!==t),!1):(e.listeners.splice(t,1),!0)}function oe(e,t){var n;return null!==(n=e[t])&&void 0!==n?n:e[t]={attrCallback:void 0,attrListener:void 0,cow:!1,listeners:[]}}K.set(Object.prototype,V),void 0!==T&&void 0!==T.Event&&K.set(T.Event.prototype,V);class se{constructor(){ae.set(this,Object.create(null))}addEventListener(e,t,n){const r=ce(this),{callback:i,capture:o,once:s,passive:a,signal:c,type:u}=function(e,t,n){var r;return ue(t),"object"==typeof n&&null!==n?{type:String(e),callback:null!=t?t:void 0,capture:Boolean(n.capture),passive:Boolean(n.passive),once:Boolean(n.once),signal:null!==(r=n.signal)&&void 0!==r?r:void 0}:{type:String(e),callback:null!=t?t:void 0,capture:Boolean(n),passive:!1,once:!1,signal:void 0}}(e,t,n);if(null==i||(null==c?void 0:c.aborted))return;const l=oe(r,u),d=te(l,i,o);-1===d?ne(l,i,o,a,s,c):function(e,t,n,r){O.warn(X(e)?"capture":"bubble",e.callback),Q(e)!==t&&k.warn("passive"),Y(e)!==n&&k.warn("once"),e.signal!==r&&k.warn("signal")}(l.listeners[d],a,s,c)}removeEventListener(e,t,n){const r=ce(this),{callback:i,capture:o,type:s}=function(e,t,n){return ue(t),"object"==typeof n&&null!==n?{type:String(e),callback:null!=t?t:void 0,capture:Boolean(n.capture)}:{type:String(e),callback:null!=t?t:void 0,capture:Boolean(n)}}(e,t,n),a=r[s];null!=i&&a&&re(a,i,o)}dispatchEvent(e){const t=ce(this)[String(e.type)];if(null==t)return!0;const n=e instanceof M?e:V.wrap(e),r=q(n,"event");if(r.dispatchFlag)throw i="This event has been in dispatching.",T.DOMException?new T.DOMException(i,"InvalidStateError"):(null==B&&(B=class e extends Error{constructor(t){super(t),Error.captureStackTrace&&Error.captureStackTrace(this,e)}get code(){return 11}get name(){return"InvalidStateError"}},Object.defineProperties(B.prototype,{code:{enumerable:!0},name:{enumerable:!0}}),H(B),H(B.prototype)),new B(i));var i;if(r.dispatchFlag=!0,r.target=r.currentTarget=this,!r.stopPropagationFlag){const{cow:e,listeners:i}=t;t.cow=!0;for(let o=0;o<i.length;++o){const s=i[o];if(!Z(s)&&(Y(s)&&ie(t,o,!e)&&(o-=1),r.inPassiveListenerFlag=Q(s),ee(s,this,n),r.inPassiveListenerFlag=!1,r.stopImmediatePropagationFlag))break}e||(t.cow=!1)}return r.target=null,r.currentTarget=null,r.stopImmediatePropagationFlag=!1,r.stopPropagationFlag=!1,r.dispatchFlag=!1,!r.canceledFlag}}const ae=new WeakMap;function ce(e,t="this"){const n=ae.get(e);return y(null!=n,"'%s' must be an object that EventTarget constructor created, but got another one: %o",t,e),n}function ue(e){if("function"!=typeof e&&("object"!=typeof e||null===e||"function"!=typeof e.handleEvent)){if(null!=e&&"object"!=typeof e)throw new TypeError(C(_.message,[e]));_.warn(e)}}const le=Object.getOwnPropertyNames(se.prototype);for(let e=0;e<le.length;++e)"constructor"!==le[e]&&Object.defineProperty(se.prototype,le[e],{enumerable:!0});function de(e,t,n){Object.defineProperty(e,`on${t}`,{get(){return function(e,t){var n,r;return null!==(r=null===(n=ce(e,"target")[t])||void 0===n?void 0:n.attrCallback)&&void 0!==r?r:null}(this,t)},set(e){!function(e,t,n){null!=n&&"function"!=typeof n&&P.warn(n),"function"==typeof n||"object"==typeof n&&null!==n?function(e,t,n){const r=oe(ce(e,"target"),String(t));r.attrCallback=n,null==r.attrListener&&(r.attrListener=ne(r,function(e){return function(t){const n=e.attrCallback;"function"==typeof n&&n.call(this,t)}}(r),!1,!1,!1,void 0))}(e,t,n):function(e,t){const n=ce(e,"target")[String(t)];n&&n.attrListener&&(re(n,n.attrListener.callback,!1),n.attrCallback=n.attrListener=void 0)}(e,t)}(this,t,e)},configurable:!0,enumerable:!0})}void 0!==T&&void 0!==T.EventTarget&&Object.setPrototypeOf(se.prototype,T.EventTarget.prototype);const he=se,pe=e=>t=>e(t);var fe,ge,me=r(2493),ve=r.n(me);function ye(e){let t,n=[];return new(ve())(r=>(n=[...n,r],t||(t=e.subscribe({complete:()=>n.forEach(e=>e.complete()),error:e=>n.forEach(t=>t.error(e)),next:e=>n.forEach(t=>t.next(e))})),()=>{n=n.filter(e=>e!==r),n.length||(t.unsubscribe(),t=void 0)}))}!function(e){e.BotId="acs.botId",e.ChatClient="acs.chatClient",e.ChatThreadClient="acs.chatThreadClient",e.Reconnect="acs.reconnect",e.UserId="acs.userId",e.UserDisplayName="acs.userDisplayName",e.AuthConfig="acs.authConfig",e.ConnectionStatusObserverReady="dl.connectionStatusObserverReady",e.ThreadId="acs.threadId",e.DisconnectUTC="acs.disconnectUTC",e.AdapterOptions="acs.adapterOptions",e.EventManager="acs.eventManager",e.EnvironmentUrl="acs.environmentUrl",e.Token="acs.token",e.FileManager="fileManager",e.PollingInterval="pollingInterval",e.WebChatStatus="webChatStatus",e.MessagePollingHandleInstance="messagePollingHandleInstance"}(fe||(fe={})),function(e){e.INFO="INFO",e.DEBUG="DEBUG",e.WARN="WARN",e.ERROR="ERROR"}(ge||(ge={}));const Ce={loggerInstance:void 0,setInstance:e=>{Ce.loggerInstance=e},logEvent:(e,t)=>{void 0!==Ce.loggerInstance&&Ce.loggerInstance.logEvent(e,t)}};var Se,Te;function Ee(e){return new Promise(t=>setTimeout(()=>{t()},e))}!function(e){e.ADAPTER_STATE_UPDATE="ADAPTER_STATE_UPDATE",e.ACS_SDK_START_INIT="ACS_SDK_START_INIT",e.ACS_SDK_START_INIT_ERROR="ACS_SDK_START_INIT_ERROR",e.ACS_SDK_CHATCLIENT_ERROR="ACS_SDK_CHATCLIENT_ERROR",e.ACS_SDK_JOINTHREAD_ERROR="ACS_SDK_JOINTHREAD_ERROR",e.ACS_SDK_CHATCLIENT_RECONNECT_ERROR="ACS_SDK_CHATCLIENT_RECONNECT_ERROR",e.ACS_ADAPTER_ATTACHMENT_DOWNLOADED="ACS_ADAPTER_ATTACHMENT_DOWNLOADED",e.ACS_ADAPTER_ATTACHMENT_DOWNLOAD_ERROR="ACS_ADAPTER_ATTACHMENT_DOWNLOAD_ERROR",e.ACS_ADAPTER_ATTACHMENT_NEW="ACS_ADAPTER_ATTACHMENT_NEW",e.ACS_ADAPTER_ATTACHMENT_ALREADY_DOWNLOADED="ACS_ADAPTER_ATTACHMENT_ALREADY_DOWNLOADED",e.ACS_ADAPTER_PROCESSED_ATTACHMENTS="ACS_ADAPTER_PROCESSED_ATTACHMENTS",e.ACS_ADAPTER_CONVERT_HISTORY="ACS_ADAPTER_CONVERT_HISTORY",e.ACS_ADAPTER_CONVERT_TYPING_MESSAGE="ACS_ADAPTER_CONVERT_TYPING_MESSAGE",e.ACS_ADAPTER_CONVERT_MESSAGE="ACS_ADAPTER_CONVERT_MESSAGE",e.ACS_ADAPTER_CONVERT_EDITED_MESSAGE="ACS_ADAPTER_CONVERT_EDITED_MESSAGE",e.ACS_ADAPTER_CONVERT_DELETED_MESSAGE="ACS_ADAPTER_CONVERT_DELETED_MESSAGE",e.ACS_ADAPTER_CONVERT_THREAD_UPDATED="ACS_ADAPTER_CONVERT_THREAD_UPDATED",e.ACS_ADAPTER_CONVERT_THREAD_DELETED="ACS_ADAPTER_CONVERT_THREAD_DELETED",e.ACS_ADAPTER_INGRESS_MESSAGE="ACS_ADAPTER_INGRESS_MESSAGE",e.ACS_ADAPTER_INGRESS_FAILED="ACS_ADAPTER_INGRESS_FAILED",e.ACS_ADAPTER_INGRESS_STREAMING_CHAT_MESSAGE_CHUNK_FAILED="ACS_ADAPTER_INGRESS_STREAMING_CHAT_MESSAGE_CHUNK_FAILED",e.ACS_ADAPTER_EGRESS_MESSAGE="ACS_ADAPTER_EGRESS_MESSAGE",e.ACS_ADAPTER_EGRESS_SEND_MESSAGE="ACS_ADAPTER_EGRESS_SEND_MESSAGE",e.ACS_ADAPTER_EGRESS_FAILED="ACS_ADAPTER_EGRESS_FAILED",e.ACS_ADAPTER_REQUEST_DOWNLOAD_ATTACHMENTS="ACS_ADAPTER_REQUEST_DOWNLOAD_ATTACHMENTS",e.ACS_ADAPTER_SEND_MESSAGE_FAILED="ACS_ADAPTER_SEND_MESSAGE_FAILED",e.ACS_ADAPTER_SEND_MESSAGE_SUCCESS="ACS_ADAPTER_SEND_MESSAGE_SUCCESS",e.ACS_ADAPTER_SEND_MESSAGE_RETRY="ACS_ADAPTER_SEND_MESSAGE_RETRY",e.ACS_ADAPTER_INGRESS_TYPING_FAILED="ACS_ADAPTER_INGRESS_TYPING_FAILED",e.ACS_ADAPTER_INGRESS_TYPING_SUCCESS="ACS_ADAPTER_INGRESS_TYPING_SUCCESS",e.ACS_ADAPTER_EGRESS_TYPING_SENDING_REQUEST="ACS_ADAPTER_EGRESS_TYPING_SENDING_REQUEST",e.ACS_ADAPTER_EGRESS_TYPING_FAILED="ACS_ADAPTER_EGRESS_TYPING_FAILED",e.ACS_ADAPTER_EGRESS_TYPING_SUCCESS="ACS_ADAPTER_EGRESS_TYPING_SUCCESS",e.ACS_ADAPTER_REALTIME_NOTIFICATION_CONNECTED="ACS_ADAPTER_REALTIME_NOTIFICATION_CONNECTED",e.ACS_ADAPTER_REALTIME_NOTIFICATION_DISCONNECTED="ACS_ADAPTER_REALTIME_NOTIFICATION_DISCONNECTED",e.ACS_PROCESSING_POLLED_MESSAGE="ACS_PROCESSING_POLLED_MESSAGE",e.ACS_PROCESSING_NEW_MESSAGE="ACS_PROCESSING_NEW_MESSAGE",e.ACS_PROCESSING_EDITED_MESSAGE="ACS_PROCESSING_EDITED_MESSAGE",e.ACS_PROCESSING_DELETED_MESSAGE="ACS_PROCESSING_DELETED_MESSAGE",e.ACS_SKIP_POLLED_MESSAGE="ACS_SKIP_POLLED_MESSAGE",e.ACS_CANCEL_POLLING_CALLBACK="ACS_CANCEL_POLLING_CALLBACK",e.ACS_CREATE_POLLING_CALLBACK="ACS_CREATE_POLLING_CALLBACK",e.ACS_ADAPTER_POLLING_STATUSCODE="ACS_ADAPTER_POLLING_STATUSCODE",e.ACS_SEND_POLLING_REQUEST="ACS_SEND_POLLING_REQUEST",e.ACS_ADAPTER_POLLING_SKIPPED="ACS_ADAPTER_POLLING_SKIPPED",e.ACS_ADAPTER_POLLING_STOPPED="ACS_ADAPTER_POLLING_STOPPED",e.ACS_SKIP_NEW_MESSAGE="ACS_SKIP_NEW_MESSAGE",e.ACS_SKIP_STREAMING_CHAT_MESSAGE_CHUNK="ACS_SKIP_STREAMING_CHAT_MESSAGE_CHUNK",e.ACS_SKIP_EDITED_MESSAGE="ACS_SKIP_EDITED_MESSAGE",e.ACS_SKIP_DELETED_MESSAGE="ACS_SKIP_DELETED_MESSAGE",e.ACS_ADAPTER_POST_ACTIVITY="ACS_ADAPTER_POST_ACTIVITY",e.ACS_ADAPTER_POST_FILE_ACTIVITY="ACS_ADAPTER_POST_FILE_ACTIVITY",e.ACS_SDK_RECONNECT="ACS_SDK_RECONNECT",e.MESSAGE_RECEIVED="ADAPTER_MESSAGE_RECEIVED",e.PROCESS_CACHED_PAGED_HISTORY_MESSAGE="PROCESS_CACHED_PAGED_HISTORY_MESSAGE",e.PROCESS_CACHED_HISTORY_MESSAGE="PROCESS_CACHED_HISTORY_MESSAGE",e.PROCESS_CACHED_NEW_MESSAGE="PROCESS_CACHED_NEW_MESSAGE",e.CACHE_PAGED_HISTORY_MESSAGE="CACHE_PAGED_HISTORY_MESSAGE",e.CACHE_POLLED_HISTORY_MESSAGE="CACHE_POLLED_HISTORY_MESSAGE",e.CACHE_NEW_MESSAGE="CACHE_NEW_MESSAGE",e.TYPING_MESSAGE_RECEIVED="ADAPTER_TYPING_MESSAGE_RECEIVED",e.THREAD_THREAD_UPDATED="ADAPTER_THREAD_UPDATED_RECEIVED",e.THREAD_DELETED_RECEIVED="ADAPTER_THREAD_DELETED_RECEIVED",e.PARTICIPANT_REMOVED_RECEIVED="ADAPTER_PARTICIPANT_REMOVED_RECEIVED",e.PARTICIPANT_ADDED_RECEIVED="ADAPTER_PARTICIPANT_ADDED_RECEIVED",e.MESSAGE_EDIT_RECEIVED="ADAPTER_MESSAGE_EDIT_RECEIVED",e.MESSAGE_DELETED_RECEIVED="ADAPTER_MESSAGE_DELETED_RECEIVED",e.REGISTER_ON_NEW_MESSAGE="ADAPTER_REGISTER_ON_NEW_MESSAGE",e.REGISTER_ON_TYPING_INDICATOR="ADAPTER_REGISTER_ON_TYPING_INDICATOR",e.REGISTER_ON_MESSAGE_EDIT="ADAPTER_REGISTER_ON_MESSAGE_EDIT",e.REGISTER_ON_MESSAGE_DELETED="REGISTER_ON_MESSAGE_DELETED",e.REGISTER_ON_THREAD_DELETED="ADAPTER_REGISTER_ON_THREAD_DELETED",e.REGISTER_ON_THREAD_UPDATED="ADAPTER_REGISTER_ON_THREAD_UPDATED",e.REGISTER_ON_PARTICIPANT_ADDED="ADAPTER_REGISTER_ON_PARTICIPANT_ADDED",e.REGISTER_ON_PARTICIPANT_REMOVED="ADAPTER_REGISTER_ON_PARTICIPANT_REMOVED",e.REGISTER_ON_REALTIME_NOTIFICATION_CONNECTED="ADAPTER_REGISTER_ON_REALTIME_NOTIFICATION_CONNECTED",e.REGISTER_ON_REALTIME_NOTIFICATION_DISCONNECTED="ADAPTER_REGISTER_ON_REALTIME_NOTIFICATION_DISCONNECTED",e.NETWORK_ONLINE="NETWORK_ONLINE",e.NETWORK_OFFLINE="NETWORK_OFFLINE",e.FILEMANAGER_DOWNLOAD_FILE_FAILED="FILEMANAGER_DOWNLOAD_FILE_FAILED",e.FILEMANAGER_UPLOAD_FILE_FAILED="FILEMANAGER_UPLOAD_FILE_FAILED",e.FILEMANAGER_UPLOAD_FILE_REQUEST="FILEMANAGER_UPLOAD_FILE_REQUEST",e.WEBCHAT_SUBSCRIPTION_TIMEOUT="WEBCHAT_SUBSCRIPTION_TIMEOUT",e.WEBCHAT_SUBSCRIPTION_SUCCESS="WEBCHAT_SUBSCRIPTION_SUCCESS",e.WEBCHAT_STATUS_CONNECTED="WEBCHAT_STATUS_CONNECTED",e.REGISTER_ON_STREAMING_CHAT_MESSAGE_CHUNK_RECEIVED="ADAPTER_REGISTER_ON_STREAMING_CHAT_MESSAGE_CHUNK_RECEIVED",e.STREAMING_CHAT_MESSAGE_CHUNK_RECEIVED="ADAPTER_STREAMING_CHAT_MESSAGE_CHUNK_RECEIVED",e.ACS_PROCESSING_STREAMING_CHAT_MESSAGE_CHUNK="ACS_PROCESSING_STREAMING_CHAT_MESSAGE_CHUNK",e.ACS_ADAPTER_CONVERT_STREAMING_CHAT_MESSAGE_CHUNK="ACS_ADAPTER_CONVERT_STREAMING_CHAT_MESSAGE_CHUNK",e.ACS_PROCESSING_PARTICIPANT_ADDED_EVENT="ACS_PROCESSING_PARTICIPANT_ADDED_EVENT",e.ACS_PROCESSING_PARTICIPANT_REMOVED_EVENT="ACS_PROCESSING_PARTICIPANT_REMOVED_EVENT",e.ACS_PARTICIPANT_ADDED_EVENT_PROCESSED="ACS_PARTICIPANT_ADDED_EVENT_PROCESSED",e.ACS_PARTICIPANT_REMOVED_EVENT_PROCESSED="ACS_PARTICIPANT_REMOVED_EVENT_PROCESSED",e.UNSUPPORTED_MESSAGE_TYPE="UNSUPPORTED_MESSAGE_TYPE"}(Se||(Se={})),function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Connecting=1]="Connecting",e[e.Connected=2]="Connected",e[e.FailedToConnect=4]="FailedToConnect"}(Te||(Te={}));const be=function(t={},n=pe){const r={};let i,o=!1;const s=n(()=>{const t=new he,n=[];let a=e.CONNECTING;return{addEventListener:t.addEventListener.bind(t),dispatchEvent:t.dispatchEvent.bind(t),removeEventListener:t.removeEventListener.bind(t),activities:({signal:e}={})=>{const t=function(e={}){const t=function(e){const t=new Error("aborted");if(e&&e.aborted)return Promise.reject(t);const n=f(),r=()=>{e.removeEventListener("abort",r),n.reject(t)};return e&&e.addEventListener("abort",r),n.promise}(e.signal),n=[];let r,i;return t.catch(()=>{}),{iterable:{[Symbol.asyncIterator](){return d(this,arguments,function*(){if(r)throw new Error("asyncIterableQueue: You can only iterate once. The iteration has already started or finished.");for(r=!0;;){n.length?yield l(e.signal&&e.signal.aborted&&t):(yield l(Promise.race([t,(i||(i=f())).promise])),i=null);const r=n.shift();if(m()(r,v))break;yield yield l(r)}})}},end(){n.push(v)},push(e){n.push(e),i&&i.resolve()},watermark:()=>n.length}}({signal:e});return n.push(t),e&&e.addEventListener("abort",()=>{const e=n.indexOf(t);~e||n.splice(e,1)}),t.iterable},close:()=>{n.forEach(e=>e.end()),n.splice(0,1/0),i&&i.unsubscribe(),i=null},egress:()=>Promise.resolve(),getState:e=>r[e],getReadyState:()=>a,ingress:e=>{n.forEach(t=>t.push(e))},setState:(e,t)=>{if(o&&!(e in r))throw new Error(`Cannot set config "${String(e)}" because it was not set before being sealed.`);r[e]=t},setReadyState:n=>{if(n!==a){if(a===e.CLOSED)throw new Error('Cannot change "readyState" after it is CLOSED.');if(n!==e.CLOSED&&n!==e.CONNECTING&&n!==e.OPEN)throw new Error('"readyState" must be either CLOSED, CONNECTING or OPEN.');a=n,n===e.CLOSED&&(i&&i.unsubscribe(),i=null),t.dispatchEvent(new M(n===e.OPEN?"open":"error"))}},subscribe:e=>{if(i&&i.unsubscribe(),i=null,!e)return;let t;e.subscribe({start(e){i=e,t=e},complete(){i===t&&(i=null)},error(){i===t&&(i=null)},next(e){s.ingress(e)}})}}})(t);if(Object.getPrototypeOf(s)!==Object.prototype)throw new Error("Object returned from enhancer must not be a class object.");const a=function(e,t){const{getReadyState:n}=e,r=c(e,["getReadyState"]),i=Object.assign(Object.assign({},r),{readyState:-1});for(const e in t)Object.defineProperty(i,e,{enumerable:!0,get:()=>t[e]});return Object.defineProperty(i,"readyState",{get:()=>n()}),Object.seal(i)}(s,r);return o=!0,a},{CLOSED:Ie,CONNECTING:we,OPEN:Re}=e,Ae=e=>(e=>"string"==typeof e.communicationUserId)(e)?Object.assign(Object.assign({},e),{kind:"communicationUser"}):(e=>"string"==typeof e.phoneNumber)(e)?Object.assign(Object.assign({},e),{kind:"phoneNumber"}):(e=>"string"==typeof e.microsoftTeamsUserId)(e)?Object.assign(Object.assign({},e),{kind:"microsoftTeamsUser"}):(e=>"string"==typeof e.teamsAppId)(e)?Object.assign(Object.assign({},e),{kind:"microsoftTeamsApp"}):Object.assign(Object.assign({},e),{kind:"unknown"}),Oe=e=>{const t=Ae(e);switch(t.kind){case"communicationUser":return t.communicationUserId;case"microsoftTeamsUser":{const{microsoftTeamsUserId:e,rawId:n,cloud:r,isAnonymous:i}=t;if(n)return n;if(i)return`8:teamsvisitor:${e}`;switch(r){case"dod":return`8:dod:${e}`;case"gcch":return`8:gcch:${e}`;case"public":return`8:orgid:${e}`}return`8:orgid:${e}`}case"microsoftTeamsApp":{const{teamsAppId:e,rawId:n,cloud:r}=t;if(n)return n;switch(r){case"dod":return`28:dod:${e}`;case"gcch":return`28:gcch:${e}`}return`28:orgid:${e}`}case"phoneNumber":{const{phoneNumber:e,rawId:n}=t;return n||`4:${e}`}case"unknown":return t.id}},ke=(e,t)=>{const n=Object.keys(e)[0],r=e[n];if(t in r)return r[t];throw new Error(`Property ${t} is required for identifier of type ${n}.`)},_e=e=>{var t,n,r,i,o,s;const a=Ae(e);switch(a.kind){case"communicationUser":return{rawId:Oe(a),communicationUser:{id:a.communicationUserId}};case"phoneNumber":return{rawId:null!==(t=a.rawId)&&void 0!==t?t:Oe(a),phoneNumber:{value:a.phoneNumber}};case"microsoftTeamsUser":return{rawId:null!==(n=a.rawId)&&void 0!==n?n:Oe(a),microsoftTeamsUser:{userId:a.microsoftTeamsUserId,isAnonymous:null!==(r=a.isAnonymous)&&void 0!==r&&r,cloud:null!==(i=a.cloud)&&void 0!==i?i:"public"}};case"microsoftTeamsApp":return{rawId:null!==(o=a.rawId)&&void 0!==o?o:Oe(a),microsoftTeamsApp:{appId:a.teamsAppId,cloud:null!==(s=a.cloud)&&void 0!==s?s:"public"}};case"unknown":return{rawId:a.id};default:throw new Error(`Can't serialize an identifier with kind ${a.kind}`)}},Pe=e=>{var t;(e=>{const t=[];if(void 0!==e.communicationUser&&t.push("communicationUser"),void 0!==e.microsoftTeamsUser&&t.push("microsoftTeamsUser"),void 0!==e.microsoftTeamsApp&&t.push("microsoftTeamsApp"),void 0!==e.phoneNumber&&t.push("phoneNumber"),t.length>1)throw new Error(`Only one of the properties in ${JSON.stringify(t)} should be present.`)})(e);const{communicationUser:n,microsoftTeamsUser:r,microsoftTeamsApp:i,phoneNumber:o}=e,s=null!==(t=e.kind)&&void 0!==t?t:(e=>e.communicationUser?"communicationUser":e.phoneNumber?"phoneNumber":e.microsoftTeamsUser?"microsoftTeamsUser":e.microsoftTeamsApp?"microsoftTeamsApp":"unknown")(e);return"communicationUser"===s&&n?{kind:"communicationUser",communicationUserId:ke({communicationUser:n},"id")}:"phoneNumber"===s&&o?{kind:"phoneNumber",phoneNumber:ke({phoneNumber:o},"value"),rawId:ke({phoneNumber:e},"rawId")}:"microsoftTeamsUser"===s&&r?{kind:"microsoftTeamsUser",microsoftTeamsUserId:ke({microsoftTeamsUser:r},"userId"),isAnonymous:ke({microsoftTeamsUser:r},"isAnonymous"),cloud:ke({microsoftTeamsUser:r},"cloud"),rawId:ke({microsoftTeamsUser:e},"rawId")}:"microsoftTeamsApp"===s&&i?{kind:"microsoftTeamsApp",teamsAppId:ke({microsoftTeamsApp:i},"appId"),cloud:ke({microsoftTeamsApp:i},"cloud"),rawId:ke({microsoftTeamsApp:e},"rawId")}:{kind:"unknown",id:ke({unknown:e},"rawId")}},Me=e=>{const{id:t}=e,n=c(e,["id"]);return Object.assign(Object.assign({},n),{communicationIdentifier:_e(t)})},De=e=>{const{attachmentType:t}=e,n=c(e,["attachmentType"]);if("unknown"===t)throw new Error("'unknown' attachmentType not supported");return Object.assign(Object.assign({},n),{attachmentType:t})},Ne=e=>{const{communicationIdentifier:t}=e,n=c(e,["communicationIdentifier"]);return Object.assign(Object.assign({},n),{id:Pe(t)})},xe=e=>{const{participants:t,attachments:n,initiatorCommunicationIdentifier:r}=e,i=c(e,["participants","attachments","initiatorCommunicationIdentifier"]);let o=Object.assign({},i);if(r){const e=Pe(r);o=Object.assign(Object.assign({},o),{initiator:e})}return t&&(o=Object.assign(Object.assign({},o),{participants:null==t?void 0:t.map(e=>Ne(e))})),n&&(o=Object.assign(Object.assign({},o),{attachments:null==n?void 0:n.map(e=>(e=>{const{attachmentType:t}=e,n=c(e,["attachmentType"]);return Object.assign(Object.assign({},n),{attachmentType:t})})(e))})),o},Ue=e=>{const{state:t}=e;return{result:t}},Le=e=>{const{content:t,senderCommunicationIdentifier:n,policyViolation:r}=e,i=c(e,["content","senderCommunicationIdentifier","policyViolation"]);let o=Object.assign({},i);if(t&&(o=Object.assign(Object.assign({},o),{content:xe(t)})),n){const e=Pe(n);o=Object.assign(Object.assign({},o),{sender:e})}return r&&(o=Object.assign(Object.assign({},o),{policyViolation:Ue(r)})),o},qe=e=>{if("threadCreationDate"===e.kind)return e;if("none"===e.kind)return e;throw new Error(`Retention Policy ${e.kind} is not supported`)},je=e=>{const{createdByCommunicationIdentifier:t,retentionPolicy:n}=e,r=c(e,["createdByCommunicationIdentifier","retentionPolicy"]);let i=Object.assign({},r);return t&&(i=Object.assign(Object.assign({},i),{createdBy:Pe(t)})),n&&(i=Object.assign(Object.assign({},i),{retentionPolicy:qe(n)})),i},Fe=e=>{const{senderCommunicationIdentifier:t}=e,n=c(e,["senderCommunicationIdentifier"]);return Object.assign(Object.assign({},n),{sender:Pe(t)})};var Be,Ge,He;!function(e){e.Unknown="unknown",e.CommunicationUser="communicationUser",e.PhoneNumber="phoneNumber",e.MicrosoftTeamsUser="microsoftTeamsUser",e.MicrosoftTeamsApp="microsoftTeamsApp"}(Be||(Be={})),function(e){e.Public="public",e.Dod="dod",e.Gcch="gcch"}(Ge||(Ge={})),function(e){e.Original="original",e.Small="small"}(He||(He={}));var Ve=r(1219);const ze=(0,r(947).y)({namespace:"Azure.Communication",packageName:"@azure/communication-chat",packageVersion:"1.6.0-beta.4"}),We={type:{name:"Composite",className:"ChatMessageReadReceiptsCollection",modelProperties:{value:{serializedName:"value",required:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatMessageReadReceipt"}}}},nextLink:{serializedName:"nextLink",readOnly:!0,type:{name:"String"}}}}},Ke={type:{name:"Composite",className:"ChatMessageReadReceipt",modelProperties:{senderCommunicationIdentifier:{serializedName:"senderCommunicationIdentifier",type:{name:"Composite",className:"CommunicationIdentifierModel"}},chatMessageId:{serializedName:"chatMessageId",required:!0,type:{name:"String"}},readOn:{serializedName:"readOn",required:!0,type:{name:"DateTime"}}}}},$e={type:{name:"Composite",className:"CommunicationIdentifierModel",modelProperties:{kind:{serializedName:"kind",type:{name:"String"}},rawId:{serializedName:"rawId",type:{name:"String"}},communicationUser:{serializedName:"communicationUser",type:{name:"Composite",className:"CommunicationUserIdentifierModel"}},phoneNumber:{serializedName:"phoneNumber",type:{name:"Composite",className:"PhoneNumberIdentifierModel"}},microsoftTeamsUser:{serializedName:"microsoftTeamsUser",type:{name:"Composite",className:"MicrosoftTeamsUserIdentifierModel"}},microsoftTeamsApp:{serializedName:"microsoftTeamsApp",type:{name:"Composite",className:"MicrosoftTeamsAppIdentifierModel"}}}}},Je={type:{name:"Composite",className:"CommunicationUserIdentifierModel",modelProperties:{id:{serializedName:"id",required:!0,type:{name:"String"}}}}},Xe={type:{name:"Composite",className:"PhoneNumberIdentifierModel",modelProperties:{value:{serializedName:"value",required:!0,type:{name:"String"}}}}},Qe={type:{name:"Composite",className:"MicrosoftTeamsUserIdentifierModel",modelProperties:{userId:{serializedName:"userId",required:!0,type:{name:"String"}},isAnonymous:{serializedName:"isAnonymous",type:{name:"Boolean"}},cloud:{serializedName:"cloud",type:{name:"String"}}}}},Ye={type:{name:"Composite",className:"MicrosoftTeamsAppIdentifierModel",modelProperties:{appId:{serializedName:"appId",required:!0,type:{name:"String"}},cloud:{serializedName:"cloud",type:{name:"String"}}}}},Ze={type:{name:"Composite",className:"CommunicationErrorResponse",modelProperties:{error:{serializedName:"error",type:{name:"Composite",className:"ChatError"}}}}},et={type:{name:"Composite",className:"ChatError",modelProperties:{code:{serializedName:"code",required:!0,type:{name:"String"}},message:{serializedName:"message",required:!0,type:{name:"String"}},target:{serializedName:"target",readOnly:!0,type:{name:"String"}},details:{serializedName:"details",readOnly:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatError"}}}},innerError:{serializedName:"innererror",type:{name:"Composite",className:"ChatError"}}}}},tt={type:{name:"Composite",className:"SendReadReceiptRequest",modelProperties:{chatMessageId:{serializedName:"chatMessageId",required:!0,type:{name:"String"}}}}},nt={type:{name:"Composite",className:"SendChatMessageRequest",modelProperties:{content:{serializedName:"content",required:!0,type:{name:"String"}},senderDisplayName:{serializedName:"senderDisplayName",type:{name:"String"}},type:{serializedName:"type",type:{name:"Enum",allowedValues:["text","html","topicUpdated","participantAdded","participantRemoved"]}},metadata:{serializedName:"metadata",type:{name:"Dictionary",value:{type:{name:"String"}}}},attachments:{serializedName:"attachments",type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatAttachment"}}}}}}},rt={type:{name:"Composite",className:"ChatAttachment",modelProperties:{id:{serializedName:"id",required:!0,type:{name:"String"}},attachmentType:{serializedName:"attachmentType",required:!0,type:{name:"Enum",allowedValues:["image","file"]}},name:{serializedName:"name",type:{name:"String"}},url:{serializedName:"url",type:{name:"String"}},previewUrl:{serializedName:"previewUrl",type:{name:"String"}}}}},it={type:{name:"Composite",className:"SendChatMessageResult",modelProperties:{id:{serializedName:"id",required:!0,type:{name:"String"}}}}},ot={type:{name:"Composite",className:"ChatMessagesCollection",modelProperties:{value:{serializedName:"value",required:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatMessage"}}}},nextLink:{serializedName:"nextLink",readOnly:!0,type:{name:"String"}}}}},st={type:{name:"Composite",className:"ChatMessage",modelProperties:{id:{serializedName:"id",required:!0,type:{name:"String"}},type:{serializedName:"type",required:!0,type:{name:"Enum",allowedValues:["text","html","topicUpdated","participantAdded","participantRemoved"]}},sequenceId:{serializedName:"sequenceId",required:!0,type:{name:"String"}},version:{serializedName:"version",required:!0,type:{name:"String"}},content:{serializedName:"content",type:{name:"Composite",className:"ChatMessageContent"}},senderDisplayName:{serializedName:"senderDisplayName",type:{name:"String"}},createdOn:{serializedName:"createdOn",required:!0,type:{name:"DateTime"}},senderCommunicationIdentifier:{serializedName:"senderCommunicationIdentifier",type:{name:"Composite",className:"CommunicationIdentifierModel"}},deletedOn:{serializedName:"deletedOn",type:{name:"DateTime"}},editedOn:{serializedName:"editedOn",type:{name:"DateTime"}},metadata:{serializedName:"metadata",type:{name:"Dictionary",value:{type:{name:"String"}}}},policyViolation:{serializedName:"policyViolation",type:{name:"Composite",className:"PolicyViolation"}}}}},at={type:{name:"Composite",className:"ChatMessageContent",modelProperties:{message:{serializedName:"message",type:{name:"String"}},topic:{serializedName:"topic",type:{name:"String"}},participants:{serializedName:"participants",type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatParticipant"}}}},attachments:{serializedName:"attachments",type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatAttachment"}}}},initiatorCommunicationIdentifier:{serializedName:"initiatorCommunicationIdentifier",type:{name:"Composite",className:"CommunicationIdentifierModel"}}}}},ct={type:{name:"Composite",className:"ChatParticipant",modelProperties:{communicationIdentifier:{serializedName:"communicationIdentifier",type:{name:"Composite",className:"CommunicationIdentifierModel"}},displayName:{serializedName:"displayName",type:{name:"String"}},shareHistoryTime:{serializedName:"shareHistoryTime",type:{name:"DateTime"}},metadata:{serializedName:"metadata",type:{name:"Dictionary",value:{type:{name:"String"}}}}}}},ut={type:{name:"Composite",className:"PolicyViolation",modelProperties:{state:{serializedName:"state",required:!0,type:{name:"Enum",allowedValues:["contentBlocked","warning"]}}}}},lt={type:{name:"Composite",className:"UpdateChatMessageRequest",modelProperties:{content:{serializedName:"content",type:{name:"String"}},metadata:{serializedName:"metadata",type:{name:"Dictionary",value:{type:{name:"String"}}}},attachments:{serializedName:"attachments",type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatAttachment"}}}}}}},dt={type:{name:"Composite",className:"ChatParticipantsCollection",modelProperties:{value:{serializedName:"value",required:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatParticipant"}}}},nextLink:{serializedName:"nextLink",readOnly:!0,type:{name:"String"}}}}},ht={type:{name:"Composite",className:"AddChatParticipantsRequest",modelProperties:{participants:{serializedName:"participants",required:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatParticipant"}}}}}}},pt={type:{name:"Composite",className:"AddChatParticipantsResult",modelProperties:{invalidParticipants:{serializedName:"invalidParticipants",readOnly:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatError"}}}}}}},ft={type:{name:"Composite",className:"CreateChatThreadRequest",modelProperties:{topic:{serializedName:"topic",required:!0,type:{name:"String"}},participants:{serializedName:"participants",type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatParticipant"}}}},metadata:{serializedName:"metadata",type:{name:"Dictionary",value:{type:{name:"String"}}}},retentionPolicy:{serializedName:"retentionPolicy",type:{name:"Composite",className:"ChatRetentionPolicy"}}}}},gt={type:{name:"Composite",className:"ChatRetentionPolicy",uberParent:"ChatRetentionPolicy",polymorphicDiscriminator:{serializedName:"kind",clientName:"kind"},modelProperties:{kind:{serializedName:"kind",required:!0,type:{name:"Enum",allowedValues:["threadCreationDate","none"]}}}}},mt={type:{name:"Composite",className:"CreateChatThreadResult",modelProperties:{chatThread:{serializedName:"chatThread",type:{name:"Composite",className:"ChatThreadProperties"}},invalidParticipants:{serializedName:"invalidParticipants",readOnly:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatError"}}}}}}},vt={type:{name:"Composite",className:"ChatThreadProperties",modelProperties:{id:{serializedName:"id",required:!0,type:{name:"String"}},topic:{serializedName:"topic",required:!0,type:{name:"String"}},createdOn:{serializedName:"createdOn",required:!0,type:{name:"DateTime"}},createdByCommunicationIdentifier:{serializedName:"createdByCommunicationIdentifier",type:{name:"Composite",className:"CommunicationIdentifierModel"}},deletedOn:{serializedName:"deletedOn",type:{name:"DateTime"}},metadata:{serializedName:"metadata",type:{name:"Dictionary",value:{type:{name:"String"}}}},retentionPolicy:{serializedName:"retentionPolicy",type:{name:"Composite",className:"ChatRetentionPolicy"}},messagingPolicy:{serializedName:"messagingPolicy",type:{name:"Composite",className:"MessagingPolicy"}}}}},yt={type:{name:"Composite",className:"MessagingPolicy",modelProperties:{textOnlyChat:{serializedName:"textOnlyChat",type:{name:"Boolean"}}}}},Ct={type:{name:"Composite",className:"ChatThreadsItemCollection",modelProperties:{value:{serializedName:"value",required:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatThreadItem"}}}},nextLink:{serializedName:"nextLink",readOnly:!0,type:{name:"String"}}}}},St={type:{name:"Composite",className:"ChatThreadItem",modelProperties:{id:{serializedName:"id",required:!0,type:{name:"String"}},topic:{serializedName:"topic",required:!0,type:{name:"String"}},deletedOn:{serializedName:"deletedOn",type:{name:"DateTime"}},lastMessageReceivedOn:{serializedName:"lastMessageReceivedOn",readOnly:!0,type:{name:"DateTime"}}}}},Tt={type:{name:"Composite",className:"UpdateChatThreadRequest",modelProperties:{topic:{serializedName:"topic",type:{name:"String"}},metadata:{serializedName:"metadata",type:{name:"Dictionary",value:{type:{name:"String"}}}},retentionPolicy:{serializedName:"retentionPolicy",type:{name:"Composite",className:"ChatRetentionPolicy"}}}}},Et={type:{name:"Composite",className:"SendTypingNotificationRequest",modelProperties:{senderDisplayName:{serializedName:"senderDisplayName",type:{name:"String"}}}}},bt={type:{name:"Composite",className:"UploadChatImageResult",modelProperties:{id:{serializedName:"id",required:!0,type:{name:"String"}},attachmentType:{serializedName:"attachmentType",type:{name:"Enum",allowedValues:["image","file"]}},name:{serializedName:"name",type:{name:"String"}}}}},It={type:{name:"Composite",className:"ErrorResponse",modelProperties:{error:{serializedName:"error",type:{name:"Composite",className:"ErrorModel"}}}}},wt={type:{name:"Composite",className:"ErrorModel",modelProperties:{code:{serializedName:"code",required:!0,type:{name:"String"}},message:{serializedName:"message",required:!0,type:{name:"String"}},details:{serializedName:"details",type:{name:"Sequence",element:{type:{name:"Composite",className:"ErrorDetail"}}}}}}},Rt={type:{name:"Composite",className:"ErrorDetail",modelProperties:{code:{serializedName:"code",required:!0,type:{name:"String"}},message:{serializedName:"message",required:!0,type:{name:"String"}}}}},At={serializedName:"threadCreationDate",type:{name:"Composite",className:"ThreadCreationDateRetentionPolicy",uberParent:"ChatRetentionPolicy",polymorphicDiscriminator:gt.type.polymorphicDiscriminator,modelProperties:Object.assign(Object.assign({},gt.type.modelProperties),{deleteThreadAfterDays:{serializedName:"deleteThreadAfterDays",required:!0,type:{name:"Number"}}})}},Ot={serializedName:"none",type:{name:"Composite",className:"NoneRetentionPolicy",uberParent:"ChatRetentionPolicy",polymorphicDiscriminator:gt.type.polymorphicDiscriminator,modelProperties:Object.assign({},gt.type.modelProperties)}};let kt={ChatRetentionPolicy:gt,"ChatRetentionPolicy.threadCreationDate":At,"ChatRetentionPolicy.none":Ot};const _t={parameterPath:"accept",mapper:{defaultValue:"application/json",isConstant:!0,serializedName:"Accept",type:{name:"String"}}},Pt={parameterPath:"endpoint",mapper:{serializedName:"endpoint",required:!0,type:{name:"String"}},skipEncoding:!0},Mt={parameterPath:"chatThreadId",mapper:{serializedName:"chatThreadId",required:!0,type:{name:"String"}}},Dt={parameterPath:["options","maxPageSize"],mapper:{serializedName:"maxPageSize",type:{name:"Number"}}},Nt={parameterPath:["options","skip"],mapper:{serializedName:"skip",type:{name:"Number"}}},xt={parameterPath:"apiVersion",mapper:{defaultValue:"2024-06-05-preview",isConstant:!0,serializedName:"api-version",type:{name:"String"}}},Ut={parameterPath:["options","contentType"],mapper:{defaultValue:"application/json",isConstant:!0,serializedName:"Content-Type",type:{name:"String"}}},Lt={parameterPath:"sendReadReceiptRequest",mapper:tt},qt={parameterPath:"sendChatMessageRequest",mapper:nt},jt={parameterPath:["options","startTime"],mapper:{serializedName:"startTime",type:{name:"DateTime"}}},Ft={parameterPath:"chatMessageId",mapper:{serializedName:"chatMessageId",required:!0,type:{name:"String"}}},Bt={parameterPath:["options","contentType"],mapper:{defaultValue:"application/merge-patch+json",isConstant:!0,serializedName:"Content-Type",type:{name:"String"}}},Gt={parameterPath:"updateChatMessageRequest",mapper:lt},Ht={parameterPath:"participantCommunicationIdentifier",mapper:$e},Vt={parameterPath:"addChatParticipantsRequest",mapper:ht},zt={parameterPath:"updateChatThreadRequest",mapper:Tt},Wt={parameterPath:["options","sendTypingNotificationRequest"],mapper:Et},Kt={parameterPath:"imageId",mapper:{serializedName:"imageId",required:!0,type:{name:"String"}}},$t={parameterPath:"nextLink",mapper:{serializedName:"nextLink",required:!0,type:{name:"String"}},skipEncoding:!0},Jt={parameterPath:"createChatThreadRequest",mapper:ft};class Xt{constructor(e){this.client=e}async listChatReadReceipts(e,t){return ze.withSpan("ChatApiClient.listChatReadReceipts",null!=t?t:{},async t=>this.client.sendOperationRequest({chatThreadId:e,options:t},Yt))}async sendChatReadReceipt(e,t,n){return ze.withSpan("ChatApiClient.sendChatReadReceipt",null!=n?n:{},async n=>this.client.sendOperationRequest({chatThreadId:e,sendReadReceiptRequest:t,options:n},Zt))}async sendChatMessage(e,t,n){return ze.withSpan("ChatApiClient.sendChatMessage",null!=n?n:{},async n=>this.client.sendOperationRequest({chatThreadId:e,sendChatMessageRequest:t,options:n},en))}async listChatMessages(e,t){return ze.withSpan("ChatApiClient.listChatMessages",null!=t?t:{},async t=>this.client.sendOperationRequest({chatThreadId:e,options:t},tn))}async getChatMessage(e,t,n){return ze.withSpan("ChatApiClient.getChatMessage",null!=n?n:{},async n=>this.client.sendOperationRequest({chatThreadId:e,chatMessageId:t,options:n},nn))}async updateChatMessage(e,t,n,r){return ze.withSpan("ChatApiClient.updateChatMessage",null!=r?r:{},async r=>this.client.sendOperationRequest({chatThreadId:e,chatMessageId:t,updateChatMessageRequest:n,options:r},rn))}async deleteChatMessage(e,t,n){return ze.withSpan("ChatApiClient.deleteChatMessage",null!=n?n:{},async n=>this.client.sendOperationRequest({chatThreadId:e,chatMessageId:t,options:n},on))}async listChatParticipants(e,t){return ze.withSpan("ChatApiClient.listChatParticipants",null!=t?t:{},async t=>this.client.sendOperationRequest({chatThreadId:e,options:t},sn))}async removeChatParticipant(e,t,n){return ze.withSpan("ChatApiClient.removeChatParticipant",null!=n?n:{},async n=>this.client.sendOperationRequest({chatThreadId:e,participantCommunicationIdentifier:t,options:n},an))}async addChatParticipants(e,t,n){return ze.withSpan("ChatApiClient.addChatParticipants",null!=n?n:{},async n=>this.client.sendOperationRequest({chatThreadId:e,addChatParticipantsRequest:t,options:n},cn))}async updateChatThreadProperties(e,t,n){return ze.withSpan("ChatApiClient.updateChatThreadProperties",null!=n?n:{},async n=>this.client.sendOperationRequest({chatThreadId:e,updateChatThreadRequest:t,options:n},un))}async getChatThreadProperties(e,t){return ze.withSpan("ChatApiClient.getChatThreadProperties",null!=t?t:{},async t=>this.client.sendOperationRequest({chatThreadId:e,options:t},ln))}async sendTypingNotification(e,t){return ze.withSpan("ChatApiClient.sendTypingNotification",null!=t?t:{},async t=>this.client.sendOperationRequest({chatThreadId:e,options:t},dn))}async uploadChatImage(e,t,n){return ze.withSpan("ChatApiClient.uploadChatImage",null!=n?n:{},async n=>this.client.sendOperationRequest({chatThreadId:e,chatImageFile:t,options:n},hn))}async getChatImage(e,t,n,r){return ze.withSpan("ChatApiClient.getChatImage",null!=r?r:{},async r=>this.client.sendOperationRequest({chatThreadId:e,imageId:t,imageViewType:n,options:r},pn))}async deleteChatImage(e,t,n){return ze.withSpan("ChatApiClient.deleteChatImage",null!=n?n:{},async n=>this.client.sendOperationRequest({chatThreadId:e,imageId:t,options:n},fn))}async listChatReadReceiptsNext(e,t,n){return ze.withSpan("ChatApiClient.listChatReadReceiptsNext",null!=n?n:{},async n=>this.client.sendOperationRequest({chatThreadId:e,nextLink:t,options:n},gn))}async listChatMessagesNext(e,t,n){return ze.withSpan("ChatApiClient.listChatMessagesNext",null!=n?n:{},async n=>this.client.sendOperationRequest({chatThreadId:e,nextLink:t,options:n},mn))}async listChatParticipantsNext(e,t,n){return ze.withSpan("ChatApiClient.listChatParticipantsNext",null!=n?n:{},async n=>this.client.sendOperationRequest({chatThreadId:e,nextLink:t,options:n},vn))}}const Qt=Ve.createSerializer(t,!1),Yt={path:"/chat/threads/{chatThreadId}/readReceipts",httpMethod:"GET",responses:{200:{bodyMapper:We},401:{bodyMapper:Ze,isError:!0},403:{bodyMapper:Ze,isError:!0},429:{bodyMapper:Ze,isError:!0},503:{bodyMapper:Ze,isError:!0}},queryParameters:[Dt,Nt,xt],urlParameters:[Pt,Mt],headerParameters:[_t],serializer:Qt},Zt={path:"/chat/threads/{chatThreadId}/readReceipts",httpMethod:"POST",responses:{200:{},401:{bodyMapper:Ze,isError:!0},403:{bodyMapper:Ze,isError:!0},429:{bodyMapper:Ze,isError:!0},503:{bodyMapper:Ze,isError:!0}},requestBody:Lt,queryParameters:[xt],urlParameters:[Pt,Mt],headerParameters:[_t,Ut],mediaType:"json",serializer:Qt},en={path:"/chat/threads/{chatThreadId}/messages",httpMethod:"POST",responses:{201:{bodyMapper:it},401:{bodyMapper:Ze,isError:!0},403:{bodyMapper:Ze,isError:!0},429:{bodyMapper:Ze,isError:!0},503:{bodyMapper:Ze,isError:!0}},requestBody:qt,queryParameters:[xt],urlParameters:[Pt,Mt],headerParameters:[_t,Ut],mediaType:"json",serializer:Qt},tn={path:"/chat/threads/{chatThreadId}/messages",httpMethod:"GET",responses:{200:{bodyMapper:ot},401:{bodyMapper:Ze,isError:!0},403:{bodyMapper:Ze,isError:!0},429:{bodyMapper:Ze,isError:!0},503:{bodyMapper:Ze,isError:!0}},queryParameters:[Dt,xt,jt],urlParameters:[Pt,Mt],headerParameters:[_t],serializer:Qt},nn={path:"/chat/threads/{chatThreadId}/messages/{chatMessageId}",httpMethod:"GET",responses:{200:{bodyMapper:st},401:{bodyMapper:Ze,isError:!0},403:{bodyMapper:Ze,isError:!0},429:{bodyMapper:Ze,isError:!0},503:{bodyMapper:Ze,isError:!0}},queryParameters:[xt],urlParameters:[Pt,Mt,Ft],headerParameters:[_t],serializer:Qt},rn={path:"/chat/threads/{chatThreadId}/messages/{chatMessageId}",httpMethod:"PATCH",responses:{204:{},401:{bodyMapper:Ze,isError:!0},403:{bodyMapper:Ze,isError:!0},429:{bodyMapper:Ze,isError:!0},503:{bodyMapper:Ze,isError:!0}},requestBody:Gt,queryParameters:[xt],urlParameters:[Pt,Mt,Ft],headerParameters:[_t,Bt],mediaType:"json",serializer:Qt},on={path:"/chat/threads/{chatThreadId}/messages/{chatMessageId}",httpMethod:"DELETE",responses:{204:{},401:{bodyMapper:Ze,isError:!0},403:{bodyMapper:Ze,isError:!0},429:{bodyMapper:Ze,isError:!0},503:{bodyMapper:Ze,isError:!0}},queryParameters:[xt],urlParameters:[Pt,Mt,Ft],headerParameters:[_t],serializer:Qt},sn={path:"/chat/threads/{chatThreadId}/participants",httpMethod:"GET",responses:{200:{bodyMapper:dt},401:{bodyMapper:Ze,isError:!0},403:{bodyMapper:Ze,isError:!0},429:{bodyMapper:Ze,isError:!0},503:{bodyMapper:Ze,isError:!0}},queryParameters:[Dt,Nt,xt],urlParameters:[Pt,Mt],headerParameters:[_t],serializer:Qt},an={path:"/chat/threads/{chatThreadId}/participants/:remove",httpMethod:"POST",responses:{204:{},401:{bodyMapper:Ze,isError:!0},403:{bodyMapper:Ze,isError:!0},429:{bodyMapper:Ze,isError:!0},503:{bodyMapper:Ze,isError:!0}},requestBody:Ht,queryParameters:[xt],urlParameters:[Pt,Mt],headerParameters:[_t,Ut],mediaType:"json",serializer:Qt},cn={path:"/chat/threads/{chatThreadId}/participants/:add",httpMethod:"POST",responses:{201:{bodyMapper:pt},401:{bodyMapper:Ze,isError:!0},403:{bodyMapper:Ze,isError:!0},429:{bodyMapper:Ze,isError:!0},503:{bodyMapper:Ze,isError:!0}},requestBody:Vt,queryParameters:[xt],urlParameters:[Pt,Mt],headerParameters:[_t,Ut],mediaType:"json",serializer:Qt},un={path:"/chat/threads/{chatThreadId}",httpMethod:"PATCH",responses:{204:{},401:{bodyMapper:Ze,isError:!0},403:{bodyMapper:Ze,isError:!0},429:{bodyMapper:Ze,isError:!0},503:{bodyMapper:Ze,isError:!0}},requestBody:zt,queryParameters:[xt],urlParameters:[Pt,Mt],headerParameters:[_t,Bt],mediaType:"json",serializer:Qt},ln={path:"/chat/threads/{chatThreadId}",httpMethod:"GET",responses:{200:{bodyMapper:vt},401:{bodyMapper:Ze,isError:!0},403:{bodyMapper:Ze,isError:!0},429:{bodyMapper:Ze,isError:!0},503:{bodyMapper:Ze,isError:!0}},queryParameters:[xt],urlParameters:[Pt,Mt],headerParameters:[_t],serializer:Qt},dn={path:"/chat/threads/{chatThreadId}/typing",httpMethod:"POST",responses:{200:{},401:{bodyMapper:Ze,isError:!0},403:{bodyMapper:Ze,isError:!0},429:{bodyMapper:Ze,isError:!0},503:{bodyMapper:Ze,isError:!0}},requestBody:Wt,queryParameters:[xt],urlParameters:[Pt,Mt],headerParameters:[_t,Ut],mediaType:"json",serializer:Qt},hn={path:"/chat/threads/{chatThreadId}/images",httpMethod:"POST",responses:{201:{bodyMapper:bt},default:{bodyMapper:It}},requestBody:{parameterPath:"chatImageFile",mapper:{serializedName:"chatImageFile",required:!0,type:{name:"Stream"}}},queryParameters:[xt],urlParameters:[Pt,Mt],headerParameters:[{parameterPath:["options","contentType"],mapper:{defaultValue:"application/octet-stream",isConstant:!0,serializedName:"Content-Type",type:{name:"String"}}},{parameterPath:"accept",mapper:{defaultValue:"application/json",isConstant:!0,serializedName:"Accept",type:{name:"String"}}},{parameterPath:["options","imageFilename"],mapper:{serializedName:"image-filename",type:{name:"String"}}}],mediaType:"binary",serializer:Qt},pn={path:"/chat/threads/{chatThreadId}/images/{imageId}/view/{imageViewType}",httpMethod:"GET",responses:{200:{bodyMapper:{type:{name:"Stream"},serializedName:"parsedResponse"}},default:{bodyMapper:It}},queryParameters:[xt],urlParameters:[Pt,Mt,Kt,{parameterPath:"imageViewType",mapper:{serializedName:"imageViewType",required:!0,type:{name:"String"}}}],headerParameters:[{parameterPath:"accept",mapper:{defaultValue:"application/json, image/gif, image/jpeg, image/png, image/bmp, image/tiff",isConstant:!0,serializedName:"Accept",type:{name:"String"}}}],serializer:Qt},fn={path:"/chat/threads/{chatThreadId}/images/{imageId}",httpMethod:"DELETE",responses:{204:{},default:{bodyMapper:It}},queryParameters:[xt],urlParameters:[Pt,Mt,Kt],headerParameters:[_t],serializer:Qt},gn={path:"{nextLink}",httpMethod:"GET",responses:{200:{bodyMapper:We},401:{bodyMapper:Ze,isError:!0},403:{bodyMapper:Ze,isError:!0},429:{bodyMapper:Ze,isError:!0},503:{bodyMapper:Ze,isError:!0}},urlParameters:[Pt,Mt,$t],headerParameters:[_t],serializer:Qt},mn={path:"{nextLink}",httpMethod:"GET",responses:{200:{bodyMapper:ot},401:{bodyMapper:Ze,isError:!0},403:{bodyMapper:Ze,isError:!0},429:{bodyMapper:Ze,isError:!0},503:{bodyMapper:Ze,isError:!0}},urlParameters:[Pt,Mt,$t],headerParameters:[_t],serializer:Qt},vn={path:"{nextLink}",httpMethod:"GET",responses:{200:{bodyMapper:dt},401:{bodyMapper:Ze,isError:!0},403:{bodyMapper:Ze,isError:!0},429:{bodyMapper:Ze,isError:!0},503:{bodyMapper:Ze,isError:!0}},urlParameters:[Pt,Mt,$t],headerParameters:[_t],serializer:Qt};class yn{constructor(e){this.client=e}async createChatThread(e,t){return ze.withSpan("ChatApiClient.createChatThread",null!=t?t:{},async t=>this.client.sendOperationRequest({createChatThreadRequest:e,options:t},Sn))}async listChatThreads(e){return ze.withSpan("ChatApiClient.listChatThreads",null!=e?e:{},async e=>this.client.sendOperationRequest({options:e},Tn))}async deleteChatThread(e,t){return ze.withSpan("ChatApiClient.deleteChatThread",null!=t?t:{},async t=>this.client.sendOperationRequest({chatThreadId:e,options:t},En))}async listChatThreadsNext(e,t){return ze.withSpan("ChatApiClient.listChatThreadsNext",null!=t?t:{},async t=>this.client.sendOperationRequest({nextLink:e,options:t},bn))}}const Cn=Ve.createSerializer(t,!1),Sn={path:"/chat/threads",httpMethod:"POST",responses:{201:{bodyMapper:mt},401:{bodyMapper:Ze,isError:!0},403:{bodyMapper:Ze,isError:!0},429:{bodyMapper:Ze,isError:!0},503:{bodyMapper:Ze,isError:!0}},requestBody:Jt,queryParameters:[xt],urlParameters:[Pt],headerParameters:[_t,Ut,{parameterPath:["options","repeatabilityRequestId"],mapper:{serializedName:"repeatability-request-id",type:{name:"String"}}}],mediaType:"json",serializer:Cn},Tn={path:"/chat/threads",httpMethod:"GET",responses:{200:{bodyMapper:Ct},401:{bodyMapper:Ze,isError:!0},403:{bodyMapper:Ze,isError:!0},429:{bodyMapper:Ze,isError:!0},503:{bodyMapper:Ze,isError:!0}},queryParameters:[Dt,xt,jt],urlParameters:[Pt],headerParameters:[_t],serializer:Cn},En={path:"/chat/threads/{chatThreadId}",httpMethod:"DELETE",responses:{204:{},401:{bodyMapper:Ze,isError:!0},403:{bodyMapper:Ze,isError:!0},429:{bodyMapper:Ze,isError:!0},503:{bodyMapper:Ze,isError:!0}},queryParameters:[xt],urlParameters:[Pt,Mt],headerParameters:[_t],serializer:Cn},bn={path:"{nextLink}",httpMethod:"GET",responses:{200:{bodyMapper:Ct},401:{bodyMapper:Ze,isError:!0},403:{bodyMapper:Ze,isError:!0},429:{bodyMapper:Ze,isError:!0},503:{bodyMapper:Ze,isError:!0}},urlParameters:[Pt,$t],headerParameters:[_t],serializer:Cn};class In extends Ve.ServiceClient{constructor(e,t){var n,r;if(void 0===e)throw new Error("'endpoint' cannot be null");t||(t={});const i="azsdk-js-communication-chat/1.6.0-beta.4",o=t.userAgentOptions&&t.userAgentOptions.userAgentPrefix?`${t.userAgentOptions.userAgentPrefix} ${i}`:`${i}`;super(Object.assign(Object.assign(Object.assign({},{requestContentType:"application/json; charset=utf-8"}),t),{userAgentOptions:{userAgentPrefix:o},endpoint:null!==(r=null!==(n=t.endpoint)&&void 0!==n?n:t.baseUri)&&void 0!==r?r:"{endpoint}"})),this.endpoint=e,this.apiVersion=t.apiVersion||"2024-06-05-preview",this.chatThread=new Xt(this),this.chat=new yn(this),this.addCustomApiVersionPolicy(t.apiVersion)}addCustomApiVersionPolicy(e){if(!e)return;const t={name:"CustomApiVersionPolicy",async sendRequest(t,n){const r=t.url.split("?");if(r.length>1){const n=r[1].split("&").map(t=>t.indexOf("api-version")>-1?"api-version="+e:t);t.url=r[0]+"?"+n.join("&")}return n(t)}};this.pipeline.addPolicy(t)}}const wn=(0,r(3526).KV)("communication-chat");class Rn extends Error{constructor(e){super(e),this.name="AbortError"}}var An=r(5923);function On(e){return Boolean(e&&"function"==typeof e.getReader&&"function"==typeof e.tee)}class kn{async sendRequest(e){var t;if("https:"!==new URL(e.url).protocol&&!e.allowInsecureConnection)throw new Error(`Cannot connect to ${e.url} while allowInsecureConnection is false.`);const n=new XMLHttpRequest;if(e.proxySettings)throw new Error("HTTP proxy is not supported in browser environment");const r=e.abortSignal;if(r){if(r.aborted)throw new Rn("The operation was aborted.");const e=()=>{n.abort()};r.addEventListener("abort",e),n.addEventListener("readystatechange",()=>{n.readyState===XMLHttpRequest.DONE&&r.removeEventListener("abort",e)})}_n(n.upload,e.onUploadProgress),_n(n,e.onDownloadProgress),n.open(e.method,e.url),n.timeout=e.timeout,n.withCredentials=e.withCredentials;for(const[t,r]of e.headers)n.setRequestHeader(t,r);n.responseType=(null===(t=e.streamResponseStatusCodes)||void 0===t?void 0:t.size)?"blob":"text";const i="function"==typeof e.body?e.body():e.body;if(function(e){return e&&"function"==typeof e.pipe}(i)||On(i))throw new Error("Streams are not supported by xhrHttpClient.");return n.send(void 0===i?null:i),"blob"===n.responseType?new Promise((t,r)=>{!function(e,t,n,r){e.addEventListener("readystatechange",()=>{var i,o;if(e.readyState===XMLHttpRequest.HEADERS_RECEIVED)if((null===(i=t.streamResponseStatusCodes)||void 0===i?void 0:i.has(Number.POSITIVE_INFINITY))||(null===(o=t.streamResponseStatusCodes)||void 0===o?void 0:o.has(e.status))){const r=new Promise((n,r)=>{e.addEventListener("load",()=>{n(e.response)}),Mn(t,e,r)});n({request:t,status:e.status,headers:Pn(e),blobBody:r})}else e.addEventListener("load",()=>{e.response?e.response.text().then(r=>{n({request:t,status:e.status,headers:Pn(e),bodyAsText:r})}).catch(e=>{r(e)}):n({request:t,status:e.status,headers:Pn(e)})})})}(n,e,t,r),Mn(e,n,r)}):new Promise(function(t,r){n.addEventListener("load",()=>t({request:e,status:n.status,headers:Pn(n),bodyAsText:n.responseText})),Mn(e,n,r)})}}function _n(e,t){t&&e.addEventListener("progress",e=>t({loadedBytes:e.loaded}))}function Pn(e){const t=(0,An.createHttpHeaders)(),n=e.getAllResponseHeaders().trim().split(/[\r\n]+/);for(const e of n){const n=e.indexOf(":"),r=e.slice(0,n),i=e.slice(n+2);t.set(r,i)}return t}function Mn(e,t,n){t.addEventListener("error",()=>n(new An.RestError(`Failed to send request to ${e.url}`,{code:An.RestError.REQUEST_SEND_ERROR,request:e})));const r=new Rn("The operation was aborted.");t.addEventListener("abort",()=>n(r)),t.addEventListener("timeout",()=>n(r))}const Dn=e=>{const t={credential:{getToken:(t,n)=>e.getToken({abortSignal:null==n?void 0:n.abortSignal})},scopes:[]};return(0,An.bearerTokenAuthenticationPolicy)(t)};class Nn{constructor(e,t,n,r={}){this.endpoint=e,this.timeOfLastTypingRequest=void 0,this.threadId=t,this.tokenCredential=n;const i=Object.assign(Object.assign({},r),{loggingOptions:{logger:wn.info}});this.client=new In(this.endpoint,Object.assign({endpoint:this.endpoint},i));const o=Dn(this.tokenCredential);this.client.pipeline.addPolicy(o),"undefined"!=typeof XMLHttpRequest&&(this.xhrClient=new In(this.endpoint,Object.assign(Object.assign({endpoint:this.endpoint},i),{httpClient:new kn})),this.xhrClient.pipeline.addPolicy(o))}getProperties(e={}){return ze.withSpan("ChatClient-GetProperties",e,async e=>{const t=await this.client.chatThread.getChatThreadProperties(this.threadId,e);return je(t)})}updateTopic(e,t={}){return ze.withSpan("ChatThreadClient-UpdateTopic",t,async t=>{await this.client.chatThread.updateChatThreadProperties(this.threadId,{topic:e},t)})}updateProperties(e={}){return ze.withSpan("ChatThreadClient-UpdateProperties",e,async t=>{await this.client.chatThread.updateChatThreadProperties(this.threadId,e,t)})}sendMessage(e,t={}){return ze.withSpan("ChatThreadClient-SendMessage",t,async n=>{this.timeOfLastTypingRequest=void 0;const r=await this.client.chatThread.sendChatMessage(this.threadId,((e,t)=>{const{attachments:n}=t,r=c(t,["attachments"]);let i=Object.assign(Object.assign({},e),r);return n&&(i=Object.assign(Object.assign({},i),{attachments:null==n?void 0:n.map(e=>De(e))})),i})(e,t),n);return r})}getMessage(e,t={}){return ze.withSpan("ChatThreadClient-GetMessage",t,async t=>{const n=await this.client.chatThread.getChatMessage(this.threadId,e,t);return Le(n)})}listMessagesPage(e){return d(this,arguments,function*(e,t={}){if(!e.continuationToken){const n=yield l(this.client.chatThread.listChatMessages(this.threadId,t));e.continuationToken=n.nextLink,n.value&&(yield yield l(n.value.map(Le,this)))}for(;e.continuationToken;){const n=yield l(this.client.chatThread.listChatMessagesNext(this.threadId,e.continuationToken,t));if(e.continuationToken=n.nextLink,!n.value)break;yield yield l(n.value.map(Le,this))}})}listMessagesAll(e){return d(this,arguments,function*(){var t,n,r,i;try{for(var o,s=!0,a=p(this.listMessagesPage({},e));!(t=(o=yield l(a.next())).done);s=!0){i=o.value,s=!1;const e=i;yield l(yield*h(p(e)))}}catch(e){n={error:e}}finally{try{s||t||!(r=a.return)||(yield l(r.call(a)))}finally{if(n)throw n.error}}})}listMessages(e={}){const{span:t,updatedOptions:n}=ze.startSpan("ChatThreadClient-ListMessages",e);try{const e=this.listMessagesAll(n);return{next:()=>e.next(),[Symbol.asyncIterator](){return this},byPage:(e={})=>this.listMessagesPage(e,n)}}catch(e){throw t.setStatus({status:"error",error:e}),e}finally{t.end()}}deleteMessage(e,t={}){return ze.withSpan("ChatThreadClient-DeleteMessage",t,async t=>{await this.client.chatThread.deleteChatMessage(this.threadId,e,t)})}async updateMessage(e,t={}){return ze.withSpan("ChatThreadClient-UpdateMessage",t,async n=>{await this.client.chatThread.updateChatMessage(this.threadId,e,(e=>{const{attachments:t}=e,n=c(e,["attachments"]);let r=Object.assign({},n);return t&&(r=Object.assign(Object.assign({},r),{attachments:null==t?void 0:t.map(e=>De(e))})),r})(t),n)})}async addParticipants(e,t={}){return ze.withSpan("ChatThreadClient-AddParticipants",t,async t=>{var n,r;return await this.client.chatThread.addChatParticipants(this.threadId,(n=e,{participants:null===(r=n.participants)||void 0===r?void 0:r.map(e=>Me(e))}),t)})}listParticipantsPage(e){return d(this,arguments,function*(e,t={}){if(!e.continuationToken){const n=yield l(this.client.chatThread.listChatParticipants(this.threadId,t));e.continuationToken=n.nextLink,n.value&&(yield yield l(n.value.map(Ne,this)))}for(;e.continuationToken;){const n=yield l(this.client.chatThread.listChatParticipantsNext(this.threadId,e.continuationToken,t));if(e.continuationToken=n.nextLink,!n.value)break;yield yield l(n.value.map(Ne,this))}})}listParticipantsAll(e){return d(this,arguments,function*(){var t,n,r,i;try{for(var o,s=!0,a=p(this.listParticipantsPage({},e));!(t=(o=yield l(a.next())).done);s=!0){i=o.value,s=!1;const e=i;yield l(yield*h(p(e)))}}catch(e){n={error:e}}finally{try{s||t||!(r=a.return)||(yield l(r.call(a)))}finally{if(n)throw n.error}}})}listParticipants(e={}){const{span:t,updatedOptions:n}=ze.startSpan("ChatThreadClient-ListParticipants",e);try{const e=this.listParticipantsAll(n);return{next:()=>e.next(),[Symbol.asyncIterator](){return this},byPage:(e={})=>this.listParticipantsPage(e,n)}}catch(e){throw t.setStatus({status:"error",error:e}),e}finally{t.end()}}async removeParticipant(e,t={}){return ze.withSpan("ChatThreadClient-RemoveParticipant",t,async t=>{await this.client.chatThread.removeChatParticipant(this.threadId,_e(e),t)})}async sendTypingNotification(e={}){return ze.withSpan("ChatThreadClient-SendTypingNotification",e,async e=>{const t=new Date,{senderDisplayName:n}=e,r=c(e,["senderDisplayName"]);return this.canPostTypingNotification(t)?(this.timeOfLastTypingRequest=t,await this.client.chatThread.sendTypingNotification(this.threadId,Object.assign({sendTypingNotificationRequest:{senderDisplayName:n}},r)),!0):(wn.info(`Typing Notification NOT Send. [thread_id=${this.threadId}]`),!1)})}async sendReadReceipt(e,t={}){return ze.withSpan("ChatThreadClient-SendReadReceipt",t,async t=>{await this.client.chatThread.sendChatReadReceipt(this.threadId,e,t)})}listReadReceiptsPage(e){return d(this,arguments,function*(e,t={}){if(!e.continuationToken){const n=yield l(this.client.chatThread.listChatReadReceipts(this.threadId,t));e.continuationToken=n.nextLink,n.value&&(yield yield l(n.value.map(Fe,this)))}for(;e.continuationToken;){const n=yield l(this.client.chatThread.listChatReadReceiptsNext(this.threadId,e.continuationToken,t));if(e.continuationToken=n.nextLink,!n.value)break;yield yield l(n.value.map(Fe,this))}})}listReadReceiptsAll(e){return d(this,arguments,function*(){var t,n,r,i;try{for(var o,s=!0,a=p(this.listReadReceiptsPage({},e));!(t=(o=yield l(a.next())).done);s=!0){i=o.value,s=!1;const e=i;yield l(yield*h(p(e)))}}catch(e){n={error:e}}finally{try{s||t||!(r=a.return)||(yield l(r.call(a)))}finally{if(n)throw n.error}}})}listReadReceipts(e={}){const{span:t,updatedOptions:n}=ze.startSpan("ChatThreadClient-ListChatReadReceipts",e);try{const e=this.listReadReceiptsAll(n);return{next:()=>e.next(),[Symbol.asyncIterator](){return this},byPage:(e={})=>this.listReadReceiptsPage(e,n)}}catch(e){throw t.setStatus({status:"error",error:e}),e}finally{t.end()}}canPostTypingNotification(e){return!(this.timeOfLastTypingRequest&&e.getTime()-this.timeOfLastTypingRequest.getTime()<8e3&&(wn.info(`Typing interval check failed. [last_request=${this.timeOfLastTypingRequest}]`),1))}async uploadImage(e,t,n,r={}){let i={};return void 0!==n&&(i="number"==typeof n?Object.assign(Object.assign({},r),{imageBytesLength:n}):Object.assign(Object.assign({},r),n)),ze.withSpan("ChatThreadClient-UploadImage",i,async n=>{let r;if(this.xhrClient&&(!this.supportsReadableStream()&&On(e)||!On(e)))r=await this.xhrClient.chatThread.uploadChatImage(this.threadId,On(e)?await this.getArrayBufferFromReadableStream(e):e,Object.assign({imageFilename:t},n));else{let i=e;("function"==typeof Blob||"object"==typeof Blob)&&e instanceof Blob?i=await this.getArrayBufferFromBlob(e):On(e)&&(i=await this.getArrayBufferFromReadableStream(e)),r=await this.client.chatThread.uploadChatImage(this.threadId,i,Object.assign({imageFilename:t},n))}return r})}deleteImage(e,t={}){return ze.withSpan("ChatThreadClient-DeleteImage",t,async t=>{await this.client.chatThread.deleteChatImage(this.threadId,e,t)})}supportsReadableStream(){let e=!1;const t=new Request("",{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}async getArrayBufferFromReadableStream(e){const t=await new Response(e).arrayBuffer();return new Uint8Array(t)}async getArrayBufferFromBlob(e){return new Uint8Array(await e.arrayBuffer())}}var xn=r(7007),Un=r(5777),Ln=r(781);class qn{constructor(e,t,n={}){this.endpoint=e,this.signalingClient=void 0,this.emitter=new xn.EventEmitter,this.isRealtimeNotificationsStarted=!1,this.tokenCredential=t;const r=Object.assign(Object.assign({},n),{loggingOptions:{logger:wn.info}});this.client=new In(this.endpoint,Object.assign({endpoint:this.endpoint},r));const i=Dn(this.tokenCredential);this.client.pipeline.addPolicy(i),this.clientOptions=Object.assign({},n),this.clientOptions.signalingClientOptions=Object.assign(Object.assign({},this.clientOptions.signalingClientOptions),{resourceEndpoint:this.endpoint,gatewayApiVersion:this.client.apiVersion}),this.signalingClient=((e,t,n)=>{var r,i,o,s;return new Ln.CommunicationSignalingClient(e,t,{resourceEndpoint:null!==(r=null==n?void 0:n.resourceEndpoint)&&void 0!==r?r:void 0,gatewayApiVersion:null!==(i=null==n?void 0:n.gatewayApiVersion)&&void 0!==i?i:void 0,additionalPolicies:null!==(o=null==n?void 0:n.additionalPolicies)&&void 0!==o?o:void 0,userAgentOptions:null!==(s=null==n?void 0:n.userAgentOptions)&&void 0!==s?s:void 0})})(t,wn,this.clientOptions.signalingClientOptions)}getChatThreadClient(e){return new Nn(this.endpoint,e,this.tokenCredential,this.clientOptions)}async createChatThread(e,t={}){return ze.withSpan("ChatClient-CreateChatThread",t,async n=>{var r,i;n.idempotencyToken=null!==(r=n.idempotencyToken)&&void 0!==r?r:(0,Un.randomUUID)();const o=(e=>{const{participants:t,idempotencyToken:n}=e,r=c(e,["participants","idempotencyToken"]);return Object.assign({repeatabilityRequestId:n},r)})(n);return(e=>{const{chatThread:t}=e,n=c(e,["chatThread"]);return t?Object.assign(Object.assign({},n),{chatThread:je(t)}):Object.assign({},n)})(await this.client.chat.createChatThread({topic:e.topic,participants:null===(i=t.participants)||void 0===i?void 0:i.map(e=>Me(e)),metadata:t.metadata,retentionPolicy:t.retentionPolicy},o))})}listChatThreadsPage(e){return d(this,arguments,function*(e,t={}){if(!e.continuationToken){const n=yield l(this.client.chat.listChatThreads(t));e.continuationToken=n.nextLink,n.value&&(yield yield l(n.value))}for(;e.continuationToken;){const n=yield l(this.client.chat.listChatThreadsNext(e.continuationToken,t));if(e.continuationToken=n.nextLink,!n.value)break;yield yield l(n.value)}})}listChatThreadsAll(e){return d(this,arguments,function*(){var t,n,r,i;try{for(var o,s=!0,a=p(this.listChatThreadsPage({},e));!(t=(o=yield l(a.next())).done);s=!0){i=o.value,s=!1;const e=i;yield l(yield*h(p(e)))}}catch(e){n={error:e}}finally{try{s||t||!(r=a.return)||(yield l(r.call(a)))}finally{if(n)throw n.error}}})}listChatThreads(e={}){const{span:t,updatedOptions:n}=ze.startSpan("ChatClient-ListChatThreads",e);try{const e=this.listChatThreadsAll(n);return{next:()=>e.next(),[Symbol.asyncIterator](){return this},byPage:(e={})=>this.listChatThreadsPage(e,n)}}catch(e){throw t.setStatus({error:e,status:"error"}),e}finally{t.end()}}async deleteChatThread(e,t={}){return ze.withSpan("ChatClient-DeleteChatThread",t,async t=>{await this.client.chat.deleteChatThread(e,t)})}async startRealtimeNotifications(){if(void 0===this.signalingClient)throw new Error("Realtime notifications are not supported in node js.");this.isRealtimeNotificationsStarted||(this.isRealtimeNotificationsStarted=!0,await this.signalingClient.start(),this.subscribeToSignalingEvents())}async stopRealtimeNotifications(){if(void 0===this.signalingClient)throw new Error("Realtime notifications are not supported in node js.");this.isRealtimeNotificationsStarted=!1,await this.signalingClient.stop(),this.emitter.removeAllListeners()}on(e,t){if(void 0===this.signalingClient)throw new Error("Realtime notifications are only supported in the browser.");if(!this.isRealtimeNotificationsStarted&&"realTimeNotificationConnected"!==e&&"realTimeNotificationDisconnected"!==e)throw new Error("You must call startRealtimeNotifications before you can subscribe to events.");this.emitter.on(e,t)}off(e,t){if(void 0===this.signalingClient)throw new Error("Realtime notifications are only supported in the browser.");this.emitter.removeListener(e,t)}subscribeToSignalingEvents(){if(void 0===this.signalingClient)throw new Error("Realtime notifications are only supported in the browser.");this.signalingClient.on("connectionChanged",e=>{2===e?this.emitter.emit("realTimeNotificationConnected"):3===e&&this.emitter.emit("realTimeNotificationDisconnected")}),this.signalingClient.on("chatMessageReceived",e=>{this.emitter.emit("chatMessageReceived",e)}),this.signalingClient.on("chatMessageEdited",e=>{this.emitter.emit("chatMessageEdited",e)}),this.signalingClient.on("chatMessageDeleted",e=>{this.emitter.emit("chatMessageDeleted",e)}),this.signalingClient.on("typingIndicatorReceived",e=>{this.emitter.emit("typingIndicatorReceived",e)}),this.signalingClient.on("readReceiptReceived",e=>{this.emitter.emit("readReceiptReceived",e)}),this.signalingClient.on("chatThreadCreated",e=>{this.emitter.emit("chatThreadCreated",e)}),this.signalingClient.on("chatThreadDeleted",e=>{this.emitter.emit("chatThreadDeleted",e)}),this.signalingClient.on("chatThreadPropertiesUpdated",e=>{this.emitter.emit("chatThreadPropertiesUpdated",e)}),this.signalingClient.on("participantsAdded",e=>{this.emitter.emit("participantsAdded",e)}),this.signalingClient.on("participantsRemoved",e=>{this.emitter.emit("participantsRemoved",e)}),this.signalingClient.on("streamingChatMessageStarted",e=>{this.emitter.emit("streamingChatMessageStarted",e)}),this.signalingClient.on("streamingChatMessageChunkReceived",e=>{this.emitter.emit("streamingChatMessageChunkReceived",e)})}}class jn extends Error{}jn.prototype.name="InvalidTokenError";const Fn=e=>{const{exp:t}=function(e,t){if("string"!=typeof e)throw new jn("Invalid token specified: must be a string");t||(t={});const n=!0===t.header?0:1,r=e.split(".")[n];if("string"!=typeof r)throw new jn(`Invalid token specified: missing part #${n+1}`);let i;try{i=function(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return function(e){return decodeURIComponent(atob(e).replace(/(.)/g,(e,t)=>{let n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n}))}(t)}catch(e){return atob(t)}}(r)}catch(e){throw new jn(`Invalid token specified: invalid base64 for part #${n+1} (${e.message})`)}try{return JSON.parse(i)}catch(e){throw new jn(`Invalid token specified: invalid json for part #${n+1} (${e.message})`)}}(e);return{token:e,expiresOnTimestamp:1e3*t}},Bn={token:"",expiresOnTimestamp:-10};class Gn{constructor(e){this.expiringSoonIntervalInMs=6e5,this.refreshAfterLifetimePercentage=.5,this.activeTokenFetching=null,this.activeTokenUpdating=null,this.disposed=!1;const{tokenRefresher:t,token:n,refreshProactively:r}=e;this.refresh=t,this.currentToken=n?Fn(n):Bn,this.refreshProactively=null!=r&&r,this.refreshProactively&&this.scheduleRefresh()}async getToken(e){if(!this.isTokenExpiringSoon(this.currentToken))return this.currentToken;if(!this.isTokenValid(this.currentToken)){const t=this.updateTokenAndReschedule(null==e?void 0:e.abortSignal);await t}return this.currentToken}dispose(){this.disposed=!0,this.activeTokenFetching=null,this.activeTokenUpdating=null,this.currentToken=Bn,this.activeTimeout&&clearTimeout(this.activeTimeout)}async updateTokenAndReschedule(e){if(this.activeTokenUpdating)return this.activeTokenUpdating;this.activeTokenUpdating=this.refreshTokenAndReschedule(e);try{await this.activeTokenUpdating}finally{this.activeTokenUpdating=null}}async refreshTokenAndReschedule(e){const t=await this.refreshToken(e);if(!this.isTokenValid(t))throw new Error("The token returned from the tokenRefresher is expired.");this.currentToken=t,this.refreshProactively&&this.scheduleRefresh()}async refreshToken(e){try{return this.activeTokenFetching||(this.activeTokenFetching=this.refresh(e)),Fn(await this.activeTokenFetching)}finally{this.activeTokenFetching=null}}scheduleRefresh(){if(this.disposed)return;this.activeTimeout&&clearTimeout(this.activeTimeout);const e=this.currentToken.expiresOnTimestamp-Date.now();let t=null;t=this.isTokenExpiringSoon(this.currentToken)?e*this.refreshAfterLifetimePercentage:e-this.expiringSoonIntervalInMs,this.activeTimeout=setTimeout(()=>this.updateTokenAndReschedule(),t)}isTokenValid(e){return e&&Date.now()<e.expiresOnTimestamp}isTokenExpiringSoon(e){return!e||Date.now()>=e.expiresOnTimestamp-this.expiringSoonIntervalInMs}}class Hn{constructor(e){this.token=e}async getToken(){return this.token}dispose(){}}class Vn{constructor(e){this.disposed=!1,this.tokenCredential="string"==typeof e?new Hn(Fn(e)):new Gn(e)}async getToken(e){this.throwIfDisposed();const t=await this.tokenCredential.getToken(e);return this.throwIfDisposed(),t}dispose(){this.disposed=!0,this.tokenCredential.dispose()}throwIfDisposed(){if(this.disposed)throw new Error("User credential is disposed")}}const zn={id:"",environmentUrl:"",token:""},Wn={displayName:""},Kn={errorEventSubscriberInstance:void 0,setInstance:e=>{Kn.errorEventSubscriberInstance=e},notifyErrorEvent:e=>{void 0!==Kn.errorEventSubscriberInstance&&Kn.errorEventSubscriberInstance.notifyErrorEvent(e)}};var $n;!function(e){e.EDITED_MESSAGE_ATTACHMENT_DOWNLOAD_FAILED="EDITED_MESSAGE_ATTACHMENT_DOWNLOAD_FAILED",e.HISTORY_MESSAGE_METADATA_FILEID_FETCH_FAILED="HISTORY_MESSAGE_METADATA_FILEID_FETCH_FAILED",e.NEW_MESSAGE_DOWNLOAD_ATTACHMENT_FAILED="NEW_MESSAGE_DOWNLOAD_ATTACHMENT_FAILED",e.MESSAGE_POLLING_FAILED="MESSAGE_POLLING_FAILED",e.INGRESS_MESSAGE_INVALID_JSON="INGRESS_MESSAGE_INVALID_JSON",e.EGRESS_ATTACHMENT_UPLOAD_FAILED="EGRESS_ATTACHMENT_UPLOAD_FAILED",e.EGRESS_SEND_MESSAGE_FAILED="EGRESS_SEND_MESSAGE_FAILED",e.ADAPTER_INIT_TOKEN_MISSING_ERROR="ADAPTER_INIT_TOKEN_MISSING_ERROR",e.ADAPTER_INIT_THREAD_ID_MISSING_ERROR="ADAPTER_INIT_THREAD_ID_MISSING_ERROR",e.ADAPTER_INIT_EXCEPTION="ADAPTER_INIT_EXCEPTION",e.ADAPTER_RECONNECT_FAILED="ADAPTER_RECONNECT_FAILED",e.MESSAGE_STREAMING_CHUNK_ATTACHMENT_DOWNLOAD_FAILED="MESSAGE_STREAMING_CHUNK_ATTACHMENT_DOWNLOAD_FAILED"}($n||($n={}));const Jn=(e,t)=>{Ce.logEvent(ge.INFO,{Event:Se.ACS_ADAPTER_POLLING_SKIPPED,Description:t,TimeStamp:(new Date).toISOString(),ChatThreadId:e(fe.ThreadId),ACSRequesterUserId:e(fe.UserId)})},Xn=(e,t)=>{Ce.logEvent(ge.INFO,{Event:Se.ACS_SKIP_POLLED_MESSAGE,Description:"ACS Adapter: Skipping polled message, already processed",TimeStamp:(new Date).toISOString(),ChatThreadId:e(fe.ThreadId),ChatMessageId:t,ACSRequesterUserId:e(fe.UserId)})},Qn=(e,t)=>{Ce.logEvent(ge.INFO,{Event:Se.ACS_PROCESSING_POLLED_MESSAGE,Description:"ACS Adapter: Processing polled message "+t,TimeStamp:(new Date).toISOString(),ChatThreadId:e(fe.ThreadId),ChatMessageId:t,ACSRequesterUserId:e(fe.UserId)})},Yn=(e,t)=>{Ce.logEvent(ge.INFO,{Event:Se.CACHE_POLLED_HISTORY_MESSAGE,Description:"ACS Adapter: Cache polled history message",TimeStamp:(new Date).toISOString(),ChatThreadId:e(fe.ThreadId),ACSRequesterUserId:e(fe.UserId),ChatMessageId:t})},Zn=(e,t)=>{const n="text"===t.type?t.sender:t.content.initiator;Ce.logEvent(ge.DEBUG,{Event:Se.PROCESS_CACHED_PAGED_HISTORY_MESSAGE,Description:`ACS Adapter: Process cached history message with id ${t.id}`,MessageSender:n.communicationUserId,TimeStamp:t.createdOn.toISOString(),ChatThreadId:e(fe.ThreadId),ChatMessageId:t.id})},er=(e,t)=>{const n="sender"in t?t.sender:"initiator"in t.content.initiator?t.content.initiator:void 0;Ce.logEvent(ge.DEBUG,{Event:Se.PROCESS_CACHED_HISTORY_MESSAGE,Description:`ACS Adapter: Process polled cached history message with Id ${t.id}`,MessageSender:n&&n.communicationUserId,TimeStamp:t.createdOn.toISOString(),ChatThreadId:e(fe.ThreadId),ChatMessageId:t.id})},tr=e=>{Ce.logEvent(ge.DEBUG,{Event:Se.PROCESS_CACHED_NEW_MESSAGE,Description:`ACS Adapter: Process cached new message with id ${e.id}`,MessageSender:e.sender.communicationUserId,TimeStamp:e.createdOn.toISOString(),ChatThreadId:e.threadId,ChatMessageId:e.id})},nr=e=>{Ce.logEvent(ge.DEBUG,{Event:Se.PROCESS_CACHED_NEW_MESSAGE,Description:"ACS Adapter: Process cached new participants removed event",ACSRequesterUserId:e.removedBy.id.communicationUserId,TimeStamp:e.removedOn.toISOString(),ChatThreadId:e.threadId,UserAdded:e.participantsRemoved.map(e=>e.id.communicationUserId)})},rr=e=>{Ce.logEvent(ge.DEBUG,{Event:Se.UNSUPPORTED_MESSAGE_TYPE,Description:`Message with ${e.id} has unsupported message type: ${e.type}`,TimeStamp:(new Date).toISOString()})},ir=e=>{Ce.logEvent(ge.ERROR,{Event:Se.FILEMANAGER_DOWNLOAD_FILE_FAILED,Description:"Downloading attachment for message failed.",ExceptionDetails:e})},or=(e,t,n,r)=>{Ce.logEvent(ge.ERROR,{Event:Se.ACS_SDK_START_INIT_ERROR,ChatThreadId:e,ACSRequesterUserId:t,Description:n,ExceptionDetails:r})};class sr extends M{constructor(e,t){super(e),this.detail=t}}class ar extends he{raiseCustomEvent(e,t){const n=t?{payload:t}:void 0;let r=null;try{r=new sr(e,n)}catch(e){}this.dispatchEvent(r)}constructor(){super(),this.handleOnline=()=>u(this,void 0,void 0,function*(){this.raiseCustomEvent("online")}),this.handleOffline=()=>u(this,void 0,void 0,function*(){return this.raiseCustomEvent("offline")}),this.handleLeaveChat=()=>u(this,void 0,void 0,function*(){return this.raiseCustomEvent("acs-adapter-leavechat")}),this.handleAcsChatOnline=()=>u(this,void 0,void 0,function*(){return this.raiseCustomEvent("acschat-online")}),this.handleBeforeunload=()=>{this.raiseCustomEvent("beforeunload")},this.handleError=e=>u(this,void 0,void 0,function*(){this.raiseCustomEvent("error",e)}),this.handleLoadMoreHistoryMessages=()=>u(this,void 0,void 0,function*(){this.raiseCustomEvent("acs-adapter-loadnextpage")}),window.addEventListener("online",this.handleOnline),window.addEventListener("offline",this.handleOffline),window.addEventListener("beforeunload",this.handleBeforeunload),window.addEventListener("acs-adapter-leavechat",this.handleLeaveChat),window.addEventListener("acs-adapter-loadnextpage",this.handleLoadMoreHistoryMessages)}end(){window.removeEventListener("online",this.handleOnline),window.removeEventListener("offline",this.handleOffline),window.removeEventListener("beforeunload",this.handleBeforeunload),window.removeEventListener("acs-adapter-leavechat",this.handleLeaveChat),window.removeEventListener("acs-adapter-loadnextpage",this.handleLoadMoreHistoryMessages)}}var cr,ur;de(ar.prototype,"online"),de(ar.prototype,"offline"),de(ar.prototype,"error"),de(ar.prototype,"beforeunload"),de(ar.prototype,"leavechat"),function(e){e.Message="message",e.Typing="typing"}(cr||(cr={})),function(e){e.Bot="bot",e.Channel="channel",e.Unknown="",e.User="user"}(ur||(ur={}));const lr="streaminfo",dr={},hr=JSON.parse('{"rE":"0.0.1-beta.5","El":{"oY":"1.6.0-beta.5"}}'),pr={requestOptions:{customHeaders:{"x-ms-useragent":`acs-webchat-adapter-${hr.rE} azsdk-js-communication-chat/${hr.El.oY}`}}},fr={requestOptions:{customHeaders:{"x-ms-useragent":`acs-webchat-adapter-${hr.rE} azsdk-js-communication-chat/${hr.El.oY}`}}},gr="ACS_CHANNEL",mr="joined",vr="left";var yr;!function(e){e.THREAD="Thread",e.ERROR="Error"}(yr||(yr={}));const Cr="microsoft.azure.communication.chat.bot.contenttype",Sr="azurebotservice.adaptivecard";var Tr;!function(e){e[e.READ=0]="READ",e[e.WRITE=1]="WRITE"}(Tr||(Tr={}));const Er=e=>"text"===e||"participantAdded"===e||"participantRemoved"===e,br=e=>"participantsAdded"in e,Ir=e=>"participantsRemoved"in e,wr=e=>new Promise(t=>setTimeout(t,e)),Rr=(e,t,n)=>{const r=null==e?void 0:e.get(t);if(r){const e=r.content===n.content,t=!kr(r.updatedOn,n.updatedOn),i=kr(r.deletedOn,n.deletedOn),o=r.fileIds?new Set(r.fileIds):void 0,s=n.fileIds?new Set(n.fileIds):void 0,a=!o&&!s||o.size===s.size&&[...o].every(e=>s.has(e));return e&&!t&&a&&i}return!1},Ar=(e,t,n)=>{const r=null==e?void 0:e.get(t);if(r){let e=!1;return n.addedParticipants?e=Or(n.addedParticipants,r.addedParticipants):n.removedParticipants&&(e=Or(n.removedParticipants,r.removedParticipants)),e}return!1},Or=(e,t)=>{if(e.length!==t.length)return!1;const n=new Map;for(const e of t){const t="communicationUserId"in e.id?e.id.communicationUserId:JSON.stringify(e.id);n.set(t,e)}for(const t of e){const e="communicationUserId"in t.id?t.id.communicationUserId:JSON.stringify(t.id),r=n.get(e);if(!r||t.displayName!==r.displayName||!kr(t.shareHistoryTime,r.shareHistoryTime))return!1}return!0},kr=(e,t)=>!e&&!t||!(!e||!t)&&Mr(e)===Mr(t),_r=e=>{var t,n,r;if(!(null===(t=e.content)||void 0===t?void 0:t.initiator))throw new Error("Message does not contain initiator information");if(!(null===(n=e.content)||void 0===n?void 0:n.participants))throw new Error("Message does not contain participants information");return Dr((null===(r=e.content)||void 0===r?void 0:r.initiator).communicationUserId,e.createdOn,e.content.participants)},Pr=e=>{if(br(e))return Dr(e.addedBy.id.communicationUserId,e.addedOn,e.participantsAdded);if(Ir(e))return Dr(e.removedBy.id.communicationUserId,e.removedOn,e.participantsRemoved);throw new Error("Event does not contain participants information")},Mr=e=>e.toISOString().substring(0,19),Dr=(e,t,n)=>{const r=n.map(e=>e.id.communicationUserId).sort().join("_"),i=Nr(r);return`${Mr(t)}_${e}_${i}`},Nr=e=>{let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return Math.abs(t).toString(16)},xr=e=>{const t=Ae(e);switch(t.kind){case"communicationUser":return t.communicationUserId;case"microsoftTeamsUser":return t.microsoftTeamsUserId;case"phoneNumber":return t.phoneNumber;case"unknown":return t.id}},Ur=(e,t,n,r)=>u(void 0,void 0,void 0,function*(){try{let r;return r=t?e.map((e,n)=>({fileId:e,metadata:t[n]})):e.map(e=>({fileId:e})),yield n.downloadFiles(r)}catch(e){ir(e),r.handleError(e)}}),Lr=e=>u(void 0,void 0,void 0,function*(){return Promise.all(e.map(e=>u(void 0,void 0,void 0,function*(){if(e){const t=yield(e=>new Promise(t=>{const n=new FileReader;n.onloadend=()=>{t(n.result)},n.readAsDataURL(e)}))(e);return{contentType:e.type,contentUrl:t,name:e.name,thumbnailUrl:e.type.match("(image|video|audio).*")?t:void 0}}})))}),qr=e=>e.map(e=>null==e?void 0:e.size),jr=(e,t,n,r,i)=>{const o=Rr(e,t.id,{content:t.message,deletedOn:t.deletedOn,updatedOn:t.editedOn,fileIds:null==r?void 0:r.getFileIds(t.metadata)});return o||(Ce.logEvent(ge.INFO,{Event:i,Description:"ACS Adapter: Processing message",MessageSender:t.sender.communicationUserId,TimeStamp:(new Date).toISOString(),ChatThreadId:n(fe.ThreadId),ChatMessageId:t.id}),e.set(t.id,{content:t.message,updatedOn:t.editedOn,deletedOn:t.deletedOn,fileIds:null==r?void 0:r.getFileIds(t.metadata)})),o},Fr=(e,t,n)=>{switch(e.type){case"text":return Rr(t,e.id,{content:e.content.message,updatedOn:e.editedOn,deletedOn:e.deletedOn,fileIds:null==n?void 0:n.getFileIds(e.metadata)});case"participantAdded":{const n=_r(e);return Ar(t,n,{addedParticipants:e.content.participants})}case"participantRemoved":{const n=_r(e);return Ar(t,n,{removedParticipants:e.content.participants})}default:return rr(e),!1}},Br=(e,t,n)=>{switch(e.type){case"text":t.set(e.id,{content:e.content.message,updatedOn:e.editedOn,deletedOn:e.deletedOn,fileIds:null==n?void 0:n.getFileIds(e.metadata)});break;case"participantAdded":{const n=_r(e);t.set(n,{addedParticipants:e.content.participants});break}case"participantRemoved":{const n=_r(e);t.set(n,{removedParticipants:e.content.participants});break}default:rr(e)}};var Gr=r(7162),Hr=r.n(Gr);function Vr(){return Hr()().toString(36).substr(2)}function zr(e,t,n,r=!0,i){var o,s,a,c;return u(this,void 0,void 0,function*(){const u=xr(t.sender);let l,d,h,p,f,g;if((t.metadata?t.metadata[`${Cr}`]:void 0)===Sr)try{const e=JSON.parse(t.content);n&&e.attachments&&(l=[],l=l.concat(e.attachments),g=e.attachmentLayout),r&&(p=null==e?void 0:e.value),f=null==e?void 0:e.suggestedActions,h=null==e?void 0:e.text}catch(n){const r="Valid JSON object is expected.";if(((e,t,n)=>{Ce.logEvent(ge.ERROR,{Event:Se.ACS_ADAPTER_INGRESS_FAILED,Description:t,ACSRequesterUserId:e.currentUserId,MessageSender:e.sender.communicationUserId,TimeStamp:e.createdOn.toISOString(),ChatThreadId:e.threadId,ChatMessageId:e.messageId,ExceptionDetails:n})})(t,r,n),Kn.notifyErrorEvent({ErrorType:$n.INGRESS_MESSAGE_INVALID_JSON,ErrorMessage:n.message,ErrorStack:n.stack,ErrorDetails:null==n?void 0:n.details,Timestamp:t.createdOn.toISOString(),AcsChatDetails:{MessageId:t.messageId,ThreadId:t.threadId,MessageSenderId:t.sender.communicationUserId,RequesterUserId:t.currentUserId},AdditionalParams:{SenderDisplayName:t.senderDisplayName,MessageText:t.content,Metadata:t.metadata}}),i){const n=new Error(r);n.details={type:"MESSAGE_PARSING_FAILED",actualMessage:t.content},e.handleError(n)}}else h=t.content;t.files&&!l&&(l=yield Lr(t.files),d=qr(t.files));let m=(v=t.messageId,dr[v]);var v;let y;void 0===m&&(m=null===(o=t.metadata)||void 0===o?void 0:o.clientActivityId),t.sequenceId&&Math.sign(parseInt(t.sequenceId))>0&&(y=parseInt(t.sequenceId));const C={attachments:l,channelId:gr,channelData:{"webchat:sequence-id":y,attachmentSizes:d,fromUserId:u,clientActivityID:m,messageId:t.messageId,state:"sent",tags:null===(s=t.metadata)||void 0===s?void 0:s.tags,metadata:t.metadata,additionalMessageMetadata:{editedOn:null===(a=t.editedOn)||void 0===a?void 0:a.toISOString(),deletedOn:null===(c=t.deletedOn)||void 0===c?void 0:c.toISOString()}},conversation:{id:t.threadId},from:{id:u,name:t.senderDisplayName?t.senderDisplayName:void 0,role:u===t.currentUserId?ur.User:ur.Bot},id:t.messageId?t.messageId:Vr(),text:h,timestamp:new Date(t.createdOn).toISOString(),type:cr.Message,messageid:t.messageId?t.messageId:"",value:p,suggestedActions:f,attachmentLayout:g};return t.streamingMetadata&&(C.channelData.streamType=t.streamingMetadata.streamingMessageType,C.channelData.streamId=t.messageId,C.entities=[{type:lr,streamType:t.streamingMetadata.streamingMessageType,streamId:t.messageId}]),C})}const Wr=(e,t,n,r)=>{var i,o;return{messageId:e.id,content:null===(i=e.content)||void 0===i?void 0:i.message,createdOn:e.createdOn,editedOn:e.editedOn,deletedOn:e.deletedOn,sender:e.sender,senderDisplayName:e.senderDisplayName,currentUserId:n,threadId:t,metadata:e.metadata,tags:null===(o=e.metadata)||void 0===o?void 0:o.tags,sequenceId:e.id,files:r}},Kr=(e,t,n)=>u(void 0,void 0,void 0,function*(){const{chatMessage:r,options:i}=e.detail.payload;let o,s;const a=n(fe.EventManager),c=n(fe.FileManager);try{s=c.getFileIds(r.metadata);const e=c.getFileMetadata(r.metadata);if(s){const l=$r(t,r.id,s,e);if((null==l?void 0:l.length)<=0)return;Ce.logEvent(ge.INFO,{Event:Se.ACS_ADAPTER_CONVERT_HISTORY,Description:"ACS Adapter: attachments download queued: "+l.map(e=>e.fileId).join(","),ACSRequesterUserId:n(fe.UserId),MessageSender:r.sender.communicationUserId,TimeStamp:r.createdOn.toISOString(),ChatMessageId:r.id}),o=yield((e,t,n,r,i)=>u(void 0,void 0,void 0,function*(){try{if(r){i||(i=9e4);const n=new Promise((e,t)=>{setTimeout(()=>{t(new Error("Attachment download timed out."))},i)});return Promise.race([t.downloadFiles(e),n])}return yield t.downloadFiles(e)}catch(e){ir(e),n.handleError(e)}}))(l,c,this,null==i?void 0:i.shouldFileAttachmentDownloadTimeout,null==i?void 0:i.fileAttachmentDownloadTimeout),Ce.logEvent(ge.INFO,{Event:Se.ACS_ADAPTER_CONVERT_HISTORY,Description:"ACS Adapter: attachments downloaded: ",ACSRequesterUserId:n(fe.UserId),MessageSender:r.sender.communicationUserId,TimeStamp:r.createdOn.toISOString(),ChatMessageId:r.id}),a.raiseCustomEvent("acs-attachment-downloaded",{chatMessage:r,files:o})}}catch(e){Ce.logEvent(ge.ERROR,{Event:Se.ACS_ADAPTER_ATTACHMENT_DOWNLOAD_ERROR,Description:"ACS Adapter: Failed to download attachments",ACSRequesterUserId:n(fe.UserId),MessageSender:r.sender.communicationUserId,TimeStamp:r.createdOn.toISOString(),ChatMessageId:r.id,ExceptionDetails:e}),(null==i?void 0:i.enableMessageErrorHandler)&&(new Error("Failed to download attachments.").details={type:"ATTACHMENT_DOWNLOAD_FAILED",actualMessage:s},a.handleError(e))}}),$r=(e,t,n,r)=>{const i=[];if(e&&Ce.logEvent(ge.INFO,{Event:Se.ACS_ADAPTER_PROCESSED_ATTACHMENTS,Description:`ACS Adapter: Attachments processed on this thread ${[...Object.keys(e)]}`,TimeStamp:(new Date).toISOString(),ChatMessageId:t}),Object.prototype.hasOwnProperty.call(e,t))for(let o=0;o<n.length;++o)e[t].has(n[o])||(i.push({fileId:n[o],metadata:r[o]}),e[t].set(n[o],r[o]));else{e[t]=new Map,Ce.logEvent(ge.INFO,{Event:Se.ACS_ADAPTER_ATTACHMENT_NEW,Description:`ACS Adapter: New attachment download ${null==n?void 0:n.join(",")}`,TimeStamp:(new Date).toISOString(),ChatMessageId:t});for(let o=0;o<n.length;++o)i.push({fileId:n[o],metadata:r[o]}),e[t].set(n[o],r[o])}return i},Jr=(e,t,n,r)=>u(void 0,void 0,void 0,function*(){for(const i of e){const e=yield Xr(n,i,t);r(e)}}),Xr=(e,t,n)=>u(void 0,void 0,void 0,function*(){const r=xr(t.id),i={displayName:t.displayName,tag:n,id:r},o=yield function({getState:e}){return()=>t=>u(this,void 0,void 0,function*(){return((e,t,n)=>({channelId:gr,conversation:{id:void 0},channelData:{type:yr.THREAD,members:[{id:e.id,displayName:e.displayName,tag:e.tag}]},from:{id:void 0,name:void 0,role:ur.Channel},id:t,timestamp:n,type:cr.Message,messageid:void 0,text:JSON.stringify(`${e.displayName} ${e.tag} chat`)}))(t,e(fe.UserId),(new Date).toISOString())})}({getState:e})()(i);return Ce.logEvent(ge.INFO,{Event:Se.ACS_ADAPTER_CONVERT_THREAD_UPDATED,Description:"ACS Adapter: convert thread update"}),o}),Qr=(e,t,n,r,i,o)=>u(void 0,void 0,void 0,function*(){if(!Er(t.type))return!1;if(i(fe.WebChatStatus)!==Te.Connected)return((e,t,n)=>{Ce.logEvent(ge.INFO,{Event:Se.CACHE_PAGED_HISTORY_MESSAGE,Description:e,TimeStamp:(new Date).toISOString(),ChatThreadId:n(fe.ThreadId),ACSRequesterUserId:n(fe.UserId),ChatMessageId:t.id})})(n,t,i),e.push(t),!0;if(!r)switch(t.type){case"text":{const e=yield ei(t,i);o(e);break}case"participantAdded":t.content.participants&&Jr(t.content.participants,mr,i,o);break;case"participantRemoved":t.content.participants&&Jr(t.content.participants,vr,i,o)}return!0}),Yr=(e,t,n,r)=>u(void 0,void 0,void 0,function*(){switch(e.type){case"text":{const i=yield ei(e,t);Zr(i,e,t,n,r);break}case"participantAdded":for(const i of e.content.participants){const o=yield Xr(t,i,mr);Zr(o,e,t,n,r)}break;case"participantRemoved":for(const i of e.content.participants){const o=yield Xr(t,i,vr);Zr(o,e,t,n,r)}}}),Zr=(e,t,n,r,i)=>{e&&(((e,t,n)=>{const r="text"===n.type?n.sender:n.content.initiator;Ce.logEvent(ge.INFO,{Event:Se.ACS_ADAPTER_POST_ACTIVITY,Description:t,MessageSender:r.communicationUserId,TimeStamp:n.createdOn.toISOString(),ChatMessageId:n.id,ACSRequesterUserId:e(fe.UserId)})})(n,i+e.messageid,t),e.channelData||(e.channelData={}),e.channelData.fromList=!0,r(e))},ei=(e,t)=>u(void 0,void 0,void 0,function*(){const n=yield function({getState:e}){return()=>t=>u(this,void 0,void 0,function*(){var n,r;const i=e(fe.ChatClient),o=e(fe.AdapterOptions),s=e(fe.FileManager),a=e(fe.EventManager),c=e(fe.ThreadId),u=e(fe.UserId);if(!i){const n="ACS Adapter: Failed to ingress history message without an active chatClient.";throw Ce.logEvent(ge.ERROR,{Event:Se.ACS_ADAPTER_INGRESS_FAILED,Description:n,ACSRequesterUserId:e(fe.UserId),MessageSender:t.sender.communicationUserId,TimeStamp:t.createdOn.toISOString(),ChatMessageId:t.id}),new Error(n)}let l;try{if(l=s.getFileIds(t.metadata),l)return a.raiseCustomEvent("queue-attachment-download",{chatMessage:t,options:o}),null}catch(i){Ce.logEvent(ge.ERROR,{Event:Se.ACS_ADAPTER_CONVERT_HISTORY,Description:"Failed to queue attachments download",ACSRequesterUserId:e(fe.UserId),MessageSender:t.sender.communicationUserId,TimeStamp:t.createdOn.toISOString(),ChatMessageId:t.id,ExceptionDetails:i}),Kn.notifyErrorEvent({ErrorType:$n.HISTORY_MESSAGE_METADATA_FILEID_FETCH_FAILED,ErrorMessage:i.message,ErrorStack:i.stack,ErrorDetails:null==i?void 0:i.details,Timestamp:t.createdOn.toISOString(),AcsChatDetails:{MessageId:t.id,ThreadId:c,MessageSenderId:t.sender.communicationUserId,RequesterUserId:e(fe.UserId)},AdditionalParams:{MessageDetails:t},CorrelationVector:null===(r=null===(n=null==i?void 0:i.request)||void 0===n?void 0:n.headers)||void 0===r?void 0:r.get("ms-cv")}),(null==o?void 0:o.enableMessageErrorHandler)&&(new Error("Failed to download attachments.").details={type:"QUEUE_ATTACHMENT_DOWNLOAD_FAILED",actualMessage:l},a.handleError(i))}const d=Wr(t,c,u,void 0);return yield zr(a,d,null==o?void 0:o.enableAdaptiveCards,null==o?void 0:o.enableAdaptiveCardsResponses,null==o?void 0:o.enableMessageErrorHandler)})}({getState:t})()(e);var r;return r=e,Ce.logEvent(ge.INFO,{Event:Se.ACS_ADAPTER_CONVERT_HISTORY,Description:"ACS Adapter: convert history message:",CustomProperties:r,MessageSender:r.sender.communicationUserId,TimeStamp:r.createdOn.toISOString(),ChatMessageId:r.id}),n}),ti=(e,t)=>u(void 0,void 0,void 0,function*(){try{const n=yield function({getState:e}){return()=>t=>u(this,void 0,void 0,function*(){var n,r,i,o;const s=e(fe.ChatClient),a=e(fe.FileManager),c=e(fe.EventManager);if(!s)throw new Error("ACS Adapter: Failed to ingress edited message without an active chatClient.");const u=xr(t.sender),l={channelId:gr,channelData:{"webchat:sequence-id":parseInt(t.id),additionalMessageMetadata:{editedOn:t.editedOn.toISOString()}},conversation:{id:e(fe.UserId)},from:{id:u,name:t.senderDisplayName,role:u===e(fe.UserId)?ur.User:ur.Bot},messageid:t.id,id:t.id?t.id:Vr(),text:t.message,timestamp:t.createdOn.toISOString(),type:cr.Message};if(t.metadata&&0!==Object.keys(t.metadata).length){let s,u,d;try{const e=a.getFileIds(t.metadata),n=a.getFileMetadata(t.metadata);e&&(s=yield Ur(e,n,a,c),u=yield Lr(s),d=qr(s))}catch(i){((e,t,n)=>{Ce.logEvent(ge.ERROR,{Event:Se.ACS_ADAPTER_CONVERT_HISTORY,Description:"Failed to parse ChatMessage metadata",ACSRequesterUserId:n(fe.UserId),MessageSender:e.sender.communicationUserId,TimeStamp:e.editedOn.toISOString(),ChatThreadId:e.threadId,ChatMessageId:e.id,ExceptionDetails:t})})(t,i,e),Kn.notifyErrorEvent({ErrorType:$n.EDITED_MESSAGE_ATTACHMENT_DOWNLOAD_FAILED,ErrorMessage:i.message,ErrorStack:i.stack,ErrorDetails:null==i?void 0:i.details,Timestamp:t.editedOn.toISOString(),AcsChatDetails:{MessageId:t.id,ThreadId:t.threadId,MessageSenderId:t.sender.communicationUserId,RequesterUserId:e(fe.UserId)},AdditionalParams:{MessageEditedEvent:t},CorrelationVector:null===(r=null===(n=null==i?void 0:i.request)||void 0===n?void 0:n.headers)||void 0===r?void 0:r.get("ms-cv")}),c.handleError(i)}l.channelData.metadata=t.metadata,u&&(l.attachments=u,l.channelData.attachmentSizes=d),(null===(i=t.metadata)||void 0===i?void 0:i.tags)&&(l.channelData.tags=null===(o=t.metadata)||void 0===o?void 0:o.tags)}return l})}({getState:t})()(e);return(e=>{Ce.logEvent(ge.INFO,{Event:Se.ACS_ADAPTER_CONVERT_EDITED_MESSAGE,Description:"ACS Adapter: convert edited message",CustomProperties:e,MessageSender:e.sender.communicationUserId,TimeStamp:e.editedOn.toISOString(),ChatThreadId:e.threadId,ChatMessageId:e.id})})(e),n}catch(n){((e,t,n)=>{Ce.logEvent(ge.ERROR,{Event:Se.ACS_ADAPTER_INGRESS_FAILED,Description:t,ACSRequesterUserId:n(fe.UserId),MessageSender:e.sender.communicationUserId,TimeStamp:e.editedOn.toISOString(),ChatThreadId:e.threadId,ChatMessageId:e.id})})(e,n.message,t)}}),ni=(e,t)=>u(void 0,void 0,void 0,function*(){try{const n=yield function({getState:e}){return()=>t=>u(this,void 0,void 0,function*(){if(!e(fe.ChatClient))throw new Error("ACS Adapter: Failed to ingress deleted message without an active chatClient.");const n=xr(t.sender);return{channelId:gr,channelData:{"webchat:sequence-id":parseInt(t.id),additionalMessageMetadata:{deletedOn:t.deletedOn.toISOString()}},conversation:{id:e(fe.UserId)},from:{id:n,name:t.senderDisplayName,role:n===e(fe.UserId)?ur.User:ur.Bot},messageid:t.id,id:t.id?t.id:Vr(),text:"",timestamp:t.createdOn.toISOString(),type:cr.Message}})}({getState:t})()(e);return(e=>{Ce.logEvent(ge.INFO,{Event:Se.ACS_ADAPTER_CONVERT_DELETED_MESSAGE,Description:"ACS Adapter: convert edited deleted message event",CustomProperties:e,MessageSender:e.sender.communicationUserId,TimeStamp:e.deletedOn.toISOString(),ChatThreadId:e.threadId,ChatMessageId:e.id})})(e),n}catch(n){((e,t,n)=>{Ce.logEvent(ge.ERROR,{Event:Se.ACS_ADAPTER_INGRESS_FAILED,Description:t,ACSRequesterUserId:n(fe.UserId),MessageSender:e.sender.communicationUserId,TimeStamp:e.deletedOn.toISOString(),ChatThreadId:e.threadId,ChatMessageId:e.id})})(e,n.message,t)}});let ri,ii,oi;const si=[],ai={requestOptions:{customHeaders:{"x-ms-useragent":`acs-webchat-adapter-${hr.rE} azsdk-js-communication-chat/${hr.El.oY}`}}};function ci(){return function(...e){return a(e=>e.setState,(e,t)=>Object.assign(Object.assign({},e),{setState:t}))(...e)}(({getState:t,setState:n,getReadyState:r,setReadyState:i,subscribe:o})=>{const s=e=>u(this,void 0,void 0,function*(){const n=yield function({getState:e}){return()=>t=>u(this,void 0,void 0,function*(){var n,r,i;const o=e(fe.ChatClient),s=e(fe.AdapterOptions),a=e(fe.FileManager),c=e(fe.EventManager),u=e(fe.UserId);if(!o){const n="ACS Adapter: Failed to ingress message without an active chatClient.";throw Ce.logEvent(ge.ERROR,{Event:Se.ACS_ADAPTER_INGRESS_FAILED,Description:n,ACSRequesterUserId:e(fe.UserId),MessageSender:t.sender.communicationUserId,TimeStamp:t.createdOn.toISOString(),ChatThreadId:t.threadId,ChatMessageId:t.id}),new Error(n)}let l,d;if(t.metadata&&0!==Object.keys(t.metadata).length){let i;l=t.metadata;try{Ce.logEvent(ge.INFO,{Event:Se.ACS_ADAPTER_REQUEST_DOWNLOAD_ATTACHMENTS,Description:"Preparing to download attachments",ACSRequesterUserId:e(fe.UserId),MessageSender:t.sender.communicationUserId,TimeStamp:t.createdOn.toISOString(),ChatThreadId:t.threadId,ChatMessageId:t.id}),i=a.getFileIds(t.metadata);const n=a.getFileMetadata(t.metadata);i&&(d=yield Ur(i,n,a,c))}catch(o){if(Ce.logEvent(ge.ERROR,{Event:Se.ACS_ADAPTER_CONVERT_HISTORY,Description:"Failed to download attachments",ACSRequesterUserId:e(fe.UserId),MessageSender:t.sender.communicationUserId,TimeStamp:t.createdOn.toISOString(),ChatThreadId:t.threadId,ChatMessageId:t.id,ExceptionDetails:o}),Kn.notifyErrorEvent({ErrorType:$n.NEW_MESSAGE_DOWNLOAD_ATTACHMENT_FAILED,ErrorMessage:o.message,ErrorStack:o.stack,ErrorDetails:null==o?void 0:o.details,Timestamp:t.createdOn.toISOString(),AcsChatDetails:{MessageId:t.id,ThreadId:t.threadId,MessageSenderId:t.sender.communicationUserId,RequesterUserId:u},AdditionalParams:{SenderDisplayName:t.senderDisplayName,MessageText:t.message,Metadata:t.metadata},CorrelationVector:null===(r=null===(n=null==o?void 0:o.request)||void 0===n?void 0:n.headers)||void 0===r?void 0:r.get("ms-cv")}),null==s?void 0:s.enableMessageErrorHandler){const e=new Error("Failed to download attachments.");e.details={type:"ATTACHMENT_DOWNLOAD_FAILED",actualMessage:i},c.handleError(e)}}}const h={messageId:t.id,content:t.message,createdOn:t.createdOn,sender:t.sender,senderDisplayName:t.senderDisplayName,currentUserId:u,threadId:t.threadId,metadata:l,tags:null===(i=t.metadata)||void 0===i?void 0:i.tags,sequenceId:t.id,streamingMetadata:t.streamingMetadata,files:d};return yield zr(c,h,null==s?void 0:s.enableAdaptiveCards,null==s?void 0:s.enableAdaptiveCardsResponses,null==s?void 0:s.enableMessageErrorHandler)})}({getState:t})()(e);return Ce.logEvent(ge.INFO,{Event:Se.ACS_ADAPTER_CONVERT_MESSAGE,Description:"ACS Adapter: convert normal message",CustomProperties:e,MessageSender:e.sender.communicationUserId,TimeStamp:e.createdOn.toISOString(),ChatThreadId:e.threadId,ChatMessageId:e.id}),n}),a=(e,n)=>u(this,void 0,void 0,function*(){const r=yield function({getState:e}){return()=>({message:t,files:n})=>u(this,void 0,void 0,function*(){const r=e(fe.AdapterOptions),i=e(fe.EventManager),o=e(fe.ThreadId),s=e(fe.UserId);if(!n)return null;const a=Wr(t,o,s,n);return yield zr(i,a,null==r?void 0:r.enableAdaptiveCards,null==r?void 0:r.enableAdaptiveCardsResponses,null==r?void 0:r.enableMessageErrorHandler)})}({getState:t})()({message:e,files:n});return Ce.logEvent(ge.INFO,{Event:Se.ACS_ADAPTER_CONVERT_HISTORY,Description:"ACS Adapter: convert attachment history message:",CustomProperties:e,MessageSender:e.sender.communicationUserId,TimeStamp:e.createdOn.toISOString(),ChatMessageId:e.id}),r}),c=e=>u(this,void 0,void 0,function*(){const n=yield function({getState:e}){return()=>t=>u(this,void 0,void 0,function*(){return((e,t,n)=>{const r={message:e.message,stack:e.stack,details:null==e?void 0:e.details};return{channelId:gr,conversation:{id:void 0},channelData:{type:yr.ERROR},from:{id:void 0,name:void 0,role:ur.Channel},id:t,timestamp:n,type:cr.Message,messageid:void 0,text:JSON.stringify(r)}})(t,e(fe.UserId),(new Date).toISOString())})}({getState:t})()(e);return Ce.logEvent(ge.ERROR,{Event:Se.ACS_SDK_CHATCLIENT_ERROR,Description:"ACS Adapter: convert error message",ExceptionDetails:e.message}),n}),l=e=>u(this,void 0,void 0,function*(){const n=yield function({getState:e}){return()=>t=>u(this,void 0,void 0,function*(){if(!e(fe.ChatClient)){const n="ACS Adapter: Failed to ingress typing message without an active chatClient.";throw Ce.logEvent(ge.ERROR,{Event:Se.ACS_ADAPTER_INGRESS_FAILED,Description:n,ACSRequesterUserId:e(fe.UserId),MessageSender:t.sender.communicationUserId,TimeStamp:t.receivedOn.toISOString(),ChatThreadId:t.threadId}),new Error(n)}const{receivedOn:n,sender:r}=t,i=xr(r);return{channelId:gr,conversation:{id:e(fe.UserId)},from:{id:i,name:t.senderDisplayName,role:i===e(fe.UserId)?ur.User:ur.Bot},timestamp:new Date(n).toISOString(),type:cr.Typing}})}({getState:t})()(e);return Ce.logEvent(ge.INFO,{Event:Se.ACS_ADAPTER_CONVERT_TYPING_MESSAGE,Description:"ACS Adapter: convert typing message.",MessageSender:e.sender.communicationUserId,TimeStamp:e.receivedOn.toISOString(),ChatThreadId:e.threadId}),n}),d=e=>u(this,void 0,void 0,function*(){const n=yield function({getState:e}){return()=>t=>u(this,void 0,void 0,function*(){return((e,t)=>({channelId:gr,conversation:{id:void 0},channelData:{type:yr.THREAD,properties:{deleteTime:e.deletedOn.toISOString(),isDeleted:"True"}},from:{id:void 0,name:void 0,role:ur.Channel},id:t,timestamp:e.deletedOn.toISOString(),type:cr.Message,messageid:void 0}))(t,e(fe.UserId))})}({getState:t})()(e);return Ce.logEvent(ge.INFO,{Event:Se.ACS_ADAPTER_CONVERT_THREAD_DELETED,Description:"ACS Adapter: convert thread delete",ACSRequesterUserId:e.deletedBy.id.communicationUserId,TimeStamp:e.deletedOn.toISOString(),ChatThreadId:e.threadId}),n}),h=(e,t,n)=>u(this,void 0,void 0,function*(){const r=yield c(n);!e&&t(r)}),p=(e,{unsubscribed:n},r,i=void 0,o=void 0)=>u(this,void 0,void 0,function*(){if(void 0===o){const o=e.listMessages(Object.assign(Object.assign({},ai),{startTime:i}));let s=yield o.next();for(;!s.done;){const e=s.value;Qr(si,e,"ACS Adapter: Cache paged history message",n,t,r),s=yield o.next()}}else{let s=ii;void 0===s&&(s=e.listMessages(Object.assign(Object.assign({},ai),{maxPageSize:o,startTime:i})).byPage());const a="ACS Adapter: Cache paged history message  (with pagesize limit)";let c=0;for(;c<o;){const e=ri;if(e)for(let i=oi>=0?oi:0;i<e.value.length;i++){const o=e.value[i];Qr(si,o,a,n,t,r)&&c++}const i=yield s.next();if(i.done)break;for(let e=0;e<i.value.length;e++){if(c>=o){ii=s,oi=e,ri=i;break}const u=i.value[e];Qr(si,u,a,n,t,r)&&c++}}}}),f=(e,{unsubscribed:n},r,i=void 0)=>u(this,void 0,void 0,function*(){const o=t(fe.EventManager);null==o||o.addEventListener("acs-adapter-loadnextpage",()=>{p(e,{unsubscribed:n},r,void 0,i)})}),g=({unsubscribed:e},n)=>u(this,void 0,void 0,function*(){const r=t(fe.EventManager);null==r||r.addEventListener("error",t=>{var r;h(e,n,null===(r=null==t?void 0:t.detail)||void 0===r?void 0:r.payload)})}),m=({unsubscribed:e},n)=>u(this,void 0,void 0,function*(){const r=t(fe.EventManager);null==r||r.addEventListener("acs-adapter-leavechat",()=>{const r=t(fe.UserId);!e&&n.removeParticipant({communicationUserId:r},ai)})});return c=>(h,v)=>u(this,void 0,void 0,function*(){return(h===fe.ChatThreadClient&&v||h===fe.Reconnect&&v)&&o(new(ve())(o=>{const c=t(fe.ChatClient),h=t(fe.AdapterOptions),y=t(fe.MessagePollingHandleInstance);let C=t(fe.FileManager);const S=o.next.bind(o);let T,E,b=!0;const I={},w={unsubscribed:!1},R=!0===v?t(fe.ChatThreadClient):v,A=new Map,O=[],k=[],_=(n,o,s,a,c=0)=>u(this,void 0,void 0,function*(){var l,d,p,f;const g=h&&h.serverPageSizeLimit;let m;if(r()!==e.CLOSED)try{if(!b)return void Jn(t,"ACS Adapter: Polling call issued too soon: skipping");if(!(null==y?void 0:y.getIsPollingEnabled()))return void Jn(t,"ACS Adapter: Polling call disabled from the client: skipping");(e=>{Ce.logEvent(ge.INFO,{Event:Se.ACS_SEND_POLLING_REQUEST,Description:"ACS Adapter: Send polling request",TimeStamp:(new Date).toISOString(),ChatThreadId:e(fe.ThreadId),ACSRequesterUserId:e(fe.UserId)})})(t);const e=o.listMessages(Object.assign(Object.assign({},ai),{startTime:s,maxPageSize:g}));let n=yield e.next();for(;!n.done;){const r=n.value;if(Er(r.type)&&r.sequenceId!==a)if(C||(C=t(fe.FileManager)),Fr(r,A,C))Xn(t,r.id);else{if(Qn(t,r.id),t(fe.WebChatStatus)!==Te.Connected){Yn(t,r.id),k.push(r),n=yield e.next();continue}Br(r,A,C),Yr(r,t,S,"ACS Adapter: Post activity, messageId: ")}(!s||parseInt(r.sequenceId)>parseInt(a))&&(s=r.createdOn,a=r.sequenceId),n=yield e.next()}}catch(e){m=e,((e,t)=>{Ce.logEvent(ge.ERROR,{Event:Se.ACS_SDK_CHATCLIENT_ERROR,Description:"ACS Adapter: Polling message fetch failed.",TimeStamp:(new Date).toISOString(),ChatThreadId:e(fe.ThreadId),ExceptionDetails:t})})(t,e),Kn.notifyErrorEvent({StatusCode:null===(l=e.response)||void 0===l?void 0:l.status,ErrorType:$n.MESSAGE_POLLING_FAILED,ErrorMessage:e.message,ErrorStack:e.stack,ErrorDetails:null==e?void 0:e.details,Timestamp:(new Date).toISOString(),AcsChatDetails:{ThreadId:t(fe.ThreadId)},CorrelationVector:null===(p=null===(d=null==e?void 0:e.request)||void 0===d?void 0:d.headers)||void 0===p?void 0:p.get("ms-cv")})}finally{const r=null===(f=null==m?void 0:m.response)||void 0===f?void 0:f.status;b=!1,window.setTimeout(()=>b=!0,15e3),(null==y?void 0:y.stopPolling())||m&&!P(r)?((null==y?void 0:y.stopPolling())&&(e=>{Ce.logEvent(ge.INFO,{Event:Se.ACS_ADAPTER_POLLING_STOPPED,Description:"ACS Adapter: Polling call stopped from the client",TimeStamp:(new Date).toISOString(),ChatThreadId:e(fe.ThreadId),ACSRequesterUserId:e(fe.UserId)})})(t),i(e.CLOSED)):(T&&(((e,t)=>{Ce.logEvent(ge.INFO,{Event:Se.ACS_CANCEL_POLLING_CALLBACK,Description:"ACS Adapter: Canceling polling callback with Id "+t,TimeStamp:(new Date).toISOString(),ChatThreadId:e(fe.ThreadId),ACSRequesterUserId:e(fe.UserId)})})(t,T),clearTimeout(T)),T=window.setTimeout(()=>u(this,void 0,void 0,function*(){c<=45&&(b=!0),yield _(n,o,s,a,c+1)}),c<=45?1e3:n),((e,t)=>{Ce.logEvent(ge.INFO,{Event:Se.ACS_CREATE_POLLING_CALLBACK,Description:"ACS Adapter: Created polling callback with Id "+t,TimeStamp:(new Date).toISOString(),ChatThreadId:e(fe.ThreadId),ACSRequesterUserId:e(fe.UserId)})})(t,T))}else Jn(t,"ACS Adapter: Polling skipped because of thread deletion.")}),P=e=>(((e,t)=>{Ce.logEvent(ge.INFO,{Event:Se.ACS_ADAPTER_POLLING_STATUSCODE,Description:"ACS Adapter: Polling status code "+t,TimeStamp:(new Date).toISOString(),ChatThreadId:e(fe.ThreadId),ACSRequesterUserId:e(fe.UserId)})})(t,e),!(401===e||403===e||404===e)),M=()=>u(this,void 0,void 0,function*(){T&&(((e,t)=>{Ce.logEvent(ge.INFO,{Event:Se.ACS_CANCEL_POLLING_CALLBACK,Description:"ACS Adapter: Canceling polling in RTN connected callback Id "+t,TimeStamp:(new Date).toISOString(),ChatThreadId:e(fe.ThreadId),ACSRequesterUserId:e(fe.UserId)})})(t,T),clearTimeout(T)),yield _(t(fe.PollingInterval),R)}),D=e=>u(this,void 0,void 0,function*(){if(e.threadId===t(fe.ThreadId)){if(Ce.logEvent(ge.DEBUG,{Event:Se.MESSAGE_RECEIVED,Description:`ACS Adapter: Received a message with id ${e.id}`,MessageSender:e.sender.communicationUserId,TimeStamp:e.createdOn.toISOString(),ChatThreadId:e.threadId,ChatMessageId:e.id}),C||(C=t(fe.FileManager)),t(fe.WebChatStatus)!==Te.Connected)return Ce.logEvent(ge.INFO,{Event:Se.CACHE_NEW_MESSAGE,Description:"ACS Adapter: Cache new message",TimeStamp:(new Date).toISOString(),ChatThreadId:t(fe.ThreadId),ACSRequesterUserId:t(fe.UserId),ChatMessageId:e.id}),void O.push(e);if(jr(A,e,t,C,Se.ACS_PROCESSING_NEW_MESSAGE))return void Ce.logEvent(ge.INFO,{Event:Se.ACS_SKIP_NEW_MESSAGE,Description:"ACS Adapter: Skipping RTN message, already processed",MessageSender:e.sender.communicationUserId,TimeStamp:(new Date).toISOString(),ChatThreadId:t(fe.ThreadId),ChatMessageId:e.id});const n=yield s(e);n&&S(n)}}),N=e=>u(this,void 0,void 0,function*(){if(xr(e.sender)!==t(fe.UserId)&&e.threadId===t(fe.ThreadId)){Ce.logEvent(ge.DEBUG,{Event:Se.TYPING_MESSAGE_RECEIVED,Description:"ACS Adapter: Received a typing message",MessageSender:e.sender.communicationUserId,TimeStamp:e.receivedOn.toISOString(),ChatThreadId:e.threadId});const t=yield l(e);S(t)}}),x=e=>u(this,void 0,void 0,function*(){if(e.threadId===t(fe.ThreadId)){(e=>{Ce.logEvent(ge.DEBUG,{Event:Se.MESSAGE_DELETED_RECEIVED,Description:`ACS Adapter: Received a message delete event with id ${e.id}`,MessageSender:e.sender.communicationUserId,TimeStamp:e.deletedOn.toISOString(),ChatThreadId:e.threadId,ChatMessageId:e.id})})(e);const n=Object.assign(Object.assign({},e),{message:""});if(jr(A,n,t,C,Se.ACS_PROCESSING_DELETED_MESSAGE))return void((e,t)=>{Ce.logEvent(ge.INFO,{Event:Se.ACS_SKIP_DELETED_MESSAGE,Description:"ACS Adapter: Skipping deleted message RTN, already processed",TimeStamp:(new Date).toISOString(),MessageSender:e.sender.communicationUserId,ChatThreadId:t(fe.ThreadId),ChatMessageId:e.id})})(e,t);const r=yield ni(e,t);r&&S(r)}}),U=e=>u(this,void 0,void 0,function*(){if(e.threadId===t(fe.ThreadId)){if((e=>{Ce.logEvent(ge.DEBUG,{Event:Se.MESSAGE_EDIT_RECEIVED,Description:`ACS Adapter: Received a message edit event with id ${e.id}`,MessageSender:e.sender.communicationUserId,TimeStamp:e.editedOn.toISOString(),ChatThreadId:e.threadId,ChatMessageId:e.id})})(e),C||(C=t(fe.FileManager)),jr(A,e,t,C,Se.ACS_PROCESSING_EDITED_MESSAGE))return void((e,t)=>{Ce.logEvent(ge.INFO,{Event:Se.ACS_SKIP_EDITED_MESSAGE,Description:"ACS Adapter: Skipping edited RTN message, already processed",TimeStamp:(new Date).toISOString(),MessageSender:e.sender.communicationUserId,ChatThreadId:t(fe.ThreadId),ChatMessageId:e.id})})(e,t);const n=yield ti(e,t);n&&S(n)}}),L=e=>u(this,void 0,void 0,function*(){if(e.threadId===t(fe.ThreadId)){(e=>{Ce.logEvent(ge.DEBUG,{Event:Se.STREAMING_CHAT_MESSAGE_CHUNK_RECEIVED,Description:`ACS Adapter: Received a message streaming chunk event with id ${e.id}`,MessageSender:e.sender.communicationUserId,TimeStamp:e.editedOn.toISOString(),ChatThreadId:e.threadId,ChatMessageId:e.id})})(e),C||(C=t(fe.FileManager));const n=A.has(e.id);if(jr(A,e,t,C,Se.ACS_PROCESSING_STREAMING_CHAT_MESSAGE_CHUNK))return void(e=>{Ce.logEvent(ge.INFO,{Event:Se.ACS_SKIP_STREAMING_CHAT_MESSAGE_CHUNK,Description:"ACS Adapter: Skipping RTN streaming message chunk, already processed",MessageSender:e.sender.communicationUserId,TimeStamp:e.editedOn.toISOString(),ChatThreadId:e.threadId,ChatMessageId:e.id})})(e);const r=yield((e,t,n)=>u(void 0,void 0,void 0,function*(){var r;try{const r=(({getState:e,isFirstChunk:t})=>()=>n=>u(void 0,void 0,void 0,function*(){var r,i,o,s;const a=e(fe.ChatClient),c=e(fe.FileManager),u=e(fe.EventManager);if(!a)throw new Error("ACS Adapter: Failed to ingress streaming message chunk event without an active chatClient.");const l=xr(n.sender),d={channelId:gr,channelData:{"webchat:sequence-id":parseInt(n.id)},conversation:{id:e(fe.ThreadId)},from:{id:l,name:n.senderDisplayName?n.senderDisplayName:void 0,role:l===e(fe.UserId)?ur.User:ur.Bot},messageid:n.id,id:n.id?n.id:Vr(),text:n.message,timestamp:n.editedOn.toISOString(),type:cr.Typing};if(n.metadata&&0!==Object.keys(n.metadata).length){let t,a,l;try{const e=c.getFileIds(n.metadata),r=c.getFileMetadata(n.metadata);e&&(t=yield Ur(e,r,c,u),a=yield Lr(t),l=qr(t))}catch(t){Ce.logEvent(ge.ERROR,{Event:Se.ACS_PROCESSING_STREAMING_CHAT_MESSAGE_CHUNK,Description:"Failed to parse StreamingChatMessageChunk metadata",ACSRequesterUserId:e(fe.UserId),MessageSender:n.sender.communicationUserId,TimeStamp:n.editedOn.toISOString(),ChatThreadId:n.threadId,ChatMessageId:n.id,ExceptionDetails:t}),Kn.notifyErrorEvent({ErrorType:$n.MESSAGE_STREAMING_CHUNK_ATTACHMENT_DOWNLOAD_FAILED,ErrorMessage:t.message,ErrorStack:t.stack,ErrorDetails:null==t?void 0:t.details,Timestamp:n.editedOn.toISOString(),AcsChatDetails:{MessageId:n.id,ThreadId:n.threadId,MessageSenderId:n.sender.communicationUserId,RequesterUserId:e(fe.UserId)},AdditionalParams:{MessageEditedEvent:n},CorrelationVector:null===(i=null===(r=null==t?void 0:t.request)||void 0===r?void 0:r.headers)||void 0===i?void 0:i.get("ms-cv")}),u.handleError(t)}d.channelData.metadata=n.metadata,a&&a.length>0&&(d.attachments=a,d.channelData.attachmentSizes=l),(null===(o=n.metadata)||void 0===o?void 0:o.tags)&&n.metadata.tags.length>0&&(d.channelData.tags=null===(s=n.metadata)||void 0===s?void 0:s.tags)}return n.streamingMetadata&&(d.channelData.streamType=n.streamingMetadata.streamingMessageType,d.channelData.streamSequence=n.streamingMetadata.streamingSequenceNumber,d.entities=[{type:lr,streamType:n.streamingMetadata.streamingMessageType,streamSequence:n.streamingMetadata.streamingSequenceNumber}],t||(d.channelData.streamId=n.id,d.entities[0].streamId=n.id)),d}))({getState:t,isFirstChunk:!n}),i=r(),o=yield i(e);return(e=>{Ce.logEvent(ge.INFO,{Event:Se.ACS_ADAPTER_CONVERT_STREAMING_CHAT_MESSAGE_CHUNK,Description:"ACS Adapter: convert streaming message chunk",CustomProperties:e,MessageSender:e.sender.communicationUserId,TimeStamp:e.editedOn.toISOString(),ChatThreadId:e.threadId,ChatMessageId:e.id})})(e),o}catch(n){((e,t,n)=>{Ce.logEvent(ge.ERROR,{Event:Se.ACS_ADAPTER_INGRESS_STREAMING_CHAT_MESSAGE_CHUNK_FAILED,Description:n,ACSRequesterUserId:t(fe.UserId),MessageSender:e.sender.communicationUserId,TimeStamp:e.editedOn.toISOString(),ChatThreadId:e.threadId,ChatMessageId:e.id})})(e,t,null!==(r=n.message)&&void 0!==r?r:"")}}))(e,t,n);r&&S(r)}}),q=e=>u(this,void 0,void 0,function*(){if(e.threadId===t(fe.ThreadId)){if(t(fe.WebChatStatus)!==Te.Connected)return(e=>{Ce.logEvent(ge.INFO,{Event:Se.CACHE_NEW_MESSAGE,Description:"ACS Adapter: Cache new participant added event",ACSRequesterUserId:e.addedBy.id.communicationUserId,TimeStamp:e.addedOn.toISOString(),ChatThreadId:e.threadId,UserAdded:e.participantsAdded.map(e=>e.id.communicationUserId)})})(e),void O.push(e);if((e=>{Ce.logEvent(ge.DEBUG,{Event:Se.PARTICIPANT_ADDED_RECEIVED,Description:"ACS Adapter: Received a participant added event",ACSRequesterUserId:e.addedBy.id.communicationUserId,TimeStamp:e.addedOn.toISOString(),ChatThreadId:e.threadId,UserAdded:e.participantsAdded.map(e=>e.id.communicationUserId)})})(e),((e,t,n)=>{const r=Pr(t),i=Ar(e,r,{addedParticipants:t.participantsAdded});return i||(((e,t)=>{Ce.logEvent(ge.INFO,{Event:Se.ACS_PROCESSING_PARTICIPANT_ADDED_EVENT,Description:"ACS Adapter: Processing participant added event",ACSRequesterUserId:t.addedBy.id.communicationUserId,TimeStamp:(new Date).toISOString(),ChatThreadId:e(fe.ThreadId),UserAdded:t.participantsAdded.map(e=>e.id.communicationUserId)})})(n,t),e.set(r,{addedParticipants:t.participantsAdded})),i})(A,e,t))return void((e,t)=>{Ce.logEvent(ge.INFO,{Event:Se.ACS_PARTICIPANT_ADDED_EVENT_PROCESSED,Description:"ACS Adapter: Skipping RTN participant added event, already processed",ACSRequesterUserId:t.addedBy.id.communicationUserId,TimeStamp:(new Date).toISOString(),ChatThreadId:e(fe.ThreadId),UserAdded:t.participantsAdded.map(e=>e.id.communicationUserId)})})(t,e);Jr(e.participantsAdded,mr,t,S)}}),j=e=>u(this,void 0,void 0,function*(){if(e.threadId===t(fe.ThreadId)){if(t(fe.WebChatStatus)!==Te.Connected)return(e=>{Ce.logEvent(ge.INFO,{Event:Se.CACHE_NEW_MESSAGE,Description:"ACS Adapter: Cache new participant added even",ACSRequesterUserId:e.removedBy.id.communicationUserId,TimeStamp:e.removedOn.toISOString(),ChatThreadId:e.threadId,UserRemoved:e.participantsRemoved.map(e=>e.id.communicationUserId)})})(e),void O.push(e);if((e=>{Ce.logEvent(ge.DEBUG,{Event:Se.PARTICIPANT_REMOVED_RECEIVED,Description:"ACS Adapter: Received a participant removed event",ACSRequesterUserId:e.removedBy.id.communicationUserId,TimeStamp:e.removedOn.toISOString(),ChatThreadId:e.threadId,UserRemoved:e.participantsRemoved.map(e=>e.id.communicationUserId)})})(e),((e,t,n)=>{const r=Pr(t),i=Ar(e,r,{removedParticipants:t.participantsRemoved});return i||(((e,t)=>{Ce.logEvent(ge.INFO,{Event:Se.ACS_PROCESSING_PARTICIPANT_ADDED_EVENT,Description:"ACS Adapter: Processing participant removed event",ACSRequesterUserId:t.removedBy.id.communicationUserId,TimeStamp:(new Date).toISOString(),ChatThreadId:e(fe.ThreadId),UserRemoved:t.participantsRemoved.map(e=>e.id.communicationUserId)})})(n,t),e.set(r,{removedParticipants:t.participantsRemoved})),i})(A,e,t))return void((e,t)=>{Ce.logEvent(ge.INFO,{Event:Se.ACS_PARTICIPANT_REMOVED_EVENT_PROCESSED,Description:"ACS Adapter: Skipping RTN participant removed event, already processed",ACSRequesterUserId:t.removedBy.id.communicationUserId,TimeStamp:(new Date).toISOString(),ChatThreadId:e(fe.ThreadId),UserRemoved:t.participantsRemoved.map(e=>e.id.communicationUserId)})})(t,e);Jr(e.participantsRemoved,vr,t,S)}}),F=e=>u(this,void 0,void 0,function*(){if(e.threadId===t(fe.ThreadId)){Ce.logEvent(ge.DEBUG,{Event:Se.THREAD_DELETED_RECEIVED,Description:"ACS Adapter: Received a thread deleted event",ACSRequesterUserId:e.deletedBy.id.communicationUserId,TimeStamp:e.deletedOn.toISOString(),ChatThreadId:e.threadId});const t=yield d(e);S(t)}});return c.on("chatMessageReceived",D),Ce.logEvent(ge.DEBUG,{Event:Se.REGISTER_ON_NEW_MESSAGE,Description:"ACS Adapter: Registering on new message success"}),c.on("typingIndicatorReceived",N),Ce.logEvent(ge.DEBUG,{Event:Se.REGISTER_ON_TYPING_INDICATOR,Description:"ACS Adapter: Registering on typing indicator success"}),c.on("chatMessageEdited",U),Ce.logEvent(ge.DEBUG,{Event:Se.REGISTER_ON_MESSAGE_EDIT,Description:"ACS Adapter: Registering on message edit success"}),c.on("chatMessageDeleted",x),Ce.logEvent(ge.DEBUG,{Event:Se.REGISTER_ON_MESSAGE_DELETED,Description:"ACS Adapter: Registering on message delete success"}),c.on("chatThreadDeleted",F),Ce.logEvent(ge.DEBUG,{Event:Se.REGISTER_ON_THREAD_DELETED,Description:"ACS Adapter: Registering on thread delete success"}),c.on("realTimeNotificationConnected",()=>u(this,void 0,void 0,function*(){Ce.logEvent(ge.DEBUG,{Event:Se.ACS_ADAPTER_REALTIME_NOTIFICATION_CONNECTED,Description:"ACS Adapter: Realtime notification connected",TimeStamp:(new Date).toISOString()}),yield M()})),Ce.logEvent(ge.DEBUG,{Event:Se.REGISTER_ON_REALTIME_NOTIFICATION_CONNECTED,Description:"ACS Adapter: Registering on realtime notification connected"}),c.on("realTimeNotificationDisconnected",()=>u(this,void 0,void 0,function*(){E=new Date,Ce.logEvent(ge.DEBUG,{Event:Se.ACS_ADAPTER_REALTIME_NOTIFICATION_DISCONNECTED,Description:"ACS Adapter: Realtime notification disconnected",TimeStamp:E.toISOString()})})),Ce.logEvent(ge.DEBUG,{Event:Se.REGISTER_ON_REALTIME_NOTIFICATION_DISCONNECTED,Description:"ACS Adapter: Registering on realtime notification disconnected"}),c.on("streamingChatMessageChunkReceived",L),Ce.logEvent(ge.DEBUG,{Event:Se.REGISTER_ON_STREAMING_CHAT_MESSAGE_CHUNK_RECEIVED,Description:"ACS Adapter: Registering on streaming chat message chunk received"}),(null==h?void 0:h.enableThreadMemberUpdateNotification)&&(c.on("participantsAdded",q),Ce.logEvent(ge.DEBUG,{Event:Se.REGISTER_ON_PARTICIPANT_ADDED,Description:"ACS Adapter: Registering on participant added success"}),c.on("participantsRemoved",j),Ce.logEvent(ge.DEBUG,{Event:Se.REGISTER_ON_PARTICIPANT_REMOVED,Description:"ACS Adapter: Registering on participant removed success"})),(null==h?void 0:h.enableLeaveThreadOnWindowClosed)&&t(fe.EventManager).addEventListener("beforeunload",()=>{const e=t(fe.Token),n=t(fe.EnvironmentUrl),r=t(fe.ThreadId),i=t(fe.UserId);fetch(`${n}/chat/threads/${r}/members/${i}?api-version=2020-09-21-preview2`,{keepalive:!0,method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}})}),g(w,S),(()=>{u(this,void 0,void 0,function*(){const e=t(fe.EventManager);null==e||e.addEventListener("queue-attachment-download",e=>u(this,void 0,void 0,function*(){yield Kr(e,I,t)}))})})(),(()=>{u(this,void 0,void 0,function*(){const e=t(fe.EventManager);null==e||e.addEventListener("acs-attachment-downloaded",e=>u(this,void 0,void 0,function*(){const{chatMessage:t,files:n}=e.detail.payload;Ce.logEvent(ge.INFO,{Event:Se.ACS_ADAPTER_ATTACHMENT_DOWNLOADED,Description:"ACS Adapter: Attachment downloaded "+(null==n?void 0:n.map(e=>e.name).join(",")),MessageSender:t.sender.communicationUserId,TimeStamp:t.createdOn.toISOString(),ChatMessageId:t.id});const r=yield a(t,n);r&&(Ce.logEvent(ge.INFO,{Event:Se.ACS_ADAPTER_POST_FILE_ACTIVITY,Description:"ACS Adapter: Post file attachment activity, messageId: "+r.messageid,MessageSender:t.sender.communicationUserId,TimeStamp:t.createdOn.toISOString(),ChatMessageId:t.id}),S(r))}))})})(),(()=>{u(this,void 0,void 0,function*(){const e=t(fe.EventManager);null==e||e.addEventListener("webchat-status-connected",()=>u(this,void 0,void 0,function*(){for(Ce.logEvent(ge.DEBUG,{Event:Se.WEBCHAT_STATUS_CONNECTED,Description:"ACS Adapter: Event Webchat connected received"});si.length>0;){const e=si.pop();Zn(t,e),Yr(e,t,S,"ACS Adapter: Post activity, paged history message with Id: ")}for(;k.length>0;){const e=k.pop();er(t,e),Br(e,A,C);const n="ACS Adapter: Post activity, history messageId: "+e.id;Yr(e,t,S,n)}for(;O.length>0;){const n=O.pop();br(n)?(e=n,Ce.logEvent(ge.DEBUG,{Event:Se.PROCESS_CACHED_NEW_MESSAGE,Description:"ACS Adapter: Process cached new participants added event",ACSRequesterUserId:e.addedBy.id.communicationUserId,TimeStamp:e.addedOn.toISOString(),ChatThreadId:e.threadId,UserAdded:e.participantsAdded.map(e=>e.id.communicationUserId)}),Jr(n.participantsAdded,mr,t,S)):Ir(n)?(nr(n),Jr(n.participantsRemoved,vr,t,S)):"message"in n&&(tr(n),yield D(n))}var e}))})})(),m(w,R),(e=>{u(this,void 0,void 0,function*(){const r=t(fe.EventManager);null==r||r.addEventListener("online",()=>u(this,void 0,void 0,function*(){const r=t(fe.DisconnectUTC);Ce.logEvent(ge.DEBUG,{Event:Se.NETWORK_ONLINE,Description:`ACS Adapter: ACS Chat reconnected event since disconnect at ${r}`,TimeStamp:(new Date).toISOString()}),r&&(n(fe.DisconnectUTC,void 0),T&&(Ce.logEvent(ge.INFO,{Event:Se.ACS_CANCEL_POLLING_CALLBACK,Description:"ACS Adapter: Canceling polling in network connected Id "+T,TimeStamp:(new Date).toISOString(),ChatThreadId:t(fe.ThreadId),ACSRequesterUserId:t(fe.UserId)}),clearTimeout(T)),b=!0,yield _(t(fe.PollingInterval),e,r))}))})})(R),h.historyPageSizeLimit?(p(v,w,S,void 0,h&&h.historyPageSizeLimit),f(v,w,S,h&&h.historyPageSizeLimit)):(T&&(Ce.logEvent(ge.INFO,{Event:Se.ACS_CANCEL_POLLING_CALLBACK,Description:"ACS Adapter: Canceling polling, if any, at the start "+T,TimeStamp:(new Date).toISOString(),ChatThreadId:t(fe.ThreadId),ACSRequesterUserId:t(fe.UserId)}),clearTimeout(T)),_(t(fe.PollingInterval),R)),()=>{w.unsubscribed=!0,c.off("chatMessageReceived",D),c.off("typingIndicatorReceived",N),c.off("chatMessageEdited",U),c.off("chatMessageDeleted",x),c.off("participantsAdded",q),c.off("participantsRemoved",j),c.off("chatThreadDeleted",F),c.off("streamingChatMessageChunkReceived",L)}})),c(h,v)})})}const ui={requestOptions:{customHeaders:{"x-ms-useragent":`acs-webchat-adapter-${hr.rE}  azsdk-js-communication-chat/${hr.El.oY}`}}};class li{static isACSConnected(e,t){var n,r,i,o;return u(this,void 0,void 0,function*(){let s=0;for(;s<5;)try{return t&&e?(yield t.getProperties(ui),!0):(Ce.logEvent(ge.ERROR,{Event:Se.ACS_SDK_CHATCLIENT_RECONNECT_ERROR,Description:"Trying to reconnect failed as ACS Client is in uninitialized state"}),!1)}catch(e){s++;const t=null===(n=null==e?void 0:e.response)||void 0===n?void 0:n.status;if(s>=5||t&&this.isNotRetryable(t))return Ce.logEvent(ge.ERROR,{Event:Se.ACS_SDK_CHATCLIENT_RECONNECT_ERROR,Description:`Trying to reconnect failed with status ${t} after retries ${s}`,ExceptionDetails:e}),Kn.notifyErrorEvent({StatusCode:null===(r=null==e?void 0:e.response)||void 0===r?void 0:r.status,ErrorType:$n.ADAPTER_RECONNECT_FAILED,ErrorMessage:null==e?void 0:e.message,ErrorStack:null==e?void 0:e.stack,ErrorDetails:null==e?void 0:e.details,Timestamp:(new Date).toISOString(),CorrelationVector:null===(o=null===(i=null==e?void 0:e.request)||void 0===i?void 0:i.headers)||void 0===o?void 0:o.get("ms-cv")}),!1;yield wr(1e3*Math.pow(2,s))}return!1})}static isNotRetryable(e){return 401===e||403===e||404===e}}class di{constructor(e){this.getIsPollingEnabled=()=>!this.messagePoller||this.messagePoller.getIsPollingEnabled(),this.stopPolling=()=>!!this.messagePoller&&this.messagePoller.stopPolling(),this.messagePoller=e}}class hi{constructor(e,t,n){this.accessToken=e,this.downloadUrl=t,this.uploadUrl=n}downloadBlob(e){return u(this,void 0,void 0,function*(){const t=yield fetch(e);if(!t.ok)throw new Error("Failed to fetch file contents.");return yield t.blob()})}downloadDriveItem(e){var t;return u(this,void 0,void 0,function*(){const n=this.downloadUrl(e),r={method:"GET",headers:{Authorization:"Bearer "+this.accessToken,"Content-Type":"application/json"}},i=yield fetch(n,r),o=yield i.json();if(!i.ok)throw new Error(`Failed to download drive item from OneDrive: ${null===(t=o.error)||void 0===t?void 0:t.message}`);return o})}downloadDriveItemContents(e){var t;return u(this,void 0,void 0,function*(){const n=yield fetch(e);if(!n.ok){const e=yield n.json();throw new Error(`Failed to download drive item contents from OneDrive: ${null===(t=e.error)||void 0===t?void 0:t.message}`)}return yield n.blob()})}uploadFiles(e){return u(this,void 0,void 0,function*(){return Promise.all(e.map(e=>u(this,void 0,void 0,function*(){const t=yield this.downloadBlob(e.contentUrl),n=this.uploadUrl(e.name),r={method:"PUT",headers:{Authorization:"Bearer "+this.accessToken,"Content-Type":e.contentType},body:t},i=yield fetch(n,r),o=yield i.json();if(o.error)throw new Error(`Failed to upload file to OneDrive. ${o.error.message}`);return{fileId:o.id,metadata:{filename:e.name}}})))})}downloadFiles(e){return u(this,void 0,void 0,function*(){return Promise.all(e.map(e=>u(this,void 0,void 0,function*(){var t,n;const r=yield this.downloadDriveItem(e.fileId),i=r["@microsoft.graph.downloadUrl"],o=yield this.downloadDriveItemContents(i);return e.metadata&&console.log(`File name: ${null===(t=e.metadata)||void 0===t?void 0:t.name}`),new File([o],r.name,{type:null===(n=r.file)||void 0===n?void 0:n.mimeType,lastModified:r.lastModifiedDateTime})})))})}updatePermissions(){return u(this,void 0,void 0,function*(){throw new Error("Method not implemented.")})}getFileIds(e){if(null==e?void 0:e.onedriveReferences)try{return JSON.parse(null==e?void 0:e.onedriveReferences)}catch(e){throw new Error("Failed to parse onedriveReferences in ChatMessage metadata.")}}createFileIdProperty(e){return{onedriveReferences:JSON.stringify(e)}}getFileMetadata(e){if(null==e?void 0:e.onedriveMetadata)try{return JSON.parse(null==e?void 0:e.onedriveMetadata)}catch(e){throw new Error("Failed to parse onedriveMetadata in ChatMessage metadata.")}}createFileMetadataProperty(e){return{onedriveMetadata:JSON.stringify(e)}}createBotAttachment(e){if(!e||0===Object.keys(e).length)return null;const t=this.getFileMetadata(e),n=this.getFileIds(e);let r,i;return n&&n.length>0&&(r=n[0]),t&&t.length>0&&(i=t[0]),r?{contentType:null==i?void 0:i.contentType,name:null==i?void 0:i.fileName,content:{uniqueId:r}}:null}}const pi=(t,n,r,i,o,c=3e4,l,d,h,f,g)=>(c=c>=5e3?c:5e3,be(g,s(function(){return t=>n=>{const r=t(n);let i;r.setState(fe.WebChatStatus,Te.Uninitialized),r.addEventListener("open",()=>u(this,void 0,void 0,function*(){const e=r.getState(fe.EventManager);if(Ce.logEvent(ge.INFO,{Event:Se.ADAPTER_STATE_UPDATE,Description:"Adapter state has been changed to open"}),i)Ce.logEvent(ge.INFO,{Event:Se.WEBCHAT_SUBSCRIPTION_SUCCESS,Description:"WebChat already connected"}),i.next(Te.Connected),r.setState(fe.WebChatStatus,Te.Connected),e.raiseCustomEvent("webchat-status-connected",{});else{let t=5;const o=(null==n?void 0:n.webChatInitTimeout)?null==n?void 0:n.webChatInitTimeout:2e3;for(;!i&&t<o;)yield Ee(t),t*=2;i?(Ce.logEvent(ge.INFO,{Event:Se.WEBCHAT_SUBSCRIPTION_SUCCESS,Description:`WebChat subscribed to connection status changes in ${t} ms`}),i.next(Te.Connected),r.setState(fe.WebChatStatus,Te.Connected),e.raiseCustomEvent("webchat-status-connected",{})):(Ce.logEvent(ge.ERROR,{Event:Se.WEBCHAT_SUBSCRIPTION_TIMEOUT,Description:`WebChat couldn't subscribe to connection status changes in ${o} ms`}),e.handleError(new Error("WebChat subscription timeout to connection status changes")),r.setState(fe.WebChatStatus,Te.FailedToConnect))}})),r.addEventListener("error",()=>{Ce.logEvent(ge.INFO,{Event:Se.ADAPTER_STATE_UPDATE,Description:"Adapter state has been changed to error"});const t=r.getReadyState()===e.CLOSED?Te.FailedToConnect:Te.Connecting;i&&i.next(t),r.setState(fe.WebChatStatus,t)});let o=!0;return Object.assign(Object.assign({},r),{activity$:ye(new(ve())(t=>{const n=new AbortController;return function(){var e,i,o,s;u(this,void 0,void 0,function*(){try{try{for(var a,c=!0,u=p(r.activities({signal:n.signal}));a=yield u.next(),!(e=a.done);){s=a.value,c=!1;try{const e=s;t.next(e)}finally{c=!0}}}catch(e){i={error:e}}finally{try{c||e||!(o=u.return)||(yield o.call(u))}finally{if(i)throw i.error}}t.complete()}catch(e){t.error(e)}})}(),o?o=!1:(r.setReadyState(e.CONNECTING),r.setReadyState(e.OPEN),r.setState(fe.Reconnect,!0)),()=>{n.abort()}})),connectionStatus$:ye(new(ve())(e=>(e.next(Te.Uninitialized),e.next(Te.Connecting),i=e,()=>{i=void 0}))),end:()=>{r.close()},postActivity:e=>new(ve())(t=>{!function(){u(this,void 0,void 0,function*(){yield r.egress(e,{progress:({id:e})=>e&&t.next(e)}),t.complete()})}()})})}}(),function(t,n,r,i,o,c,l,d,h,p,f){return s(s=>a=>{Ce.setInstance(p),Kn.setInstance(l);const g=new di(f.messagePollingHandle),m=s(a),v=new ar;return m.setState(fe.BotId,void 0),m.setState(fe.ChatClient,void 0),m.setState(fe.UserId,void 0),m.setState(fe.AuthConfig,void 0),m.setState(fe.ChatThreadClient,void 0),m.setState(fe.UserDisplayName,void 0),m.setState(fe.ConnectionStatusObserverReady,!1),m.setState(fe.DisconnectUTC,void 0),m.setState(fe.EventManager,v),m.setState(fe.AdapterOptions,f),m.setState(fe.EnvironmentUrl,void 0),m.setState(fe.ThreadId,void 0),m.setState(fe.Token,void 0),m.setState(fe.Reconnect,!1),m.setState(fe.FileManager,void 0),m.setState(fe.PollingInterval,c),m.setState(fe.MessagePollingHandleInstance,g),function(){u(this,void 0,void 0,function*(){const s=yield((e,t,n,r,i,o)=>u(void 0,void 0,void 0,function*(){var s,a;const c={chatClient:void 0,chatThreadClient:void 0};try{e||(or(n,t,"ACS Adapter: ACS Adapter start init error. Token is null."),Kn.notifyErrorEvent({ErrorType:$n.ADAPTER_INIT_TOKEN_MISSING_ERROR,Timestamp:(new Date).toISOString(),AcsChatDetails:{ThreadId:n,RequesterUserId:t}})),n||(or(n,t,"ACS Adapter: ACS Adapter start init error. ThreadId is null."),Kn.notifyErrorEvent({ErrorType:$n.ADAPTER_INIT_THREAD_ID_MISSING_ERROR,Timestamp:(new Date).toISOString(),AcsChatDetails:{RequesterUserId:t}})),zn.id=t,zn.environmentUrl=r,zn.token=e,Wn.displayName=null!=i?i:"",((e,t)=>{Ce.logEvent(ge.INFO,{Event:Se.ACS_SDK_START_INIT,ChatThreadId:e,ACSRequesterUserId:t,Description:"ACS Adapter: ACS Adapter start init."})})(n,t);const s=new Vn(e);return c.chatClient=null!=o?o:new qn(zn.environmentUrl,s),c.chatThreadClient=c.chatClient.getChatThreadClient(n),c.chatThreadClient||Ce.logEvent(ge.ERROR,{Event:Se.ACS_SDK_JOINTHREAD_ERROR,Description:"ACS Adapter: failed to join the thread."}),yield c.chatClient.startRealtimeNotifications(),c}catch(e){or(n,t,"ACS Adapter: ACS Adapter start init error.",e),Kn.notifyErrorEvent({ErrorType:$n.ADAPTER_INIT_EXCEPTION,ErrorMessage:e.message,ErrorStack:e.stack,ErrorDetails:null==e?void 0:e.details,Timestamp:(new Date).toISOString(),AcsChatDetails:{RequesterUserId:t,ThreadId:t},CorrelationVector:null===(a=null===(s=null==e?void 0:e.request)||void 0===s?void 0:s.headers)||void 0===a?void 0:a.get("ms-cv")})}}))(t,n,r,i,d,h);m.setState(fe.ThreadId,r),m.setState(fe.ChatClient,s.chatClient),m.setState(fe.ChatThreadClient,s.chatThreadClient),m.setState(fe.UserId,zn.id),m.setState(fe.UserDisplayName,d),m.setState(fe.AuthConfig,zn),m.setState(fe.EnvironmentUrl,i),m.setState(fe.Token,t),m.setState(fe.FileManager,o),m.setReadyState(e.OPEN),v.addEventListener("online",()=>u(this,void 0,void 0,function*(){(yield li.isACSConnected(s.chatClient,s.chatThreadClient))?(m.setReadyState(e.OPEN),Ce.logEvent(ge.INFO,{Event:Se.ACS_SDK_RECONNECT,Description:"ACS Adapter: Reconnect to network."})):v.handleError(new Error("ACS Chat client could not reconnect"))})),v.addEventListener("offline",()=>{m.setReadyState(e.CONNECTING),m.setState(fe.DisconnectUTC,new Date)})})}(),m},function(e){return s(function(...e){return a(e=>e.ingress,(e,t)=>Object.assign(Object.assign({},e),{ingress:t}))(...e)}(...e&&e.ingressMiddleware?e.ingressMiddleware:[]),ci())}(f),function(e){return function(...e){return a(e=>e.egress,(e,t)=>Object.assign(Object.assign({},e),{egress:t}))(...e)}(...e&&e.egressMiddleware?e.egressMiddleware:[],function(){return({getState:e})=>t=>n=>u(this,void 0,void 0,function*(){var r,i;if(n.type!==cr.Message||!(n.attachments||[]).length)return t(n);const{attachments:o}=n,s=e(fe.FileManager),a=e(fe.EventManager);n.channelData=Object.assign(Object.assign({},n.channelData),{uploadedFiles:[]}),Ce.logEvent(ge.ERROR,{Event:Se.FILEMANAGER_UPLOAD_FILE_FAILED,Description:"Sending upload file request",ACSRequesterUserId:e(fe.UserId),TimeStamp:n.timestamp,ChatThreadId:e(fe.ThreadId)});try{const e=yield s.uploadFiles(o);n.channelData.uploadedFiles=e}catch(t){Ce.logEvent(ge.ERROR,{Event:Se.FILEMANAGER_UPLOAD_FILE_FAILED,Description:"Uploading file failed",ACSRequesterUserId:e(fe.UserId),TimeStamp:n.timestamp,ChatThreadId:e(fe.ThreadId),ExceptionDetails:t}),Kn.notifyErrorEvent({ErrorType:$n.EGRESS_ATTACHMENT_UPLOAD_FAILED,ErrorMessage:t.message,ErrorStack:t.stack,ErrorDetails:null==t?void 0:t.details,Timestamp:n.timestamp,AcsChatDetails:{ThreadId:e(fe.ThreadId),RequesterUserId:e(fe.UserId)},AdditionalParams:{activity:n},CorrelationVector:null===(i=null===(r=null==t?void 0:t.request)||void 0===r?void 0:r.headers)||void 0===i?void 0:i.get("ms-cv")}),a.handleError(t)}t(n)})}(),function(){return({getState:e})=>t=>n=>u(this,void 0,void 0,function*(){var r,i,o,s,a,c,u,l,d,h;if(n.type!==cr.Message)return t(n);const p=e(fe.ChatThreadClient),f=e(fe.UserDisplayName),g=e(fe.EventManager),m=e(fe.FileManager);if(!p){const t="ACS Adapter: Failed to egress message without an active chatThreadClient.";throw Ce.logEvent(ge.ERROR,{Event:Se.ACS_ADAPTER_EGRESS_FAILED,Description:t,ACSRequesterUserId:e(fe.UserId),TimeStamp:n.timestamp,ChatThreadId:e(fe.ThreadId),ChatMessageId:n.messageid}),new Error(t)}Ce.logEvent(ge.INFO,{Event:Se.ACS_ADAPTER_EGRESS_MESSAGE,Description:"Convert activity to egress ACS message",ACSRequesterUserId:e(fe.UserId),TimeStamp:n.timestamp,ChatThreadId:e(fe.ThreadId),ChatMessageId:n.messageid});const{text:v,value:y}=n,C=Date.now().toString();n.clientmessageid=C;let S=v||"";const T={},E=null===(i=null===(r=n.channelData)||void 0===r?void 0:r.uploadedFiles)||void 0===i?void 0:i.map(e=>null==e?void 0:e.fileId),b=E?m.createFileIdProperty(E):void 0,I=null===(s=null===(o=n.channelData)||void 0===o?void 0:o.uploadedFiles)||void 0===s?void 0:s.map(e=>null==e?void 0:e.metadata),w=I?m.createFileMetadataProperty(I):void 0,R=m.createBotAttachment(Object.assign(Object.assign({},b),w));R&&0!==Object.keys(R).length&&(T.attachments=[R]);const A=null===(a=n.channelData)||void 0===a?void 0:a.tags,O=A?{tags:A}:void 0;let k=null===(c=n.channelData)||void 0===c?void 0:c.metadata;(null===(u=n.channelData)||void 0===u?void 0:u.clientActivityID)&&(k=Object.assign(Object.assign({},k),{clientActivityId:n.channelData.clientActivityID.toString()})),y&&(T.value=y),n.attachmentLayout&&(T.attachmentLayout=n.attachmentLayout),"{}"!==JSON.stringify(T)&&(v&&(T.text=v),S=JSON.stringify(T),k=Object.assign(Object.assign({},k),{"microsoft.azure.communication.chat.bot.contenttype":"azurebotservice.adaptivecard"}));const _=Object.assign(Object.assign({},pr),{senderDisplayName:f||void 0});(k||A||E)&&(_.metadata=Object.assign(Object.assign(Object.assign(Object.assign({},k),O),b),w));const P={content:S};try{Ce.logEvent(ge.INFO,{Event:Se.ACS_ADAPTER_EGRESS_SEND_MESSAGE,Description:"Convert activity to egress ACS message",ACSRequesterUserId:e(fe.UserId),TimeStamp:n.timestamp,ChatThreadId:e(fe.ThreadId),ChatMessageId:n.messageid});const t=yield p.sendMessage(P,_);M=t.id,D=n.channelData.clientActivityID,dr[M]=D,Ce.logEvent(ge.DEBUG,{Event:Se.ACS_ADAPTER_SEND_MESSAGE_SUCCESS,Description:`Adapter: Successfully sent a message with messageid ${t.id}.`,CustomProperties:P,ACSRequesterUserId:e(fe.UserId),TimeStamp:(new Date).toISOString(),ChatThreadId:e(fe.ThreadId),ChatMessageId:n.messageid,ClientActivityId:null==n?void 0:n.channelData.clientActivityID})}catch(t){const r=null==t?void 0:t.request;Ce.logEvent(ge.ERROR,{Event:Se.ACS_ADAPTER_SEND_MESSAGE_FAILED,Description:"Send message failed.",CustomProperties:P,ACSRequesterUserId:e(fe.UserId),TimeStamp:(new Date).toISOString(),ChatThreadId:e(fe.ThreadId),ChatMessageId:n.messageid,ClientActivityId:null==n?void 0:n.channelData.clientActivityID,ExceptionDetails:t}),Kn.notifyErrorEvent({StatusCode:null===(l=t.response)||void 0===l?void 0:l.status,ErrorType:$n.EGRESS_SEND_MESSAGE_FAILED,ErrorMessage:t.message,ErrorStack:t.stack,ErrorDetails:null==t?void 0:t.details,Timestamp:(new Date).toISOString(),AcsChatDetails:{ThreadId:e(fe.ThreadId),RequesterUserId:e(fe.UserId)},AdditionalParams:{activity:n,sendMessageRequest:P,sendMessageOptions:_,httpRequest:r},CorrelationVector:null===(h=null===(d=null==t?void 0:t.request)||void 0===d?void 0:d.headers)||void 0===h?void 0:h.get("ms-cv")}),g.handleError(t)}var M,D})}(),function(){return({getState:e})=>t=>n=>u(this,void 0,void 0,function*(){var r,i,o;if(n.type!==cr.Typing)return t(n);const s=e(fe.ChatThreadClient),a=e(fe.AdapterOptions);if(!s){const t="ACS Adapter: Failed to egress typing activity with an undefined chatThreadClient.";throw Ce.logEvent(ge.ERROR,{Event:Se.ACS_ADAPTER_EGRESS_TYPING_FAILED,Description:t,ACSRequesterUserId:e(fe.UserId),TimeStamp:n.timestamp,ChatThreadId:e(fe.ThreadId)}),new Error(t)}const c=(null==a?void 0:a.enableSenderDisplayNameInTypingNotification)?Object.assign(Object.assign({},fr),{senderDisplayName:e(fe.UserDisplayName)}):Object.assign({},fr);try{Ce.logEvent(ge.DEBUG,{Event:Se.ACS_ADAPTER_EGRESS_TYPING_SENDING_REQUEST,Description:"ACS Adapter: Request sending a typing indication",ACSRequesterUserId:e(fe.UserId),TimeStamp:n.timestamp,ChatThreadId:e(fe.ThreadId)}),yield s.sendTypingNotification(c),Ce.logEvent(ge.DEBUG,{Event:Se.ACS_ADAPTER_INGRESS_TYPING_SUCCESS,Description:"ACS Adapter: Successfully sent a typing indication",ACSRequesterUserId:e(fe.UserId),TimeStamp:n.timestamp,ChatThreadId:e(fe.ThreadId)})}catch(t){const s=null==t?void 0:t.request;Ce.logEvent(ge.ERROR,{Event:Se.ACS_ADAPTER_SEND_MESSAGE_FAILED,Description:"Send message failed.",CustomProperties:c,ACSRequesterUserId:e(fe.UserId),TimeStamp:(new Date).toISOString(),ChatThreadId:e(fe.ThreadId),ChatMessageId:n.messageid,ClientActivityId:null==n?void 0:n.channelData.clientActivityID,ExceptionDetails:t}),Kn.notifyErrorEvent({StatusCode:null===(r=t.response)||void 0===r?void 0:r.status,ErrorType:$n.EGRESS_SEND_MESSAGE_FAILED,ErrorMessage:t.message,ErrorStack:t.stack,ErrorDetails:null==t?void 0:t.details,Timestamp:(new Date).toISOString(),AcsChatDetails:{ThreadId:e(fe.ThreadId),RequesterUserId:e(fe.UserId)},AdditionalParams:{activity:n,httpRequest:s},CorrelationVector:null===(o=null===(i=null==t?void 0:t.request)||void 0===i?void 0:i.headers)||void 0===o?void 0:o.get("ms-cv")})}})}())}(f))}(t,n,r,i,o,c,l,d,h,f,g))))})(),i})(),e.exports=r()},8065:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.failEvent=t.completeEvent=t.startEvent=void 0,t.startEvent=function(e){return e+"Started"},t.completeEvent=function(e){return e+"Completed"},t.failEvent=function(e){return e+"Failed"}},8171:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.IframeLoaded="AMSIframeLoaded",e.SkypeTokenAuth="AMSSkypeTokenAuth",e.CreateObject="AMSCreateObject",e.UploadDocument="AMSUploadDocument",e.GetViewStatus="AMSGetViewStatus",e.GetView="AMSGetView",e.SendTelemetry="AMSSendTelemetry"}(n||(n={})),t.default=n},8178:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Version="1.8.7",t.FullVersionString="AWT-Web-JS-"+t.Version},8185:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.prototype.start=function(){this.timeStart=(new Date).getTime()},e.prototype.stop=function(){return(new Date).getTime()-this.timeStart},e}();t.default=n},8208:(e,t,n)=>{"use strict";function r(e,t){switch(t){case"utf-8":return function(e){return(new TextDecoder).decode(e)}(e);case"base64":return o(e);case"base64url":return function(e){return o(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}(e);case"hex":return function(e){return[...e].map(e=>e.toString(16).padStart(2,"0")).join("")}(e)}}function i(e,t){switch(t){case"utf-8":return function(e){return(new TextEncoder).encode(e)}(e);case"base64":return s(e);case"base64url":return function(e){return s(e.replace(/-/g,"+").replace(/_/g,"/"))}(e);case"hex":return function(e){const t=new Uint8Array(e.length/2);for(let n=0;n<e.length/2;++n){const r=e[2*n],i=e[2*n+1];if(!a.has(r)||!a.has(i))return t.slice(0,n);t[n]=parseInt(`${r}${i}`,16)}return t}(e)}}function o(e){return btoa([...e].map(e=>String.fromCharCode(e)).join(""))}function s(e){return new Uint8Array([...atob(e)].map(e=>e.charCodeAt(0)))}n.d(t,{Al:()=>i,SW:()=>r});const a=new Set("0123456789abcdefABCDEF")},8217:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.low=0,this.high=0,this.low=parseInt(e,10),this.low<0&&(this.high=-1)}return e.prototype._Equals=function(t){var n=new e(t);return this.low===n.low&&this.high===n.high},e}();t.Int64=n;var r=function(){function e(e){this.low=0,this.high=0,this.low=parseInt(e,10)}return e.prototype._Equals=function(t){var n=new e(t);return this.low===n.low&&this.high===n.high},e}();t.UInt64=r;var i=function(){function e(){}return e._ToByte=function(e){return this._ToUInt8(e)},e._ToUInt8=function(e){return 255&e},e._ToInt32=function(e){return 2147483647&e|2147483648&e},e._ToUInt32=function(e){return 4294967295&e},e}();t.Number=i},8224:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7729),i=n(393),o=function(){function e(){}return e.getSDK=function(e){return new Promise(function(t){var n={hostType:e.hostType,protocolType:e.protocolType},o=r.default.getClientBridge(n),s={logger:new i.default(o,e.logger)};return o.setup(s).then(function(){var e={dispose:o.dispose.bind(o),id:o.id,initialize:o.initialize.bind(o),joinConversation:o.joinConversation.bind(o),update:o.update.bind(o),setDebug:o.setDebug.bind(o)};return t(e)})})},e}();t.default=o},8227:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});const r=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,i=function(e){return"string"==typeof e&&r.test(e)}},8247:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.JoinConversation="JoinConversation",e.RegisterOnNewMessage="RegisterOnNewMessage",e.RegisterOnThreadUpdate="RegisterOnThreadUpdate",e.OnNewMessageFailure="OnNewMessageFailure",e.OnThreadUpdateFailure="OnThreadUpdateFailure",e.SendLiveStateFailure="SendLiveStateFailure",e.JoinConversationV1GetThreadRequestFailed="JoinConversationV1GetThreadRequestFailed",e.UpdateToken="UpdateToken",e.SyncingPollData="SyncingPollData",e.IC3InitializationBegins="IC3InitializationBegins",e.IC3StartedPolling="IC3StartedPolling",e.IC3StoppedPolling="IC3StoppedPolling",e.IC3EndpointCreationSuccess="IC3EndpointCreationSuccess",e.RedirectOnRequestCreationFailure="RedirectOnRequestCreationFailure",e.ResetOnRequestCreationFailure="ResetOnRequestCreationFailure",e.MaxRetryCountReachedForRedirect="MaxRetryCountReachedForRedirect",e.OnRequestCreationFailureRedirect="OnRequestCreationFailureRedirect",e.OnRequestCreationSuccessRedirect="OnRequestCreationSuccessRedirect",e.ErrorDuringPolling="ErrorDuringPolling",e.HTTPRequestFailed="HTTPRequestFailed",e.HTTPRequestUnusualResponse="HTTPRequestUnusualResponse"}(n||(n={})),t.default=n},8303:(e,t,n)=>{"use strict";var r=n(4994);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(7383)),o=r(n(4579)),s=function(){function e(){(0,i.default)(this,e)}return(0,o.default)(e,null,[{key:"raiseCustomEvent",value:function(t,n){var r=e.createCustomEvent(t,n);window.dispatchEvent(r)}},{key:"createCustomEvent",value:function(e,t){var n=t?{detail:t}:void 0,r=null;try{r=new CustomEvent(e,n)}catch(t){(r=document.createEvent("CustomEvent")).initCustomEvent(e,!0,!0,n)}return r}}]),e}();t.default=s},8362:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(772),s=n(1649),a=n(4897);t.default=function(e,t,n,c,u,l){return r(void 0,void 0,void 0,function(){var r,d;return i(this,function(i){switch(i.label){case 0:if(e||a.default.throwUninitializedChatSDK(t,s.default.StartPolling),n!==o.default.V2)return[3,4];t.startScenario(s.default.StartPolling),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,null==l?void 0:l.startPolling()];case 2:return i.sent(),t.completeScenario(s.default.StartPolling),[3,4];case 3:return r=i.sent(),d={errorObject:"".concat(r)},t.failScenario(s.default.StartPolling,{RequestId:c,ChatId:u,ExceptionDetails:JSON.stringify(d)}),[3,4];case 4:return[2]}})})}},8369:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7319);t._BondDataType=r._BondDataType;var i=n(3990);t._Encoding=i;var o=n(9267);t.IO=o;var s=n(8217);t.Int64=s.Int64,t.UInt64=s.UInt64,t.Number=s.Number;var a=function(){function e(e){this._stream=e}return e.prototype._WriteBlob=function(e){this._stream._Write(e,0,e.length)},e.prototype._WriteBool=function(e){this._stream._WriteByte(e?1:0)},e.prototype._WriteContainerBegin=function(e,t){this._WriteUInt8(t),this._WriteUInt32(e)},e.prototype._WriteMapContainerBegin=function(e,t,n){this._WriteUInt8(t),this._WriteUInt8(n),this._WriteUInt32(e)},e.prototype._WriteDouble=function(e){var t=i._Double_GetBytes(e);this._stream._Write(t,0,t.length)},e.prototype._WriteFieldBegin=function(e,t,n){t<=5?this._stream._WriteByte(e|t<<5):t<=255?(this._stream._WriteByte(192|e),this._stream._WriteByte(t)):(this._stream._WriteByte(224|e),this._stream._WriteByte(t),this._stream._WriteByte(t>>8))},e.prototype._WriteInt32=function(e){e=i._Zigzag_EncodeZigzag32(e),this._WriteUInt32(e)},e.prototype._WriteInt64=function(e){this._WriteUInt64(i._Zigzag_EncodeZigzag64(e))},e.prototype._WriteString=function(e){if(""===e)this._WriteUInt32(0);else{var t=i._Utf8_GetBytes(e);this._WriteUInt32(t.length),this._stream._Write(t,0,t.length)}},e.prototype._WriteStructEnd=function(e){this._WriteUInt8(e?r._BondDataType._BT_STOP_BASE:r._BondDataType._BT_STOP)},e.prototype._WriteUInt32=function(e){var t=i._Varint_GetBytes(s.Number._ToUInt32(e));this._stream._Write(t,0,t.length)},e.prototype._WriteUInt64=function(e){var t=i._Varint64_GetBytes(e);this._stream._Write(t,0,t.length)},e.prototype._WriteUInt8=function(e){this._stream._WriteByte(s.Number._ToUInt8(e))},e}();t.CompactBinaryProtocolWriter=a},8405:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4746),i=n(5719),o=n(4372),s=n(2343),a=n(7767),c=n(3943),u=function(){function e(){}return e.poll=function(e,t,n){var u=a.default.getDefaultIC3Headers();u[o.default.RegistrationTokenHeader]=t,u[o.default.ContentTypeHeader]=r.default.ContentTypeJson;var l={callbackOnFailure:n,data:JSON.stringify({}),enableExponentialBackoff:!0,headers:u,redirect404RetryCount:r.default.retryCount,retryCount:r.default.retryCount,shouldRedirectOn404:!0,shouldResetOnFailure:!0,shouldRetryOnFailure:c.default.shouldRetryOnFailure,timeBetweenRetry:r.default.timeBetweenOperationRetry,type:s.default.POST,url:e};return i.HttpClient.MakeRequest(l)},e}();t.default=u},8508:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.NoCalling=19235e4]="NoCalling",e[e.VideoAndVoiceCalling=192350001]="VideoAndVoiceCalling",e[e.VoiceOnly=192350002]="VoiceOnly"}(n||(n={})),t.default=n},8536:(e,t,n)=>{"use strict";var r=n(4994);Object.defineProperty(t,"__esModule",{value:!0}),t.CustomContextData=void 0;var i=r(n(7383)),o=r(n(4579)),s=function(){function e(){(0,i.default)(this,e)}return(0,o.default)(e,null,[{key:"sort",value:function(e){var t=new Array;return Object.keys(e).forEach(function(n){if(e&&e["".concat(n)]){var r={key:n,value:e["".concat(n)]};t.push(r)}}),t.sort(function(e,t){var n=e.key.toUpperCase(),r=t.key.toUpperCase();return n<r?-1:n>r?1:0}),t}}]),e}();t.CustomContextData=s},8562:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var r=n(3407),i=n(8823);const o=function(e,t,n){var o=(e=e||{}).random||(e.rng||r.A)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t){n=n||0;for(var s=0;s<16;++s)t[n+s]=o[s];return t}return(0,i.A)(o)}},8580:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},s=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.createIC3Adapter=t.createACSAdapter=t.createDirectLine=void 0;var a=n(2044),c=n(1908),u=n(1649),l=n(9445),d=n(241),h=n(8039),p=n(279),f=n(7064),g=n(1982),m=n(4897),v=n(414),y=function(e,t,n,s,a,c){return i(void 0,void 0,void 0,function(){var i,d,h,p,f;return o(this,function(o){switch(o.label){case 0:i=e.DirectLine?e.DirectLine.options:{},d=v.default.resolveChatAdapterUrl(t,n,s),null==a||a.setCDNPackages({DirectLine:d}),c.startScenario(u.default.CreateDirectLine),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,l.default.loadScript(d)];case 2:return o.sent(),[3,4];case 3:return h=o.sent(),m.default.throwScriptLoadFailure(h,c,u.default.CreateDirectLine),[3,4];case 4:try{return p=window.DirectLine,f=new p.DirectLine(r({},i)),c.completeScenario(u.default.CreateDirectLine),[2,f]}catch(e){m.default.throwChatAdapterInitializationFailure(e,c,u.default.CreateDirectLine)}return[2]}})})};t.createDirectLine=y;var C=function(e,t,n,l,v,y,C,S,T,E,b){return i(void 0,void 0,void 0,function(){var t,n,i,l,v,I,w,R,A,O,k,_,P;return o(this,function(o){t=e.ACSAdapter,n=t?t.options:{},i=[(0,d.default)({widgetId:C.widgetId}),(0,f.default)()],l=[(0,g.default)()],!1===(null===(k=null==t?void 0:t.fileScan)||void 0===k?void 0:k.disabled)&&(l=s([(0,p.default)()],l,!0)),v={notifyErrorEvent:function(e){var n;b.logEvent(c.default.ERROR,r({},e)),(null==t?void 0:t.errorEventSubscriber)&&(null===(n=null==t?void 0:t.errorEventSubscriber)||void 0===n||n.notifyErrorEvent(e))}},I=(null==n?void 0:n.egressMiddleware)?s(s([],n.egressMiddleware,!0),i,!0):s([],i,!0),w=(null==n?void 0:n.ingressMiddleware)?s(s([],n.ingressMiddleware,!0),l,!0):s([],l,!0),R=r(r({enableAdaptiveCards:!0,enableThreadMemberUpdateNotification:!0,enableLeaveThreadOnWindowClosed:!1,enableSenderDisplayNameInTypingNotification:!0},n),{ingressMiddleware:w,egressMiddleware:I}),y.startScenario(u.default.CreateACSAdapter);try{return A=(0,h.createACSAdapter)(S.token,S.visitorId||"teamsvisitor",S.chatId,S.acsEndpoint,T,3e4,v,a.default.Customer,E,b,R),y.completeScenario(u.default.CreateACSAdapter),!1===(null===(P=null===(_=e.ACSAdapter)||void 0===_?void 0:_.fileScan)||void 0===P?void 0:P.disabled)&&(A.end&&(O=A.end,A.end=function(){A.fileManager.fileScanner.end(),O()}),window.chatAdapter=A),[2,A]}catch(e){m.default.throwChatAdapterInitializationFailure(e,y,u.default.CreateACSAdapter)}return[2]})})};t.createACSAdapter=C;var S=function(e,t,n,s,a,c,d,h,p){return i(void 0,void 0,void 0,function(){var i,f,g,y,C;return o(this,function(o){switch(o.label){case 0:i=e.IC3Adapter?e.IC3Adapter.options:{},f=v.default.resolveChatAdapterUrl(t,n,s),null==a||a.setCDNPackages({IC3Adapter:f}),c.startScenario(u.default.CreateIC3Adapter),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,l.default.loadScript(f)];case 2:return o.sent(),[3,4];case 3:return g=o.sent(),m.default.throwScriptLoadFailure(g,c,u.default.CreateACSAdapter),[3,4];case 4:y=r({chatToken:d,userDisplayName:"Customer",userId:d.visitorId||"teamsvisitor",sdkURL:v.default.resolveIC3ClientUrl(t),sdk:h},i);try{return(C=new window.Microsoft.BotFramework.WebChat.IC3Adapter(y)).logger=p,c.completeScenario(u.default.CreateIC3Adapter),[2,C]}catch(e){m.default.throwChatAdapterInitializationFailure(e,c,u.default.CreateIC3Adapter)}return[2]}})})};t.createIC3Adapter=S,t.default={createDirectLine:y,createACSAdapter:C,createIC3Adapter:S}},8603:(e,t,n)=>{"use strict";function r(e){return!("object"!=typeof e||null===e||Array.isArray(e)||e instanceof RegExp||e instanceof Date)}n.d(t,{G:()=>r})},8634:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.AMSClientLoadStates=void 0,function(e){e.LOADING="LOADING",e.LOADED="LOADED",e.ERROR="ERROR",e.NOT_LOADED="NOT_LOADED"}(n||(t.AMSClientLoadStates=n={}))},8644:(e,t,n)=>{"use strict";var r=n(4994);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(7383)),o=r(n(3693)),s=function e(){(0,i.default)(this,e)};t.default=s,(0,o.default)(s,"LiveChatConnectorPath","livechatconnector/organization"),(0,o.default)(s,"LiveChatConnectorAuthPath","livechatconnector/auth/organization"),(0,o.default)(s,"LcwFcsDetailsPath","livechatconnector/v2/lcwfcsdetails"),(0,o.default)(s,"LiveChatConfigPath","livechatconnector/config"),(0,o.default)(s,"LiveChatSessionInitPath","livechatconnector/sessioninit"),(0,o.default)(s,"LiveChatAuthSessionInitPath","livechatconnector/auth/sessioninit"),(0,o.default)(s,"LiveChatGetChatTokenPath","livechatconnector/getchattoken"),(0,o.default)(s,"LiveChatv2GetChatTokenPath","livechatconnector/v2/getchattoken"),(0,o.default)(s,"LiveChatv3GetChatTokenPath","livechatconnector/v3/getchattoken"),(0,o.default)(s,"LiveChatv4GetChatTokenPath","livechatconnector/v4/getchattoken"),(0,o.default)(s,"LiveChatv4AuthGetChatTokenPath","livechatconnector/v4/auth/getchattoken"),(0,o.default)(s,"LiveChatAuthGetChatTokenPath","livechatconnector/auth/getchattoken"),(0,o.default)(s,"LiveChatv2AuthGetChatTokenPath","livechatconnector/v2/auth/getchattoken"),(0,o.default)(s,"LiveChatv3AuthGetChatTokenPath","livechatconnector/v3/auth/getchattoken"),(0,o.default)(s,"LiveChatSessionClosePath","livechatconnector/sessionclose"),(0,o.default)(s,"LiveChatAuthSessionClosePath","livechatconnector/auth/sessionclose"),(0,o.default)(s,"LiveChatSubmitPostChatPath","survey/submitpostchat"),(0,o.default)(s,"LiveChatAuthSubmitPostChatPath","survey/auth/submitpostchat"),(0,o.default)(s,"LiveChatGetSurveyInviteLinkPath","livechatconnector/getsurveyinvite"),(0,o.default)(s,"LiveChatAuthGetSurveyInviteLinkPath","livechatconnector/auth/getsurveyinvite"),(0,o.default)(s,"LiveChatGetChatTranscriptPath","livechatconnector/getchattranscripts"),(0,o.default)(s,"LiveChatv2GetChatTranscriptPath","livechatconnector/v2/getchattranscripts"),(0,o.default)(s,"LiveChatAuthGetChatTranscriptPath","livechatconnector/auth/getchattranscripts"),(0,o.default)(s,"LiveChatv2AuthGetChatTranscriptPath","livechatconnector/v2/auth/getchattranscripts"),(0,o.default)(s,"LiveChatTranscriptEmailRequestPath","livechatconnector/createemailrequest"),(0,o.default)(s,"LiveChatAuthTranscriptEmailRequestPath","livechatconnector/auth/createemailrequest"),(0,o.default)(s,"LiveChatFetchDataMaskingInfoPath","livechatconnector/fetchdatamaskinginfo"),(0,o.default)(s,"LiveChatSecondaryChannelEventPath","livechatconnector/secondarychannelevent"),(0,o.default)(s,"LiveChatAuthSecondaryChannelEventPath","livechatconnector/auth/secondarychannelevent"),(0,o.default)(s,"LiveChatLiveWorkItemDetailsPath","livechatconnector/getliveworkitemdetails"),(0,o.default)(s,"LiveChatAuthLiveWorkItemDetailsPath","livechatconnector/auth/getliveworkitemdetails"),(0,o.default)(s,"LiveChatGetReconnectableChatsPath","livechatconnector/auth/reconnectablechats"),(0,o.default)(s,"LiveChatReconnectAvailabilityPath","livechatconnector/reconnect"),(0,o.default)(s,"LiveChatValidateAuthChatMapRecordPath","livechatconnector/auth/validateauthchatmaprecord"),(0,o.default)(s,"GetAgentAvailabilityPath","livechatconnector/auth/getagentavailability"),(0,o.default)(s,"SendTypingIndicatorPath","inbound/typingindicator/livechat/sendtypingindicator"),(0,o.default)(s,"LiveChatAuthGetPersistentChatHistoryPath","livechatconnector/auth/organization")},8654:(e,t,n)=>{"use strict";var r=n(4994);Object.defineProperty(t,"__esModule",{value:!0}),t.OSInfo=void 0;var i=r(n(7383)),o=r(n(4579)),s=n(86),a=function(){function e(){(0,i.default)(this,e)}return(0,o.default)(e,null,[{key:"getOsType",value:function(){var e=function(){return window.navigator.userAgent};return e().match(/windows\sphone\s\d+\.\d+/i)?s.OperatingSystem.WINDOWS_PHONE:e().match(/ arm;/i)?s.OperatingSystem.WINDOWS_RT:e().match(/(iPad|iPhone|iPod)(?=.*like Mac OS X)/i)?s.OperatingSystem.IOS:e().match(/android/i)?s.OperatingSystem.ANDROID:e().match(/(linux|joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|cros)/i)?s.OperatingSystem.LINUX:e().match(/(macintosh|mac os x)/i)?s.OperatingSystem.MACOSX:e().match(/(windows|win32)/i)?s.OperatingSystem.WINDOWS:s.OperatingSystem.UNKNOWN}}]),e}();t.OSInfo=a},8686:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4938),i=function(){function e(e,t){this._outboundQueue=e,this._maxNumberOfEvents=t,this._currentBatch={},this._currentNumEventsInBatch=0}return e.prototype.addEventToBatch=function(e){if(e.priority===r.AWTEventPriority.Immediate_sync){var t={};return t[e.apiKey]=[e],t}return this._currentNumEventsInBatch>=this._maxNumberOfEvents&&this.flushBatch(),void 0===this._currentBatch[e.apiKey]&&(this._currentBatch[e.apiKey]=[]),this._currentBatch[e.apiKey].push(e),this._currentNumEventsInBatch++,null},e.prototype.flushBatch=function(){this._currentNumEventsInBatch>0&&(this._outboundQueue.push(this._currentBatch),this._currentBatch={},this._currentNumEventsInBatch=0)},e.prototype.hasBatch=function(){return this._currentNumEventsInBatch>0},e}();t.default=i},8688:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5082),i=n(4746),o=n(5881),s=n(7535),a=n(2246),c=n(5719),u=n(3396),l=n(4372),d=n(2343),h=n(8247),p=n(1659),f=n(3311),g=n(1052),m=n(9305),v=n(7767),y=n(7145),C=n(3943),S=n(3364),T=function(){function e(e){this.hostType=a.default.Page,this.protocolType=m.default.IC3V1SDK,this.id=e,this.conversations=[],this.newConversationMessageListeners={},this.threadUpdateListeners={},this.internalConversationsData={},this.liveStateFailureCount=0,this.debug=!1}return e.prototype.startPolling=function(){this.ic3Initializer&&this.ic3Initializer.startPolling()},e.prototype.stopPolling=function(){this.ic3Initializer&&this.ic3Initializer.stopPolling()},e.prototype.setup=function(e){return this.logger=e.logger,c.HttpClient.setLogger(this.logger),Promise.resolve()},e.prototype.initialize=function(e){return this.setupSession(e),Promise.resolve()},e.prototype.update=function(e){return Promise.resolve()},e.prototype.dispose=function(){return this.conversations=[],this.newConversationMessageListeners={},this.threadUpdateListeners={},this.internalConversationsData={},Promise.resolve()},e.prototype.joinConversation=function(e,t){var n;void 0===t&&(t=!0);var r=S.default.timer(),i={id:e};return-1===this.conversations.findIndex(function(e){return e.id===i.id})&&(this.conversations.push(i),this.newConversationMessageListeners[i.id]=this.newConversationMessageListeners[i.id]||[],this.threadUpdateListeners[i.id]=this.threadUpdateListeners[i.id]||[]),null===(n=this.logger)||void 0===n||n.log(p.default.INFO,h.default.JoinConversation,{ElapsedTimeInMilliseconds:r.milliSecondsElapsed,EndpointUrl:this.EndpointUrl,EndpointId:this.EndpointId}),S.default.isNullOrUndefined(t)||!0!==t||this.sendHeartBeat(i.id),Promise.resolve(i)},e.prototype.sendLiveState=function(e){var t=this;this.debug&&console.debug("IC3Core/sendLiveState");var n=g.default.LiveState,r=f.default.Text,o=C.default.createBaseMessageData(n,r,"");return this.sendMessageToIC3(e,o).then(function(){return t.liveStateFailureCount=0,Promise.resolve()}).catch(function(e){var n;t.liveStateFailureCount++,t.liveStateFailureCount>=i.default.liveStateRetryCount&&(null===(n=t.logger)||void 0===n||n.log(p.default.ERROR,h.default.SendLiveStateFailure,{ExceptionDetails:e,EndpointUrl:t.EndpointUrl,EndpointId:t.EndpointId}),t.stopHeartBeat(),t.liveStateFailureCount=0)})},e.prototype.sendHeartBeat=function(e){this.heartBeatTimer||(this.debug&&console.debug("IC3Core/sendHeartBeat"),this.sendLiveState(e),this.heartBeatTimer=window.setInterval(this.sendLiveState.bind(this,e),i.default.heartBeatDuration))},e.prototype.stopHeartBeat=function(){clearInterval(this.heartBeatTimer)},e.prototype.sendMessage=function(e,t){var n=C.default.createMessageData(t);return this.sendMessageToIC3(e.id,n)},e.prototype.getMessages=function(e){var t=this,n=v.default.getDefaultGetMessagesQueryParameters(),r=S.default.addQueryParametersToPath(y.default.getMessagesUrl(e.id,this.ic3Info.RegionGtms),n),o=v.default.getDefaultIC3Headers();o[l.default.RegistrationTokenHeader]=this.ic3Info.RegistrationToken,o[l.default.ContentTypeHeader]=i.default.ContentTypeJson;var s={enableExponentialBackoff:!0,headers:o,redirect404RetryCount:i.default.retryCount,retryCount:i.default.retryCount,shouldRedirectOn404:!1,shouldResetOnFailure:!1,shouldRetryOnFailure:C.default.shouldRetryOnFailure,timeBetweenRetry:i.default.timeBetweenOperationRetry,type:d.default.GET,url:r};return c.HttpClient.MakeRequest(s).then(function(e){for(var r=[],i=0,o=e.messages;i<o.length;i++){var s=o[i];C.default.isSystemMessage(s)||r.push(C.default.createIRawMessage(s,t.ic3Info))}return t.getAllMessagesFromBackwardLinkUrl(e._metadata.backwardLink,n.startTime,r)})},e.prototype.registerOnNewMessage=function(e,t){var n;return this.newConversationMessageListeners[e.id].push(t),null===(n=this.logger)||void 0===n||n.log(p.default.INFO,h.default.RegisterOnNewMessage,{EndpointUrl:this.EndpointUrl,EndpointId:this.EndpointId}),Promise.resolve()},e.prototype.registerOnThreadUpdate=function(e,t){var n;return this.threadUpdateListeners[e.id].push(t),null===(n=this.logger)||void 0===n||n.log(p.default.INFO,h.default.RegisterOnThreadUpdate,{EndpointUrl:this.EndpointUrl,EndpointId:this.EndpointId}),Promise.resolve()},e.prototype.disconnectFromConversation=function(e){return this.conversations.findIndex(function(t){return t.id===e.id}),delete this.internalConversationsData[e.id],this.ic3Info.visitor&&(this.stopHeartBeat(),this.stopPolling()),Promise.resolve()},e.prototype.sendFileData=function(e,t,n){var i=this;if(S.default.isNullOrUndefined(n)&&(n=o.default.AmsBasedFileSharing),t.size<=0)throw new Error("File size is lesser or equal to zero.");var s={fileSharingProtocolType:n,id:"",name:t.name,size:t.size,type:t.type,url:""};return new Promise(function(n,o){r.default.createNewDocument(e.id,t,i.ic3Info).then(function(e){s.id=e.id;var a=C.default.isDocumentTypeImage(t.type);s.url=y.default.getAmsObjectContentUrl(e.id,i.ic3Info.RegionGtms,a),r.default.uploadDocument(e.id,t,i.ic3Info).then(function(){n(s)}).catch(function(e){o(e)})}).catch(function(e){o(e)})})},e.prototype.sendFileMessage=function(e,t,n){return this.sendMessageToIC3(e.id,C.default.createFileMessage(t,this.ic3Info,n))},e.prototype.downloadFileData=function(e,t){var n=this;return this.debug&&console.debug("IC3Core/IC3ClientAdapter/downloadFileData"),new Promise(function(e,i){var s=t.fileSharingProtocolType;S.default.isNullOrUndefined(s)&&(s=o.default.AmsBasedFileSharing),s===o.default.AmsBasedFileSharing?r.default.downloadDocument(t,n.ic3Info).then(function(t){e(t)}).catch(function(e){i(e)}):i("This Protocol is not implemented")})},e.prototype.getFileStatus=function(e,t){var n=this;return new Promise(function(e,i){var a=t.fileSharingProtocolType;S.default.isNullOrUndefined(a)&&(a=o.default.AmsBasedFileSharing),a===o.default.AmsBasedFileSharing?r.default.getFileStatus(t,n.ic3Info).then(function(t){e(t)}).catch(function(e){i(s.default.Error+" e")}):i("This Protocol is not implemented")})},e.prototype.indicateTypingStatus=function(e,t,n){var r=C.default.createTypingStatusThreadMessageData(t,n);return this.sendMessageToIC3(e.id,r)},e.prototype.sendMessageToBot=function(e,t,n){var r=C.default.createBotMessageData(e.id,n),o=y.default.getBotMessagesUrl(t,this.ic3Info.RegionGtms),s=v.default.getDefaultIC3Headers();s[l.default.RegistrationTokenHeader]=this.ic3Info.RegistrationToken,s[l.default.ContentTypeHeader]=i.default.ContentTypeTextPlain;var a={data:r,dataType:u.default.TEXT,enableExponentialBackoff:!0,headers:s,redirect404RetryCount:i.default.retryCount,retryCount:i.default.retryCount,shouldRedirectOn404:!1,shouldResetOnFailure:!1,shouldRetryOnFailure:C.default.shouldRetryOnFailure,timeBetweenRetry:i.default.timeBetweenOperationRetry,type:d.default.POST,url:o};return c.HttpClient.MakeRequest(a)},e.prototype.getMembers=function(e){var t=this.internalConversationsData[e.id].members,n=[];return S.default.isNullOrUndefinedOrEmptyArray(t)||t.forEach(function(e){var t={displayName:e.friendlyName,id:e.id,type:C.default.getPersonType(e.id)};n.push(t)}),Promise.resolve(n)},e.prototype.sendMessageToIC3=function(e,t){var n=y.default.getMessagesUrl(e,this.ic3Info.RegionGtms),r=v.default.getDefaultIC3Headers();r[l.default.RegistrationTokenHeader]=this.ic3Info.RegistrationToken,r[l.default.ContentTypeHeader]=i.default.ContentTypeJson;var o={data:JSON.stringify(t),enableExponentialBackoff:!0,headers:r,redirect404RetryCount:i.default.retryCount,retryCount:i.default.retryCount,shouldRedirectOn404:!1,shouldResetOnFailure:!1,shouldRetryOnFailure:C.default.shouldRetryOnFailure,timeBetweenRetry:i.default.timeBetweenOperationRetry,type:d.default.POST,url:n};return c.HttpClient.MakeRequest(o)},e.prototype.onNewMessage=function(e,t,n){var r,i=this,o=S.default.timer();try{e&&(S.default.isNullOrUndefined(this.newConversationMessageListeners[e.id])||C.default.isSystemMessage(t)||this.newConversationMessageListeners[e.id].forEach(function(e){e(C.default.createIRawMessage(t,i.ic3Info,n))}))}catch(e){var s=o.milliSecondsElapsed;return void(null===(r=this.logger)||void 0===r||r.log(p.default.ERROR,h.default.OnNewMessageFailure,{ExceptionDetails:e,ElapsedTimeInMilliseconds:s,EndpointUrl:this.EndpointUrl,EndpointId:this.EndpointId}))}},e.prototype.onThreadUpdate=function(e,t){var n,r=S.default.timer();try{e&&(S.default.isNullOrUndefined(this.threadUpdateListeners[e.id])||this.threadUpdateListeners[e.id].forEach(function(e){e(C.default.createIRawThread(t))}))}catch(e){var i=r.milliSecondsElapsed;return void(null===(n=this.logger)||void 0===n||n.log(p.default.ERROR,h.default.OnThreadUpdateFailure,{ExceptionDetails:e,ElapsedTimeInMilliseconds:i,EndpointUrl:this.EndpointUrl,EndpointId:this.EndpointId}))}},e.prototype.getAllMessagesFromBackwardLinkUrl=function(e,t,n){var r=this;return S.default.isNullOrEmptyString(e)?Promise.resolve(n):this.getMessagesFromBackwardLinkUrl(e,t).then(function(e){for(var i=0,o=e.messages;i<o.length;i++){var s=o[i];C.default.isSystemMessage(s)||n.push(C.default.createIRawMessage(s,r.ic3Info))}return r.getAllMessagesFromBackwardLinkUrl(e._metadata.backwardLink,t,n)})},e.prototype.getMessagesFromBackwardLinkUrl=function(e,t){var n={startTime:t},r=S.default.addQueryParametersToPath(e,n),o=v.default.getDefaultIC3Headers();o[l.default.RegistrationTokenHeader]=this.ic3Info.RegistrationToken,o[l.default.ContentTypeHeader]=i.default.ContentTypeJson;var s={enableExponentialBackoff:!0,headers:o,redirect404RetryCount:i.default.retryCount,retryCount:i.default.retryCount,shouldRedirectOn404:!1,shouldResetOnFailure:!1,shouldRetryOnFailure:C.default.shouldRetryOnFailure,timeBetweenRetry:i.default.timeBetweenOperationRetry,type:d.default.GET,url:r};return c.HttpClient.MakeRequest(s)},e.prototype.setupSession=function(e){this.ic3Info={SkypeToken:e.token,RegionGtms:e.regionGtms,visitor:e.visitor},S.default.isNullOrUndefined(this.ic3Info)||(this.EndpointId=this.ic3Info.endpointId,this.EndpointUrl=this.ic3Info.RegionGtms?this.ic3Info.RegionGtms.chatService:"")},e.prototype.setDebug=function(e){void 0===e&&(e=!1),this.debug=e},e}();t.default=T},8767:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9382);t.default=function(e){return void 0===e&&(e=!1),r.default.setDebug(e),r.default}},8770:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.suppressConversationDetailsRetrievalFailure=t.suppressChatSDKError=void 0;var i=n(1590);t.suppressChatSDKError=function(e,t,n,i,o,s){void 0===o&&(o={}),void 0===s&&(s="");var a={response:e};t&&(a.errorObject="".concat(t)),n.failScenario(i,r(r({},o),{ExceptionDetails:JSON.stringify(a)})),s&&(a.message=s,console.error(s))},t.suppressConversationDetailsRetrievalFailure=function(e,n,r,o){void 0===o&&(o={}),(0,t.suppressChatSDKError)(i.ChatSDKErrorName.ConversationDetailsRetrievalFailure,e,n,r,o)},t.default={suppressChatSDKError:t.suppressChatSDKError,suppressConversationDetailsRetrievalFailure:t.suppressConversationDetailsRetrievalFailure}},8805:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3465),i=n(4938),o=function(){function e(e){this._event={name:"",properties:{}},e&&this.setName(e)}return e.prototype.setName=function(e){this._event.name=e},e.prototype.getName=function(){return this._event.name},e.prototype.setType=function(e){this._event.type=e},e.prototype.getType=function(){return this._event.type},e.prototype.setTimestamp=function(e){this._event.timestamp=e},e.prototype.getTimestamp=function(){return this._event.timestamp},e.prototype.setEventPriority=function(e){this._event.priority=e},e.prototype.getEventPriority=function(){return this._event.priority},e.prototype.setProperty=function(e,t,n){void 0===n&&(n=i.AWTPropertyType.Unspecified);var o={value:t,type:n,pii:i.AWTPiiKind.NotSet,cc:i.AWTCustomerContentKind.NotSet};null!==(o=r.sanitizeProperty(e,o))?this._event.properties[e]=o:delete this._event.properties[e]},e.prototype.setPropertyWithPii=function(e,t,n,o){void 0===o&&(o=i.AWTPropertyType.Unspecified);var s={value:t,type:o,pii:n,cc:i.AWTCustomerContentKind.NotSet};null!==(s=r.sanitizeProperty(e,s))?this._event.properties[e]=s:delete this._event.properties[e]},e.prototype.setPropertyWithCustomerContent=function(e,t,n,o){void 0===o&&(o=i.AWTPropertyType.Unspecified);var s={value:t,type:o,pii:i.AWTPiiKind.NotSet,cc:n};null!==(s=r.sanitizeProperty(e,s))?this._event.properties[e]=s:delete this._event.properties[e]},e.prototype.getPropertyMap=function(){return this._event.properties},e.prototype.getEvent=function(){return this._event},e}();t.default=o},8823:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});for(var r=n(8227),i=[],o=0;o<256;++o)i.push((o+256).toString(16).substr(1));const s=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(i[e[t+0]]+i[e[t+1]]+i[e[t+2]]+i[e[t+3]]+"-"+i[e[t+4]]+i[e[t+5]]+"-"+i[e[t+6]]+i[e[t+7]]+"-"+i[e[t+8]]+i[e[t+9]]+"-"+i[e[t+10]]+i[e[t+11]]+i[e[t+12]]+i[e[t+13]]+i[e[t+14]]+i[e[t+15]]).toLowerCase();if(!(0,r.A)(n))throw TypeError("Stringified UUID is invalid");return n}},8890:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.shouldRetryForStatus=function(e){return!(e>=300&&e<500&&408!==e||501===e||505===e)},e.getMillisToBackoffForRetry=function(e){var t,n=Math.floor(1200*Math.random())+2400;return t=Math.pow(4,e)*n,Math.min(t,12e4)},e}();t.default=n},8906:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(3547),s=n(9812),a=n(8171),c=n(9714),u=n(1243),l=n(6654),d=n(4569),h=function(){function e(e){void 0===e&&(e=void 0),this.runtimeId=l.uuidv4(),this.debug=!1,this.logger=e,c.default.isBrowser()&&console.error("FramedMode should be used on Web platform"),e&&(this.scenarioMarker=new u.default(e),this.scenarioMarker.setRuntimeId(this.runtimeId))}return e.prototype.setDebug=function(e){this.debug=e},e.prototype.setup=function(){return r(this,void 0,void 0,function(){return i(this,function(e){return[2,Promise.resolve()]})})},e.prototype.initialize=function(e){return r(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return this.debug&&console.log("[FramedlessClient][initialize]"),this.chatToken=e.chatToken,[4,this.skypeTokenAuth()];case 1:return t.sent(),[2]}})})},e.prototype.skypeTokenAuth=function(e){var t,n,c,u,l,d,h,p;return void 0===e&&(e=null),r(this,void 0,void 0,function(){var r,f;return i(this,function(i){switch(i.label){case 0:null===(t=this.scenarioMarker)||void 0===t||t.startScenario(a.default.SkypeTokenAuth,{AMSClientRuntimeId:this.runtimeId,ChatId:e?e.chatId:null===(n=this.chatToken)||void 0===n?void 0:n.chatId}),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,o.default.skypeTokenAuth(e||this.chatToken)];case 2:return(r=i.sent()).ok||null===(c=this.scenarioMarker)||void 0===c||c.failScenario(a.default.SkypeTokenAuth,{AMSClientRuntimeId:this.runtimeId,ChatId:e?e.chatId:null===(u=this.chatToken)||void 0===u?void 0:u.chatId,ExceptionDetails:{status:r.status}}),null===(l=this.scenarioMarker)||void 0===l||l.completeScenario(a.default.SkypeTokenAuth,{AMSClientRuntimeId:this.runtimeId,ChatId:e?e.chatId:null===(d=this.chatToken)||void 0===d?void 0:d.chatId}),[2,r];case 3:throw f=i.sent(),null===(h=this.scenarioMarker)||void 0===h||h.failScenario(a.default.SkypeTokenAuth,{AMSClientRuntimeId:this.runtimeId,ChatId:e?e.chatId:null===(p=this.chatToken)||void 0===p?void 0:p.chatId,RequestPath:f instanceof s.AMSError?f.requestUrl:"",ExceptionDetails:f instanceof Error?f.message:String(f)}),new Error("skypeTokenAuth");case 4:return[2]}})})},e.prototype.createObject=function(e,t,n,c){var u,l,h,p,f,g;return void 0===n&&(n=null),void 0===c&&(c=[]),r(this,void 0,void 0,function(){var r,m;return i(this,function(i){switch(i.label){case 0:null===(u=this.scenarioMarker)||void 0===u||u.startScenario(a.default.CreateObject,{AMSClientRuntimeId:this.runtimeId,ChatId:n?n.chatId:null===(l=this.chatToken)||void 0===l?void 0:l.chatId,MimeType:t.type,FileExtension:d.default(t.name)}),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,o.default.createObject(e,t,n||this.chatToken,c)];case 2:return r=i.sent(),null===(h=this.scenarioMarker)||void 0===h||h.completeScenario(a.default.CreateObject,{AMSClientRuntimeId:this.runtimeId,ChatId:n?n.chatId:null===(p=this.chatToken)||void 0===p?void 0:p.chatId,DocumentId:null==r?void 0:r.id,MimeType:t.type,FileExtension:d.default(t.name)}),[2,r];case 3:throw m=i.sent(),null===(f=this.scenarioMarker)||void 0===f||f.failScenario(a.default.CreateObject,{AMSClientRuntimeId:this.runtimeId,ChatId:n?n.chatId:null===(g=this.chatToken)||void 0===g?void 0:g.chatId,RequestPath:m instanceof s.AMSError?m.requestUrl:"",MimeType:t.type,FileExtension:d.default(t.name),ExceptionDetails:m instanceof Error?m.message:String(m)}),new Error("createObject");case 4:return[2]}})})},e.prototype.uploadDocument=function(e,t,n,c){var u,l,h,p,f,g;return void 0===n&&(n=null),void 0===c&&(c=[]),r(this,void 0,void 0,function(){var r,m;return i(this,function(i){switch(i.label){case 0:null===(u=this.scenarioMarker)||void 0===u||u.startScenario(a.default.UploadDocument,{AMSClientRuntimeId:this.runtimeId,ChatId:n?n.chatId:null===(l=this.chatToken)||void 0===l?void 0:l.chatId,DocumentId:e,MimeType:t.type,FileExtension:d.default(t.name)}),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,o.default.uploadDocument(e,t,n||this.chatToken,c)];case 2:return r=i.sent(),null===(h=this.scenarioMarker)||void 0===h||h.completeScenario(a.default.UploadDocument,{AMSClientRuntimeId:this.runtimeId,ChatId:n?n.chatId:null===(p=this.chatToken)||void 0===p?void 0:p.chatId,DocumentId:e,MimeType:t.type,FileExtension:d.default(t.name)}),[2,r];case 3:throw m=i.sent(),null===(f=this.scenarioMarker)||void 0===f||f.failScenario(a.default.UploadDocument,{AMSClientRuntimeId:this.runtimeId,ChatId:n?n.chatId:null===(g=this.chatToken)||void 0===g?void 0:g.chatId,RequestPath:m instanceof s.AMSError?m.requestUrl:"",DocumentId:e,MimeType:t.type,FileExtension:d.default(t.name),ExceptionDetails:m instanceof Error?m.message:String(m)}),new Error("uploadDocument");case 4:return[2]}})})},e.prototype.getViewStatus=function(e,t,n){var c,u,l,h,p,f;return void 0===t&&(t=null),void 0===n&&(n=[]),r(this,void 0,void 0,function(){var r,g;return i(this,function(i){switch(i.label){case 0:null===(c=this.scenarioMarker)||void 0===c||c.startScenario(a.default.GetViewStatus,{AMSClientRuntimeId:this.runtimeId,ChatId:t?t.chatId:null===(u=this.chatToken)||void 0===u?void 0:u.chatId,DocumentId:null==e?void 0:e.id,MimeType:null==e?void 0:e.type,FileExtension:d.default((null==e?void 0:e.name)||"")}),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,o.default.getViewStatus(e,t||this.chatToken,n)];case 2:return r=i.sent(),null===(l=this.scenarioMarker)||void 0===l||l.completeScenario(a.default.GetViewStatus,{AMSClientRuntimeId:this.runtimeId,ChatId:t?t.chatId:null===(h=this.chatToken)||void 0===h?void 0:h.chatId,DocumentId:null==e?void 0:e.id,MimeType:null==e?void 0:e.type,FileExtension:d.default((null==e?void 0:e.name)||"")}),[2,r];case 3:throw g=i.sent(),null===(p=this.scenarioMarker)||void 0===p||p.failScenario(a.default.GetViewStatus,{AMSClientRuntimeId:this.runtimeId,ChatId:t?t.chatId:null===(f=this.chatToken)||void 0===f?void 0:f.chatId,RequestPath:g instanceof s.AMSError?g.requestUrl:"",DocumentId:null==e?void 0:e.id,MimeType:null==e?void 0:e.type,FileExtension:d.default((null==e?void 0:e.name)||""),ExceptionDetails:g instanceof Error?g.message:String(g)}),new Error("getViewStatus");case 4:return[2]}})})},e.prototype.getView=function(e,t,n,c){var u,l,h,p,f,g;return void 0===n&&(n=null),void 0===c&&(c=[]),r(this,void 0,void 0,function(){var r,m;return i(this,function(i){switch(i.label){case 0:null===(u=this.scenarioMarker)||void 0===u||u.startScenario(a.default.GetView,{AMSClientRuntimeId:this.runtimeId,ChatId:n?n.chatId:null===(l=this.chatToken)||void 0===l?void 0:l.chatId,DocumentId:null==e?void 0:e.id,MimeType:null==e?void 0:e.type,FileExtension:d.default((null==e?void 0:e.name)||"")}),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,o.default.getView(e,t,n||this.chatToken,c)];case 2:return r=i.sent(),null===(h=this.scenarioMarker)||void 0===h||h.completeScenario(a.default.GetView,{AMSClientRuntimeId:this.runtimeId,ChatId:n?n.chatId:null===(p=this.chatToken)||void 0===p?void 0:p.chatId,DocumentId:null==e?void 0:e.id,MimeType:null==e?void 0:e.type,FileExtension:d.default((null==e?void 0:e.name)||"")}),[2,r];case 3:throw m=i.sent(),null===(f=this.scenarioMarker)||void 0===f||f.failScenario(a.default.GetView,{AMSClientRuntimeId:this.runtimeId,ChatId:n?n.chatId:null===(g=this.chatToken)||void 0===g?void 0:g.chatId,RequestPath:m instanceof s.AMSError?m.requestUrl:"",DocumentId:null==e?void 0:e.id,MimeType:null==e?void 0:e.type,FileExtension:d.default((null==e?void 0:e.name)||""),ExceptionDetails:m instanceof Error?m.message:String(m)}),new Error("getView");case 4:return[2]}})})},e.prototype.fetchBlob=function(e){return r(this,void 0,void 0,function(){var t;return i(this,function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),[4,fetch(e)];case 1:return[4,n.sent().blob()];case 2:return[2,n.sent()];case 3:throw t=n.sent(),console.log(t),new Error("fetchBlob");case 4:return[2]}})})},e}();t.default=h},8990:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Unknown=0]="Unknown",e[e.User=1]="User",e[e.Bot=2]="Bot"}(n||(n={})),t.default=n},9021:function(e,t,n){var r;e.exports=(r=r||function(e){var t;if("undefined"!=typeof window&&window.crypto&&(t=window.crypto),"undefined"!=typeof self&&self.crypto&&(t=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(t=globalThis.crypto),!t&&"undefined"!=typeof window&&window.msCrypto&&(t=window.msCrypto),!t&&void 0!==n.g&&n.g.crypto&&(t=n.g.crypto),!t)try{t=n(477)}catch(e){}var r=function(){if(t){if("function"==typeof t.getRandomValues)try{return t.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof t.randomBytes)try{return t.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},i=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),o={},s=o.lib={},a=s.Base={extend:function(e){var t=i(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},c=s.WordArray=a.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes,i=e.sigBytes;if(this.clamp(),r%4)for(var o=0;o<i;o++){var s=n[o>>>2]>>>24-o%4*8&255;t[r+o>>>2]|=s<<24-(r+o)%4*8}else for(var a=0;a<i;a+=4)t[r+a>>>2]=n[a>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=a.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],n=0;n<e;n+=4)t.push(r());return new c.init(t,e)}}),u=o.enc={},l=u.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var o=t[i>>>2]>>>24-i%4*8&255;r.push((o>>>4).toString(16)),r.push((15&o).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new c.init(n,t/2)}},d=u.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var o=t[i>>>2]>>>24-i%4*8&255;r.push(String.fromCharCode(o))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new c.init(n,t)}},h=u.Utf8={stringify:function(e){try{return decodeURIComponent(escape(d.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return d.parse(unescape(encodeURIComponent(e)))}},p=s.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=h.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n,r=this._data,i=r.words,o=r.sigBytes,s=this.blockSize,a=o/(4*s),u=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*s,l=e.min(4*u,o);if(u){for(var d=0;d<u;d+=s)this._doProcessBlock(i,d);n=i.splice(0,u),r.sigBytes-=l}return new c.init(n,l)},clone:function(){var e=a.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),f=(s.Hasher=p.extend({cfg:a.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){p.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new f.HMAC.init(e,n).finalize(t)}}}),o.algo={});return o}(Math),r)},9037:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Text="text",e.TopicUpdated="topicUpdated",e.ParticipantAdded="participantAdded",e.ParticipantRemoved="participantRemoved"}(n||(n={})),t.default=n},9045:(e,t,n)=>{var r=n(3738).default;e.exports=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},e.exports.__esModule=!0,e.exports.default=e.exports},9140:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.failEvent=t.completeEvent=t.startEvent=void 0,t.startEvent=function(e){return"".concat(e,"Started")},t.completeEvent=function(e){return"".concat(e,"Completed")},t.failEvent=function(e){return"".concat(e,"Failed")}},9143:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4782),i=n(4938),o=n(4296),s=n(3290),a=n(8805),c=n(1427),u=n(3465),l="awt_stats",d=function(){function e(){}return e.setEventsHandler=function(e){this._eventHandler=e},e.getEventsHandler=function(){return this._eventHandler},e.scheduleTimer=function(){var e=this,t=this._profiles[this._currentProfile][2];this._timeout<0&&t>=0&&!this._paused&&(this._eventHandler.hasEvents()?(0===t&&this._currentBackoffCount>0&&(t=1),this._timeout=setTimeout(function(){return e._batchAndSendEvents()},t*(1<<this._currentBackoffCount)*1e3)):this._timerCount=0)},e.initialize=function(e){var t=this;this._newEventsAllowed=!0,this._config=e,this._eventHandler=new o.default(e.collectorUri,e.cacheMemorySizeLimitInNumberOfEvents,e.httpXHROverride,e.clockSkewRefreshDurationInMins),this._initializeProfiles(),s.default.initialize(function(e,n){if(t._config.canSendStatEvent(l)){var r=new a.default(l);for(var o in r.setEventPriority(i.AWTEventPriority.High),r.setProperty("TenantId",n),e)e.hasOwnProperty(o)&&r.setProperty(o,e[o].toString());c.default.getLogger(u.StatsApiKey).logEvent(r)}})},e.setTransmitProfile=function(e){this._currentProfile!==e&&void 0!==this._profiles[e]&&(this.clearTimeout(),this._currentProfile=e,this.scheduleTimer())},e.loadTransmitProfiles=function(e){for(var t in this._resetTransmitProfiles(),e)if(e.hasOwnProperty(t)){if(3!==e[t].length)continue;for(var n=2;n>=0;--n)if(e[t][n]<0){for(var r=n;r>=0;--r)e[t][r]=-1;break}for(n=2;n>0;--n)if(e[t][n]>0&&e[t][n-1]>0){var i=e[t][n-1]/e[t][n];e[t][n-1]=Math.ceil(i)*e[t][n]}this._profiles[t]=e[t]}},e.sendEvent=function(e){this._newEventsAllowed&&(this._currentBackoffCount>0&&e.priority===i.AWTEventPriority.Immediate_sync&&(e.priority=i.AWTEventPriority.High),this._eventHandler.addEvent(e),this.scheduleTimer())},e.flush=function(e){var t=(new Date).getTime();!this._paused&&this._lastUploadNowCall+3e4<t&&(this._lastUploadNowCall=t,this._timeout>-1&&(clearTimeout(this._timeout),this._timeout=-1),this._eventHandler.uploadNow(e))},e.pauseTransmission=function(){this._paused||(this.clearTimeout(),this._eventHandler.pauseTransmission(),this._paused=!0)},e.resumeTransmision=function(){this._paused&&(this._paused=!1,this._eventHandler.resumeTransmission(),this.scheduleTimer())},e.flushAndTeardown=function(){s.default.teardown(),this._newEventsAllowed=!1,this.clearTimeout(),this._eventHandler.teardown()},e.backOffTransmission=function(){this._currentBackoffCount<4&&(this._currentBackoffCount++,this.clearTimeout(),this.scheduleTimer())},e.clearBackOff=function(){this._currentBackoffCount>0&&(this._currentBackoffCount=0,this.clearTimeout(),this.scheduleTimer())},e._resetTransmitProfiles=function(){this.clearTimeout(),this._initializeProfiles(),this._currentProfile=r.AWT_REAL_TIME,this.scheduleTimer()},e.clearTimeout=function(){this._timeout>0&&(clearTimeout(this._timeout),this._timeout=-1,this._timerCount=0)},e._batchAndSendEvents=function(){var e=i.AWTEventPriority.High;this._timerCount++,this._timerCount*this._profiles[this._currentProfile][2]===this._profiles[this._currentProfile][0]?(e=i.AWTEventPriority.Low,this._timerCount=0):this._timerCount*this._profiles[this._currentProfile][2]===this._profiles[this._currentProfile][1]&&(e=i.AWTEventPriority.Normal),this._eventHandler.sendEventsForPriorityAndAbove(e),this._timeout=-1,this.scheduleTimer()},e._initializeProfiles=function(){this._profiles={},this._profiles[r.AWT_REAL_TIME]=[4,2,1],this._profiles[r.AWT_NEAR_REAL_TIME]=[12,6,3],this._profiles[r.AWT_BEST_EFFORT]=[36,18,9]},e._newEventsAllowed=!1,e._currentProfile=r.AWT_REAL_TIME,e._timeout=-1,e._currentBackoffCount=0,e._paused=!1,e._timerCount=0,e._lastUploadNowCall=0,e}();t.default=d},9199:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.clockSkewRefreshDurationInMins=e,this._reset()}return e.prototype.allowRequestSending=function(){return this._isFirstRequest&&!this._clockSkewSet?(this._isFirstRequest=!1,this._allowRequestSending=!1,!0):this._allowRequestSending},e.prototype.shouldAddClockSkewHeaders=function(){return this._shouldAddClockSkewHeaders},e.prototype.getClockSkewHeaderValue=function(){return this._clockSkewHeaderValue},e.prototype.setClockSkew=function(e){this._clockSkewSet||(e?this._clockSkewHeaderValue=e:this._shouldAddClockSkewHeaders=!1,this._clockSkewSet=!0,this._allowRequestSending=!0)},e.prototype._reset=function(){var e=this;this._isFirstRequest=!0,this._clockSkewSet=!1,this._allowRequestSending=!0,this._shouldAddClockSkewHeaders=!0,this._clockSkewHeaderValue="use-collector-delta",this.clockSkewRefreshDurationInMins>0&&setTimeout(function(){return e._reset()},6e4*this.clockSkewRefreshDurationInMins)},e}();t.default=n},9229:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isReactNative=t.isNode=t.isBrowser=void 0,t.isBrowser=function(){return"undefined"!=typeof window&&void 0!==window.document},t.isNode=function(){return"undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node},t.isReactNative=function(){return"undefined"!=typeof navigator&&"ReactNative"==navigator.product},t.default={isBrowser:t.isBrowser,isNode:t.isNode,isReactNative:t.isReactNative}},9267:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(8217),i=function(){function e(){this._buffer=[]}return e.prototype._WriteByte=function(e){this._buffer.push(r.Number._ToByte(e))},e.prototype._Write=function(e,t,n){for(;n--;)this._WriteByte(e[t++])},e.prototype._GetBuffer=function(){return this._buffer},e}();t.MemoryStream=i},9278:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PollingMessagePrinter=void 0;var r=n(2698),i=n(3428),o=function(){function e(){}return e.printify=function(e){var t,n,o,s,a={};return e&&(a.id=e.id,a.tags=e&&(null===(t=e.metadata)||void 0===t?void 0:t.tags)?e.metadata.tags.replace(/"/g,"").split(",").filter(function(e){return e.length>0}):[],a.card=Object.values(r.SupportedAdaptiveCards).some(function(t){var n,r;return null===(r=null===(n=null==e?void 0:e.content)||void 0===n?void 0:n.message)||void 0===r?void 0:r.includes(t)}),a.bot=!(null===(n=a.tags)||void 0===n?void 0:n.find(function(e){return"public"===e})),!a.card&&(null===(o=null==e?void 0:e.content)||void 0===o?void 0:o.message)&&(a.content=(0,i.messageContentMetadata)(null===(s=e.content)||void 0===s?void 0:s.message)),a.created=e.createdOn),a},e}();t.PollingMessagePrinter=o},9291:e=>{e.exports=function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},e.exports.__esModule=!0,e.exports.default=e.exports},9293:e=>{function t(e,t,n,r,i,o,s){try{var a=e[o](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}e.exports=function(e){return function(){var n=this,r=arguments;return new Promise(function(i,o){var s=e.apply(n,r);function a(e){t(s,i,o,a,c,"next",e)}function c(e){t(s,i,o,a,c,"throw",e)}a(void 0)})}},e.exports.__esModule=!0,e.exports.default=e.exports},9305:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.IC3V1SDK=0,e.IC3V2SDK=1,e.MockIC3SDK=2,e}();t.default=n},9362:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(4746),s=n(4372),a=n(1136),c=n(6717),u=n(7767),l=n(7145),d=n(3364),h=n(3355),p=n(1659),f=n(8247),g=n(4665),m=n(3943),v=n(5719),y=n(2343),C=function(){function e(){this.debug=!1,this.current404RetryCount=0,this.currentOtherRetryCount=0,this.skipUnsubscribe=!1,this.telemetryMessage="",this.errorCode="",this.pollDataHandler=function(e){},this.resetRetryCount()}return e.prototype.setup=function(e){return r(this,void 0,void 0,function(){return i(this,function(t){return this.logger=e,[2]})})},e.prototype.getPoller=function(){var e=this.pollDataHandler.bind(this);return this.poller||(this.poller=new h.default(this.ic3Info,e,this.redirectErrorHandler.bind(this),this.onRequestCreationFailure.bind(this))),this.poller},e.prototype.setIc3Info=function(e){return r(this,void 0,void 0,function(){var t;return i(this,function(n){return t={RegionGtms:JSON.parse(JSON.stringify(e.RegionGtms)),SkypeToken:e.SkypeToken,visitor:e.visitor},this.ic3Info=t,[2]})})},e.prototype.initializeIC3=function(e){var t,n=this;return e&&(this.pollDataHandler=e),null===(t=this.logger)||void 0===t||t.log(p.default.INFO,f.default.IC3InitializationBegins,{Description:"Endpoint to poll is "+JSON.stringify(this.ic3Info.RegionGtms.chatService),EndpointUrl:this.ic3Info.RegionGtms.chatService,EndpointId:this.ic3Info.endpointId}),this.createEndpoint().then(function(){return n.createSubscription()}).then(function(){return n.setEndpointProperty()}).then(function(){return n.startPolling(e)}).then(function(){return n.resetRetryCount()}).then(function(){return Promise.resolve(n.ic3Info)}).catch(function(e){return n.redirectErrorHandler(e)})},e.prototype.startPolling=function(e){var t,n=!e&&this.pollDataHandler?this.pollDataHandler.bind(this):this.pollDataHandler;this.poller||(this.poller=new h.default(this.ic3Info,n,this.redirectErrorHandler.bind(this),this.onRequestCreationFailure.bind(this))),this.poller.ic3Info=this.ic3Info,null===(t=this.logger)||void 0===t||t.log(p.default.INFO,f.default.IC3StartedPolling,{EndpointUrl:this.ic3Info.RegionGtms.chatService,EndpointId:this.ic3Info.endpointId}),this.poller.start()},e.prototype.stopPolling=function(e){var t,n=e?o.default.oldInitializer:o.default.newInitializer;null===(t=this.logger)||void 0===t||t.log(p.default.INFO,f.default.IC3StoppedPolling,{Description:n+" stopped polling.",EndpointUrl:this.ic3Info.RegionGtms.chatService,EndpointId:this.ic3Info.endpointId}),this.poller&&this.poller.stop()},e.prototype.reset=function(e){return this.stopPolling(e),this.unsubscribeFromEndpoint()},e.prototype.resetRetryCount=function(){this.current404RetryCount=0,this.currentOtherRetryCount=0},e.prototype.onEndpointCreationFailure=function(e){this.onRequestCreationFailure(e,o.default.endpointRequestLog)},e.prototype.onEndpointCreationSuccess=function(e){var t,n,r=d.default.getResponseHeader(e,s.default.SetRegistrationTokenHeader);d.default.isNullOrUndefined(r)||(this.ic3Info.RegistrationToken=d.default.getRegistrationTokenValue(r));var i=d.default.getResponseHeader(e,s.default.LocationHeader);if(!d.default.isNullOrUndefined(i)){var o=i.match(/endpoints\/(%7B[\da-z\-]+%7D)/);this.ic3Info.endpointId=o&&o[1],null===(t=this.logger)||void 0===t||t.log(p.default.INFO,f.default.IC3EndpointCreationSuccess,{Description:"IC3 endpoint Id is "+this.ic3Info.endpointId,EndpointUrl:this.ic3Info.RegionGtms.chatService,EndpointId:this.ic3Info.endpointId}),e.status===g.default.Created&&m.default.parseChatServiceHostUrl(i)!==this.ic3Info.RegionGtms.chatService&&(this.ic3Info.RegionGtms.chatService=m.default.parseChatServiceHostUrl(i),null===(n=this.logger)||void 0===n||n.log(p.default.WARN,f.default.OnRequestCreationSuccessRedirect,{Description:"Endpoint changed",EndpointUrl:this.ic3Info.RegionGtms.chatService,EndpointId:this.ic3Info.endpointId}))}},e.prototype.createEndpointRequest=function(){var e=l.default.getV1EndpointUrl(this.ic3Info.RegionGtms),t=u.default.getDefaultIC3Headers();t[s.default.AuthenticationHeader]=s.default.SkypeTokenHeaderValue+this.ic3Info.SkypeToken,t[s.default.ContentTypeHeader]=o.default.ContentTypeJson;var n={endpointFeatures:[c.default.Agent,c.default.InviteFree,c.default.MessageProperties].join(",")},r={callbackOnFailure:this.onEndpointCreationFailure.bind(this),callbackOnSuccess:this.onEndpointCreationSuccess.bind(this),data:JSON.stringify(n),enableExponentialBackoff:!0,headers:t,redirect404RetryCount:o.default.retryCount,retryCount:o.default.retryCount,shouldRedirectOn404:!0,shouldResetOnFailure:!0,shouldRetryOnFailure:m.default.shouldRetryOnFailure,timeBetweenRetry:o.default.timeBetweenOperationRetry,type:y.default.POST,url:e};return v.HttpClient.MakeRequest(r)},e.prototype.createEndpoint=function(){var e=this;return this.createEndpointRequest().then(function(t){return t.subscriptions&&t.subscriptions.length>0&&(e.ic3Info.subscriptionId=t.subscriptions[0].id),t})},e.prototype.onSubscriptionCreationFailure=function(e){this.onRequestCreationFailure(e,o.default.subscriptionRequestLog)},e.prototype.onSubscriptionCreationSuccess=function(e){var t,n=d.default.getResponseHeader(e,s.default.LocationHeader)||"";e.status!==g.default.Created||d.default.isNullOrUndefined(n)||m.default.parseChatServiceHostUrl(n)===this.ic3Info.RegionGtms.chatService||(this.ic3Info.RegionGtms.chatService=m.default.parseChatServiceHostUrl(n),null===(t=this.logger)||void 0===t||t.log(p.default.WARN,f.default.OnRequestCreationSuccessRedirect,{Description:"Endpoint changed",EndpointUrl:this.ic3Info.RegionGtms.chatService,EndpointId:this.ic3Info.endpointId}));var r=n.match(/\/(\d+)$/);r&&(this.ic3Info.subscriptionId=r[1])},e.prototype.createSubscriptionRequest=function(){var e=l.default.getV1SubscriptionUrl(this.ic3Info.RegionGtms),t=u.default.getDefaultIC3Headers();t[s.default.RegistrationTokenHeader]=this.ic3Info.RegistrationToken,t[s.default.ContentTypeHeader]=o.default.ContentTypeJson;var n={channelType:o.default.HttpLongPoll,interestedResources:[a.default.ConversationMessages,a.default.ConversationProperties,a.default.Threads,a.default.Contacts]},r={callbackOnFailure:this.onSubscriptionCreationFailure.bind(this),callbackOnSuccess:this.onSubscriptionCreationSuccess.bind(this),data:JSON.stringify(n),enableExponentialBackoff:!0,headers:t,redirect404RetryCount:o.default.retryCount,retryCount:o.default.retryCount,shouldRedirectOn404:!0,shouldResetOnFailure:!0,shouldRetryOnFailure:m.default.shouldRetryOnFailure,timeBetweenRetry:o.default.timeBetweenOperationRetry,type:y.default.POST,url:e};return v.HttpClient.MakeRequest(r)},e.prototype.createSubscription=function(){return this.createSubscriptionRequest()},e.prototype.onSetEndpointPropertyCreationFailure=function(e){this.onRequestCreationFailure(e,o.default.setPropertiesRequestLog)},e.prototype.setEndpointProperty=function(){if(this.ic3Info.visitor)return Promise.resolve();var e=l.default.getV1SetPropertiesUrl(this.ic3Info.RegionGtms),t={};t[s.default.SetEndpointProperty]=!0;var n=u.default.getDefaultIC3Headers();n[s.default.AuthenticationHeader]=s.default.SkypeTokenHeaderValue+this.ic3Info.SkypeToken,n[s.default.RegistrationTokenHeader]=this.ic3Info.RegistrationToken,n[s.default.ContentTypeHeader]=o.default.ContentTypeJson;var r={callbackOnFailure:this.onSetEndpointPropertyCreationFailure.bind(this),data:JSON.stringify(t),enableExponentialBackoff:!0,headers:n,redirect404RetryCount:o.default.retryCount,retryCount:o.default.retryCount,shouldRedirectOn404:!0,shouldResetOnFailure:!0,shouldRetryOnFailure:m.default.shouldRetryOnFailure,timeBetweenRetry:o.default.timeBetweenOperationRetry,type:y.default.PUT,url:e};return v.HttpClient.MakeRequest(r)},e.prototype.onUnsubscribeCreationFailure=function(e){this.onRequestCreationFailure(e,o.default.unsubscribeRequestLog)},e.prototype.unsubscribeFromEndpoint=function(){if(this.ic3Info.visitor||d.default.isNullOrUndefined(this.ic3Info.endpointId)||this.skipUnsubscribe)return this.skipUnsubscribe=!0,Promise.resolve();var e=l.default.getV1DeleteEndpointUrl(this.ic3Info.RegionGtms,this.ic3Info.endpointId),t=u.default.getDefaultIC3Headers();t[s.default.AuthenticationHeader]=s.default.SkypeTokenHeaderValue+this.ic3Info.SkypeToken,t[s.default.RegistrationTokenHeader]=this.ic3Info.RegistrationToken,t[s.default.ContentTypeHeader]=o.default.ContentTypeJson;var n={callbackOnFailure:this.onUnsubscribeCreationFailure.bind(this),enableExponentialBackoff:!0,headers:t,redirect404RetryCount:o.default.retryCount,retryCount:o.default.retryCount,shouldRedirectOn404:!0,shouldResetOnFailure:!0,shouldRetryOnFailure:m.default.shouldRetryOnFailure,timeBetweenRetry:o.default.timeBetweenOperationRetry,type:y.default.DELETE,url:e};return v.HttpClient.MakeRequest(n)},e.prototype.onRequestCreationFailure=function(e,t){var n,r,i=d.default.getResponseHeader(e,s.default.LocationHeader);this.telemetryMessage=t+" failed. Error Code: "+e.status+".",this.errorCode=e.status.toString(),this.skipUnsubscribe=!0,e.status!==g.default.Redirect||d.default.isNullOrEmptyString(i)?(null===(r=this.logger)||void 0===r||r.log(p.default.WARN,f.default.ResetOnRequestCreationFailure,{Description:this.telemetryMessage+" Trying to reset.",ErrorCode:e.status.toString(),EndpointUrl:this.ic3Info.RegionGtms.chatService,EndpointId:this.ic3Info.endpointId}),this.current404RetryCount=0,this.currentOtherRetryCount++):(null===(n=this.logger)||void 0===n||n.log(p.default.WARN,f.default.RedirectOnRequestCreationFailure,{Description:this.telemetryMessage+" Trying to redirect.",ErrorCode:e.status.toString(),EndpointUrl:this.ic3Info.RegionGtms.chatService,EndpointId:this.ic3Info.endpointId}),this.onRequestCreationFailureRedirect(e))},e.prototype.redirectErrorHandler=function(e){var t,n=this;return e.message===o.default.Reset_Flag&&this.current404RetryCount<=o.default.retry404Count&&this.currentOtherRetryCount<=o.default.retryCount?this.reset().then(function(){return n.initializeIC3()}):(null===(t=this.logger)||void 0===t||t.log(p.default.ERROR,f.default.MaxRetryCountReachedForRedirect,{Description:"Fatal Error. Initialization failed. Maximum retry count reached. Exiting. "+this.telemetryMessage,ErrorCode:this.errorCode,ExceptionDetails:e,EndpointUrl:this.ic3Info.RegionGtms.chatService,EndpointId:this.ic3Info.endpointId}),this.reset().then(function(){return Promise.reject(e.message)}))},e.prototype.onRequestCreationFailureRedirect=function(e){var t;this.current404RetryCount++,this.currentOtherRetryCount=0,this.ic3Info.RegionGtms.chatService=m.default.parseChatServiceHostUrl(d.default.getResponseHeader(e,s.default.LocationHeader)),null===(t=this.logger)||void 0===t||t.log(p.default.WARN,f.default.OnRequestCreationFailureRedirect,{Description:"Endpoint changed.",EndpointUrl:this.ic3Info.RegionGtms.chatService,EndpointId:this.ic3Info.endpointId})},e}();t.default=C},9376:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.Bridged="bridged",e.Unbridged="unbridged",e}();t.default=n},9382:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i,o=n(1545),s=n(4736),a=n(9229),c=n(4938),u=n(1908),l=n(7030),d=n(4736),h=n(7137);!function(e){e.ReactNative="ReactNative"}(i||(i={}));var p={collectorUri:"https://browser.pipe.aria.microsoft.com/Collector/3.0/",cacheMemorySizeLimitInNumberOfEvents:1e4,disableCookiesUsage:!1,canSendStatEvent:function(e){return!0},clockSkewRefreshDurationInMins:0},f=function(){function e(){}return e.initialize=function(t,n){void 0===n&&(n=p),this._debug&&console.log("[AriaTelemetry][logger][initialize][custom]"),e._key=t,e._configuration=r(r(r({},p),n),{collectorUri:e._collectorUri}),e._logger=o.AWTLogManager.initialize(t,e._configuration)},e.setDebug=function(t){e._debug=t},e.disable=function(){this._debug&&console.log("[AriaTelemetry][disable]"),e._disable=!0},e.setCollectorUri=function(t){e._collectorUri=t,e._configuration=r(r(r({},p),e._configuration),{collectorUri:e._collectorUri})},e.setCDNPackages=function(t){e._CDNPackagesInfo=r(r({},e._CDNPackagesInfo),t)},e.info=function(t,n){var i;void 0===n&&(n=l.default.EVENTS);var o={name:l.default.EVENTS,properties:r(r(r(r(r({},e.populateBaseProperties()),e.fillWebPlatformData()),e.fillMobilePlatformData()),t),{LogLevel:u.default.INFO}),priority:c.AWTEventPriority.High};n==l.default.IC3CLIENT&&(o={name:l.default.IC3CLIENT,properties:r(r(r({},e.populateIC3ClientBaseProperties()),t),{LogLevel:u.default.INFO}),priority:c.AWTEventPriority.High}),n==l.default.OCSDK&&(o={name:l.default.OCSDK,properties:r(r(r({},e.populateOCSDKBaseProperties()),t),{LogLevel:u.default.INFO}),priority:c.AWTEventPriority.High}),n==l.default.ACSCLIENT&&(o={name:l.default.ACSCLIENT,properties:r(r(r({},e.populateACSClientBaseProperties()),t),{LogLevel:u.default.INFO}),priority:c.AWTEventPriority.High}),n==l.default.ACSADAPTER&&(o={name:l.default.ACSADAPTER,properties:r(r(r({},e.populateACSAdapterBaseProperties()),t),{LogLevel:u.default.INFO}),priority:c.AWTEventPriority.High}),n==l.default.CALLINGSDK&&(o={name:l.default.CALLINGSDK,properties:r(r(r({},e.populateCallingSDKBaseProperties()),t),{LogLevel:u.default.INFO}),priority:c.AWTEventPriority.High}),n==l.default.AMSCLIENT&&(o={name:l.default.AMSCLIENT,properties:r(r(r({},e.populateAMSClientBaseProperties()),t),{LogLevel:u.default.INFO}),priority:c.AWTEventPriority.High}),this._debug&&console.log("[AriaTelemetry][info] ".concat(n)),this._debug&&console.log(o),this._debug&&console.log(o.properties.Event),!e._disable&&(null===(i=e.logger)||void 0===i||i.logEvent(o))},e.debug=function(t,n){var i;void 0===n&&(n=l.default.EVENTS);var o={name:l.default.EVENTS,properties:r(r(r(r(r({},e.populateBaseProperties()),e.fillWebPlatformData()),e.fillMobilePlatformData()),t),{LogLevel:u.default.DEBUG}),priority:c.AWTEventPriority.High};n==l.default.IC3CLIENT&&(o={name:l.default.IC3CLIENT,properties:r(r(r({},e.populateIC3ClientBaseProperties()),t),{LogLevel:u.default.DEBUG}),priority:c.AWTEventPriority.High}),n==l.default.OCSDK&&(o={name:l.default.OCSDK,properties:r(r(r({},e.populateOCSDKBaseProperties()),t),{LogLevel:u.default.DEBUG}),priority:c.AWTEventPriority.High}),n==l.default.ACSCLIENT&&(o={name:l.default.ACSCLIENT,properties:r(r(r({},e.populateACSClientBaseProperties()),t),{LogLevel:u.default.DEBUG}),priority:c.AWTEventPriority.High}),n==l.default.ACSADAPTER&&(o={name:l.default.ACSADAPTER,properties:r(r(r({},e.populateACSAdapterBaseProperties()),t),{LogLevel:u.default.DEBUG}),priority:c.AWTEventPriority.High}),n==l.default.CALLINGSDK&&(o={name:l.default.CALLINGSDK,properties:r(r(r({},e.populateCallingSDKBaseProperties()),t),{LogLevel:u.default.DEBUG}),priority:c.AWTEventPriority.High}),n==l.default.AMSCLIENT&&(o={name:l.default.AMSCLIENT,properties:r(r(r({},e.populateAMSClientBaseProperties()),t),{LogLevel:u.default.DEBUG}),priority:c.AWTEventPriority.High}),this._debug&&console.log("[AriaTelemetry][debug] ".concat(n)),this._debug&&console.log(o),this._debug&&console.log(o.properties.Event),!e._disable&&(null===(i=e.logger)||void 0===i||i.logEvent(o))},e.warn=function(t,n){var i;void 0===n&&(n=l.default.EVENTS);var o={name:l.default.EVENTS,properties:r(r(r(r(r({},e.populateBaseProperties()),e.fillWebPlatformData()),e.fillMobilePlatformData()),t),{LogLevel:u.default.WARN}),priority:c.AWTEventPriority.High};n==l.default.IC3CLIENT&&(o={name:l.default.IC3CLIENT,properties:r(r(r({},e.populateIC3ClientBaseProperties()),t),{LogLevel:u.default.WARN}),priority:c.AWTEventPriority.High}),n==l.default.OCSDK&&(o={name:l.default.OCSDK,properties:r(r(r({},e.populateOCSDKBaseProperties()),t),{LogLevel:u.default.WARN}),priority:c.AWTEventPriority.High}),n==l.default.ACSCLIENT&&(o={name:l.default.ACSCLIENT,properties:r(r(r({},e.populateACSClientBaseProperties()),t),{LogLevel:u.default.WARN}),priority:c.AWTEventPriority.High}),n==l.default.ACSADAPTER&&(o={name:l.default.ACSADAPTER,properties:r(r(r({},e.populateACSAdapterBaseProperties()),t),{LogLevel:u.default.WARN}),priority:c.AWTEventPriority.High}),n==l.default.CALLINGSDK&&(o={name:l.default.CALLINGSDK,properties:r(r(r({},e.populateCallingSDKBaseProperties()),t),{LogLevel:u.default.WARN}),priority:c.AWTEventPriority.High}),n==l.default.AMSCLIENT&&(o={name:l.default.AMSCLIENT,properties:r(r(r({},e.populateAMSClientBaseProperties()),t),{LogLevel:u.default.WARN}),priority:c.AWTEventPriority.High}),this._debug&&console.log("[AriaTelemetry][warn] ".concat(n)),this._debug&&console.log(o),this._debug&&console.log(o.properties.Event),!e._disable&&(null===(i=e.logger)||void 0===i||i.logEvent(o))},e.error=function(t,n){var i;void 0===n&&(n=l.default.EVENTS);var o={name:l.default.EVENTS,properties:r(r(r(r(r({},e.populateBaseProperties()),e.fillWebPlatformData()),e.fillMobilePlatformData()),t),{LogLevel:u.default.ERROR}),priority:c.AWTEventPriority.High};n==l.default.IC3CLIENT&&(o={name:l.default.IC3CLIENT,properties:r(r(r({},e.populateIC3ClientBaseProperties()),t),{LogLevel:u.default.ERROR}),priority:c.AWTEventPriority.High}),n==l.default.OCSDK&&(o={name:l.default.OCSDK,properties:r(r(r({},e.populateOCSDKBaseProperties()),t),{LogLevel:u.default.ERROR}),priority:c.AWTEventPriority.High}),n==l.default.ACSCLIENT&&(o={name:l.default.ACSCLIENT,properties:r(r(r({},e.populateACSClientBaseProperties()),t),{LogLevel:u.default.ERROR}),priority:c.AWTEventPriority.High}),n==l.default.ACSADAPTER&&(o={name:l.default.ACSADAPTER,properties:r(r(r({},e.populateACSAdapterBaseProperties()),t),{LogLevel:u.default.ERROR}),priority:c.AWTEventPriority.High}),n==l.default.CALLINGSDK&&(o={name:l.default.CALLINGSDK,properties:r(r(r({},e.populateCallingSDKBaseProperties()),t),{LogLevel:u.default.ERROR}),priority:c.AWTEventPriority.High}),n==l.default.AMSCLIENT&&(o={name:l.default.AMSCLIENT,properties:r(r(r({},e.populateAMSClientBaseProperties()),t),{LogLevel:u.default.ERROR}),priority:c.AWTEventPriority.High}),this._debug&&console.log("[AriaTelemetry][error] ".concat(n)),this._debug&&console.log(o),this._debug&&console.log(o.properties.Event),!e._disable&&(null===(i=e.logger)||void 0===i||i.logEvent(o))},e.log=function(t,n){var i;void 0===n&&(n=l.default.EVENTS);var o={name:l.default.EVENTS,properties:r(r(r(r(r({},e.populateBaseProperties()),e.fillWebPlatformData()),e.fillMobilePlatformData()),t),{LogLevel:u.default.LOG}),priority:c.AWTEventPriority.High};n==l.default.IC3CLIENT&&(o={name:l.default.IC3CLIENT,properties:r(r(r({},e.populateIC3ClientBaseProperties()),t),{LogLevel:u.default.LOG}),priority:c.AWTEventPriority.High}),n==l.default.OCSDK&&(o={name:l.default.OCSDK,properties:r(r(r({},e.populateOCSDKBaseProperties()),t),{LogLevel:u.default.LOG}),priority:c.AWTEventPriority.High}),n==l.default.ACSCLIENT&&(o={name:l.default.ACSCLIENT,properties:r(r(r({},e.populateACSClientBaseProperties()),t),{LogLevel:u.default.LOG}),priority:c.AWTEventPriority.High}),n==l.default.ACSADAPTER&&(o={name:l.default.ACSADAPTER,properties:r(r(r({},e.populateACSAdapterBaseProperties()),t),{LogLevel:u.default.LOG}),priority:c.AWTEventPriority.High}),n==l.default.CALLINGSDK&&(o={name:l.default.CALLINGSDK,properties:r(r(r({},e.populateCallingSDKBaseProperties()),t),{LogLevel:u.default.LOG}),priority:c.AWTEventPriority.High}),n==l.default.AMSCLIENT&&(o={name:l.default.AMSCLIENT,properties:r(r(r({},e.populateAMSClientBaseProperties()),t),{LogLevel:u.default.LOG}),priority:c.AWTEventPriority.High}),this._debug&&console.log("[AriaTelemetry][log]"),this._debug&&console.log(o),this._debug&&console.log(o.properties.Event),!e._disable&&(null===(i=e.logger)||void 0===i||i.logEvent(o))},Object.defineProperty(e,"logger",{get:function(){return e._logger||(this._debug&&console.log("[AriaTelemetry][logger][initialize]"),e._logger=o.AWTLogManager.initialize(d.ariaTelemetryKey,e._configuration)),e._logger},enumerable:!1,configurable:!0}),e.populateBaseProperties=function(){var t={OCSDK:n(5119).rE,IC3Core:n(1278).rE,ACSChat:n(1533).rE,ACSCommon:n(4046).rE,AMSClient:n(2084).rE};return{ChatSDKRuntimeId:"",OrgId:"",OrgUrl:"",WidgetId:"",RequestId:"",ChatId:"",CallId:"",Domain:"",ExceptionDetails:"",ElapsedTimeInMilliseconds:"",ChatSDKVersion:n(6517).version,NPMPackagesInfo:JSON.stringify(t),CDNPackagesInfo:JSON.stringify(e._CDNPackagesInfo),PlatformDetails:""}},e.fillMobilePlatformData=function(){var e={},t={};if(!(0,a.isReactNative)())return e;try{var r=n(Object(function(){var e=new Error("Cannot find module 'react-native'");throw e.code="MODULE_NOT_FOUND",e}())).Platform;t.Renderer=i.ReactNative,e.DeviceInfo_OsVersion=r.Version,t.DeviceInfo_OsVersion=r.Version,"android"===r.OS.toLowerCase()?(e.DeviceInfo_OsName="Android",t.DeviceInfo_OsName="Android"):"ios"===r.OS.toLowerCase()?(e.DeviceInfo_OsName="iOS",t.DeviceInfo_OsName="iOS"):(e.DeviceInfo_OsName="".concat(r.OS),t.DeviceInfo_OsName="".concat(r.OS)),this._debug&&console.log("[AriaTelemetry][fillMobilePlatformData][".concat(e.DeviceInfo_OsName,"]"))}catch(e){this._debug&&console.log("[AriaTelemetry][fillMobilePlatformData][Web]")}return e.PlatformDetails=JSON.stringify(t),e},e.fillWebPlatformData=function(){var e={};if(!(0,a.isBrowser)())return e;try{e.Domain=window.location.origin||"",this._debug&&console.log("[AriaTelemetry][fillWebPlatformData]")}catch(e){this._debug&&console.log("[AriaTelemetry][fillWebPlatformData][Error]")}return e},e.populateIC3ClientBaseProperties=function(){return{ChatSDKRuntimeId:"",OrgId:"",OrgUrl:"",WidgetId:"",RequestId:"",ChatId:"",Event:"",Description:"",SubscriptionId:"",EndpointId:"",EndpointUrl:"",ErrorCode:"",ExceptionDetails:"",ElapsedTimeInMilliseconds:"",IC3ClientVersion:s.ic3ClientVersion}},e.populateOCSDKBaseProperties=function(){return{ChatSDKRuntimeId:"",OrgId:"",OrgUrl:"",WidgetId:"",RequestId:"",ChatId:"",TransactionId:"",Event:"",ExceptionDetails:"",ElapsedTimeInMilliseconds:"",HttpRequestResponseTime:"",RequestHeaders:"",RequestPayload:"",RequestPath:"",RequestMethod:"",ResponseStatusCode:"",OCSDKVersion:n(5119).rE}},e.populateACSClientBaseProperties=function(){return{ChatSDKRuntimeId:"",OrgId:"",OrgUrl:"",WidgetId:"",RequestId:"",ChatId:"",Event:"",ExceptionDetails:"",ElapsedTimeInMilliseconds:"",ACSChatVersion:n(1533).rE}},e.populateACSAdapterBaseProperties=function(){return{ChatSDKRuntimeId:"",OrgId:"",OrgUrl:"",WidgetId:"",RequestId:"",ChatId:"",Event:"",ExceptionDetails:"",ElapsedTimeInMilliseconds:"",ACSAdapterVersion:h.version}},e.populateCallingSDKBaseProperties=function(){return{ChatSDKRuntimeId:"",OrgId:"",OrgUrl:"",WidgetId:"",RequestId:"",ChatId:"",CallId:"",Event:"",Description:"",ExceptionDetails:"",ElapsedTimeInMilliseconds:""}},e.populateAMSClientBaseProperties=function(){return{ChatSDKRuntimeId:"",OrgId:"",OrgUrl:"",WidgetId:"",RequestId:"",ChatId:"",Event:"",ExceptionDetails:"",ElapsedTimeInMilliseconds:"",AMSClientVersion:n(2084).rE}},e._debug=!1,e._disable=!1,e._key=d.ariaTelemetryKey,e._collectorUri=p.collectorUri,e._configuration={},e}();t.default=f},9445:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},o=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.sleep=t.removeElementById=t.loadScript=void 0;var s=n(3511);t.sleep=s.default;var a=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return r(void 0,o([e],t,!0),void 0,function(e,t,n,o,c){return void 0===t&&(t=function(){}),void 0===n&&(n=function(){}),void 0===o&&(o=3),void 0===c&&(c=0),i(this,function(u){return[2,new Promise(function(u,l){return r(void 0,void 0,void 0,function(){var d,h,p;return i(this,function(f){switch(f.label){case 0:return d=Array.from(document.getElementsByTagName("script")),h=d.filter(function(t){return t.src==e}),h.length?[4,t()]:[3,2];case 1:return f.sent(),[2,u()];case 2:return(p=document.createElement("script")).setAttribute("src",e),p.setAttribute("type","text/javascript"),document.head.appendChild(p),p.addEventListener("load",function(){return r(void 0,void 0,void 0,function(){return i(this,function(e){switch(e.label){case 0:return[4,t()];case 1:return e.sent(),u(),[2]}})})}),p.addEventListener("error",function(){return r(void 0,void 0,void 0,function(){var r,u;return i(this,function(i){switch(i.label){case 0:return++c>=o?[4,n()]:[3,2];case 1:return i.sent(),[2,l(new Error("Resource failed to load, or can't be used."))];case 2:return p.remove(),r=1e3*Math.min(Math.pow(2,c)+Math.random(),60),[4,(0,s.default)(r)];case 3:i.sent(),i.label=4;case 4:return i.trys.push([4,6,,7]),[4,a(e,t,n,o,c)];case 5:return i.sent(),[3,7];case 6:return u=i.sent(),l(u),[3,7];case 7:return[2]}})})}),[2]}})})})]})})};t.loadScript=a;var c=function(e){var t;null===(t=document.getElementById(e))||void 0===t||t.remove()};t.removeElementById=c,t.default={loadScript:a,removeElementById:c,sleep:s.default}},9714:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isReactNative=t.isNode=t.isBrowser=void 0,t.isBrowser=function(){return"undefined"!=typeof window&&void 0!==window.document},t.isNode=function(){return"undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node},t.isReactNative=function(){return"undefined"!=typeof navigator&&"ReactNative"==navigator.product},t.default={isBrowser:t.isBrowser,isNode:t.isNode,isReactNative:t.isReactNative}},9759:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7723),i=n(8906),o=n(1039);t.default=r.default,function(){if(void 0===typeof window)throw new Error("window object not found");"Microsoft"in window||(window.Microsoft={}),"CRM"in window.Microsoft||(window.Microsoft.CRM={}),"Omnichannel"in window.Microsoft.CRM||(window.Microsoft.CRM.Omnichannel={}),"AMSClient"in window.Microsoft.CRM.Omnichannel||(window.Microsoft.CRM.Omnichannel.AMS={SDK:{createAMSClient:r.default,FramedClient:o.default,FramedlessClient:i.default}})}()},9812:function(e,t){"use strict";var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.AMSError=void 0;var i=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.name="AMSError",i.requestUrl=n,i.originalError=r,i}return r(t,e),t}(Error);t.AMSError=i},9839:(e,t,n)=>{"use strict";var r=n(4994);Object.defineProperty(t,"__esModule",{value:!0}),t.Timer=void 0;var i=r(n(7383)),o=r(n(4579)),s=function(){function e(){(0,i.default)(this,e)}return(0,o.default)(e,null,[{key:"TIMER",value:function(){var e=(new Date).getTime();return{get milliSecondsElapsed(){return(new Date).getTime()-e}}}}]),e}();t.Timer=s},9941:(e,t,n)=>{"use strict";n.d(t,{r:()=>s,w:()=>o});var r=n(7084);const i=(e,t)=>{const n=Object.keys(e)[0],r=e[n];if(t in r)return r[t];throw new Error(`Property ${t} is required for identifier of type ${n}.`)},o=e=>{var t,n,i,o,s,a;const c=(0,r.QW)(e);switch(c.kind){case"communicationUser":return{rawId:(0,r.Zp)(c),communicationUser:{id:c.communicationUserId}};case"phoneNumber":return{rawId:null!==(t=c.rawId)&&void 0!==t?t:(0,r.Zp)(c),phoneNumber:{value:c.phoneNumber}};case"microsoftTeamsUser":return{rawId:null!==(n=c.rawId)&&void 0!==n?n:(0,r.Zp)(c),microsoftTeamsUser:{userId:c.microsoftTeamsUserId,isAnonymous:null!==(i=c.isAnonymous)&&void 0!==i&&i,cloud:null!==(o=c.cloud)&&void 0!==o?o:"public"}};case"microsoftTeamsApp":return{rawId:null!==(s=c.rawId)&&void 0!==s?s:(0,r.Zp)(c),microsoftTeamsApp:{appId:c.teamsAppId,cloud:null!==(a=c.cloud)&&void 0!==a?a:"public"}};case"unknown":return{rawId:c.id};default:throw new Error(`Can't serialize an identifier with kind ${c.kind}`)}},s=e=>{var t;(e=>{const t=[];if(void 0!==e.communicationUser&&t.push("communicationUser"),void 0!==e.microsoftTeamsUser&&t.push("microsoftTeamsUser"),void 0!==e.microsoftTeamsApp&&t.push("microsoftTeamsApp"),void 0!==e.phoneNumber&&t.push("phoneNumber"),t.length>1)throw new Error(`Only one of the properties in ${JSON.stringify(t)} should be present.`)})(e);const{communicationUser:n,microsoftTeamsUser:r,microsoftTeamsApp:o,phoneNumber:s}=e,a=null!==(t=e.kind)&&void 0!==t?t:(e=>e.communicationUser?"communicationUser":e.phoneNumber?"phoneNumber":e.microsoftTeamsUser?"microsoftTeamsUser":e.microsoftTeamsApp?"microsoftTeamsApp":"unknown")(e);return"communicationUser"===a&&n?{kind:"communicationUser",communicationUserId:i({communicationUser:n},"id")}:"phoneNumber"===a&&s?{kind:"phoneNumber",phoneNumber:i({phoneNumber:s},"value"),rawId:i({phoneNumber:e},"rawId")}:"microsoftTeamsUser"===a&&r?{kind:"microsoftTeamsUser",microsoftTeamsUserId:i({microsoftTeamsUser:r},"userId"),isAnonymous:i({microsoftTeamsUser:r},"isAnonymous"),cloud:i({microsoftTeamsUser:r},"cloud"),rawId:i({microsoftTeamsUser:e},"rawId")}:"microsoftTeamsApp"===a&&o?{kind:"microsoftTeamsApp",teamsAppId:i({microsoftTeamsApp:o},"appId"),cloud:i({microsoftTeamsApp:o},"cloud"),rawId:i({microsoftTeamsApp:e},"rawId")}:{kind:"unknown",id:i({unknown:e},"rawId")}}},9956:function(e,t,n){e.exports=n(9021).enc.Hex},9974:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e._IsDataViewSupport=function(){return"undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},e}();t.BrowserChecker=n}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={exports:{}};return e[r].call(o.exports,o,o.exports,n),o.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};const r=n(2902);let i=null;if("function"==typeof r)i=r;else if("function"==typeof r.default)i=r.default;else if(r.default&&"function"==typeof r.default.default)i=r.default.default;else if(r.default&&"function"==typeof r.default.OmnichannelChatSDK)i=r.default.OmnichannelChatSDK;else if(r.default)for(const e in r.default)if("function"==typeof r.default[e]&&r.default[e].prototype){i=r.default[e],console.log("Found SDK at SDKModule.default."+e);break}"function"==typeof i?(window.OmnichannelChatSDK=i,console.log("SDK successfully attached to window.OmnichannelChatSDK")):(console.error("Could not find SDK constructor!"),console.log("SDKModule:",r),console.log("SDKModule.default:",r.default),window.OmnichannelChatSDK=r)})();